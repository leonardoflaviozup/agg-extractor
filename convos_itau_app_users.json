{"cooldowns":[{"cooldown_group_id":"4","cooldown_group_name":"insights","created_by":null,"created_at":"2020-11-27T18:19:54.612Z","cooldown":12,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":12,"cooldownQueued":0},{"cooldown_group_id":"5","cooldown_group_name":"afternoon_insight","created_by":null,"created_at":"2020-11-27T18:19:54.612Z","cooldown":12,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":12,"cooldownQueued":0},{"cooldown_group_id":"16","cooldown_group_name":"loyalty_program","created_by":null,"created_at":"2020-11-27T18:19:54.612Z","cooldown":24,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":12,"cooldownQueued":0},{"cooldown_group_id":"2","cooldown_group_name":"meliuz","created_by":null,"created_at":"2020-11-27T18:19:54.612Z","cooldown":20,"cooldownDelayed":21,"cooldownEngaged":22,"cooldownFrustrated":23,"cooldownInteracted":24,"cooldownDismissed":25,"cooldownThumbsDown":26,"notificationCooldown":20,"cooldownQueued":0},{"cooldown_group_id":"7","cooldown_group_name":"promo_three_days","created_by":null,"created_at":"2020-11-27T18:19:54.612Z","cooldown":60,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":60,"cooldownQueued":0},{"cooldown_group_id":"8","cooldown_group_name":"travel_three_days","created_by":null,"created_at":"2020-11-27T18:19:54.612Z","cooldown":60,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":60,"cooldownQueued":0},{"cooldown_group_id":"1","cooldown_group_name":"uber","created_by":"bruno@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":10,"cooldownDelayed":11,"cooldownEngaged":12,"cooldownFrustrated":13,"cooldownInteracted":14,"cooldownDismissed":15,"cooldownThumbsDown":16,"notificationCooldown":17,"cooldownQueued":0},{"cooldown_group_id":"10","cooldown_group_name":"tesco","created_by":"christy@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":72,"cooldownQueued":0},{"cooldown_group_id":"14","cooldown_group_name":"aldi","created_by":"christy@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":72,"cooldownQueued":0},{"cooldown_group_id":"13","cooldown_group_name":"dunnes","created_by":"christy@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":72,"cooldownQueued":0},{"cooldown_group_id":"15","cooldown_group_name":"lidl","created_by":"christy@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":72,"cooldownQueued":0},{"cooldown_group_id":"12","cooldown_group_name":"spar","created_by":"christy@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":72,"cooldownQueued":0},{"cooldown_group_id":"11","cooldown_group_name":"super_valu","created_by":"christy@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":72,"cooldownQueued":0},{"cooldown_group_id":"20","cooldown_group_name":"covid-19","created_by":"luciana@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":12,"cooldownDelayed":0,"cooldownEngaged":72,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":12,"cooldownQueued":0},{"cooldown_group_id":"9","cooldown_group_name":"default","created_by":"filipe@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":12,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":12,"cooldownQueued":0},{"cooldown_group_id":"24","cooldown_group_name":"shopping_best_practices","created_by":"ivanir@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":12,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":12,"cooldownQueued":0},{"cooldown_group_id":"6","cooldown_group_name":"insight_three_days","created_by":"ericsen@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":60,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":96,"cooldownQueued":0},{"cooldown_group_id":"25","cooldown_group_name":"shopping_games","created_by":"ivanir@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":12,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":12,"cooldownQueued":0},{"cooldown_group_id":"26","cooldown_group_name":"discovery","created_by":"gustavo@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":720,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":0,"cooldownQueued":0},{"cooldown_group_id":"27","cooldown_group_name":"bv_educ_financeira","created_by":"ericsen@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":168,"cooldownDelayed":72,"cooldownEngaged":168,"cooldownFrustrated":168,"cooldownInteracted":168,"cooldownDismissed":360,"cooldownThumbsDown":360,"notificationCooldown":168,"cooldownQueued":0},{"cooldown_group_id":"33","cooldown_group_name":"tax_aditional_voluntary_contribution","created_by":"mayara@olivia.ai","created_at":"2020-12-15T18:15:49.593Z","cooldown":1440,"cooldownDelayed":0,"cooldownEngaged":2880,"cooldownFrustrated":0,"cooldownInteracted":1440,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":0,"cooldownQueued":0},{"cooldown_group_id":"2147483647","cooldown_group_name":"gas_station","created_by":"leonardo-flavio.santos@mailer.com.br","created_at":"2022-08-23T14:23:54.414Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":168,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":0,"cooldownQueued":0},{"cooldown_group_id":"44","cooldown_group_name":"tink_comparison","created_by":"thiago@olivia.ai","created_at":"2021-04-28T20:57:30.565Z","cooldown":0,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":0,"cooldownQueued":16},{"cooldown_group_id":"46","cooldown_group_name":"income_spent_on_bills","created_by":"ivanir@olivia.ai","created_at":"2021-07-08T16:41:40.785Z","cooldown":0,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":0,"cooldownQueued":0},{"cooldown_group_id":"21","cooldown_group_name":"pet_savings","created_by":"frank.carvalho@mailer.com.br","created_at":"2022-09-27T19:44:20.165Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":168,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":0,"cooldownQueued":0},{"cooldown_group_id":"49","cooldown_group_name":"you_just_got_paid","created_by":"leal@olivia.ai","created_at":"2021-12-28T20:53:14.602Z","cooldown":72,"cooldownDelayed":72,"cooldownEngaged":72,"cooldownFrustrated":72,"cooldownInteracted":72,"cooldownDismissed":72,"cooldownThumbsDown":99999,"notificationCooldown":48,"cooldownQueued":0},{"cooldown_group_id":"38","cooldown_group_name":"fruta_imperfeita","created_by":"gustavo@olivia.ai","created_at":"2021-04-07T21:30:12.525Z","cooldown":4320,"cooldownDelayed":8760,"cooldownEngaged":8760,"cooldownFrustrated":99999,"cooldownInteracted":8760,"cooldownDismissed":99999,"cooldownThumbsDown":99999,"notificationCooldown":4320,"cooldownQueued":0},{"cooldown_group_id":"37","cooldown_group_name":"mobile_phone_offers","created_by":"gustavo@olivia.ai","created_at":"2021-04-01T18:17:12.763Z","cooldown":720,"cooldownDelayed":4300,"cooldownEngaged":8760,"cooldownFrustrated":8760,"cooldownInteracted":720,"cooldownDismissed":4300,"cooldownThumbsDown":99999,"notificationCooldown":720,"cooldownQueued":0},{"cooldown_group_id":"35","cooldown_group_name":"proposes_challenge","created_by":"thiago@olivia.ai","created_at":"2021-04-01T18:17:12.763Z","cooldown":0,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":0,"cooldownQueued":0},{"cooldown_group_id":"47","cooldown_group_name":"itau_self_comparison_expenses","created_by":"leal@olivia.ai","created_at":"2021-09-30T17:16:51.471Z","cooldown":720,"cooldownDelayed":48,"cooldownEngaged":720,"cooldownFrustrated":720,"cooldownInteracted":720,"cooldownDismissed":1440,"cooldownThumbsDown":99999,"notificationCooldown":0,"cooldownQueued":720},{"cooldown_group_id":"36","cooldown_group_name":"weekly_updates","created_by":"thiago@olivia.ai","created_at":"2021-04-01T18:17:12.763Z","cooldown":0,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":72,"cooldownThumbsDown":0,"notificationCooldown":72,"cooldownQueued":72},{"cooldown_group_id":"48","cooldown_group_name":"itau_x_ray_inicial","created_by":"leal@olivia.ai","created_at":"2021-11-08T20:55:44.996Z","cooldown":999999,"cooldownDelayed":999999,"cooldownEngaged":999999,"cooldownFrustrated":999999,"cooldownInteracted":999999,"cooldownDismissed":999999,"cooldownThumbsDown":999999,"notificationCooldown":0,"cooldownQueued":0},{"cooldown_group_id":"50","cooldown_group_name":"best_credit_card_due_date","created_by":"leal@olivia.ai","created_at":"2022-01-05T18:03:50.244Z","cooldown":0,"cooldownDelayed":168,"cooldownEngaged":99999,"cooldownFrustrated":99999,"cooldownInteracted":168,"cooldownDismissed":2880,"cooldownThumbsDown":99999,"notificationCooldown":48,"cooldownQueued":72},{"cooldown_group_id":"39","cooldown_group_name":"act_stay_and_spend_covid19","created_by":"ivanir@olivia.ai","created_at":"2021-04-22T12:42:22.973Z","cooldown":2160,"cooldownDelayed":2160,"cooldownEngaged":99999,"cooldownFrustrated":99999,"cooldownInteracted":2160,"cooldownDismissed":2160,"cooldownThumbsDown":99999,"notificationCooldown":2160,"cooldownQueued":0},{"cooldown_group_id":"40","cooldown_group_name":"act_phone_tv_broadband_switching","created_by":"ivanir@olivia.ai","created_at":"2021-04-22T12:42:22.973Z","cooldown":720,"cooldownDelayed":4300,"cooldownEngaged":8760,"cooldownFrustrated":8760,"cooldownInteracted":720,"cooldownDismissed":4300,"cooldownThumbsDown":99999,"notificationCooldown":720,"cooldownQueued":0},{"cooldown_group_id":"41","cooldown_group_name":"reduza","created_by":"gustavo@olivia.ai","created_at":"2021-04-28T20:57:30.565Z","cooldown":2880,"cooldownDelayed":2880,"cooldownEngaged":2880,"cooldownFrustrated":8640,"cooldownInteracted":2880,"cooldownDismissed":8640,"cooldownThumbsDown":99999,"notificationCooldown":0,"cooldownQueued":0},{"cooldown_group_id":"42","cooldown_group_name":"full_period_comparison","created_by":"thiago@olivia.ai","created_at":"2021-04-28T20:57:30.565Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":168,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":0,"cooldownQueued":168},{"cooldown_group_id":"43","cooldown_group_name":"half_period_comparison","created_by":"thiago@olivia.ai","created_at":"2021-04-28T20:57:30.565Z","cooldown":168,"cooldownDelayed":0,"cooldownEngaged":168,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":0,"cooldownQueued":168},{"cooldown_group_id":"45","cooldown_group_name":"regular_users_expectation","created_by":"leal@olivia.ai","created_at":"2021-05-17T15:50:47.432Z","cooldown":4380,"cooldownDelayed":4380,"cooldownEngaged":4380,"cooldownFrustrated":4380,"cooldownInteracted":4380,"cooldownDismissed":4380,"cooldownThumbsDown":4380,"notificationCooldown":4380,"cooldownQueued":4380},{"cooldown_group_id":"29","cooldown_group_name":"bv_wishlist","created_by":"luciana@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":4320,"cooldownDelayed":720,"cooldownEngaged":4320,"cooldownFrustrated":99999,"cooldownInteracted":4320,"cooldownDismissed":4320,"cooldownThumbsDown":99999,"notificationCooldown":720,"cooldownQueued":0},{"cooldown_group_id":"30","cooldown_group_name":"act_enercred_intro","created_by":"marcio@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":2160,"cooldownDelayed":720,"cooldownEngaged":99999,"cooldownFrustrated":99999,"cooldownInteracted":2160,"cooldownDismissed":99999,"cooldownThumbsDown":99999,"notificationCooldown":720,"cooldownQueued":0},{"cooldown_group_id":"28","cooldown_group_name":"il_smart_invest","created_by":"ivanir@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":720,"cooldownDelayed":720,"cooldownEngaged":99999,"cooldownFrustrated":99999,"cooldownInteracted":99999,"cooldownDismissed":99999,"cooldownThumbsDown":99999,"notificationCooldown":720,"cooldownQueued":0},{"cooldown_group_id":"32","cooldown_group_name":"x_ray","created_by":"ivanir@olivia.ai","created_at":"2020-12-11T12:58:04.396Z","cooldown":24,"cooldownDelayed":168,"cooldownEngaged":99999,"cooldownFrustrated":99999,"cooldownInteracted":24,"cooldownDismissed":99999,"cooldownThumbsDown":99999,"notificationCooldown":24,"cooldownQueued":0},{"cooldown_group_id":"34","cooldown_group_name":"connect_account_1acc","created_by":"mayara@olivia.ai","created_at":"2021-01-07T20:06:39.710Z","cooldown":720,"cooldownDelayed":720,"cooldownEngaged":720,"cooldownFrustrated":8760,"cooldownInteracted":720,"cooldownDismissed":8760,"cooldownThumbsDown":8760,"notificationCooldown":720,"cooldownQueued":0},{"cooldown_group_id":"23","cooldown_group_name":"act_banking_service_packages","created_by":"ivanir@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":12,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":12,"cooldownQueued":0},{"cooldown_group_id":"31","cooldown_group_name":"ops_il_adviser","created_by":"marcio@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":4320,"cooldownDelayed":4320,"cooldownEngaged":4320,"cooldownFrustrated":4320,"cooldownInteracted":4320,"cooldownDismissed":4320,"cooldownThumbsDown":99999,"notificationCooldown":4320,"cooldownQueued":0},{"cooldown_group_id":"22","cooldown_group_name":"act_best_wine","created_by":"ivanir@olivia.ai","created_at":"2020-11-27T18:19:54.612Z","cooldown":12,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":99999,"cooldownInteracted":0,"cooldownDismissed":99999,"cooldownThumbsDown":99999,"notificationCooldown":12,"cooldownQueued":0},{"cooldown_group_id":"3","cooldown_group_name":"cyclical_updates","created_by":null,"created_at":"2020-11-27T18:19:54.612Z","cooldown":24,"cooldownDelayed":0,"cooldownEngaged":0,"cooldownFrustrated":0,"cooldownInteracted":0,"cooldownDismissed":0,"cooldownThumbsDown":0,"notificationCooldown":24,"cooldownQueued":24}],"promotions":[{"promotion_id":"213569","name":"alert_you_got_paid_spender","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"<b>💁🙋🕵🧙🏃🤸💎🤜🤛👏🙌💪👇👉✨🤩😊🧐🤑🤓🤔🤗😎😏😃😅😉😟😌⏳👀👁📝📊🔍🔎📌💸💵🏦💰📆💨📋🔼🔽📈🚨⚠🔮🎉⏰🐕🐈🐶🐱⛽🚘🚀🔔📳🌟🧠🚰</b>\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Teste emojis\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"<b>💁🙋🕵🧙🏃🤸💎🤜🤛👏🙌💪👇👉✨🤩😊🧐🤑🤓🤔🤗😎😏😃😅😉😟😌⏳👀👁📝📊🔍🔎📌💸💵🏦💰📆💨📋🔼🔽📈🚨⚠🔮🎉⏰🐕🐈🐶🐱⛽🚘🚀🔔📳🌟🧠🚰</b>","content_link":"","notification":"Trago boas notícias! 😃 Entrou um crédito na sua conta. Vem ver! 👀 ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"Teste emojis","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","call_to_action_body":"","featured_value_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_1_feedback":"","user_option_1_response":"","user_option_2_feedback":"","user_option_2_response":"","user_option_3_feedback":"","user_option_3_response":"","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"","user_option_engaged_feedback":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-20T14:18:17.614Z","end_date":"2051-06-08T12:51:29.850Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2021-06-08T12:53:37.983Z","updated_by":"mauricio@olivia.ai","version":12,"profile_group_id":14,"previous_version":11,"convo_header":{"type":"alert","feed_cta":"Veja aqui","feed_body":"Teste emojis","categories":"150000","feed_emoji":"","feed_subtitle":"quanto recebi","user_easiness":"high","feed_read_time":"","review_settings":{"type":"simple"},"expected_savings":"low","right_assumption":"high","time_sensitivity":"low","tags":["got paid"]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"666","etl_aggregation_name":"Total Spending and Income - Last 06 months","rvar_object":"total_spending_and_income","rvar_variable":"totals","rule":{"code":"  const _ = require('lodash');\n  const moment = require('moment');\n\n  const restrict_spending_categories = [\n    10000,\n    20000,\n    30000,\n    40000,\n    50000,\n    60000,\n    70000,\n    80000,\n    90000,\n    10000014,\n    110000,\n    115000,\n    120000,\n    130000,\n  ];\n\n  const week_days_comparison_restrict_spending_categories = [\n    20000,\n    30000,\n    50000,\n    60000,\n    70000,\n    90000,\n    10000014,\n    110000,\n    115000,\n    120000,\n    130000,\n  ];\n\n  const start_1mo_closed = moment().subtract(1, 'month').startOf('month').valueOf();\n  const end_1mo_closed = moment().subtract(1, 'month').endOf('month').valueOf();\n  const start_3mo_closed = moment().subtract(3, 'month').startOf('month').valueOf();\n  const end_3mo_closed = moment().subtract(1, 'month').endOf('month').valueOf();\n  const start_6mo_closed = moment().subtract(6, 'month').startOf('month').valueOf();\n  const end_6mo_closed = moment().subtract(1, 'month').endOf('month').valueOf();\n  const start_this_month = moment().startOf('month').valueOf();\n  const oneMonthsAgo = moment().subtract(1, 'month').startOf('day').add(1, 'day').valueOf();\n  const threeMonthsAgo = moment().subtract(3, 'month').add(1, 'day').startOf('day').valueOf();\n  const sixMonthsAgo = moment().subtract(6, 'month').add(1, 'day').startOf('day').valueOf();\n\n  const start_year = moment('2021-01-01').valueOf();\n  const end_year = moment('2021-12-31').valueOf();\n  const this_moment = moment().utc().valueOf();\n  let spending = [];\n  let income = [];\n  let savings = [];\n\n  if (transactions && transactions.length) {\n    spending = transactions.filter(t => t.date.getTime() >= start_year &&\n      t.enabled && (t.budget_type === 'variable' || t.budget_type === 'fixed') && t.cashflow === true && t.cashflow_type === 'out');\n    income = transactions.filter(t => t.date.getTime() >= start_year && t.enabled && t.cashflow === true && t.cashflow_type === 'in');\n\n    savings = transactions.filter(t => t.date.getTime() >= start_year && t.enabled && t.cashflow === true && t.cashflow_type === 'nil' && [260000].includes(t.olivia_category_level1_id));\n  }\n\n  let date_last_income_transaction;\n  let date_last_spending_transaction;\n\n  let spending_12m = 0;\n  let spending_by_category_weekdays_12m = 0;\n  let spending_by_category_weekends_12m = 0;\n  let spending_06m = 0;\n  let spending_03m = 0;\n  let spending_01m = 0;\n  let spending_this_month = 0;\n  let savings_03m = 0;\n  let savings_unpaired_transactions_03m = 0;\n  let savings_investments_accounts_03m = 0;\n  let vendors_03m = null;\n  let vendors_12m = null;\n  let categories_01m = null;\n  let categories_03m = null;\n  let categories_12m = null;\n  let categories_this_month = null;\n  let variable_categories_this_month = null;\n  let transactions_03m = 0;\n  let spending_transactions_12m = 0;\n  let spending_transactions_credit_card_12m = 0;\n  let spending_list_credit_card_12m = [];\n  let income_transactions_12m = 0;\n  let food_and_drink_03m = 0;\n  let groceries_03m = 0;\n  let spending_01m_closed = 0;\n  let spending_03m_closed = 0;\n  let fixed_spending_01m = 0;\n  let variable_spending_01m = 0;\n  let fixed_spending_03m_closed = 0;\n  let variable_spending_03m_closed = 0;\n  let fixed_spending_06m_closed = 0;\n  let variable_spending_06m_closed = 0;\n  let fixed_spending_this_month = 0;\n  let variable_spending_this_month = 0;\n  let vendors_list_03m = [];\n  let vendors_list_12m = [];\n  let top_03_vendors_list_03m = [];\n  let top_03_vendors_list_12m = [];\n  let categories_list_this_month = [];\n  let top_03_categories_list_this_month = [];\n  let variable_categories_list_this_month = [];\n  let top_03_variable_categories_list_this_month = [];\n  let categories_list_01m = [];\n  let top_03_categories_list_01m = [];\n  let categories_list_03m = [];\n  let top_03_categories_list_03m = [];\n  let categories_list_12m = [];\n  let top_03_categories_list_12m = [];\n  let spending_credit_card_by_month = {};\n  let month_with_more_credit_card_transactions = '01';\n  let max_credit_card_transactions = 0;\n  let spending_by_category_weekend_list_12m = [];\n  let spending_by_category_weekdays_list_12m = [];\n  let top_03_spending_by_category_weekdays_12m = [];\n  let top_03_spending_by_category_weekend_12m = [];\n  let most_expensive_transaction_01m_closed = null;\n  let most_expensive_transaction_03m = null;\n\n  if (savings && savings.length) {\n    savings_unpaired_transactions_03m = -_.sumBy(savings.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && !t.paired_transaction_id), 'amount').toFixed(2);\n    savings_investments_accounts_03m = -_.sumBy(savings.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && [101, 103, 104, 105, 106].includes(t.account_type_id) && (t.account_type_id != 106 || !t.paired_transaction_id)), 'amount').toFixed(2);\n    savings_03m = savings_unpaired_transactions_03m - savings_investments_accounts_03m;\n  }\n\n  if (spending && spending.length) {\n    date_last_spending_transaction = moment(_.minBy(spending, 'date').date).format('YYYY-MM-DD');\n    spending_06m = -_.sumBy(spending.filter(t => t.date.getTime() >= sixMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    spending_12m = -_.sumBy(spending.filter(t => t.date.getTime() <= end_year), 'amount').toFixed(2);\n    spending_transactions_12m = _.size(spending.filter(t => t.date.getTime() <= end_year));\n\n    spending_by_category_weekdays_12m = _.groupBy(spending.filter(t => (moment(t.date).utc().day() != 0 && moment(t.date).utc().day() != 6) && t.date.getTime() <= end_year && week_days_comparison_restrict_spending_categories.includes(t.olivia_category_level1_id)), 'olivia_category_level1_id');;\n    if (spending_by_category_weekdays_12m) {\n      for (const category of Object.keys(spending_by_category_weekdays_12m)) {\n        const value = -spending_by_category_weekdays_12m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n        const transactions = _.size(spending_by_category_weekdays_12m[category]);\n        const percentual = parseFloat((value / spending_12m).toFixed(2));\n        spending_by_category_weekdays_list_12m.push({ category, value, transactions, percentual });\n      }\n    }\n    if (spending_by_category_weekdays_list_12m && spending_by_category_weekdays_list_12m.length) {\n      spending_by_category_weekdays_list_12m.sort((a, b) => b.value - a.value);\n      top_03_spending_by_category_weekdays_12m = spending_by_category_weekdays_list_12m.splice(0, 3);\n    }\n\n    spending_by_category_weekends_12m = _.groupBy(spending.filter(t => (moment(t.date).utc().day() == 0 || moment(t.date).utc().day() == 6) && t.date.getTime() <= end_year && week_days_comparison_restrict_spending_categories.includes(t.olivia_category_level1_id)), 'olivia_category_level1_id');;\n    if (spending_by_category_weekends_12m) {\n      for (const category of Object.keys(spending_by_category_weekends_12m)) {\n        const value = -spending_by_category_weekends_12m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n        const transactions = _.size(spending_by_category_weekends_12m[category]);\n        const percentual = parseFloat((value / spending_12m).toFixed(2));\n        spending_by_category_weekend_list_12m.push({ category, value, transactions, percentual });\n      }\n    }\n    if (spending_by_category_weekend_list_12m && spending_by_category_weekend_list_12m.length) {\n      spending_by_category_weekend_list_12m.sort((a, b) => b.value - a.value);\n      top_03_spending_by_category_weekend_12m = spending_by_category_weekend_list_12m.splice(0, 3);\n    }\n\n    categories_03m = _.groupBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n\n    spending_transactions_credit_card_12m = _.size(spending.filter(t => t.date.getTime() <= end_year && t.account_type_id == 200));\n\n    spending_list_credit_card_12m = spending.filter(t => t.date.getTime() <= end_year && t.account_type_id == 200);\n\n    for (const i in spending_list_credit_card_12m) {\n      const m = moment(spending_list_credit_card_12m[i].date).format('MM');\n      spending_credit_card_by_month[m] = (spending_credit_card_by_month[m] || 0) + 1;\n    }\n    for (const m of Object.keys(spending_credit_card_by_month)) {\n      month_with_more_credit_card_transactions = (spending_credit_card_by_month[m] >= (spending_credit_card_by_month[month_with_more_credit_card_transactions] || 0)) ? m : month_with_more_credit_card_transactions;\n      max_credit_card_transactions = (spending_credit_card_by_month[m] >= spending_credit_card_by_month[month_with_more_credit_card_transactions] || 0) ? spending_credit_card_by_month[m] : spending_credit_card_by_month[month_with_more_credit_card_transactions];\n    }\n\n    var spending_01m_closed_transactions = spending.filter(t => t.date.getTime() >= start_1mo_closed && t.date.getTime() <= end_1mo_closed);\n\n    if (spending_01m_closed_transactions && spending_01m_closed_transactions.length > 0) {\n      spending_01m_closed = -_.sumBy(spending_01m_closed_transactions, 'amount').toFixed(2);\n      most_expensive_transaction_01m_closed = spending_01m_closed_transactions.reduce((first, second) => (first.amount < second.amount) ? first : second);\n      most_expensive_transaction_01m_closed = _.pick(most_expensive_transaction_01m_closed, ['description', 'amount']);\n    }\n\n    var spending_03m_transactions = spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment);\n\n    if (spending_03m_transactions && spending_03m_transactions.length > 0) {\n      spending_03m = -_.sumBy(spending_03m_transactions, 'amount').toFixed(2);\n      most_expensive_transaction_03m = spending_03m_transactions.reduce((first, second) => (first.amount < second.amount) ? first : second);\n      most_expensive_transaction_03m = _.pick(most_expensive_transaction_03m, ['description', 'amount']);\n    }\n\n    vendors_03m = _.groupBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && restrict_spending_categories.includes(t.olivia_category_level1_id)), 'relevant_description');\n    vendors_12m = _.groupBy(spending.filter(t => t.date.getTime() <= end_year && restrict_spending_categories.includes(t.olivia_category_level1_id)), 'relevant_description');\n    categories_01m = _.groupBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n    categories_03m = _.groupBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n    categories_12m = _.groupBy(spending.filter(t => t.date.getTime() <= end_year), 'olivia_category_level1_id');\n    categories_this_month = _.groupBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n    variable_categories_this_month = _.groupBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && t.budget_type === 'variable'), 'olivia_category_level1_id');\n    transactions_03m = _.size(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment));\n    food_and_drink_03m = -_.sumBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && [60000].includes(t.olivia_category_level1_id)), 'amount').toFixed(2);\n    groceries_03m = -_.sumBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && [115000].includes(t.olivia_category_level1_id)), 'amount').toFixed(2);\n    spending_01m = -_.sumBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    spending_this_month = -_.sumBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    spending_03m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed), 'amount').toFixed(2);\n    fixed_spending_01m = -_.sumBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_01m = -_.sumBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment && t.budget_type === 'variable'), 'amount').toFixed(2);\n    fixed_spending_this_month = -_.sumBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_this_month = -_.sumBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && t.budget_type === 'variable'), 'amount').toFixed(2);\n    fixed_spending_03m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_03m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed && t.budget_type === 'variable'), 'amount').toFixed(2);\n    fixed_spending_06m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_6mo_closed && t.date.getTime() <= end_6mo_closed && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_06m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_6mo_closed && t.date.getTime() <= end_6mo_closed && t.budget_type === 'variable'), 'amount').toFixed(2);\n  }\n\n  if (vendors_03m) {\n    for (const vendor of Object.keys(vendors_03m)) {\n      const value = -vendors_03m[vendor].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(vendors_03m[vendor]);\n      vendors_list_03m.push({ vendor, value, transactions });\n    }\n  }\n\n  if (vendors_list_03m && vendors_list_03m.length) {\n    vendors_list_03m.sort((a, b) => b.transactions - a.transactions);\n    top_03_vendors_list_03m = vendors_list_03m.splice(0, 3);\n  }\n\n  if (vendors_12m) {\n    for (const vendor of Object.keys(vendors_12m)) {\n      const value = -vendors_12m[vendor].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(vendors_12m[vendor]);\n      vendors_list_12m.push({ vendor, value, transactions });\n    }\n  }\n\n  if (vendors_list_12m && vendors_list_12m.length) {\n    vendors_list_12m.sort((a, b) => b.transactions - a.transactions);\n    top_03_vendors_list_12m = vendors_list_12m.splice(0, 3);\n  }\n\n  if (categories_01m) {\n    for (const category of Object.keys(categories_01m)) {\n      const value = -categories_01m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_01m[category]);\n      const percentual = parseFloat((value / spending_01m).toFixed(2));\n      categories_list_01m.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_01m && categories_list_01m.length) {\n    categories_list_01m.sort((a, b) => b.value - a.value);\n    top_03_categories_list_01m = categories_list_01m.splice(0, 3);\n  }\n\n  if (categories_03m) {\n    for (const category of Object.keys(categories_03m)) {\n      const value = -categories_03m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_03m[category]);\n      const percentual = parseFloat((value / spending_03m).toFixed(2));\n      categories_list_03m.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_03m && categories_list_03m.length) {\n    categories_list_03m.sort((a, b) => b.value - a.value);\n    top_03_categories_list_03m = categories_list_03m.splice(0, 3);\n  }\n  if (categories_12m) {\n    for (const category of Object.keys(categories_12m)) {\n      const value = -categories_12m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_12m[category]);\n      const percentual = parseFloat((value / spending_12m).toFixed(2));\n      categories_list_12m.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_12m && categories_list_12m.length) {\n    categories_list_12m.sort((a, b) => b.value - a.value);\n    top_03_categories_list_12m = categories_list_12m.splice(0, 3);\n  }\n\n  if (categories_this_month) {\n    for (const category of Object.keys(categories_this_month)) {\n      const value = -categories_this_month[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_this_month[category]);\n      const percentual = parseFloat((value / spending_this_month).toFixed(2));\n      categories_list_this_month.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_this_month && categories_list_this_month.length) {\n    categories_list_this_month.sort((a, b) => b.value - a.value);\n    top_03_categories_list_this_month = categories_list_this_month.splice(0, 3);\n  }\n\n  if (variable_categories_this_month) {\n    for (const category of Object.keys(variable_categories_this_month)) {\n      const value = -variable_categories_this_month[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(variable_categories_this_month[category]);\n      const percentual = parseFloat((value / spending_this_month).toFixed(2));\n      variable_categories_list_this_month.push({ category, value, transactions, percentual });\n    }\n  }\n  if (variable_categories_list_this_month && variable_categories_list_this_month.length) {\n    variable_categories_list_this_month.sort((a, b) => b.value - a.value);\n    top_03_variable_categories_list_this_month = variable_categories_list_this_month.splice(0, 3);\n  }\n\n  let income_12m = 0;\n  let income_06m = 0;\n  let income_03m = 0;\n  let income_01m = 0;\n  let income_03m_closed = 0;\n  let income_this_month = 0;\n  let income_paycheck_this_month = 0;\n  let income_list_12m = null;\n  let income_by_month = {};\n  let month_with_more_deposits = '01'\n\n  if (income && income.length) {\n    date_last_income_transaction = moment(_.minBy(income, 'date').date).format('YYYY-MM-DD');\n    income_transactions_12m = _.size(income.filter(t => t.date.getTime() <= end_year));\n    income_list_12m = income.filter(t => t.date.getTime() <= end_year);\n    for (const i in income_list_12m) {\n      const m = moment(income_list_12m[i].date).format('MM');\n      income_by_month[m] = (income_by_month[m] || 0) + income_list_12m[i].amount;\n    }\n    for (const m of Object.keys(income_by_month)) {\n      month_with_more_deposits = (income_by_month[m] >= (income_by_month[month_with_more_deposits] || 0)) ? m : month_with_more_deposits;\n    }\n    income_12m = _.sumBy(income_list_12m, 'amount').toFixed(2);\n    income_06m = _.sumBy(income.filter(t => t.date.getTime() >= sixMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_03m = _.sumBy(income.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_01m = _.sumBy(income.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_03m_closed = _.sumBy(income.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed), 'amount').toFixed(2);\n    income_this_month = _.sumBy(income.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_paycheck_this_month = _.sumBy(income.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && [150300].includes(t.olivia_category_id)), 'amount').toFixed(2);\n  }\n\n  let annual_savings_year = income_12m - spending_12m;\n  let annual_savings_2020 = income_12m - spending_12m;\n\n  return {\n    v: '3.3',\n    update_at: moment().format('llll'),\n    spending_06m,\n    spending_03m,\n    spending_transactions_12m,\n    spending_12m,\n    income_transactions_12m,\n    top_03_vendors_list_03m,\n    top_03_vendors_list_12m,\n    top_03_categories_list_01m,\n    top_03_categories_list_03m,\n    top_03_categories_list_12m,\n    top_03_categories_list_this_month,\n    top_03_variable_categories_list_this_month,\n    transactions_03m,\n    food_and_drink_03m,\n    groceries_03m,\n    spending_01m,\n    spending_01m_closed,\n    spending_03m_closed,\n    spending_this_month,\n    fixed_spending_01m,\n    variable_spending_01m,\n    fixed_spending_03m_closed,\n    variable_spending_03m_closed,\n    fixed_spending_06m_closed,\n    variable_spending_06m_closed,\n    fixed_spending_this_month,\n    variable_spending_this_month,\n    income_12m,\n    income_06m,\n    income_03m,\n    income_01m,\n    income_03m_closed,\n    income_this_month,\n    income_paycheck_this_month,\n    income_by_month,\n    most_expensive_transaction_01m_closed,\n    most_expensive_transaction_03m,\n    month_with_more_deposits,\n    annual_savings_year,\n    annual_savings_2020,\n    spending_transactions_credit_card_12m,\n    spending_credit_card_by_month,\n    month_with_more_credit_card_transactions,\n    max_credit_card_transactions,\n    top_03_spending_by_category_weekdays_12m,\n    top_03_spending_by_category_weekend_12m,\n    savings_unpaired_transactions_03m,\n    savings_investments_accounts_03m,\n    savings_03m,\n    date_last_spending_transaction,\n    date_last_income_transaction\n  }\n","type":"custom","filter":{"$valid_transactions":true},"description":"Agg Income and Spendind last 6 months. Save values for 3 months. Calculate top Vendors and Categories last 3 months.","invert_value":true},"updated_at":"2022-01-06T13:50:52.653Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"740","etl_aggregation_name":"L1 Category Income 7 Days Sum Amount","rvar_object":"l1cat150000","rvar_variable":"amt7d","rule":{"type":"sum_amount","filter":{"$last_x_days":7,"$valid_transactions":true,"olivia_category_level1_id":[150000]},"invert_value":false},"updated_at":"2020-12-07T17:08:01.525Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":770,"name":"Income > 1000 over the last 7 days","rule":[{"type":"compare","operator":">=","left_value":{"type":"variable","variable":"rvars.agg.l1cat150000.amt7d"},"right_value":{"type":"fixed","value":"1000","variable_type":"int"}}],"updated_at":"2020-12-07T17:08:01.50875","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_770"},{"applicability_rule_id":772,"name":"Income < Spending in the last 3 Months","rule":[{"code":"if(!rvars.agg\n  || !rvars.agg.total_spending_and_income\n  || !rvars.agg.total_spending_and_income.totals\n  || (!rvars.agg.total_spending_and_income.totals.income_03m && parseFloat(rvars.agg.total_spending_and_income.totals.income_03m) !== 0)\n  || (!rvars.agg.total_spending_and_income.totals.spending_03m && rvars.agg.total_spending_and_income.totals.spending_03m !== 0)\n) return false;\n\nif(rvars.agg.total_spending_and_income.totals.income_03m < rvars.agg.total_spending_and_income.totals.spending_03m) return true;\n\nreturn false;","type":"custom","description":""}],"updated_at":"2021-04-22T12:42:22.910937","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_772"}],"shadow":false,"requires_etls":["total_spending_and_income.totals","l1cat150000.amt7d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37240},{"promotion_id":"213416","name":"itau_deploy","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"","notification":"<var>=rvars.agg.total_spending_and_income.totals</var><var>=rvars.agg.l2cat110800.amt60d</var><var>=rvars.agg.l1cat115000.amt60d</var><var>=rvars.agg.l1cat20000.amt60d</var><var>=rvars.agg.unusual_expense.transactions</var><var>=rvars.agg.bills_by_category_and_description.last_6m</var><var>=rvars.agg.l1cat260000.amt90d</var> ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-12-07T12:17:55.160Z","end_date":"2051-06-01T13:00:33.848Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2021-07-13T13:40:01.187Z","updated_by":"mauricio@olivia.ai","version":9,"profile_group_id":14,"previous_version":8,"convo_header":{"tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"666","etl_aggregation_name":"Total Spending and Income - Last 06 months","rvar_object":"total_spending_and_income","rvar_variable":"totals","rule":{"code":"  const _ = require('lodash');\n  const moment = require('moment');\n\n  const restrict_spending_categories = [\n    10000,\n    20000,\n    30000,\n    40000,\n    50000,\n    60000,\n    70000,\n    80000,\n    90000,\n    10000014,\n    110000,\n    115000,\n    120000,\n    130000,\n  ];\n\n  const week_days_comparison_restrict_spending_categories = [\n    20000,\n    30000,\n    50000,\n    60000,\n    70000,\n    90000,\n    10000014,\n    110000,\n    115000,\n    120000,\n    130000,\n  ];\n\n  const start_1mo_closed = moment().subtract(1, 'month').startOf('month').valueOf();\n  const end_1mo_closed = moment().subtract(1, 'month').endOf('month').valueOf();\n  const start_3mo_closed = moment().subtract(3, 'month').startOf('month').valueOf();\n  const end_3mo_closed = moment().subtract(1, 'month').endOf('month').valueOf();\n  const start_6mo_closed = moment().subtract(6, 'month').startOf('month').valueOf();\n  const end_6mo_closed = moment().subtract(1, 'month').endOf('month').valueOf();\n  const start_this_month = moment().startOf('month').valueOf();\n  const oneMonthsAgo = moment().subtract(1, 'month').startOf('day').add(1, 'day').valueOf();\n  const threeMonthsAgo = moment().subtract(3, 'month').add(1, 'day').startOf('day').valueOf();\n  const sixMonthsAgo = moment().subtract(6, 'month').add(1, 'day').startOf('day').valueOf();\n\n  const start_year = moment('2021-01-01').valueOf();\n  const end_year = moment('2021-12-31').valueOf();\n  const this_moment = moment().utc().valueOf();\n  let spending = [];\n  let income = [];\n  let savings = [];\n\n  if (transactions && transactions.length) {\n    spending = transactions.filter(t => t.date.getTime() >= start_year &&\n      t.enabled && (t.budget_type === 'variable' || t.budget_type === 'fixed') && t.cashflow === true && t.cashflow_type === 'out');\n    income = transactions.filter(t => t.date.getTime() >= start_year && t.enabled && t.cashflow === true && t.cashflow_type === 'in');\n\n    savings = transactions.filter(t => t.date.getTime() >= start_year && t.enabled && t.cashflow === true && t.cashflow_type === 'nil' && [260000].includes(t.olivia_category_level1_id));\n  }\n\n  let date_last_income_transaction;\n  let date_last_spending_transaction;\n\n  let spending_12m = 0;\n  let spending_by_category_weekdays_12m = 0;\n  let spending_by_category_weekends_12m = 0;\n  let spending_06m = 0;\n  let spending_03m = 0;\n  let spending_01m = 0;\n  let spending_this_month = 0;\n  let savings_03m = 0;\n  let savings_unpaired_transactions_03m = 0;\n  let savings_investments_accounts_03m = 0;\n  let vendors_03m = null;\n  let vendors_12m = null;\n  let categories_01m = null;\n  let categories_03m = null;\n  let categories_12m = null;\n  let categories_this_month = null;\n  let variable_categories_this_month = null;\n  let transactions_03m = 0;\n  let spending_transactions_12m = 0;\n  let spending_transactions_credit_card_12m = 0;\n  let spending_list_credit_card_12m = [];\n  let income_transactions_12m = 0;\n  let food_and_drink_03m = 0;\n  let groceries_03m = 0;\n  let spending_01m_closed = 0;\n  let spending_03m_closed = 0;\n  let fixed_spending_01m = 0;\n  let variable_spending_01m = 0;\n  let fixed_spending_03m_closed = 0;\n  let variable_spending_03m_closed = 0;\n  let fixed_spending_06m_closed = 0;\n  let variable_spending_06m_closed = 0;\n  let fixed_spending_this_month = 0;\n  let variable_spending_this_month = 0;\n  let vendors_list_03m = [];\n  let vendors_list_12m = [];\n  let top_03_vendors_list_03m = [];\n  let top_03_vendors_list_12m = [];\n  let categories_list_this_month = [];\n  let top_03_categories_list_this_month = [];\n  let variable_categories_list_this_month = [];\n  let top_03_variable_categories_list_this_month = [];\n  let categories_list_01m = [];\n  let top_03_categories_list_01m = [];\n  let categories_list_03m = [];\n  let top_03_categories_list_03m = [];\n  let categories_list_12m = [];\n  let top_03_categories_list_12m = [];\n  let spending_credit_card_by_month = {};\n  let month_with_more_credit_card_transactions = '01';\n  let max_credit_card_transactions = 0;\n  let spending_by_category_weekend_list_12m = [];\n  let spending_by_category_weekdays_list_12m = [];\n  let top_03_spending_by_category_weekdays_12m = [];\n  let top_03_spending_by_category_weekend_12m = [];\n  let most_expensive_transaction_01m_closed = null;\n  let most_expensive_transaction_03m = null;\n\n  if (savings && savings.length) {\n    savings_unpaired_transactions_03m = -_.sumBy(savings.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && !t.paired_transaction_id), 'amount').toFixed(2);\n    savings_investments_accounts_03m = -_.sumBy(savings.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && [101, 103, 104, 105, 106].includes(t.account_type_id) && (t.account_type_id != 106 || !t.paired_transaction_id)), 'amount').toFixed(2);\n    savings_03m = savings_unpaired_transactions_03m - savings_investments_accounts_03m;\n  }\n\n  if (spending && spending.length) {\n    date_last_spending_transaction = moment(_.minBy(spending, 'date').date).format('YYYY-MM-DD');\n    spending_06m = -_.sumBy(spending.filter(t => t.date.getTime() >= sixMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    spending_12m = -_.sumBy(spending.filter(t => t.date.getTime() <= end_year), 'amount').toFixed(2);\n    spending_transactions_12m = _.size(spending.filter(t => t.date.getTime() <= end_year));\n\n    spending_by_category_weekdays_12m = _.groupBy(spending.filter(t => (moment(t.date).utc().day() != 0 && moment(t.date).utc().day() != 6) && t.date.getTime() <= end_year && week_days_comparison_restrict_spending_categories.includes(t.olivia_category_level1_id)), 'olivia_category_level1_id');;\n    if (spending_by_category_weekdays_12m) {\n      for (const category of Object.keys(spending_by_category_weekdays_12m)) {\n        const value = -spending_by_category_weekdays_12m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n        const transactions = _.size(spending_by_category_weekdays_12m[category]);\n        const percentual = parseFloat((value / spending_12m).toFixed(2));\n        spending_by_category_weekdays_list_12m.push({ category, value, transactions, percentual });\n      }\n    }\n    if (spending_by_category_weekdays_list_12m && spending_by_category_weekdays_list_12m.length) {\n      spending_by_category_weekdays_list_12m.sort((a, b) => b.value - a.value);\n      top_03_spending_by_category_weekdays_12m = spending_by_category_weekdays_list_12m.splice(0, 3);\n    }\n\n    spending_by_category_weekends_12m = _.groupBy(spending.filter(t => (moment(t.date).utc().day() == 0 || moment(t.date).utc().day() == 6) && t.date.getTime() <= end_year && week_days_comparison_restrict_spending_categories.includes(t.olivia_category_level1_id)), 'olivia_category_level1_id');;\n    if (spending_by_category_weekends_12m) {\n      for (const category of Object.keys(spending_by_category_weekends_12m)) {\n        const value = -spending_by_category_weekends_12m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n        const transactions = _.size(spending_by_category_weekends_12m[category]);\n        const percentual = parseFloat((value / spending_12m).toFixed(2));\n        spending_by_category_weekend_list_12m.push({ category, value, transactions, percentual });\n      }\n    }\n    if (spending_by_category_weekend_list_12m && spending_by_category_weekend_list_12m.length) {\n      spending_by_category_weekend_list_12m.sort((a, b) => b.value - a.value);\n      top_03_spending_by_category_weekend_12m = spending_by_category_weekend_list_12m.splice(0, 3);\n    }\n\n    categories_03m = _.groupBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n\n    spending_transactions_credit_card_12m = _.size(spending.filter(t => t.date.getTime() <= end_year && t.account_type_id == 200));\n\n    spending_list_credit_card_12m = spending.filter(t => t.date.getTime() <= end_year && t.account_type_id == 200);\n\n    for (const i in spending_list_credit_card_12m) {\n      const m = moment(spending_list_credit_card_12m[i].date).format('MM');\n      spending_credit_card_by_month[m] = (spending_credit_card_by_month[m] || 0) + 1;\n    }\n    for (const m of Object.keys(spending_credit_card_by_month)) {\n      month_with_more_credit_card_transactions = (spending_credit_card_by_month[m] >= (spending_credit_card_by_month[month_with_more_credit_card_transactions] || 0)) ? m : month_with_more_credit_card_transactions;\n      max_credit_card_transactions = (spending_credit_card_by_month[m] >= spending_credit_card_by_month[month_with_more_credit_card_transactions] || 0) ? spending_credit_card_by_month[m] : spending_credit_card_by_month[month_with_more_credit_card_transactions];\n    }\n\n    var spending_01m_closed_transactions = spending.filter(t => t.date.getTime() >= start_1mo_closed && t.date.getTime() <= end_1mo_closed);\n\n    if (spending_01m_closed_transactions && spending_01m_closed_transactions.length > 0) {\n      spending_01m_closed = -_.sumBy(spending_01m_closed_transactions, 'amount').toFixed(2);\n      most_expensive_transaction_01m_closed = spending_01m_closed_transactions.reduce((first, second) => (first.amount < second.amount) ? first : second);\n      most_expensive_transaction_01m_closed = _.pick(most_expensive_transaction_01m_closed, ['description', 'amount']);\n    }\n\n    var spending_03m_transactions = spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment);\n\n    if (spending_03m_transactions && spending_03m_transactions.length > 0) {\n      spending_03m = -_.sumBy(spending_03m_transactions, 'amount').toFixed(2);\n      most_expensive_transaction_03m = spending_03m_transactions.reduce((first, second) => (first.amount < second.amount) ? first : second);\n      most_expensive_transaction_03m = _.pick(most_expensive_transaction_03m, ['description', 'amount']);\n    }\n\n    vendors_03m = _.groupBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && restrict_spending_categories.includes(t.olivia_category_level1_id)), 'relevant_description');\n    vendors_12m = _.groupBy(spending.filter(t => t.date.getTime() <= end_year && restrict_spending_categories.includes(t.olivia_category_level1_id)), 'relevant_description');\n    categories_01m = _.groupBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n    categories_03m = _.groupBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n    categories_12m = _.groupBy(spending.filter(t => t.date.getTime() <= end_year), 'olivia_category_level1_id');\n    categories_this_month = _.groupBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n    variable_categories_this_month = _.groupBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && t.budget_type === 'variable'), 'olivia_category_level1_id');\n    transactions_03m = _.size(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment));\n    food_and_drink_03m = -_.sumBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && [60000].includes(t.olivia_category_level1_id)), 'amount').toFixed(2);\n    groceries_03m = -_.sumBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && [115000].includes(t.olivia_category_level1_id)), 'amount').toFixed(2);\n    spending_01m = -_.sumBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    spending_this_month = -_.sumBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    spending_03m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed), 'amount').toFixed(2);\n    fixed_spending_01m = -_.sumBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_01m = -_.sumBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment && t.budget_type === 'variable'), 'amount').toFixed(2);\n    fixed_spending_this_month = -_.sumBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_this_month = -_.sumBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && t.budget_type === 'variable'), 'amount').toFixed(2);\n    fixed_spending_03m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_03m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed && t.budget_type === 'variable'), 'amount').toFixed(2);\n    fixed_spending_06m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_6mo_closed && t.date.getTime() <= end_6mo_closed && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_06m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_6mo_closed && t.date.getTime() <= end_6mo_closed && t.budget_type === 'variable'), 'amount').toFixed(2);\n  }\n\n  if (vendors_03m) {\n    for (const vendor of Object.keys(vendors_03m)) {\n      const value = -vendors_03m[vendor].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(vendors_03m[vendor]);\n      vendors_list_03m.push({ vendor, value, transactions });\n    }\n  }\n\n  if (vendors_list_03m && vendors_list_03m.length) {\n    vendors_list_03m.sort((a, b) => b.transactions - a.transactions);\n    top_03_vendors_list_03m = vendors_list_03m.splice(0, 3);\n  }\n\n  if (vendors_12m) {\n    for (const vendor of Object.keys(vendors_12m)) {\n      const value = -vendors_12m[vendor].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(vendors_12m[vendor]);\n      vendors_list_12m.push({ vendor, value, transactions });\n    }\n  }\n\n  if (vendors_list_12m && vendors_list_12m.length) {\n    vendors_list_12m.sort((a, b) => b.transactions - a.transactions);\n    top_03_vendors_list_12m = vendors_list_12m.splice(0, 3);\n  }\n\n  if (categories_01m) {\n    for (const category of Object.keys(categories_01m)) {\n      const value = -categories_01m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_01m[category]);\n      const percentual = parseFloat((value / spending_01m).toFixed(2));\n      categories_list_01m.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_01m && categories_list_01m.length) {\n    categories_list_01m.sort((a, b) => b.value - a.value);\n    top_03_categories_list_01m = categories_list_01m.splice(0, 3);\n  }\n\n  if (categories_03m) {\n    for (const category of Object.keys(categories_03m)) {\n      const value = -categories_03m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_03m[category]);\n      const percentual = parseFloat((value / spending_03m).toFixed(2));\n      categories_list_03m.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_03m && categories_list_03m.length) {\n    categories_list_03m.sort((a, b) => b.value - a.value);\n    top_03_categories_list_03m = categories_list_03m.splice(0, 3);\n  }\n  if (categories_12m) {\n    for (const category of Object.keys(categories_12m)) {\n      const value = -categories_12m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_12m[category]);\n      const percentual = parseFloat((value / spending_12m).toFixed(2));\n      categories_list_12m.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_12m && categories_list_12m.length) {\n    categories_list_12m.sort((a, b) => b.value - a.value);\n    top_03_categories_list_12m = categories_list_12m.splice(0, 3);\n  }\n\n  if (categories_this_month) {\n    for (const category of Object.keys(categories_this_month)) {\n      const value = -categories_this_month[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_this_month[category]);\n      const percentual = parseFloat((value / spending_this_month).toFixed(2));\n      categories_list_this_month.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_this_month && categories_list_this_month.length) {\n    categories_list_this_month.sort((a, b) => b.value - a.value);\n    top_03_categories_list_this_month = categories_list_this_month.splice(0, 3);\n  }\n\n  if (variable_categories_this_month) {\n    for (const category of Object.keys(variable_categories_this_month)) {\n      const value = -variable_categories_this_month[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(variable_categories_this_month[category]);\n      const percentual = parseFloat((value / spending_this_month).toFixed(2));\n      variable_categories_list_this_month.push({ category, value, transactions, percentual });\n    }\n  }\n  if (variable_categories_list_this_month && variable_categories_list_this_month.length) {\n    variable_categories_list_this_month.sort((a, b) => b.value - a.value);\n    top_03_variable_categories_list_this_month = variable_categories_list_this_month.splice(0, 3);\n  }\n\n  let income_12m = 0;\n  let income_06m = 0;\n  let income_03m = 0;\n  let income_01m = 0;\n  let income_03m_closed = 0;\n  let income_this_month = 0;\n  let income_paycheck_this_month = 0;\n  let income_list_12m = null;\n  let income_by_month = {};\n  let month_with_more_deposits = '01'\n\n  if (income && income.length) {\n    date_last_income_transaction = moment(_.minBy(income, 'date').date).format('YYYY-MM-DD');\n    income_transactions_12m = _.size(income.filter(t => t.date.getTime() <= end_year));\n    income_list_12m = income.filter(t => t.date.getTime() <= end_year);\n    for (const i in income_list_12m) {\n      const m = moment(income_list_12m[i].date).format('MM');\n      income_by_month[m] = (income_by_month[m] || 0) + income_list_12m[i].amount;\n    }\n    for (const m of Object.keys(income_by_month)) {\n      month_with_more_deposits = (income_by_month[m] >= (income_by_month[month_with_more_deposits] || 0)) ? m : month_with_more_deposits;\n    }\n    income_12m = _.sumBy(income_list_12m, 'amount').toFixed(2);\n    income_06m = _.sumBy(income.filter(t => t.date.getTime() >= sixMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_03m = _.sumBy(income.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_01m = _.sumBy(income.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_03m_closed = _.sumBy(income.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed), 'amount').toFixed(2);\n    income_this_month = _.sumBy(income.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_paycheck_this_month = _.sumBy(income.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && [150300].includes(t.olivia_category_id)), 'amount').toFixed(2);\n  }\n\n  let annual_savings_year = income_12m - spending_12m;\n  let annual_savings_2020 = income_12m - spending_12m;\n\n  return {\n    v: '3.3',\n    update_at: moment().format('llll'),\n    spending_06m,\n    spending_03m,\n    spending_transactions_12m,\n    spending_12m,\n    income_transactions_12m,\n    top_03_vendors_list_03m,\n    top_03_vendors_list_12m,\n    top_03_categories_list_01m,\n    top_03_categories_list_03m,\n    top_03_categories_list_12m,\n    top_03_categories_list_this_month,\n    top_03_variable_categories_list_this_month,\n    transactions_03m,\n    food_and_drink_03m,\n    groceries_03m,\n    spending_01m,\n    spending_01m_closed,\n    spending_03m_closed,\n    spending_this_month,\n    fixed_spending_01m,\n    variable_spending_01m,\n    fixed_spending_03m_closed,\n    variable_spending_03m_closed,\n    fixed_spending_06m_closed,\n    variable_spending_06m_closed,\n    fixed_spending_this_month,\n    variable_spending_this_month,\n    income_12m,\n    income_06m,\n    income_03m,\n    income_01m,\n    income_03m_closed,\n    income_this_month,\n    income_paycheck_this_month,\n    income_by_month,\n    most_expensive_transaction_01m_closed,\n    most_expensive_transaction_03m,\n    month_with_more_deposits,\n    annual_savings_year,\n    annual_savings_2020,\n    spending_transactions_credit_card_12m,\n    spending_credit_card_by_month,\n    month_with_more_credit_card_transactions,\n    max_credit_card_transactions,\n    top_03_spending_by_category_weekdays_12m,\n    top_03_spending_by_category_weekend_12m,\n    savings_unpaired_transactions_03m,\n    savings_investments_accounts_03m,\n    savings_03m,\n    date_last_spending_transaction,\n    date_last_income_transaction\n  }\n","type":"custom","filter":{"$valid_transactions":true},"description":"Agg Income and Spendind last 6 months. Save values for 3 months. Calculate top Vendors and Categories last 3 months.","invert_value":true},"updated_at":"2022-01-06T13:50:52.653Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"313","etl_aggregation_name":"L2 Category Shopping/Toys & Baby Supplies 60 Days Sum Amount","rvar_object":"l2cat110800","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110800,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"524","etl_aggregation_name":"L1 Category Groceries 60 Days Sum Amount","rvar_object":"l1cat115000","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"$valid_transactions":true,"olivia_category_level1_id":115000},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"514","etl_aggregation_name":"L1 Category Education 60 Days Sum Amount","rvar_object":"l1cat20000","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"$valid_transactions":true,"olivia_category_level1_id":20000},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"741","etl_aggregation_name":"Unusual Expenses","rvar_object":"unusual_expense","rvar_variable":"transactions","rule":{"code":"  const moment = require('moment');\n\n  const unusualExpenseVariation = 15;\n  const transactionMinAmt = 30.00;\n\n  const start_last_month = moment.utc().subtract(1, 'month').startOf('month').valueOf();\n  const end_last_month = moment.utc().subtract(1, 'month').endOf('month').valueOf();\n  const start_actual_month = moment.utc().startOf('month').valueOf();\n  const end_actual_month = moment.utc().endOf('month').valueOf();\n\n  const agg = [];\n  const billsRelDesc = {};\n\n  for (const transaction of transactions) {\n    const m = transaction.date.getTime();\n    if (transaction.cashflow\n      && transaction.enabled\n      && !transaction.pending\n      && m >= start_last_month\n      && m <= end_actual_month\n      && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n    ) {\n      // group bills per relevant description and category, summing previous and current month separately\n      const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n      billsRelDesc[relDesc] = billsRelDesc[relDesc]\n        || {\n        previous: 0,\n        current: 0,\n        transaction_id: transaction.transaction_id,\n        description: transaction.description,\n        vendor: transaction.relevant_description,\n        category_id: transaction.olivia_category_id,\n      };\n      if (m <= end_last_month) {\n        billsRelDesc[relDesc].previous -= transaction.amount;\n      } else if (m >= start_actual_month) {\n        billsRelDesc[relDesc].current -= transaction.amount;\n      }\n    }\n  }\n\n  // find out which bills should be talked about\n  for (const relDesc in billsRelDesc) {\n    // previous month expense must be higher than a minimum amount\n    if (billsRelDesc[relDesc].previous > transactionMinAmt && billsRelDesc[relDesc].current) {\n      const variation = parseFloat(\n        (billsRelDesc[relDesc].current / billsRelDesc[relDesc].previous * 100 - 100).toFixed(2)\n      );\n      // variation must be higher than a minimum\n      if (variation > unusualExpenseVariation) {\n        agg.push({\n          relevant_description: relDesc,\n          description: billsRelDesc[relDesc].description,\n          prev_month: moment.utc().subtract(1, 'month').startOf('month').month(),\n          prev_payment_amt: billsRelDesc[relDesc].previous,\n          actual_month: moment.utc().startOf('month').month(),\n          actual_month_amt: billsRelDesc[relDesc].current,\n          variation: variation / 100,\n          vendor: billsRelDesc[relDesc].vendor,\n          category_id: billsRelDesc[relDesc].category_id,\n          transaction_id: billsRelDesc[relDesc].transaction_id,\n        });\n      }\n    }\n  }\n\n  return agg;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Fixed expenses whose value varied over 15% total","invert_value":true},"updated_at":"2021-04-01T18:17:12.708Z","updated_by":"vinicius.nobre@olivia.ai"},{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"},{"etl_aggregation_id":"512","etl_aggregation_name":"L1 Category Savings & Investments 90 Days Sum Amount","rvar_object":"l1cat260000","rvar_variable":"amt90d","rule":{"type":"sum_amount","filter":{"$last_x_days":90,"$valid_transactions":true,"olivia_category_level1_id":260000},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"requires_etls":["total_spending_and_income.totals","l2cat110800.amt60d","l1cat115000.amt60d","l1cat20000.amt60d","unusual_expense.transactions","bills_by_category_and_description.last_6m","l1cat260000.amt90d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37241},{"promotion_id":"214484","name":"inf_teste_deeplink","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"E só para esclarecer, esta conversa é apenas um teste interno, ok?\"}}","content_body":"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓","notification":"Oi, vamos começar o teste?! ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"Clique aqui para testar home de investimentos\",\"link\":\"deeplink://spa/investimentos/home/\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente","notification_2":"Vem testar esta conversa! ","notification_3":"Vamos fazer um teste rápido? ","disclaimer_body":"E só para esclarecer, esta conversa é apenas um teste interno, ok?","user_engaged_link":"deeplink://spa/investimentos/home/","external_link_body":"","external_link_link":"","internal_link_body":"Clique aqui para testar home de investimentos","internal_link_link":"deeplink://spa/investimentos/home/","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Só se for agora!\",\"response\":\"Opa, então só vem\",\"link_text\":\"Clique aqui para testar home de investimentos\",\"link\":\"deeplink://spa/investimentos/home/\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Acho que vou passar essa\",\"response\":\"Olha lá, tem certeza?\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"Só se for agora!","user_option_dismissed_body":"Acho que vou passar essa","user_option_delayed_response":"","user_option_engaged_response":"Opa, então só vem","user_option_delayed_link_text":"","user_option_engaged_link_text":"Clique aqui para testar home de investimentos","user_option_dismissed_response":"Olha lá, tem certeza?","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-06-07T13:34:57.566Z","end_date":"2051-07-20T12:59:48.665Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2021-07-20T13:04:42.072Z","updated_by":"mauricio@olivia.ai","version":7,"profile_group_id":14,"previous_version":6,"convo_header":{"feed_cta":"vamos!","feed_body":"Vamos testar uma conversa do Itaú com deeplink interno? 🙂 Essa dica tem mais de 123 caracteres para validar que, após esse limite, a mensagem será truncada","feed_subtitle":"deeplink","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37242},{"promotion_id":"214485","name":"inf_teste_deeplink_pagamentos","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"E só para esclarecer, esta conversa é apenas um teste interno, ok?\"}}","content_body":"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓","notification":"Oi, vamos começar o teste?! ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"Clique aqui para testar pagamentos\",\"link\":\"deeplink://pagamentos\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente","notification_2":"Vem testar esta conversa! ","notification_3":"Vamos fazer um teste rápido? ","disclaimer_body":"E só para esclarecer, esta conversa é apenas um teste interno, ok?","user_engaged_link":"deeplink://pagamentos","external_link_body":"","external_link_link":"","internal_link_body":"Clique aqui para testar pagamentos","internal_link_link":"deeplink://pagamentos","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Só se for agora!\",\"response\":\"Opa, então só vem\",\"link_text\":\"Clique aqui para testar pagamentos\",\"link\":\"deeplink://pagamentos\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Acho que vou passar essa\",\"response\":\"Olha lá, tem certeza?\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"Só se for agora!","user_option_dismissed_body":"Acho que vou passar essa","user_option_delayed_response":"","user_option_engaged_response":"Opa, então só vem","user_option_delayed_link_text":"","user_option_engaged_link_text":"Clique aqui para testar pagamentos","user_option_dismissed_response":"Olha lá, tem certeza?","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-06-07T13:34:57.566Z","end_date":"2051-07-20T13:00:26.173Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2021-07-20T13:04:42.072Z","updated_by":"mauricio@olivia.ai","version":4,"profile_group_id":14,"previous_version":3,"convo_header":{"feed_cta":"vamos!","feed_body":"Vamos testar uma conversa do Itaú com deeplink para a página de pagamentos?","feed_subtitle":"deeplink","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37245},{"promotion_id":"214486","name":"inf_teste_deeplink_investimentos","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"E só para esclarecer, esta conversa é apenas um teste interno, ok?\"}}","content_body":"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓","notification":"Oi, vamos começar o teste?! ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"Clique aqui para testar o redirecionamento para a página de investimentos\",\"link\":\"deeplink://feat_invest_dashboard\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente","notification_2":"Vem testar esta conversa! ","notification_3":"Vamos fazer um teste rápido? ","disclaimer_body":"E só para esclarecer, esta conversa é apenas um teste interno, ok?","user_engaged_link":"deeplink://feat_invest_dashboard","external_link_body":"","external_link_link":"","internal_link_body":"Clique aqui para testar o redirecionamento para a página de investimentos","internal_link_link":"deeplink://feat_invest_dashboard","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Só se for agora!\",\"response\":\"Opa, então só vem\",\"link_text\":\"Clique aqui para testar o redirecionamento para a página de investimentos\",\"link\":\"deeplink://feat_invest_dashboard\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Acho que vou passar essa\",\"response\":\"Olha lá, tem certeza?\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"Só se for agora!","user_option_dismissed_body":"Acho que vou passar essa","user_option_delayed_response":"","user_option_engaged_response":"Opa, então só vem","user_option_delayed_link_text":"","user_option_engaged_link_text":"Clique aqui para testar o redirecionamento para a página de investimentos","user_option_dismissed_response":"Olha lá, tem certeza?","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-06-07T13:34:57.566Z","end_date":"2051-07-20T13:00:53.625Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2021-07-20T13:04:42.072Z","updated_by":"mauricio@olivia.ai","version":4,"profile_group_id":14,"previous_version":3,"convo_header":{"feed_cta":"vamos!","feed_body":"Vamos testar uma conversa do Itaú com deeplink para a página de investimentos?","feed_subtitle":"deeplink","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37243},{"promotion_id":"214487","name":"inf_teste_deeplink_robo","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"E só para esclarecer, esta conversa é apenas um teste interno, ok?\"}}","content_body":"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓","notification":"Oi, vamos começar o teste?! ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"Clique aqui para testar o robô  de investimentos\",\"link\":\"deeplink://spa/investimentos-robo-advisor\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente","notification_2":"Vem testar esta conversa! ","notification_3":"Vamos fazer um teste rápido? ","disclaimer_body":"E só para esclarecer, esta conversa é apenas um teste interno, ok?","user_engaged_link":"deeplink://spa/investimentos-robo-advisor","external_link_body":"","external_link_link":"","internal_link_body":"Clique aqui para testar o robô  de investimentos","internal_link_link":"deeplink://spa/investimentos-robo-advisor","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Só se for agora!\",\"response\":\"Opa, então só vem\",\"link_text\":\"Clique aqui para testar o robô de investimentos\",\"link\":\"deeplink://spa/investimentos-robo-advisor\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Acho que vou passar essa\",\"response\":\"Olha lá, tem certeza?\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"Só se for agora!","user_option_dismissed_body":"Acho que vou passar essa","user_option_delayed_response":"","user_option_engaged_response":"Opa, então só vem","user_option_delayed_link_text":"","user_option_engaged_link_text":"Clique aqui para testar o robô de investimentos","user_option_dismissed_response":"Olha lá, tem certeza?","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-06-07T13:34:57.566Z","end_date":"2051-07-20T13:01:05.792Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2021-07-20T13:04:42.072Z","updated_by":"mauricio@olivia.ai","version":3,"profile_group_id":14,"previous_version":2,"convo_header":{"feed_cta":"vamos!","feed_body":"Vamos testar uma conversa do Itaú com deeplink para o robô de investimentos?","feed_subtitle":"deeplink","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37244},{"promotion_id":"10363","name":"act_gas_station_programs_shell","convo_template":"tpt_itau_base_no_options","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"//No code\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Já conhece o programa de fidelidade deles? Recomendo! Rende descontos e benefícios em lojas parceiras 🤓 🚘\"}}","code_body":"//No code","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Você gastou <b><var>=currency(rvars.agg.shell.amt_1m)</var></b> na rede <b>Shell</b> no último <b>mês</b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\"}}","content_body":"Já conhece o programa de fidelidade deles? Recomendo! Rende descontos e benefícios em lojas parceiras 🤓 🚘","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"👉 Clique para participar\",\"link\":\"https://resgatefacil.com.br/Cadastro\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","main_text_body":"Você gastou <b><var>=currency(rvars.agg.shell.amt_1m)</var></b> na rede <b>Shell</b> no último <b>mês</b>","notification_2":" ","notification_3":" ","disclaimer_body":"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","external_link_body":"👉 Clique para participar","external_link_link":"https://resgatefacil.com.br/Cadastro","internal_link_body":"","internal_link_link":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-05-07T18:42:44.916Z","end_date":"2053-01-16T16:59:30.964Z","validation_ids":[],"cooldown_groups":["gas_station"],"updated_at":"2023-01-16T16:59:31.067Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"default","barrier":"Mostrar ao usuário, de forma fácil, o programa de fidelidade do posto de gasolina da rede que costuma frequentar e que ele pode utilizar.","behavior":"Fazer com que o usuário se cadastre e utilize o programa de fidelidade apresentado.","benefits":"Ao acumular pontos no programa, o usuário poderá trocar seus pontos por benefícios em compras no estabelecimentos parceiros.","cooldown":"0","feed_cta":"eu topo","feed_body":"Te mostro como economizar no posto de combustível onde você abastece. Topa? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"equilibrando as contas","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"gas_station","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"826","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["external_data"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.ipiranga.amt_1m","type":"rvars","value":"400"},{"name":"agg.shell.amt_1m","type":"rvars","value":"600"}],"etl_aggregations":[{"etl_aggregation_id":"767","etl_aggregation_name":"Shell Expenses Last Month","rvar_object":"shell","rvar_variable":"amt_1m","rule":{"type":"sum_amount","filter":{"$regex":{"description":"shell"},"$last_x_months":1,"$valid_transactions":true,"olivia_category_level2_id":[130500]},"invert_value":true},"updated_at":"2021-05-13T16:51:03.644Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":826,"name":"Itau Gas Stations on Shell","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.shell.amt_1m"},"right_value":{"type":"fixed","value":"200","variable_type":"int"}}],"updated_at":"2022-08-23T14:34:43.258","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_826"}],"shadow":false,"requires_etls":["shell.amt_1m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37190},{"promotion_id":"215680","name":"regular_users_feedback","convo_template":"tpt_itau_onboarding","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Então, conta pro meu time <b>o que você mais gosta das dicas personalizadas?</b> É rapidinho ⌛\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Agora você já conhece um pouco desta nova experiência! <b>😃</b>\"}}","content_body":"Então, conta pro meu time <b>o que você mais gosta das dicas personalizadas?</b> É rapidinho ⌛","content_link":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Agora você já conhece um pouco desta nova experiência! <b>😃</b>","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"","user_option_engaged_feedback":"textinput","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-25T19:57:55.379Z","end_date":"2051-10-05T13:48:49.723Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2021-10-14T13:31:43.267Z","updated_by":"leal@olivia.ai","version":3,"profile_group_id":14,"previous_version":2,"convo_header":{"type":"default","barrier":"Solicitar o feedback de forma simples.","behavior":"Fazer com que o usuário dê o feedback sobre a experiência com os insights no Minhas Finanças.","benefits":"Melhorar o produto, de acordo com as principais necessidades do usuário.","cooldown":"4320","featured":false,"feed_cta":"conto sim!","feed_body":"O que está achando? Vem contar como tem sido até aqui 😊","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"vamos juntos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"1440","once_completed":"false","validation_ids":"","cooldownDelayed":"4320","cooldownEngaged":"4320","localHoursValid":"","expected_savings":"low","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"4320","notification_type":"insight","cooldownFrustrated":"4320","cooldownInteracted":"4320","cooldownThumbsDown":"4320","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"859","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["feedback"]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":859,"name":"Itau Regular Users Feedback","rule":[{"code":"    const moment = require('moment');\n\n    const BLACKLIST = [\n        \"promo_alert_weekly_update\",\n        \"promo_inf_last_month_summary\"\n    ]\n\n    const mapped = {};\n    for (const conversation in hist) {\n        if (typeof hist[conversation] != 'object') continue;\n        if (BLACKLIST.includes(conversation)) continue;\n        if (!hist[conversation].last_engaged) continue;\n\n        mapped[conversation] = hist[conversation].last_engaged;\n    }\n\n    const recent_conversations = Object.values(mapped)\n        .map(last_engaged => (moment().diff(moment(last_engaged), 'months') > 0) ? 0 : 1)\n        .reduce((acc, item) => item + acc, 0);\n\n    return recent_conversations > 1;\n","type":"custom","description":"User has seen 2 or more conversations last month"}],"updated_at":"2021-10-11T19:38:53.962277","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_859"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37165},{"promotion_id":"10364","name":"act_pet_savings_cobasi","convo_template":"tpt_itau_base_no_options","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"//No code\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Já conhece o programa de fidelidade deles? Recomendo! Rende ofertas exclusivas, descontos e brindes 🎉\"}}","code_body":"//No code","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi que você gastou <b><var>=currency(rvars.agg.cobasi.amt_2m)</var></b> na <b>Cobasi</b> nos últimos <b>60 dias</b> 🐶 🐱\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\"}}","content_body":"Já conhece o programa de fidelidade deles? Recomendo! Rende ofertas exclusivas, descontos e brindes 🎉","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"👉 Clique para participar\",\"link\":\"https://www.cobasi.com.br/programa-amigo-cobasi\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","main_text_body":"Vi que você gastou <b><var>=currency(rvars.agg.cobasi.amt_2m)</var></b> na <b>Cobasi</b> nos últimos <b>60 dias</b> 🐶 🐱","notification_2":" ","notification_3":" ","disclaimer_body":"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","external_link_body":"👉 Clique para participar","external_link_link":"https://www.cobasi.com.br/programa-amigo-cobasi","internal_link_body":"","internal_link_link":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-05-11T19:22:52.076Z","end_date":"2053-01-16T17:00:19.714Z","validation_ids":[],"cooldown_groups":["pet_savings"],"updated_at":"2023-01-16T17:00:19.784Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":12,"profile_group_id":14,"previous_version":11,"convo_header":{"type":"default","barrier":"O usuário saber sobre o programa de benefícios e poder acessá-lo com um clique.","behavior":"O usuário se cadastrar em programas de fidelidade para gastos com pets.","benefits":"O usuário gastar menos nas compras para o seu pet.","cooldown":"0","feed_cta":"quero ver","feed_body":"Cuidar dos pets pode custar caro! Te mostro como ter desconto de até R$ 150 na sua loja preferida ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"animais de estimação","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"pet_savings","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"727,824","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["external_data"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat1000014.amt60d","type":"rvars","value":"800"},{"name":"agg.petz.amt_2m","type":"rvars","value":"200"},{"name":"agg.cobasi.amt_2m","type":"rvars","value":"400"},{"name":"agg.petlove.amt_2m","type":"rvars","value":"200"}],"etl_aggregations":[{"etl_aggregation_id":"765","etl_aggregation_name":"Cobasi Expenses Last 2 Months","rvar_object":"cobasi","rvar_variable":"amt_2m","rule":{"type":"sum_amount","filter":{"$regex":{"description":"cobasi"},"$last_x_months":2,"$valid_transactions":true,"olivia_category_level1_id":[1000014]},"invert_value":true},"updated_at":"2021-05-13T16:51:03.644Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":727,"name":"User belongs to AB test group 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_727"},{"applicability_rule_id":824,"name":"Itau Pet Savings on Cobasi","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.cobasi.amt_2m"},"right_value":{"type":"fixed","value":"100","variable_type":"int"}}],"updated_at":"2022-08-23T17:29:38.068","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_824"}],"shadow":false,"requires_etls":["cobasi.amt_2m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37229},{"promotion_id":"10366","name":"act_pet_savings_petlove","convo_template":"tpt_itau_base_no_options","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"//No code\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Já conhece o programa de fidelidade deles? Recomendo! Rende 10% de desconto em todas as compras 🎉\"}}","code_body":"//No code","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi que você gastou <b><var>=currency(rvars.agg.petlove.amt_2m)</var></b> na <b>Petlove</b> nos últimos <b>60 dias</b> 🐶 🐱\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\"}}","content_body":"Já conhece o programa de fidelidade deles? Recomendo! Rende 10% de desconto em todas as compras 🎉","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"👉 Clique para participar\",\"link\":\"https://www.petlove.com.br/assinatura\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","main_text_body":"Vi que você gastou <b><var>=currency(rvars.agg.petlove.amt_2m)</var></b> na <b>Petlove</b> nos últimos <b>60 dias</b> 🐶 🐱","notification_2":" ","notification_3":" ","disclaimer_body":"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","external_link_body":"👉 Clique para participar","external_link_link":"https://www.petlove.com.br/assinatura","internal_link_body":"","internal_link_link":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-05-11T19:57:07.438Z","end_date":"2053-01-16T17:03:31.011Z","validation_ids":[],"cooldown_groups":["pet_savings"],"updated_at":"2023-01-16T17:03:31.098Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"default","barrier":"O usuário saber sobre o programa de benefícios e poder acessá-lo com um clique.","behavior":"O usuário se cadastrar em programas de fidelidade para gastos com pets.","benefits":"O usuário gastar menos nas compras para o seu pet.","cooldown":"0","feed_cta":"quero ver","feed_body":"Cuidar dos pets pode custar caro! Te mostro como gastar 10% menos na sua loja preferida","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"animais de estimação","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"pet_savings","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"727,825","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["external_data"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat1000014.amt60d","type":"rvars","value":"800"},{"name":"agg.petz.amt_2m","type":"rvars","value":"200"},{"name":"agg.cobasi.amt_2m","type":"rvars","value":"200"},{"name":"agg.petlove.amt_2m","type":"rvars","value":"400"}],"etl_aggregations":[{"etl_aggregation_id":"766","etl_aggregation_name":"Petlove Expenses Last 2 Months","rvar_object":"petlove","rvar_variable":"amt_2m","rule":{"type":"sum_amount","filter":{"$regex":{"description":"petlove"},"$last_x_months":2,"$valid_transactions":true,"olivia_category_level1_id":[1000014]},"invert_value":true},"updated_at":"2021-06-11T16:31:27.823Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":727,"name":"User belongs to AB test group 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_727"},{"applicability_rule_id":825,"name":"Itau Pet Savings on Petlove","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.petlove.amt_2m"},"right_value":{"type":"fixed","value":"100","variable_type":"int"}}],"updated_at":"2022-08-23T17:30:46.763","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_825"}],"shadow":false,"requires_etls":["petlove.amt_2m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37172},{"promotion_id":"10350","name":"inf_self_comparison_stable_expenses","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"<b><var>=currency(context.currentSession.svars.period_amounts[0])</var></b> foi seu gasto na categoria de <var>=context.currentSession.svars.category_name</var><br /><br />Os números indicam que seu padrão de gastos se manteve <b>estável</b>\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Fiz uma análise dos <b>primeiros 15 dias de <var>=context.currentSession.svars.period_months[0]</var></b>, te mostro:\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"<b><var>=currency(context.currentSession.svars.period_amounts[0])</var></b> foi seu gasto na categoria de <var>=context.currentSession.svars.category_name</var><br /><br />Os números indicam que seu padrão de gastos se manteve <b>estável</b>","notification":"Tenho dados pra te mostrar sobre seus gastos na categoria de <var>=category(formulas.conversation_specific_function()).full_name</var> ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer ver um comparativo mês a mês?\"}}","main_text_body":"Fiz uma análise dos <b>primeiros 15 dias de <var>=context.currentSession.svars.period_months[0]</var></b>, te mostro:","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer ver um comparativo mês a mês?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Beleza, eu volto em breve para a gente falar sobre isso!\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Vamos lá<br /><br />Na <b>1ª quinzena</b> de cada mês, você gastou:<br /><b><var>=context.currentSession.svars.period_months[1]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[1])</var><br /><b><var>=context.currentSession.svars.period_months[2]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[2])</var><br /><b><var>=context.currentSession.svars.period_months[3]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[3])</var><br /><br />Manter estabilidade de gastos, no geral, é sinal de boa saúde financeira<br /><br />Reavalie de tempos em tempos e altere a rota se necessário!\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não precisa, valeu\",\"response\":\"Tudo bem, vou buscar outros assuntos pra você\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não precisa, valeu","user_option_delayed_response":"Beleza, eu volto em breve para a gente falar sobre isso!","user_option_engaged_response":"Vamos lá<br /><br />Na <b>1ª quinzena</b> de cada mês, você gastou:<br /><b><var>=context.currentSession.svars.period_months[1]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[1])</var><br /><b><var>=context.currentSession.svars.period_months[2]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[2])</var><br /><b><var>=context.currentSession.svars.period_months[3]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[3])</var><br /><br />Manter estabilidade de gastos, no geral, é sinal de boa saúde financeira<br /><br />Reavalie de tempos em tempos e altere a rota se necessário!","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Tudo bem, vou buscar outros assuntos pra você","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-09-22T20:47:16.294Z","end_date":"2052-12-26T18:30:26.190Z","validation_ids":[],"cooldown_groups":["itau_self_comparison_expenses"],"updated_at":"2022-12-26T18:30:26.556Z","updated_by":"raimundo.botelho@mailer.com.br","version":8,"profile_group_id":14,"previous_version":7,"convo_header":{"type":"default","barrier":"A Olivia faz as contas do mês atual e compara com os meses anteriores","behavior":"Fazer com que o usuário tenha consciência dos seus gastos por categoria","benefits":"Fazer com que o usuário continue mantendo os seus gastos estáveis","cooldown":"720","feed_cta":"vamos!","feed_body":"Vamos avaliar seu padrão de gastos na categoria de [=category(formulas.conversation_specific_function()).full_name] e monitorar isso?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"gastos por categoria","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"720","localHoursValid":"","review_settings":"simple","expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"1440","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"720","cooldownThumbsDown":"2880","sharedCooldownGroup":"itau_self_comparison_expenses","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"860","cooldown_groups_merged":"true","session_variables_code":"    const moment = require('moment');\n    const { category } = formulas;\n\n    const CATEGORIES = [\n        115000, // Groceries\n        60000, // Food & Drink\n        1000014, // Pets\n        70300, // Healthcare/Pharmacy\n    ];\n\n\n\n    // const AGGREGATION = {\n    //    115000: rvars.agg.l1cat115000.sum15days4months,\n    //    60000: rvars.agg.l1cat60000.sum15days4months,\n    //    1000014: rvars.agg.l1cat1000014.sum15days4months,\n    //   70300: rvars.agg.l2cat70300.sum15days4months\n    // };\n\n    // usando etl que filtra cartões\n    const AGGREGATION = {\n        115000: rvars.agg.l1cat115000.sum15days4monthswithoutcreditcard,\n        60000: rvars.agg.l1cat60000.sum15days4monthswithoutcreditcard,\n        1000014: rvars.agg.l1cat1000014.sum15days4monthswithoutcreditcard,\n        70300: rvars.agg.l2cat70300.sum15days4monthswithoutcreditcard\n    };\n\n    const MONTHS = [\n        'current_month',\n        '1_month_ago',\n        '2_month_ago',\n        '3_month_ago'\n    ]\n\n    const tally = {};\n\n    for (const category of CATEGORIES) {\n        tally[category] = {};\n        tally[category]['enable'] = true;\n        for (const month of MONTHS) {\n            if (!(AGGREGATION[category][month] > 0)) tally[category]['enable'] = false;\n        }\n    }\n\n    // Check if there is at least one category that attends the higher expenses criteria\n    const enabled_categories = [];\n    for (const category of CATEGORIES) {\n        if (tally[category]['enable']) {\n            const period_amounts = MONTHS.map((m) => AGGREGATION[category][m]);\n            const past_expenses = period_amounts.slice(1);\n            const avg_amount = past_expenses.reduce((acc, item) => acc + item) / 3;\n\n            // Applicable if current amount between 97% and 103% of average\n            let start = avg_amount * 0.97;\n            let end = avg_amount * 1.03;\n            if (period_amounts[0] >= start && period_amounts[0] <= end) {\n                enabled_categories.push(category);\n            }\n        }\n    }\n\n    if (enabled_categories.length == 0) {\n        return {};\n    }\n\n    // Randomly selecting the conversation category:\n    // context.localMoment should be fixed while generating both session and push notification\n    // so this should be a 'fixed' way of making it random in the sense of generating pushes\n    // as well as synching with svars\n    const random_seed = moment(context.localMoment).format('x') % enabled_categories.length;\n    const random_category = enabled_categories[random_seed];\n\n    const period_amounts = MONTHS.map((m) => AGGREGATION[random_category][m]);\n    const period_months = [0, 1, 2, 3].map((months_ago) => moment().startOf('month').subtract(months_ago, 'month').locale('pt-BR').format('MMMM'));\n\n    // Exclude this month's expenses\n    const past_expenses = period_amounts.slice(1);\n    const avg_amount = past_expenses.reduce((acc, item) => acc + item) / 3;\n\n    const diff_amount = Math.abs(period_amounts[0] - avg_amount);\n\n    const category_name = category(random_category).full_name;\n\n    return {\n        period_amounts,\n        period_months,\n        diff_amount,\n        category_name\n    };\n\n","session_variables_enabled":"true","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"itau_self_comparison_expenses","notification_cooldown_groups_merged":"true","tags":["self comparison"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat60000.sum15days4months","type":"rvars","value":{"1_month_ago":103,"2_month_ago":102,"3_month_ago":101,"current_month":100.5},"data_type":"json"},{"name":"agg.l1cat115000.sum15days4months","type":"rvars","value":{"1_month_ago":0,"2_month_ago":0,"3_month_ago":0,"current_month":0},"data_type":"json"},{"name":"agg.l1cat1000014.sum15days4months","type":"rvars","value":{"1_month_ago":0,"2_month_ago":0,"3_month_ago":0,"current_month":0},"data_type":"json"},{"name":"agg.l2cat70300.sum15days4months","type":"rvars","value":{"1_month_ago":0,"2_month_ago":0,"3_month_ago":0,"current_month":0},"data_type":"json"}],"etl_aggregations":[{"etl_aggregation_id":"773","etl_aggregation_name":"L1 Category Groceries 15 Days/4 months Sum Amount","rvar_object":"l1cat115000","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level1_id === 115000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Groceries 15 Days/4 months Sum Amount","invert_value":true},"updated_at":"2021-10-21T18:01:30.677Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"842","etl_aggregation_name":"L1 Category Food & Drink 15 Days/4 months Sum Amount","rvar_object":"l1cat60000","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level1_id === 60000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Food & Drink 15 Days/4 months Sum Amount","invert_value":true},"updated_at":"2021-09-30T17:16:51.438Z","updated_by":"leal@olivia.ai"},{"etl_aggregation_id":"845","etl_aggregation_name":"L1 Category Pets 15 Days/4 months Sum Amount","rvar_object":"l1cat1000014","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level1_id === 1000014 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Pets 15 Days/4 months Sum Amount","invert_value":true},"updated_at":"2021-10-11T19:38:54.016Z","updated_by":"leal@olivia.ai"},{"etl_aggregation_id":"844","etl_aggregation_name":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount","rvar_object":"l2cat70300","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level2_id === 70300 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount","invert_value":true},"updated_at":"2021-09-30T17:16:51.438Z","updated_by":"leal@olivia.ai"},{"etl_aggregation_id":"2147483649","etl_aggregation_name":"L1 Category Groceries 15 Days/4 months Sum Amount without creditcard","rvar_object":"l1cat115000","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level1_id === 115000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Groceries 15 Days/4 months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:47:34.044Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483650","etl_aggregation_name":"L1 Category Food & Drink 15 Days/4 months Sum Amount without creditcard","rvar_object":"l1cat60000","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level1_id === 60000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Food & Drink 15 Days/4 months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:51:43.505Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483651","etl_aggregation_name":"L1 Category Pets 15 Days/4 months Sum Amount without creditcard","rvar_object":"l1cat1000014","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level1_id === 1000014 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Pets 15 Days/4 months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:56:38.616Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483652","etl_aggregation_name":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount without creditcard","rvar_object":"l2cat70300","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level2_id === 70300 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:59:20.661Z","updated_by":"leonardo-flavio.santos@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":860,"name":"Itau Self Comparison Stable Expenses","rule":[{"code":"    // Sanity checks\n    if (!rvars\n        || !rvars.agg\n        || !rvars.agg.l1cat115000\n        || !rvars.agg.l1cat60000\n        || !rvars.agg.l1cat1000014\n        || !rvars.agg.l2cat70300\n        || !rvars.agg.l1cat115000.sum15days4months\n        || !rvars.agg.l1cat60000.sum15days4months\n        || !rvars.agg.l1cat1000014.sum15days4months\n        || !rvars.agg.l2cat70300.sum15days4months) return 0;\n\n    // Only applicable day 18\n    const moment = require('moment');\n    if (moment().date() != 18) return 0;\n\n    const CATEGORIES = [\n        115000, // Groceries\n        60000, // Food & Drink\n        1000014, // Pets\n        70300, // Healthcare/Pharmacy\n    ];\n\n    const AGGREGATION = {\n        115000: rvars.agg.l1cat115000.sum15days4months,\n        60000: rvars.agg.l1cat60000.sum15days4months,\n        1000014: rvars.agg.l1cat1000014.sum15days4months,\n        70300: rvars.agg.l2cat70300.sum15days4months\n    };\n\n    const MONTHS = [\n        'current_month',\n        '1_month_ago',\n        '2_month_ago',\n        '3_month_ago'\n    ]\n\n    const tally = {};\n\n    for (const category of CATEGORIES) {\n        tally[category] = {};\n        tally[category]['enable'] = true;\n        for (const month of MONTHS) {\n            if (!(AGGREGATION[category][month] > 0)) tally[category]['enable'] = false;\n        }\n    }\n\n    // Check if there is at least one category that attends the stable expenses criteria\n    for (const category of CATEGORIES) {\n        if (tally[category]['enable']) {\n            const period_amounts = MONTHS.map((m) => AGGREGATION[category][m]);\n            const past_expenses = period_amounts.slice(1);\n            const avg_amount = past_expenses.reduce((acc, item) => acc + item) / 3;\n\n            // Applicable if current amount between 97% and 103% of average\n            if (period_amounts[0] <= avg_amount * 1.03 && period_amounts[0] >= avg_amount * 0.97) {\n                return 1;\n            }\n        }\n    }\n\n    return 0;\n","type":"custom","description":""}],"updated_at":"2021-11-18T19:30:37.994346","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_860"}],"shadow":false,"requires_etls":["l1cat115000.sum15days4months","l1cat60000.sum15days4months","l1cat1000014.sum15days4months","l2cat70300.sum15days4months","l1cat115000.sum15days4monthswithoutcreditcard","l1cat60000.sum15days4monthswithoutcreditcard","l1cat1000014.sum15days4monthswithoutcreditcard","l2cat70300.sum15days4monthswithoutcreditcard"],"conversation_group":"convos_itau_app_users","conversation_map_id":37195},{"promotion_id":"10039","name":"inf_teste_ivars_variable","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"E só para esclarecer, esta conversa é apenas um teste interno, ok?\"}}","content_body":"Por isso, criamos esta conversa só pra gente poder testar o deeplink e ter certeza de que vai funcionar 🤓","notification":"Oi, vamos testar o deeplink ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"Clique aqui para testar o robô  de investimentos\",\"link\":\"deeplink://spa/investimentos-robo-advisor\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"Aqui na Olivia a gente está sempre testando tudo, e com o Itaú não seria diferente","notification_2":"Vem testar esta conversa! ","notification_3":"Vamos fazer um teste rápido? ","disclaimer_body":"E só para esclarecer, esta conversa é apenas um teste interno, ok?","user_engaged_link":"deeplink://spa/investimentos-robo-advisor","external_link_body":"","external_link_link":"","internal_link_body":"Clique aqui para testar o robô  de investimentos","internal_link_link":"deeplink://spa/investimentos-robo-advisor","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Só se for agora!\",\"response\":\"Opa, então só vem\",\"link_text\":\"Clique aqui para testar o robô de investimentos\",\"link\":\"deeplink://spa/investimentos-robo-advisor\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Acho que vou passar essa\",\"response\":\"Olha lá, tem certeza?\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"Só se for agora!","user_option_dismissed_body":"Acho que vou passar essa","user_option_delayed_response":"","user_option_engaged_response":"Opa, então só vem","user_option_delayed_link_text":"","user_option_engaged_link_text":"Clique aqui para testar o robô de investimentos","user_option_dismissed_response":"Olha lá, tem certeza?","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-06-07T13:34:57.566Z","end_date":"2052-02-08T18:19:39.639Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-04-08T21:36:16.518Z","updated_by":"ivanir@olivia.ai","version":1,"profile_group_id":14,"previous_version":0,"convo_header":{"type":"default","cooldown":"0","feed_cta":"vamos!","feed_body":"Vamos testar uma conversa do Itaú com deeplink para o robô de investimentos?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"deeplink","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37186},{"promotion_id":"10387","name":"inf_alert_unusual_expense_celular","convo_template":"tpt_itau_unusual_expense_celular","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_celular.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_celular.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_celular.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_celular.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_celular.current_transaction.month)</var>, ou seja, houve um <b>aumento </b>de <b><var>=percent(ivars.unusual_expense_celular.current_transaction.variation)</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema.","notification":"Notei uma mudança incomum na sua conta de celular 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já sabe o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_celular.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_celular.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_celular.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_celular.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_celular.current_transaction.month)</var>, ou seja, houve um <b>aumento </b>de <b><var>=percent(ivars.unusual_expense_celular.current_transaction.variation)</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_celular.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já sabe o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_celular.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_celular.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo! 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_celular.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo! 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-18T17:03:27.164Z","end_date":"2053-01-18T17:16:43.717Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:16:43.784Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":20,"profile_group_id":14,"previous_version":19,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos ver","feed_body":"Identifiquei que a sua conta de celular aumentou. Quer ver alguns dados para entender o que houve?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"794,727","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"unusual_expenses_celular_historic","type":"ivars","value":[]},{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10300vivo | a":[{"month":10,"amount":40,"timestamp":1604188800000,"variation":0,"description":"vivo a","formatted_date":"01/11/20","transaction_id":"e6af223b-8c9d-4f37-805a-6316c861bb5f"},{"month":11,"amount":40,"timestamp":1606780800000,"variation":0,"description":"vivo a","formatted_date":"01/12/20","transaction_id":"dd39ce49-6239-4815-a3ce-fc0f5030aa7e"},{"month":0,"amount":40,"timestamp":1609459200000,"variation":0,"description":"vivo a","formatted_date":"01/01/21","transaction_id":"ccc9f751-cece-49bf-92eb-e3953ce80290"},{"month":1,"amount":40,"timestamp":1612137600000,"variation":0,"description":"vivo a","formatted_date":"01/02/21","transaction_id":"ebd3c7aa-52f1-4a52-8b12-c3153f89f45b"},{"month":2,"amount":40,"timestamp":1614556800000,"variation":0,"description":"vivo a","formatted_date":"01/03/21","transaction_id":"26581d65-d3b5-46e9-930c-1b8e7c658b04"},{"month":3,"amount":56,"timestamp":1617235200000,"variation":0.4,"description":"vivo a","formatted_date":"01/04/21","transaction_id":"fb261752-967a-4386-969d-d4a963b0ec25"}]}}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":794,"name":"Has Unusual Phone Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'vivo ',\n    'claro ',\n    'tim ',\n    'oi ',\n    'nextel '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(\"10300\") && vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n      if (rounded_variation < 0.1\n        || moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_celular_historic && ivars.unusual_expenses_celular_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Vivo, Claro, Tim and Oi on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_794"},{"applicability_rule_id":727,"name":"User belongs to AB test group 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_727"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37216},{"promotion_id":"10411","name":"inf_last_month_summary","convo_template":"tpt_itau_base_summary","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","no_etl":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Ainda estou analisando suas movimentações deste ciclo<br /><br />Vamos nos falar de novo em breve, para eu te trazer novidades! 😉\"}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","no_data":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Você não teve movimentações no ciclo de<b> <var>=ivars.last_cycle_name</var></b><br /><br />Vamos nos falar de novo em breve, para eu te trazer novidades! 😉\"}}","out_msg":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Vamos seguir de olho, cuidando de perto das suas finanças 🕵️\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"<var>=ivars.last_month_totals</var><br /><var>=ivars.itau_summary_context</var>\"}}","check_data":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"const moment = require('moment');\\nconst currency = formulas.currency;\\nconst percent = formulas.percent;\\n\\nivars.last_month_totals = '';\\nivars.last_month_variations = '';\\nivars.last_cycle_name = '';\\n\\nivars.sumary_conversation_name = conversationName;\\nivars.itau_summary_has_etl = 0;\\nivars.itau_summary_has_data = 0;\\nivars.itau_summary_up_to_date = 0;\\nivars.itau_summary_has_details = 0;\\nivars.itau_summary_context = '';\\n\\nif (dat\\n    && dat.profile_overview_panel_section\\n    && dat.profile_overview_panel_section.totals\\n    && dat.profile_overview_panel_section.totals.spending\\n    && dat.profile_overview_panel_section.totals.income\\n    && dat.profile_overview_panel_section.totals.investments) {\\n    ivars.itau_summary_has_etl = 1;\\n}\\n\\nif (ivars.itau_summary_has_etl) {\\n    if (dat.profile_overview_panel_section.totals.spending.length >= 5\\n        && dat.profile_overview_panel_section.totals.income.length >= 5\\n        && dat.profile_overview_panel_section.totals.investments.length >= 5) {\\n        ivars.itau_summary_has_data = 1;\\n        ivars.itau_summary_up_to_date = 1;\\n        ivars.itau_summary_has_details = 1;\\n    }\\n    else {\\n        if (dat.profile_overview_panel_section.totals.income.length > 1) {\\n            ivars.itau_summary_has_data = 1;\\n            ivars.itau_summary_up_to_date = 1;\\n        }\\n    }\\n}\\n\\nif (ivars.itau_summary_has_etl && ivars.itau_summary_has_data) {\\n\\n    // Last Month\\n\\n    // totals\\n    const totals_income = dat.profile_overview_panel_section.totals.income;\\n    const totals_last_income = dat.profile_overview_panel_section.totals.income[dat.profile_overview_panel_section.totals.income.length - 2];\\n    const last_cycle_name = moment(totals_last_income.begin).format('DD/MM') + ' a ' + moment(totals_last_income.end).format('DD/MM');\\n    ivars.last_cycle_name = last_cycle_name;\\n\\n    const last_income = parseFloat((totals_last_income.amount.total).toFixed(2));\\n\\n    const totals_spending = dat.profile_overview_panel_section.totals.spending;\\n    const last_spending = dat.profile_overview_panel_section.totals.spending[dat.profile_overview_panel_section.totals.spending.length - 2];\\n    const last_fixed_spending = -parseFloat((last_spending.amount.fixed).toFixed(2));\\n    const last_variable_spending = -parseFloat((last_spending.amount.variable).toFixed(2));\\n\\n    const totals_investments = dat.profile_overview_panel_section.totals.investments;\\n    const totals_last_investment = dat.profile_overview_panel_section.totals.investments[dat.profile_overview_panel_section.totals.investments.length - 2];\\n    const last_saving = parseFloat((totals_last_investment.deposit_amount - totals_last_investment.withdraw_amount).toFixed(2));\\n    if (!last_income\\n        && !last_fixed_spending\\n        && !last_variable_spending\\n        && !(last_saving && last_saving > 0)) {\\n        ivars.itau_summary_has_data = 0;\\n    }\\n    else {\\n        ivars.last_month_totals += 'Acompanhei seus números do último ciclo (<b>'\\n            + last_cycle_name\\n            + '</b>), olha só:'\\n            + ((last_income) ? ('<br /> 💵 Receitas = <b>' + currency(last_income) + '</b>') : '')\\n            + ((last_fixed_spending) ? ('<br /> 📌 Gasto Fixo = <b>' + currency(last_fixed_spending) + '</b>') : '')\\n            + ((last_variable_spending) ? ('<br /> 💸 Gasto Variável = <b>' + currency(last_variable_spending) + '</b>') : '')\\n            + ((last_saving > 0) ? ('<br /> 🏦 Valor Guardado = <b>' + currency(last_saving) + '</b>') : '');\\n\\n        ivars.last_month_variations = '';\\n\\n        if (ivars.itau_summary_has_details) {\\n\\n            // average last 3 periods\\n            const len_ti = totals_income.length;\\n            const avg_income_last_3_periods = (len_ti) ? parseFloat(((totals_income.slice(len_ti - 5, len_ti - 2).map(t => t.amount.total).reduce((p, c) => p + c, 0)) / 3).toFixed(2)) : 0;\\n            const len_ts = totals_spending.length;\\n            const avg_variable_spending_last_3_periods = (len_ts) ? -parseFloat(((totals_spending.slice(len_ts - 5, len_ts - 2).map(t => t.amount.variable).reduce((p, c) => p + c, 0)) / 3).toFixed(2)) : 0;\\n            const avg_fixed_spending_last_3_periods = (len_ts) ? -parseFloat(((totals_spending.slice(len_ts - 5, len_ts - 2).map(t => t.amount.fixed).reduce((p, c) => p + c, 0)) / 3).toFixed(2)) : 0;\\n            const len_tv = totals_investments.length;\\n            const avg_savings_last_3_periods = (len_tv) ? parseFloat(((totals_investments.slice(len_tv - 5, len_tv - 2).map(t => (t.deposit_amount - t.withdraw_amount)).reduce((p, c) => p + c, 0)) / 3).toFixed(2)) : 0;\\n\\n            if (avg_income_last_3_periods\\n                || avg_fixed_spending_last_3_periods\\n                || avg_variable_spending_last_3_periods\\n                || (avg_savings_last_3_periods && last_saving > avg_savings_last_3_periods)\\n            ) {\\n\\n\\n                ivars.itau_summary_context = 'Também fiz uma comparação com o seu histórico';\\n\\n                // calculate variations last period / 3 previous periods(avg)\\n                const income_var = avg_income_last_3_periods ? (last_income - avg_income_last_3_periods) / avg_income_last_3_periods : 0;\\n                const income_var_signal = (income_var > 0) ? '⬆' : ((income_var < 0) ? '⬇' : '');\\n                const variable_spending_var = avg_variable_spending_last_3_periods ? (last_variable_spending - avg_variable_spending_last_3_periods) / avg_variable_spending_last_3_periods : 0;\\n                const variable_spending_var_signal = (variable_spending_var > 0) ? '⬆' : ((variable_spending_var < 0) ? '⬇' : '');\\n                const fixed_spending_var = avg_fixed_spending_last_3_periods ? (last_fixed_spending - avg_fixed_spending_last_3_periods) / avg_fixed_spending_last_3_periods : 0;\\n                const fixed_spending_var_signal = (fixed_spending_var > 0) ? '⬆' : ((fixed_spending_var < 0) ? '⬇' : '');\\n                const savings_var = avg_savings_last_3_periods ? (last_saving - avg_savings_last_3_periods) / avg_savings_last_3_periods : 0;\\n                const savings_var_signal = (savings_var > 0) ? '⬆' : ((savings_var < 0) ? '⬇' : ''); // prepare last month texts\\n                ivars.last_month_variations = ('Opa, vamos lá 🔍 <br />Veja como foi seu último ciclo em comparação com a média dos 3 ciclos anteriores:'\\n                    + ((avg_income_last_3_periods) ? ('<br /> 💵 Receitas = <b>' + income_var_signal + percent(Math.abs(income_var)) + '</b>') : '')\\n                    + ((avg_fixed_spending_last_3_periods) ? ('<br /> 📌 Gasto Fixo = <b>' + fixed_spending_var_signal + percent(Math.abs(fixed_spending_var)) + '</b>') : '')\\n                    + ((avg_variable_spending_last_3_periods) ? ('<br /> 💸 Gasto Variável = <b>' + variable_spending_var_signal + percent(Math.abs(variable_spending_var)) + '</b>') : '')\\n                    + ((last_saving > 0) ? ('<br /> 🏦 Valor Guardado = <b>' + savings_var_signal + percent(Math.abs(savings_var)) + '</b>') : '')\\n                    + '<br /><br />Vamos seguir de olho, cuidando de perto das suas finanças 🕵️');\\n            }\\n            else {\\n                ivars.itau_summary_has_details = 0;\\n            }\\n\\n        }\\n    }\\n}\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","no_etl_body":"Ainda estou analisando suas movimentações deste ciclo<br /><br />Vamos nos falar de novo em breve, para eu te trazer novidades! 😉","content_body":"","no_data_body":"Você não teve movimentações no ciclo de<b> <var>=ivars.last_cycle_name</var></b><br /><br />Vamos nos falar de novo em breve, para eu te trazer novidades! 😉","notification":" ","out_msg_body":"Vamos seguir de olho, cuidando de perto das suas finanças 🕵️","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais detalhes?\"}}","main_text_body":"<var>=ivars.last_month_totals</var><br /><var>=ivars.itau_summary_context</var>","notification_2":" ","notification_3":" ","check_data_body":"const moment = require('moment');\nconst currency = formulas.currency;\nconst percent = formulas.percent;\n\nivars.last_month_totals = '';\nivars.last_month_variations = '';\nivars.last_cycle_name = '';\n\nivars.sumary_conversation_name = conversationName;\nivars.itau_summary_has_etl = 0;\nivars.itau_summary_has_data = 0;\nivars.itau_summary_up_to_date = 0;\nivars.itau_summary_has_details = 0;\nivars.itau_summary_context = '';\n\nif (dat\n    && dat.profile_overview_panel_section\n    && dat.profile_overview_panel_section.totals\n    && dat.profile_overview_panel_section.totals.spending\n    && dat.profile_overview_panel_section.totals.income\n    && dat.profile_overview_panel_section.totals.investments) <var>enc$\n    ivars.itau_summary_has_etl = 1;\n</var>\n\nif (ivars.itau_summary_has_etl) <var>enc$\n    if (dat.profile_overview_panel_section.totals.spending.length >= 5\n        && dat.profile_overview_panel_section.totals.income.length >= 5\n        && dat.profile_overview_panel_section.totals.investments.length >= 5) {\n        ivars.itau_summary_has_data = 1;\n        ivars.itau_summary_up_to_date = 1;\n        ivars.itau_summary_has_details = 1;\n    }\n    else {\n        if (dat.profile_overview_panel_section.totals.income.length > 1) {\n            ivars.itau_summary_has_data = 1;\n            ivars.itau_summary_up_to_date = 1;\n        }\n    }\n</var>\n\nif (ivars.itau_summary_has_etl && ivars.itau_summary_has_data) <var>enc$\n\n    // Last Month\n\n    // totals\n    const totals_income = dat.profile_overview_panel_section.totals.income;\n    const totals_last_income = dat.profile_overview_panel_section.totals.income[dat.profile_overview_panel_section.totals.income.length - 2];\n    const last_cycle_name = moment(totals_last_income.begin).format('DD/MM') + ' a ' + moment(totals_last_income.end).format('DD/MM');\n    ivars.last_cycle_name = last_cycle_name;\n\n    const last_income = parseFloat((totals_last_income.amount.total).toFixed(2));\n\n    const totals_spending = dat.profile_overview_panel_section.totals.spending;\n    const last_spending = dat.profile_overview_panel_section.totals.spending[dat.profile_overview_panel_section.totals.spending.length - 2];\n    const last_fixed_spending = -parseFloat((last_spending.amount.fixed).toFixed(2));\n    const last_variable_spending = -parseFloat((last_spending.amount.variable).toFixed(2));\n\n    const totals_investments = dat.profile_overview_panel_section.totals.investments;\n    const totals_last_investment = dat.profile_overview_panel_section.totals.investments[dat.profile_overview_panel_section.totals.investments.length - 2];\n    const last_saving = parseFloat((totals_last_investment.deposit_amount - totals_last_investment.withdraw_amount).toFixed(2));\n    if (!last_income\n        && !last_fixed_spending\n        && !last_variable_spending\n        && !(last_saving && last_saving > 0)) {\n        ivars.itau_summary_has_data = 0;\n    }\n    else {\n        ivars.last_month_totals += 'Acompanhei seus números do último ciclo (<b>'\n            + last_cycle_name\n            + '</b>), olha só:'\n            + ((last_income) ? ('<br /> 💵 Receitas = <b>' + currency(last_income) + '</b>') : '')\n            + ((last_fixed_spending) ? ('<br /> 📌 Gasto Fixo = <b>' + currency(last_fixed_spending) + '</b>') : '')\n            + ((last_variable_spending) ? ('<br /> 💸 Gasto Variável = <b>' + currency(last_variable_spending) + '</b>') : '')\n            + ((last_saving > 0) ? ('<br /> 🏦 Valor Guardado = <b>' + currency(last_saving) + '</b>') : '');\n\n        ivars.last_month_variations = '';\n\n        if (ivars.itau_summary_has_details) {\n\n            // average last 3 periods\n            const len_ti = totals_income.length;\n            const avg_income_last_3_periods = (len_ti) ? parseFloat(((totals_income.slice(len_ti - 5, len_ti - 2).map(t => t.amount.total).reduce((p, c) => p + c, 0)) / 3).toFixed(2)) : 0;\n            const len_ts = totals_spending.length;\n            const avg_variable_spending_last_3_periods = (len_ts) ? -parseFloat(((totals_spending.slice(len_ts - 5, len_ts - 2).map(t => t.amount.variable).reduce((p, c) => p + c, 0)) / 3).toFixed(2)) : 0;\n            const avg_fixed_spending_last_3_periods = (len_ts) ? -parseFloat(((totals_spending.slice(len_ts - 5, len_ts - 2).map(t => t.amount.fixed).reduce((p, c) => p + c, 0)) / 3).toFixed(2)) : 0;\n            const len_tv = totals_investments.length;\n            const avg_savings_last_3_periods = (len_tv) ? parseFloat(((totals_investments.slice(len_tv - 5, len_tv - 2).map(t => (t.deposit_amount - t.withdraw_amount)).reduce((p, c) => p + c, 0)) / 3).toFixed(2)) : 0;\n\n            if (avg_income_last_3_periods\n                || avg_fixed_spending_last_3_periods\n                || avg_variable_spending_last_3_periods\n                || (avg_savings_last_3_periods && last_saving > avg_savings_last_3_periods)\n            ) {\n\n\n                ivars.itau_summary_context = 'Também fiz uma comparação com o seu histórico';\n\n                // calculate variations last period / 3 previous periods(avg)\n                const income_var = avg_income_last_3_periods ? (last_income - avg_income_last_3_periods) / avg_income_last_3_periods : 0;\n                const income_var_signal = (income_var > 0) ? '⬆' : ((income_var < 0) ? '⬇' : '');\n                const variable_spending_var = avg_variable_spending_last_3_periods ? (last_variable_spending - avg_variable_spending_last_3_periods) / avg_variable_spending_last_3_periods : 0;\n                const variable_spending_var_signal = (variable_spending_var > 0) ? '⬆' : ((variable_spending_var < 0) ? '⬇' : '');\n                const fixed_spending_var = avg_fixed_spending_last_3_periods ? (last_fixed_spending - avg_fixed_spending_last_3_periods) / avg_fixed_spending_last_3_periods : 0;\n                const fixed_spending_var_signal = (fixed_spending_var > 0) ? '⬆' : ((fixed_spending_var < 0) ? '⬇' : '');\n                const savings_var = avg_savings_last_3_periods ? (last_saving - avg_savings_last_3_periods) / avg_savings_last_3_periods : 0;\n                const savings_var_signal = (savings_var > 0) ? '⬆' : ((savings_var < 0) ? '⬇' : ''); // prepare last month texts\n                ivars.last_month_variations = ('Opa, vamos lá 🔍 <br />Veja como foi seu último ciclo em comparação com a média dos 3 ciclos anteriores:'\n                    + ((avg_income_last_3_periods) ? ('<br /> 💵 Receitas = <b>' + income_var_signal + percent(Math.abs(income_var)) + '</b>') : '')\n                    + ((avg_fixed_spending_last_3_periods) ? ('<br /> 📌 Gasto Fixo = <b>' + fixed_spending_var_signal + percent(Math.abs(fixed_spending_var)) + '</b>') : '')\n                    + ((avg_variable_spending_last_3_periods) ? ('<br /> 💸 Gasto Variável = <b>' + variable_spending_var_signal + percent(Math.abs(variable_spending_var)) + '</b>') : '')\n                    + ((last_saving > 0) ? ('<br /> 🏦 Valor Guardado = <b>' + savings_var_signal + percent(Math.abs(savings_var)) + '</b>') : '')\n                    + '<br /><br />Vamos seguir de olho, cuidando de perto das suas finanças 🕵️');\n            }\n            else {\n                ivars.itau_summary_has_details = 0;\n            }\n\n        }\n    }\n</var>","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer saber mais detalhes?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Agora não, valeu\",\"response\":\"Tudo bem, em breve eu volto com novas informações para você 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"<var>=ivars.last_month_variations</var>\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"Agora não, valeu","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"","user_option_delayed_response":"Tudo bem, em breve eu volto com novas informações para você 😉","user_option_engaged_response":"<var>=ivars.last_month_variations</var>","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-26T21:00:55.357Z","end_date":"2053-01-19T14:25:29.079Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:25:29.280Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":49,"profile_group_id":14,"previous_version":48,"convo_header":{"type":"alert","barrier":"Olivia faz as principais contas e análises e entrega tudo pronto pro usuário.","behavior":"Ter disciplina de acompanhar o padrão de despesas / receitas mês a mês.","benefits":"Autoconhecimento e criação do hábito de verificar o status de suas contas. Apoio emocional (saber que estamos aqui para ajudar o usuário a se manter no controle de suas finanças).","cooldown":"720","feed_cta":"vamos!","feed_body":"Chegou a hora de vermos o resumo completo do seu último mês. Vamos nessa?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"ciclo mensal","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"8","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"720","notification_type":"insight","cooldownFrustrated":"720","cooldownInteracted":"720","cooldownThumbsDown":"720","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["summary","coringa"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.totals.income","type":"dat","value":[{"end":"2021-07-31","begin":"2021-07-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"},{"end":"2021-08-31","begin":"2021-08-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"},{"end":"2021-09-30","begin":"2021-09-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"},{"end":"2021-10-19","begin":"2021-09-20","label":"Abril","amount":{"fixed":3330,"total":32320,"variable":1110},"short_label":"Abr"},{"end":"2021-11-30","begin":"2021-11-01","label":"Abril","amount":{"fixed":3330,"total":4440,"variable":1110},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.spending","type":"dat","value":[{"end":"2021-07-31","begin":"2021-07-01","label":"Agosto 2021","amount":{"fixed":0,"total":-628.36,"variable":0},"short_label":"Ago 2021"},{"end":"2021-08-31","begin":"2021-08-01","label":"Agosto 2021","amount":{"fixed":0,"total":-628.36,"variable":0},"short_label":"Ago 2021"},{"end":"2021-09-30","begin":"2021-09-01","label":"Setembro 2021","amount":{"fixed":0,"total":-2671.17,"variable":0},"short_label":"Set 2021"},{"end":"2021-10-31","begin":"2021-10-01","label":"Outubro 2021","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Out 2021"},{"end":"2021-11-30","begin":"2021-11-01","label":"Novembro 2021","amount":{"fixed":-809.02,"total":-1668.56,"variable":-859.54},"short_label":"Nov 2021"}]},{"name":"profile_overview_panel_section.totals.investments","type":"dat","value":[{"end":"2021-07-31","begin":"2021-07-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"},{"end":"2021-08-31","begin":"2021-08-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"},{"end":"2021-09-30","begin":"2021-09-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"},{"end":"2021-10-31","begin":"2021-10-01","label":"Abril","amount":{"fixed":3330,"total":0,"variable":1110},"short_label":"Abr"},{"end":"2021-11-30","begin":"2021-11-01","label":"Abril","amount":{"fixed":3330,"total":4440,"variable":1110},"short_label":"Abr"}]}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37200},{"promotion_id":"10126","name":"inf_change_due_date","convo_template":"tpt_itau_base_no_options_no_cooldown","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"//Taken from act_change_due_date_credit_card_social\\n\\nconst _ = require('lodash');\\nconst moment = require('moment');\\n\\nif (!dat.recurrent_transactions) return 0;\\nconst recurrences = [];\\nrecurrences.push(\\n    ...(dat.recurrent_transactions.auto_detected || []),\\n    ...(dat.recurrent_transactions.added_by_user || []),\\n    ...(dat.recurrent_transactions.created_by_user || []));\\nconst regularPaychecks = recurrences.filter(\\n    r => !r.hidden && r.period === 'month' && r.frequency === 1 && r.category === 150300\\n);\\n\\n// consider biweekly paychecks and generate a secondary paycheck for it\\nconst biweeklyPaychecks = recurrences.filter(\\n    r => !r.hidden && r.period === 'month' && r.frequency === 0.5 && r.category === 150300\\n);\\n_.forEach(biweeklyPaychecks, (paycheck) => {\\n    const previousOccurrence = moment.utc(paycheck.last_occurrence).subtract(14, 'days');\\n    const previousPaycheck = _.cloneDeep(paycheck);\\n    previousPaycheck.last_occurrence = previousOccurrence.format('YYYY-MM-DD');\\n    // TODO must consider different values for each fortnight (quinzena)\\n    regularPaychecks.push(paycheck, previousPaycheck);\\n});\\n\\nconst paychecksPerDate = _.groupBy(regularPaychecks, 'last_occurrence');\\nconst paychecksSums = [];\\n_.forEach(paychecksPerDate, (paychecksPerDay) => {\\n    paychecksSums.push({ date: paychecksPerDay[0].last_occurrence, amount: _.sumBy(paychecksPerDay, 'avg_amount') });\\n});\\n\\nconst bestPaycheck = _.maxBy(paychecksSums, 'amount');\\nconst bestPaycheckDay = parseInt(new Date(bestPaycheck.date).toISOString().substr(8, 2));\\nconst bestDueDate = Math.max(1, (bestPaycheckDay + 3) % 29);\\n\\nivars.temp_paycheck_day = bestPaycheckDay;\\nivars.temp_best_due_date = bestDueDate;\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Vi que seu salário costuma cair dia <b><var>=ivars.temp_paycheck_day</var></b>, então sugiro que programe o vencimento das suas contas para o dia <b><var>=ivars.temp_best_due_date</var></b>\"}}","code_body":"//Taken from act_change_due_date_credit_card_social\n\nconst _ = require('lodash');\nconst moment = require('moment');\n\nif (!dat.recurrent_transactions) return 0;\nconst recurrences = <var></var>;\nrecurrences.push(\n    ...(dat.recurrent_transactions.auto_detected || <var></var>),\n    ...(dat.recurrent_transactions.added_by_user || <var></var>),\n    ...(dat.recurrent_transactions.created_by_user || <var></var>));\nconst regularPaychecks = recurrences.filter(\n    r => !r.hidden && r.period === 'month' && r.frequency === 1 && r.category === 150300\n);\n\n// consider biweekly paychecks and generate a secondary paycheck for it\nconst biweeklyPaychecks = recurrences.filter(\n    r => !r.hidden && r.period === 'month' && r.frequency === 0.5 && r.category === 150300\n);\n_.forEach(biweeklyPaychecks, (paycheck) => <var>enc$\n    const previousOccurrence = moment.utc(paycheck.last_occurrence).subtract(14, 'days');\n    const previousPaycheck = _.cloneDeep(paycheck);\n    previousPaycheck.last_occurrence = previousOccurrence.format('YYYY-MM-DD');\n    // TODO must consider different values for each fortnight (quinzena)\n    regularPaychecks.push(paycheck, previousPaycheck);\n</var>);\n\nconst paychecksPerDate = _.groupBy(regularPaychecks, 'last_occurrence');\nconst paychecksSums = <var></var>;\n_.forEach(paychecksPerDate, (paychecksPerDay) => <var>enc$\n    paychecksSums.push({ date: paychecksPerDay[0].last_occurrence, amount: _.sumBy(paychecksPerDay, 'avg_amount') });\n</var>);\n\nconst bestPaycheck = _.maxBy(paychecksSums, 'amount');\nconst bestPaycheckDay = parseInt(new Date(bestPaycheck.date).toISOString().substr(8, 2));\nconst bestDueDate = Math.max(1, (bestPaycheckDay + 3) % 29);\n\nivars.temp_paycheck_day = bestPaycheckDay;\nivars.temp_best_due_date = bestDueDate;","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Alinhar o vencimento das contas fixas à data do salário pode te ajudar a <b>conseguir pagar tudo</b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Vi que seu salário costuma cair dia <b><var>=ivars.temp_paycheck_day</var></b>, então sugiro que programe o vencimento das suas contas para o dia <b><var>=ivars.temp_best_due_date</var></b>","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Alinhar o vencimento das contas fixas à data do salário pode te ajudar a <b>conseguir pagar tudo</b>","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-04-27T19:03:19.848Z","end_date":"2052-06-28T20:57:58.906Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-06-28T20:57:58.976Z","updated_by":"renato.lotto@mailer.com.br","version":9,"profile_group_id":14,"previous_version":8,"convo_header":{"type":"alert","barrier":"Fazer a análise de fluxo de caixa do usuário e mostrar a melhor data para ele configurar o vencimento das suas contas.","behavior":"Fazer com que o usuário configure a data de vencimento de suas contas, de acordo com o dia em que recebe seu salário.","benefits":"Ajudar o usuário a pagar suas contas em dia, sem que pague juros nelas.","cooldown":"8640","feed_cta":"me conta","feed_body":"Vamos ver qual é o melhor dia pra pagar as suas contas?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas fixas","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"low","cooldownQueued":"8640","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8640","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"medium","cooldownDismissed":"99999","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"8640","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"830","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"recurrent_transactions.auto_detected","type":"dat","value":[{"hidden":false,"period":"month","category":150300,"frequency":1,"avg_amount":5000,"last_occurrence":1628519749352}]}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":830,"name":"Has a recurring paycheck","rule":[{"code":"    if (!dat.recurrent_transactions) return 0;\n    const recurrences = [];\n\n    recurrences.push(\n        ...(dat.recurrent_transactions.auto_detected || []),\n        ...(dat.recurrent_transactions.added_by_user || []),\n        ...(dat.recurrent_transactions.created_by_user || []));\n\n    const regularPaychecks = recurrences.filter(\n        r => !r.hidden && r.period === 'month' && r.frequency <= 1 && r.category === 150300\n    );\n\n    return regularPaychecks.length ? 1 : 0;\n","type":"custom","description":""}],"updated_at":"2021-08-09T16:54:30.542556","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_830"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37187},{"promotion_id":"10115","name":"inf_alert_missing_bill","convo_template":"tpt_itau_missing_bills","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Este mês ainda não localizei esse pagamento\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Tô de olho nas suas finanças e vi que por volta do dia <b><var>=ivars.temp_missing_bill.avg_day_of_month</var></b> você costuma pagar sua conta <b><var>=ivars.temp_missing_bill.description</var></b>\"}}","content_body":"Este mês ainda não localizei esse pagamento","notification":"Surgiu um alerta aqui de conta em aberto e quero conferir contigo. Vamos checar? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"Clique aqui para já resolver isso\",\"link\":\"deeplink://pagamentos\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Tô de olho nas suas finanças e vi que por volta do dia <b><var>=ivars.temp_missing_bill.avg_day_of_month</var></b> você costuma pagar sua conta <b><var>=ivars.temp_missing_bill.description</var></b>","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"Clique aqui para já resolver isso","internal_link_link":"deeplink://pagamentos","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-26T19:53:08.238Z","end_date":"2052-06-28T20:08:42.575Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-06-28T20:08:42.632Z","updated_by":"renato.lotto@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"alert","barrier":"Esquecimento do pagamento ou desorganização.","behavior":"Usuário ter controle sobre as suas contas.","benefits":"Ajudar o usuário a se organizar melhor e, caso tenha esquecido, pagar o quanto antes para evitar mais juros.","cooldown":"360","feed_cta":"quero ver","feed_body":"Estou vendo uma conta em aberto e resolvi te perguntar. Será que é isso mesmo?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"8","cooldownEngaged":"360","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"360","notification_type":"insight","cooldownFrustrated":"360","cooldownInteracted":"360","cooldownThumbsDown":"360","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"808","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"missing_bills_history","type":"ivars","value":[]},{"name":"aggregate_missing_bills","type":"rvars","value":[{"hash":"12344321","avg_amount":500,"description":"CONTA DE LUZ","avg_day_of_month":9}]}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":808,"name":"Has Missing BIlls","rule":[{"code":"const moment = require('moment');\nif (!rvars || !rvars.aggregate_missing_bills || !rvars.aggregate_missing_bills.length) {\n  return 0;\n}\n\nconst { missing_bills_history = {} } = ivars || {};\nfor (const bill of rvars.aggregate_missing_bills) {\n  const { hash, description, customized_description, avg_day_of_month, avg_amount } = bill;\n  if (hash == null || description == null || avg_day_of_month == null || avg_amount == null) continue;\n  let lastTime = 0;\n  for (const key in missing_bills_history) {\n    const [keyHash, keyDesc, keyCustomDesc] = key.split('|');\n    if (\n      hash == parseInt(keyHash) ||\n      (description.length && description == keyDesc) ||\n      (keyCustomDesc.length && customized_description == keyCustomDesc)\n    ) {\n      lastTime = Math.max(missing_bills_history[key], lastTime);\n    }\n  }\n  let month_to_check = moment().month();\n\n  if(moment().date() <= avg_day_of_month) {\n    month_to_check = (month_to_check + 11) % 12;\n  }\n\n  if(moment().diff(moment(lastTime), 'month') > 0 && moment().isBefore(moment([moment().year(), month_to_check, avg_day_of_month]).add(7,'days'))) {\n    return 1;\n  }\n}\n\nreturn 0;","type":"custom","description":"Check if user has missing bills"}],"updated_at":"2021-04-07T21:30:12.46234","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_808"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37206},{"promotion_id":"10118","name":"inf_alert_you_got_paid_not_spender","convo_template":"tpt_itau_base_no_options_no_cooldown","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"const moment = require('moment');\\n\\nlet current_transaction = false;\\nlet failsafe = false;\\n\\nfor(const transaction of rvars.agg.income_transactions.last_7d) {\\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\\n    || !(transaction.olivia_category_id == 150300)\\n    ) continue;\\n\\n  failsafe = transaction;\\n\\n  if(!!ivars.you_got_paid_paycheck_historic\\n      && ivars.you_got_paid_paycheck_historic.some((hist) => hist == transaction.transaction_id)) continue;\\n  current_transaction = transaction;\\n}\\n\\n// Memory control\\nif (current_transaction) {\\n  ivars.you_got_paid_paycheck_historic = ivars.you_got_paid_paycheck_historic || [];\\n  ivars.you_got_paid_paycheck_historic.push(current_transaction.transaction_id);\\n}\\n\\n// Failsafe\\nif (!current_transaction) {\\n  current_transaction = failsafe;\\n}\\n\\nivars.temp_current_transaction_amount = current_transaction.amount;\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"O dia do recebimento é uma boa hora para separar aquele dinheirinho e <b>investir</b>\"}}","code_body":"const moment = require('moment');\n\nlet current_transaction = false;\nlet failsafe = false;\n\nfor(const transaction of rvars.agg.income_transactions.last_7d) <var>enc$\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n    || !(transaction.olivia_category_id == 150300)\n    ) continue;\n\n  failsafe = transaction;\n\n  if(!!ivars.you_got_paid_paycheck_historic\n      && ivars.you_got_paid_paycheck_historic.some((hist) => hist == transaction.transaction_id)) continue;\n  current_transaction = transaction;\n</var>\n\n// Memory control\nif (current_transaction) <var>enc$\n  ivars.you_got_paid_paycheck_historic = ivars.you_got_paid_paycheck_historic || [];\n  ivars.you_got_paid_paycheck_historic.push(current_transaction.transaction_id);\n</var>\n\n// Failsafe\nif (!current_transaction) <var>enc$\n  current_transaction = failsafe;\n</var>\n\nivars.temp_current_transaction_amount = current_transaction.amount;","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Você recebeu seu salário. O valor que entrou na conta é de <b><var>=currency(ivars.temp_current_transaction_amount)</var></b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"O dia do recebimento é uma boa hora para separar aquele dinheirinho e <b>investir</b>","notification":"Trago boas notícias! Seu salário entrou na conta. Vem ver! ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"Clique aqui e faça já um investimento!\",\"link\":\"deeplink://spa/investimentos-robo-advisor\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Você recebeu seu salário. O valor que entrou na conta é de <b><var>=currency(ivars.temp_current_transaction_amount)</var></b>","notification_2":"Vi aqui seu salário caindo na conta ","notification_3":"Boa nova pra você: salário na sua conta. Corre aqui! ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"Clique aqui e faça já um investimento!","internal_link_link":"deeplink://spa/investimentos-robo-advisor","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-25T20:01:41.752Z","end_date":"2052-06-28T20:43:16.572Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-06-28T20:43:16.635Z","updated_by":"renato.lotto@mailer.com.br","version":16,"profile_group_id":14,"previous_version":15,"convo_header":{"type":"alert","barrier":"Avisar o pagamento do salário, sem que o usuário precise consultar o extrato da conta corrente.","behavior":"Fazer com que o usuário acompanhe as entradas em sua conta corrente.","benefits":"Ajudar o usuário a criar o hábito de investir o dinheiro de seu salário.","cooldown":"0","feed_cta":"quero ver","feed_body":"Eu ouvi salário?! Tem dinheiro novo no pedaço!","categories":"150300","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"quanto recebi","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"0","cooldownEngaged":"0","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"0","notification_type":"insight","cooldownFrustrated":"0","cooldownInteracted":"0","cooldownThumbsDown":"0","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"812,800","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["got paid"]},"visible":true,"deleted":false,"default_values":[{"name":"you_got_paid_paycheck_historic","type":"ivars","value":[]},{"name":"agg.income_transactions.last_7d","type":"rvars","value":[{"amount":4570,"timestamp":1618346075743,"description":"Salario","formatted_date":"13/04/21","transaction_id":"60756783e748f9001de6b00c","olivia_category_id":150300}]}],"etl_aggregations":[{"etl_aggregation_id":"753","etl_aggregation_name":"Income Transactions Since 7 Days Ago","rvar_object":"income_transactions","rvar_variable":"last_7d","rule":{"code":"    const moment = require('moment');\n\n    const LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS = [103, 104, 105, 201, 202, 203];\n    const seven_days_ago = moment.utc().subtract(7, 'days').startOf('day').valueOf();\n    const current_time = moment.utc().valueOf();\n    const income_array = [];\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.cashflow_type === 'in'\n            && !LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS.includes(transaction.account_type_id)\n            && transaction.enabled\n            && !transaction.pending\n            && m >= seven_days_ago\n            && m <= current_time\n        ) {\n            const transaction_data = {\n                amount: transaction.amount,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                transaction_id: transaction.transaction_id,\n                olivia_category_id: transaction.olivia_category_id,\n                description: transaction.description\n            };\n\n            income_array.push(transaction_data);\n        }\n    }\n\n    income_array.sort((a, b) => a.timestamp - b.timestamp);\n\n    return income_array;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate income transactions since the last 7 days","invert_value":true},"updated_at":"2021-04-14T14:18:45.963Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":812,"name":"Has Got Paid Paycheck","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.income_transactions\n    || !rvars.agg.income_transactions.last_7d) return 0;\n\n  for (const transaction of rvars.agg.income_transactions.last_7d) {\n    if (moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n      || !(transaction.olivia_category_id == 150300)\n      || (transaction.amount < 100)\n    ) continue;\n\n    if (!!ivars.you_got_paid_paycheck_historic\n      && ivars.you_got_paid_paycheck_historic.some((hist) => hist == transaction.transaction_id)) continue;\n\n    return 1;\n  }\n\n  return 0;\n","type":"custom","description":"Check for recent paycheck not on historic"}],"updated_at":"2022-03-25T17:33:47.375","updated_by":"renato.lotto@mailer.com.br","applicability_name":"applicability_rule_id_812"},{"applicability_rule_id":800,"name":"Income > Spending in the last 3 closed Months","rule":[{"code":"  if (!dat\n    || !dat.profile_overview_panel_section\n    || !dat.profile_overview_panel_section.totals.income\n    || !dat.profile_overview_panel_section.totals.spending\n  ) return false;\n\n  const _ = require('lodash');\n  const moment = require('moment');\n\n  const income_data = _.get(dat.profile_overview_panel_section, 'totals.income');\n  const spending_data = _.get(dat.profile_overview_panel_section, 'totals.spending');\n\n  // Get closed months only\n  const months = [\n    moment().startOf('month').subtract(3, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(2, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(1, 'month').format('YYYY-MM-DD')\n  ];\n\n  const monthly_income = months.map((date) => {\n    const object = _.find(income_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  const monthly_spending = months.map((date) => {\n    const object = _.find(spending_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  return monthly_spending <= monthly_income;\n","type":"custom","description":""}],"updated_at":"2021-11-25T21:34:44.17071","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_800"}],"shadow":false,"requires_etls":["income_transactions.last_7d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37164},{"promotion_id":"10119","name":"inf_alert_you_got_paid_spender","convo_template":"tpt_itau_base_no_options_no_cooldown","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"const moment = require('moment');\\n\\nlet current_transaction = false;\\nlet failsafe = false;\\n\\nfor(const transaction of rvars.agg.income_transactions.last_7d) {\\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\\n    || !(transaction.olivia_category_id == 150300)\\n    ) continue;\\n\\n  failsafe = transaction;\\n\\n  if(!!ivars.you_got_paid_paycheck_historic\\n      && ivars.you_got_paid_paycheck_historic.some((hist) => hist == transaction.transaction_id)) continue;\\n  current_transaction = transaction;\\n}\\n\\n// Memory control\\nif (current_transaction) {\\n  ivars.you_got_paid_paycheck_historic = ivars.you_got_paid_paycheck_historic || [];\\n  ivars.you_got_paid_paycheck_historic.push(current_transaction.transaction_id);\\n}\\n\\n// Failsafe\\nif (!current_transaction) {\\n  current_transaction = failsafe;\\n}\\n\\nivars.temp_current_transaction_amount = current_transaction.amount;\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Saber para onde seu dinheiro vai é o 1º passo para controlar o orçamento\"}}","code_body":"const moment = require('moment');\n\nlet current_transaction = false;\nlet failsafe = false;\n\nfor(const transaction of rvars.agg.income_transactions.last_7d) <var>enc$\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n    || !(transaction.olivia_category_id == 150300)\n    ) continue;\n\n  failsafe = transaction;\n\n  if(!!ivars.you_got_paid_paycheck_historic\n      && ivars.you_got_paid_paycheck_historic.some((hist) => hist == transaction.transaction_id)) continue;\n  current_transaction = transaction;\n</var>\n\n// Memory control\nif (current_transaction) <var>enc$\n  ivars.you_got_paid_paycheck_historic = ivars.you_got_paid_paycheck_historic || [];\n  ivars.you_got_paid_paycheck_historic.push(current_transaction.transaction_id);\n</var>\n\n// Failsafe\nif (!current_transaction) <var>enc$\n  current_transaction = failsafe;\n</var>\n\nivars.temp_current_transaction_amount = current_transaction.amount;","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Você acabou de receber seu salário. O valor que entrou na conta é de <b><var>=currency(ivars.temp_current_transaction_amount)</var></b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Saber para onde seu dinheiro vai é o 1º passo para controlar o orçamento","notification":"Trago boas notícias! Seu salário entrou na conta. Vem ver! ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Você acabou de receber seu salário. O valor que entrou na conta é de <b><var>=currency(ivars.temp_current_transaction_amount)</var></b>","notification_2":"Vi aqui seu salário caindo na conta ","notification_3":"Boa nova pra você: salário na sua conta. Corre aqui! ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-25T20:23:09.477Z","end_date":"2052-06-28T20:45:32.092Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-06-28T20:45:32.165Z","updated_by":"renato.lotto@mailer.com.br","version":15,"profile_group_id":14,"previous_version":14,"convo_header":{"type":"alert","barrier":"Avisar que seu salário está disponível, sem que o usuário precise consultar o extrato da conta corrente.","behavior":"Fazer com que o usuário acompanhe entradas extras em sua conta corrente.","benefits":"Ajudar o usuário a criar o hábito de verificar suas entradas.","cooldown":"0","feed_cta":"quero ver","feed_body":"Eu ouvi salário?! Tem dinheiro novo no pedaço!","categories":"150300","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"quanto recebi","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"0","cooldownEngaged":"0","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"0","notification_type":"insight","cooldownFrustrated":"0","cooldownInteracted":"0","cooldownThumbsDown":"0","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"812,799","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["got paid"]},"visible":true,"deleted":false,"default_values":[{"name":"you_got_paid_paycheck_historic","type":"ivars","value":[]},{"name":"agg.income_transactions.last_7d","type":"rvars","value":[{"amount":4570,"timestamp":1618346075743,"description":"Salario","formatted_date":"13/04/21","transaction_id":"60756783e748f9001de6b00c","olivia_category_id":150300}]}],"etl_aggregations":[{"etl_aggregation_id":"753","etl_aggregation_name":"Income Transactions Since 7 Days Ago","rvar_object":"income_transactions","rvar_variable":"last_7d","rule":{"code":"    const moment = require('moment');\n\n    const LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS = [103, 104, 105, 201, 202, 203];\n    const seven_days_ago = moment.utc().subtract(7, 'days').startOf('day').valueOf();\n    const current_time = moment.utc().valueOf();\n    const income_array = [];\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.cashflow_type === 'in'\n            && !LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS.includes(transaction.account_type_id)\n            && transaction.enabled\n            && !transaction.pending\n            && m >= seven_days_ago\n            && m <= current_time\n        ) {\n            const transaction_data = {\n                amount: transaction.amount,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                transaction_id: transaction.transaction_id,\n                olivia_category_id: transaction.olivia_category_id,\n                description: transaction.description\n            };\n\n            income_array.push(transaction_data);\n        }\n    }\n\n    income_array.sort((a, b) => a.timestamp - b.timestamp);\n\n    return income_array;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate income transactions since the last 7 days","invert_value":true},"updated_at":"2021-04-14T14:18:45.963Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":812,"name":"Has Got Paid Paycheck","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.income_transactions\n    || !rvars.agg.income_transactions.last_7d) return 0;\n\n  for (const transaction of rvars.agg.income_transactions.last_7d) {\n    if (moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n      || !(transaction.olivia_category_id == 150300)\n      || (transaction.amount < 100)\n    ) continue;\n\n    if (!!ivars.you_got_paid_paycheck_historic\n      && ivars.you_got_paid_paycheck_historic.some((hist) => hist == transaction.transaction_id)) continue;\n\n    return 1;\n  }\n\n  return 0;\n","type":"custom","description":"Check for recent paycheck not on historic"}],"updated_at":"2022-03-25T17:33:47.375","updated_by":"renato.lotto@mailer.com.br","applicability_name":"applicability_rule_id_812"},{"applicability_rule_id":799,"name":"Income < Spending in the last 3 closed Months","rule":[{"code":"  if (!dat\n    || !dat.profile_overview_panel_section\n    || !dat.profile_overview_panel_section.totals.income\n    || !dat.profile_overview_panel_section.totals.spending\n  ) return false;\n\n  const _ = require('lodash');\n  const moment = require('moment');\n\n  const income_data = _.get(dat.profile_overview_panel_section, 'totals.income');\n  const spending_data = _.get(dat.profile_overview_panel_section, 'totals.spending');\n\n  // Get closed months only\n  const months = [\n    moment().startOf('month').subtract(3, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(2, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(1, 'month').format('YYYY-MM-DD')\n  ];\n\n  const monthly_income = months.map((date) => {\n    const object = _.find(income_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  const monthly_spending = months.map((date) => {\n    const object = _.find(spending_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  return monthly_spending > monthly_income;\n","type":"custom","description":""}],"updated_at":"2021-11-25T21:34:44.17071","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_799"}],"shadow":false,"requires_etls":["income_transactions.last_7d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37225},{"promotion_id":"10121","name":"inf_uso_cartao_virtual","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"A primeira é o cartão virtual <b>temporário</b>, indicado para comprar pelo computador ou celular<br /><br />Lembrando que ele deixa de valer depois que for usado por você ou em 48 horas\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Tô aqui pra te apresentar as opções mais seguras para compras online!\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"A primeira é o cartão virtual <b>temporário</b>, indicado para comprar pelo computador ou celular<br /><br />Lembrando que ele deixa de valer depois que for usado por você ou em 48 horas","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"E o recorrente, quer conhecer?\"}}","main_text_body":"Tô aqui pra te apresentar as opções mais seguras para compras online!","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"E o recorrente, quer conhecer?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver outra hora\",\"response\":\"Tudo bem! Depois eu volto pra gente falar mais sobre como comprar com ainda mais segurança\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim! Ele serve pra quê?\",\"response\":\"O cartão virtual <b>recorrente</b> traz segurança para compras que você faz todo mês pela Internet — e só precisa cadastrar o cartão uma vez!<br /><br />É uma boa pedida para pagar assinaturas de TV, delivery de restaurante e transporte<br /><br />Lembrando que ele não expira em 48h nem depois de um uso<br /><br />Para gerar um cartão virtual temporário ou recorrente, acesse <b>cartões > cartão virtual</b>\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não, já conheço!\",\"response\":\"Que bom que você já conhece! É importante saber que existem alternativas para comprar com ainda mais segurança\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver outra hora","user_option_engaged_body":"Sim! Ele serve pra quê?","user_option_dismissed_body":"Não, já conheço!","user_option_delayed_response":"Tudo bem! Depois eu volto pra gente falar mais sobre como comprar com ainda mais segurança","user_option_engaged_response":"O cartão virtual <b>recorrente</b> traz segurança para compras que você faz todo mês pela Internet — e só precisa cadastrar o cartão uma vez!<br /><br />É uma boa pedida para pagar assinaturas de TV, delivery de restaurante e transporte<br /><br />Lembrando que ele não expira em 48h nem depois de um uso<br /><br />Para gerar um cartão virtual temporário ou recorrente, acesse <b>cartões > cartão virtual</b>","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Que bom que você já conhece! É importante saber que existem alternativas para comprar com ainda mais segurança","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-02T17:29:16.285Z","end_date":"2052-06-28T20:49:05.002Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-06-28T20:49:07.125Z","updated_by":"renato.lotto@mailer.com.br","version":10,"profile_group_id":14,"previous_version":9,"convo_header":{"type":"default","barrier":"Informar para que funciona o cartão virtual e como o usuário utiliza essa funcionalidade","behavior":"Fazer com que o usuário utilize o cartão virtual em compras online e cadastre o cartão virtual em plataformas de compra recorrente (Uber, Ifood, Netflix, etc)","benefits":"Fazer com que as compras online sejam seguras, evitando fraudes com o número do cartão","cooldown":"0","feed_cta":"vamos!","feed_body":"Quero te mostrar duas opções que deixam suas compras virtuais mais seguras! Vamos conversar?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"cartão virtual","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"8760","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"8760","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"843","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"824","etl_aggregation_name":"Credit Card Expenses","rvar_object":"credit_card","rvar_variable":"totals","rule":{"code":"    const moment = require('moment');\n    const last_30d = moment().subtract(30, 'days').startOf('day').valueOf();\n    const last_90d = moment().subtract(90, 'days').startOf('day').valueOf();\n    const last_120d = moment().subtract(120, 'days').startOf('day').valueOf();\n    const last_180d = moment().subtract(180, 'days').startOf('day').valueOf();\n    const credit_card_transactions = transactions.filter(t => t.enabled && t.account_type_id == 200);\n\n    const credit_card_expenses = credit_card_transactions.filter(t =>\n        (t.budget_type === 'variable' || t.budget_type === 'fixed')\n        && t.cashflow === true\n        && t.cashflow_type === 'out');\n\n    const spending_30d = credit_card_expenses.filter(t => t.date.getTime() >= last_30d).reduce((acc, item) => acc - item.amount, 0);\n    const spending_90d = credit_card_expenses.filter(t => t.date.getTime() >= last_90d).reduce((acc, item) => acc - item.amount, 0);\n    const spending_120d = credit_card_expenses.filter(t => t.date.getTime() >= last_120d).reduce((acc, item) => acc - item.amount, 0);\n    const spending_180d = credit_card_expenses.filter(t => t.date.getTime() >= last_180d).reduce((acc, item) => acc - item.amount, 0);\n    return { spending_30d, spending_90d, spending_120d, spending_180d };\n","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2023-02-06T18:12:31.927Z","updated_by":"leonardo-flavio.santos@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":843,"name":"Credit Card Expenses >= 50 in the last 30 Days","rule":[{"code":"    if (!rvars.agg\n        || !rvars.agg.credit_card\n        || !rvars.agg.credit_card.totals\n        || !rvars.agg.credit_card.totals.spending_30d\n    ) return false;\n\n    if (rvars.agg.credit_card.totals.spending_30d >= 50) return true;\n\n    return false;\n","type":"custom","description":""}],"updated_at":"2021-08-27T14:13:20.720504","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_843"}],"shadow":false,"requires_etls":["credit_card.totals"],"conversation_group":"convos_itau_app_users","conversation_map_id":37174},{"promotion_id":"10128","name":"inf_alert_you_got_paid_spender_other_gains","convo_template":"tpt_itau_base_no_options_no_cooldown","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"const moment = require('moment');\\n\\nlet current_transaction = false;\\nlet failsafe = false;\\n\\nfor(const transaction of rvars.agg.income_transactions.last_7d) {\\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\\n    || transaction.olivia_category_id == 150300\\n    || !(transaction.amount > 200)\\n  ) continue;\\n\\n  failsafe = transaction;\\n\\n  if(!!ivars.you_got_paid_other_gains_historic\\n      && ivars.you_got_paid_other_gains_historic.some((hist) => hist == transaction.transaction_id)) continue;\\n  current_transaction = transaction;\\n}\\n\\n// Memory control\\nif (current_transaction) {\\n  ivars.you_got_paid_other_gains_historic = ivars.you_got_paid_other_gains_historic || [];\\n  ivars.you_got_paid_other_gains_historic.push(current_transaction.transaction_id);\\n}\\n\\n// Failsafe\\nif (!current_transaction) {\\n  current_transaction = failsafe;\\n}\\n\\nivars.temp_current_transaction_amount = current_transaction.amount;\\nivars.temp_current_transaction_description = current_transaction.description;\\n\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Saber para onde ele vai é o 1º passo para controlar o orçamento\"}}","code_body":"const moment = require('moment');\n\nlet current_transaction = false;\nlet failsafe = false;\n\nfor(const transaction of rvars.agg.income_transactions.last_7d) <var>enc$\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n    || transaction.olivia_category_id == 150300\n    || !(transaction.amount > 200)\n  ) continue;\n\n  failsafe = transaction;\n\n  if(!!ivars.you_got_paid_other_gains_historic\n      && ivars.you_got_paid_other_gains_historic.some((hist) => hist == transaction.transaction_id)) continue;\n  current_transaction = transaction;\n</var>\n\n// Memory control\nif (current_transaction) <var>enc$\n  ivars.you_got_paid_other_gains_historic = ivars.you_got_paid_other_gains_historic || [];\n  ivars.you_got_paid_other_gains_historic.push(current_transaction.transaction_id);\n</var>\n\n// Failsafe\nif (!current_transaction) <var>enc$\n  current_transaction = failsafe;\n</var>\n\nivars.temp_current_transaction_amount = current_transaction.amount;\nivars.temp_current_transaction_description = current_transaction.description;\n","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi que sua conta recebeu o pagamento <b><var>=ivars.temp_current_transaction_description</var></b>. O valor que entrou é de <b><var>=currency(ivars.temp_current_transaction_amount)</var></b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Saber para onde ele vai é o 1º passo para controlar o orçamento","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Vi que sua conta recebeu o pagamento <b><var>=ivars.temp_current_transaction_description</var></b>. O valor que entrou é de <b><var>=currency(ivars.temp_current_transaction_amount)</var></b>","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-26T20:31:47.831Z","end_date":"2052-06-28T21:00:53.396Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-06-28T21:00:53.476Z","updated_by":"renato.lotto@mailer.com.br","version":14,"profile_group_id":14,"previous_version":13,"convo_header":{"type":"alert","barrier":"Avisar um pagamento extra disponível, sem que o usuário precise consultar o extrato da conta corrente.","behavior":"Fazer com que o usuário acompanhe entradas extras em sua conta corrente.","benefits":"Ajudar o usuário a criar o hábito de verificar suas entradas.","cooldown":"0","feed_cta":"quero ver","feed_body":"Tem um dinheiro pingando na sua conta! Quer conferir?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"quanto recebi","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"0","cooldownEngaged":"0","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"0","notification_type":"insight","cooldownFrustrated":"0","cooldownInteracted":"0","cooldownThumbsDown":"0","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"799,813","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["got paid"]},"visible":true,"deleted":false,"default_values":[{"name":"you_got_paid_other_gains_historic","type":"ivars","value":[]},{"name":"agg.income_transactions.last_7d","type":"rvars","value":[{"amount":500,"timestamp":1618782808214,"description":"Rendimentos NuConta (abr/21)","formatted_date":"18/04/21","transaction_id":"60756783e748f9001de6b00c","olivia_category_id":150700}]}],"etl_aggregations":[{"etl_aggregation_id":"753","etl_aggregation_name":"Income Transactions Since 7 Days Ago","rvar_object":"income_transactions","rvar_variable":"last_7d","rule":{"code":"    const moment = require('moment');\n\n    const LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS = [103, 104, 105, 201, 202, 203];\n    const seven_days_ago = moment.utc().subtract(7, 'days').startOf('day').valueOf();\n    const current_time = moment.utc().valueOf();\n    const income_array = [];\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.cashflow_type === 'in'\n            && !LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS.includes(transaction.account_type_id)\n            && transaction.enabled\n            && !transaction.pending\n            && m >= seven_days_ago\n            && m <= current_time\n        ) {\n            const transaction_data = {\n                amount: transaction.amount,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                transaction_id: transaction.transaction_id,\n                olivia_category_id: transaction.olivia_category_id,\n                description: transaction.description\n            };\n\n            income_array.push(transaction_data);\n        }\n    }\n\n    income_array.sort((a, b) => a.timestamp - b.timestamp);\n\n    return income_array;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate income transactions since the last 7 days","invert_value":true},"updated_at":"2021-04-14T14:18:45.963Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":799,"name":"Income < Spending in the last 3 closed Months","rule":[{"code":"  if (!dat\n    || !dat.profile_overview_panel_section\n    || !dat.profile_overview_panel_section.totals.income\n    || !dat.profile_overview_panel_section.totals.spending\n  ) return false;\n\n  const _ = require('lodash');\n  const moment = require('moment');\n\n  const income_data = _.get(dat.profile_overview_panel_section, 'totals.income');\n  const spending_data = _.get(dat.profile_overview_panel_section, 'totals.spending');\n\n  // Get closed months only\n  const months = [\n    moment().startOf('month').subtract(3, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(2, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(1, 'month').format('YYYY-MM-DD')\n  ];\n\n  const monthly_income = months.map((date) => {\n    const object = _.find(income_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  const monthly_spending = months.map((date) => {\n    const object = _.find(spending_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  return monthly_spending > monthly_income;\n","type":"custom","description":""}],"updated_at":"2021-11-25T21:34:44.17071","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_799"},{"applicability_rule_id":813,"name":"Has Got Paid Other Gains","rule":[{"code":"const moment = require('moment');\n\nif (!rvars\n  || !rvars.agg\n  || !rvars.agg.income_transactions\n  || !rvars.agg.income_transactions.last_7d) return 0;\n\nfor(const transaction of rvars.agg.income_transactions.last_7d) {\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n    || transaction.olivia_category_id == 150300\n    || !(transaction.amount > 200)\n  ) continue;\n\n  if(!!ivars.you_got_paid_other_gains_historic\n      && ivars.you_got_paid_other_gains_historic.some((hist) => hist == transaction.transaction_id)) continue;\n\n  return 1;\n}\n\nreturn 0;","type":"custom","description":"Check for recent income not paychecks, not on historic"}],"updated_at":"2021-04-22T12:42:22.910937","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_813"}],"shadow":false,"requires_etls":["income_transactions.last_7d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37231},{"promotion_id":"10131","name":"inf_beneficio_cartao_visa","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"São descontos, ações de cashback, sorteios e a possibilidade de apoiar causas sociais\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Esse programa oferece vantagens a todos os cartões Visa. Veja quais <b>benefícios</b> estão disponíveis para o seu cartão\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"São descontos, ações de cashback, sorteios e a possibilidade de apoiar causas sociais","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer cadastrar o seu cartão?\"}}","main_text_body":"Esse programa oferece vantagens a todos os cartões Visa. Veja quais <b>benefícios</b> estão disponíveis para o seu cartão","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"https://vaidevisa.visa.com.br/vdv/","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer cadastrar o seu cartão?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro fazer isso depois\",\"response\":\"Tudo bem! Depois eu volto e continuamos esta conversa\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Boa, não perca tempo!<br /><br />Ao se cadastrar no programa, você tem descontos para estudar, cuidar da saúde, buscar um emprego e muito mais<br /><br />E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\",\"link_text\":\"Clique aqui para fazer agora o seu cadastro no Vai de Visa\",\"link\":\"https://vaidevisa.visa.com.br/vdv/\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse, valeu\",\"response\":\"Sem problemas! Em breve eu volto com novas ideias pra você\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro fazer isso depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não tenho interesse, valeu","user_option_delayed_response":"Tudo bem! Depois eu volto e continuamos esta conversa","user_option_engaged_response":"Boa, não perca tempo!<br /><br />Ao se cadastrar no programa, você tem descontos para estudar, cuidar da saúde, buscar um emprego e muito mais<br /><br />E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","user_option_delayed_link_text":"","user_option_engaged_link_text":"Clique aqui para fazer agora o seu cadastro no Vai de Visa","user_option_dismissed_response":"Sem problemas! Em breve eu volto com novas ideias pra você","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-31T18:53:45.098Z","end_date":"2052-06-28T21:05:15.981Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-06-28T21:05:16.054Z","updated_by":"renato.lotto@mailer.com.br","version":6,"profile_group_id":14,"previous_version":5,"convo_header":{"type":"default","barrier":"Mostrar os benefícios e onde o usuário pode se cadastrar.","behavior":"Fazer com que o usuário se cadastre no programa de benefícios da Visa.","benefits":"Fazer com que o usuário use os benefícios da Visa e economize em suas compras.","cooldown":"8640","feed_cta":"quero saber!","feed_body":"Já ouviu falar no programa Vai de Visa? Vem conhecer e cadastrar agora o seu cartão!","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"benefícios","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"low","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8640","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2160","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"8640","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"851","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":851,"name":"Itau Beneficio Visa","rule":[{"code":"    if (!rvars\n        || !rvars.itau_credit_card_info\n        || !(rvars.itau_credit_card_info.length > 0)) return false;\n\n    const regex = /visa/i;\n\n    for (const credit_card of rvars.itau_credit_card_info) {\n        if (regex.test(credit_card.credit_card_brand) && credit_card.credit_card_expenses_01m >= 100) return true;\n    }\n\n    return false;\n","type":"custom","description":""}],"updated_at":"2021-09-30T17:16:58.915968","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_851"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37189},{"promotion_id":"10147","name":"inf_alert_restituicao_ir","convo_template":"tpt_itau_alert_restituicao_ir","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Aproveite e transfira agora esse dinheiro extra para uma aplicação\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Estou aqui pra te avisar que você recebeu sua restituição do IR no valor de <b><var>=currency(ivars.temp_current_transaction.amt)</var></b>\"}}","content_body":"Aproveite e transfira agora esse dinheiro extra para uma aplicação","notification":"Tenho boas notícias: sua restituição de IR está na conta! ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Estou aqui pra te avisar que você recebeu sua restituição do IR no valor de <b><var>=currency(ivars.temp_current_transaction.amt)</var></b>","user_engaged_link":"","external_link_body":"","external_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-15T17:41:53.958Z","end_date":"2052-06-29T18:14:19.385Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-06-29T18:14:19.443Z","updated_by":"renato.lotto@mailer.com.br","version":13,"profile_group_id":14,"previous_version":8,"convo_header":{"type":"default","barrier":"Avisar que o dinheiro da restituição do imposto de renda está disponível, sem que o usuário precise ficar consultando seu extrato da conta corrente.","behavior":"Fazer com que o usuário acompanhe entradas extras em sua conta corrente.","benefits":"Ajudar o usuário a criar o hábito de investir o dinheiro de entradas extras.","cooldown":"0","feed_cta":"quero ver","feed_body":"Vem logo saber quanto entrou na sua conta da restituição de IR!","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"equilibrando as contas","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"72","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"793","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":793,"name":"Has IR Tax Returns","rule":[{"code":"if (!rvars\n  || !rvars.aggregate_other_income\n  || !rvars.aggregate_other_income.tax_refund_transactions\n  || !rvars.aggregate_other_income.tax_refund_transactions.length\n) return false;\n\nif (!ivars.tax_refund_history) return true;\n\n// find next not shown\nlet show = false;\nfor (const i in rvars.aggregate_other_income.tax_refund_transactions) {\n  show = true;\n  for (const j in ivars.tax_refund_history) {\n    if (rvars.aggregate_other_income.tax_refund_transactions[i].transaction_id == ivars.tax_refund_history[j]) {\n      show = false;\n      break;\n    }\n  }\n\n  if (show) {\n    return true;\n  }\n}\n\nreturn false;","type":"custom","description":"Check if user has a recent IR Tax Returns transaction"}],"updated_at":"2021-04-01T18:17:12.648464","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_793"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37224},{"promotion_id":"10170","name":"idl_teste_2","convo_template":"tpt_itau_summary","convo_variables":{"cta":"Veja aqui","code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","text":"Texto Conteúdo","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","emoji":"🤔","title":"Sua conta de água subiu 24%","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"context\"}}","message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.any_spend.last_30_days</var> </b>por ano.","feedback":":|","cabecalho":"","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"main\"}}","read_time":"3-5 min","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"disclaimer\"}}","button_text":"Repetido","description":"gastos com restaurante","content_body":"context","content_link":"","content_text":"Com essa dica você pode economizar <b>até 20%</b> isso significaria <b>R$ <var>=rvars.agg.l2cat110300.amt60d</var> </b>no seu bolso todo mês.<br />O <b>MercadoFlix</b> é um serviço de entrega recorrente de supermercado. Você mostra sua cesta de compras, agenda a data para receber tudo em casa.<br />Sem cobrar taxa de adesão ou frete, o MercadoFlix também não exige valor mínimo de compra.","link_externo":"","link_interno":"","notification":"Diminua seus gastos com supermercado ","cabecalho_cta":"Veja mais","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","texto_chamada":"","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"wordcloud\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"textinput\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"main","main_text_text":"nos últimos <b>30 dias</b> você gastou com supermercados","notification_2":" ","notification_3":" ","texto_conteudo":"","cabecalho_emoji":"🤔","cabecalho_title":"Sua conta de água subiu 24%","conteudo_1_link":"https://google.com","disclaimer_body":"disclaimer","cabecalho_message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.google_play.amt30d</var></b> por ano.","user_engaged_link":"","call_to_action@cta":"","call_to_action_cta":"Você gostaria de conhecer mais a MercadoFlix?","external_link_body":"","external_link_link":"","external_link_text":"Ir para MercadoFlix","internal_link_body":"","internal_link_link":"","internal_link_text":"Ir para o resumo do mês","texto_chamada@text":"Teste<br />Teste<br /><b>Teste</b>","texto_chamada_text":"Texto Chamada","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","cabecalho_read_time":"3-5 min","call_to_action_body":"","featured_value_body":"","featured_value_text":"<b>R$ <var>=rvars.agg.l2cat110300.amt30d</var></b>","texto_conteudo@text":"","texto_conteudo_text":"Texto Conteúdo","user_option_1_reply":"Legal! Te explico como usar em apenas 3 passos:<br />1º Crie sua lista de compras pensando no que é essencial para a sua casa<br />...<br />E pronto! Gostou? Visite o site do MercadoFlix","user_option_2_reply":"","user_option_3_reply":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"delayed\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"engaged\",\"link_text\":\"\",\"link\":\"\"}}","cabecalho_description":"gastos com restaurante","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"dismissed\",\"link_text\":\"\"}}","user_option_1@feedback":"","user_option_1_feedback":"wordcloud","user_option_1_response":"","user_option_2@feedback":"","user_option_2_feedback":"textinput","user_option_2_response":"","user_option_3@feedback":"","user_option_3_feedback":"","user_option_3_response":"","call_to_action_feedback":"<b>Você sabe o que aconteceu?</b>","user_option_delayed_body":"","user_option_engaged_body":"","user_option_1_button_text":"Sim, claro","user_option_2_button_text":"Não tenho interesse","user_option_3_button_text":"","link_externo@external_link":"Link <u><font color=\"LINK_COLOR\">xoxo</font></u> :)","link_interno@internal_link":"","link_interno_internal_link":"itau:summary/monthly","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"delayed","user_option_engaged_feedback":"","user_option_engaged_response":"engaged","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"dismissed","link_externo_external_link_text":"Ir para Mercadoflix","link_interno_internal_link_text":"Ir para resumo mensal","user_option_dismissed_link_text":"","texto_conteudo_texto_chamada_text":"Texto Conteúdo","user_option_2_user_option_1_feedback":"Oxe","user_option_2_user_option_1_button_text":"Não","user_option_3_user_option_2_user_option_1_feedback":"E agora, <b>José</b>? 👀","user_option_3_user_option_2_user_option_1_button_text":"Talvez"},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-04T18:45:37.393Z","end_date":"2052-08-16T20:08:58.456Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-08-16T20:08:58.385Z","updated_by":"luciana.pavan@mailer.com.br","version":2,"profile_group_id":14,"previous_version":1,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"ABCDEFGHIJKLMNOPQRSTUWVXZ","feed_body":"ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ","categories":"10400","feed_emoji":"🤔","feed_media":"","feed_title":"gastos com supermercado","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"supermercado","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"3-5 min","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"574,2147483649","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"681","etl_aggregation_name":"Google Play - Last_30_Days","rvar_object":"google_play","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"transaction_property_ids":["google_play"]},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"308","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 60 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"641","etl_aggregation_name":"Any spend - 30 days ago","rvar_object":"any_spend","rvar_variable":"last_30_days","rule":{"code":"const _ = require('lodash');\nconst moment = require('moment');\n\nconst oneMonthAgo = moment().subtract(1, 'month').startOf('day').valueOf();\n\ntransactions = transactions.filter(t => t.date.getTime() >= oneMonthAgo && t.enabled && t.budget_type === 'variable' && t.cashflow === true && t.cashflow_type === 'out');\n\nlet amt30d = 0;\n\nif (transactions) {\n    amt30d = -_.sumBy(transactions, 'amount');\n}\n\nreturn {\n  amt30d\n}","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":574,"name":"Everyone - Constant 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":1,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_574"},{"applicability_rule_id":2147483649,"name":"Specific profile_ids","rule":[{"code":"    if (!dat.profile_settings\n        || !dat.profile_settings.name) return false;\n\n    if (parseInt(dat.profile_settings.name) == 17316797) return true;\n\n    return false;\n","type":"custom","description":"Select specific profile ids to send the insight"}],"updated_at":"2022-05-18T14:43:11.204858","updated_by":"ivanir@olivia.ai","applicability_name":"applicability_rule_id_2147483649"}],"shadow":false,"requires_etls":["l2cat110300.amt30d","google_play.amt30d","l2cat110300.amt60d","any_spend.last_30_days"],"conversation_group":"convos_itau_app_users","conversation_map_id":37188},{"promotion_id":"10174","name":"idl_teste_4","convo_template":"tpt_itau_summary","convo_variables":{"cta":"Veja aqui","code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","text":"Texto Conteúdo","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","emoji":"🤔","title":"Sua conta de água subiu 24%","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"context\"}}","message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.any_spend.last_30_days</var> </b>por ano.","feedback":":|","cabecalho":"","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"main\"}}","read_time":"3-5 min","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"disclaimer\"}}","button_text":"Repetido","description":"gastos com restaurante","content_body":"context","content_link":"","content_text":"Com essa dica você pode economizar <b>até 20%</b> isso significaria <b>R$ <var>=rvars.agg.l2cat110300.amt60d</var> </b>no seu bolso todo mês.<br />O <b>MercadoFlix</b> é um serviço de entrega recorrente de supermercado. Você mostra sua cesta de compras, agenda a data para receber tudo em casa.<br />Sem cobrar taxa de adesão ou frete, o MercadoFlix também não exige valor mínimo de compra.","link_externo":"","link_interno":"","notification":"Diminua seus gastos com supermercado ","cabecalho_cta":"Veja mais","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","texto_chamada":"","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"wordcloud\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"textinput\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"main","main_text_text":"nos últimos <b>30 dias</b> você gastou com supermercados","notification_2":" ","notification_3":" ","texto_conteudo":"","cabecalho_emoji":"🤔","cabecalho_title":"Sua conta de água subiu 24%","conteudo_1_link":"https://google.com","disclaimer_body":"disclaimer","cabecalho_message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.google_play.amt30d</var></b> por ano.","user_engaged_link":"","call_to_action@cta":"","call_to_action_cta":"Você gostaria de conhecer mais a MercadoFlix?","external_link_body":"","external_link_link":"","external_link_text":"Ir para MercadoFlix","internal_link_body":"","internal_link_link":"","internal_link_text":"Ir para o resumo do mês","texto_chamada@text":"Teste<br />Teste<br /><b>Teste</b>","texto_chamada_text":"Texto Chamada","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","cabecalho_read_time":"3-5 min","call_to_action_body":"","featured_value_body":"","featured_value_text":"<b>R$ <var>=rvars.agg.l2cat110300.amt30d</var></b>","texto_conteudo@text":"","texto_conteudo_text":"Texto Conteúdo","user_option_1_reply":"Legal! Te explico como usar em apenas 3 passos:<br />1º Crie sua lista de compras pensando no que é essencial para a sua casa<br />...<br />E pronto! Gostou? Visite o site do MercadoFlix","user_option_2_reply":"","user_option_3_reply":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"delayed\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"engaged\",\"link_text\":\"\",\"link\":\"\"}}","cabecalho_description":"gastos com restaurante","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"dismissed\",\"link_text\":\"\"}}","user_option_1@feedback":"","user_option_1_feedback":"wordcloud","user_option_1_response":"","user_option_2@feedback":"","user_option_2_feedback":"textinput","user_option_2_response":"","user_option_3@feedback":"","user_option_3_feedback":"","user_option_3_response":"","call_to_action_feedback":"<b>Você sabe o que aconteceu?</b>","user_option_delayed_body":"","user_option_engaged_body":"","user_option_1_button_text":"Sim, claro","user_option_2_button_text":"Não tenho interesse","user_option_3_button_text":"","link_externo@external_link":"Link <u><font color=\"LINK_COLOR\">xoxo</font></u> :)","link_interno@internal_link":"","link_interno_internal_link":"itau:summary/monthly","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"delayed","user_option_engaged_feedback":"","user_option_engaged_response":"engaged","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"dismissed","link_externo_external_link_text":"Ir para Mercadoflix","link_interno_internal_link_text":"Ir para resumo mensal","user_option_dismissed_link_text":"","texto_conteudo_texto_chamada_text":"Texto Conteúdo","user_option_2_user_option_1_feedback":"Oxe","user_option_2_user_option_1_button_text":"Não","user_option_3_user_option_2_user_option_1_feedback":"E agora, <b>José</b>? 👀","user_option_3_user_option_2_user_option_1_button_text":"Talvez"},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-04T18:45:37.393Z","end_date":"2052-08-16T20:11:55.232Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-08-16T20:11:55.148Z","updated_by":"luciana.pavan@mailer.com.br","version":2,"profile_group_id":14,"previous_version":1,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"vem ver","feed_body":"Oi, temos uma oferta pra você!","categories":"10400","feed_emoji":"🤔","feed_media":"","feed_title":"gastos com supermercado","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"supermercado","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"3-5 min","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"574,2147483649","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"681","etl_aggregation_name":"Google Play - Last_30_Days","rvar_object":"google_play","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"transaction_property_ids":["google_play"]},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"308","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 60 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"641","etl_aggregation_name":"Any spend - 30 days ago","rvar_object":"any_spend","rvar_variable":"last_30_days","rule":{"code":"const _ = require('lodash');\nconst moment = require('moment');\n\nconst oneMonthAgo = moment().subtract(1, 'month').startOf('day').valueOf();\n\ntransactions = transactions.filter(t => t.date.getTime() >= oneMonthAgo && t.enabled && t.budget_type === 'variable' && t.cashflow === true && t.cashflow_type === 'out');\n\nlet amt30d = 0;\n\nif (transactions) {\n    amt30d = -_.sumBy(transactions, 'amount');\n}\n\nreturn {\n  amt30d\n}","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":574,"name":"Everyone - Constant 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":1,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_574"},{"applicability_rule_id":2147483649,"name":"Specific profile_ids","rule":[{"code":"    if (!dat.profile_settings\n        || !dat.profile_settings.name) return false;\n\n    if (parseInt(dat.profile_settings.name) == 17316797) return true;\n\n    return false;\n","type":"custom","description":"Select specific profile ids to send the insight"}],"updated_at":"2022-05-18T14:43:11.204858","updated_by":"ivanir@olivia.ai","applicability_name":"applicability_rule_id_2147483649"}],"shadow":false,"requires_etls":["l2cat110300.amt30d","google_play.amt30d","l2cat110300.amt60d","any_spend.last_30_days"],"conversation_group":"convos_itau_app_users","conversation_map_id":37221},{"promotion_id":"10176","name":"idl_teste_5","convo_template":"tpt_itau_summary","convo_variables":{"cta":"Veja aqui","code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","text":"Texto Conteúdo","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","emoji":"🤔","title":"Sua conta de água subiu 24%","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"context\"}}","message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.any_spend.last_30_days</var> </b>por ano.","feedback":":|","cabecalho":"","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"main\"}}","read_time":"3-5 min","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"disclaimer\"}}","button_text":"Repetido","description":"gastos com restaurante","content_body":"context","content_link":"","content_text":"Com essa dica você pode economizar <b>até 20%</b> isso significaria <b>R$ <var>=rvars.agg.l2cat110300.amt60d</var> </b>no seu bolso todo mês.<br />O <b>MercadoFlix</b> é um serviço de entrega recorrente de supermercado. Você mostra sua cesta de compras, agenda a data para receber tudo em casa.<br />Sem cobrar taxa de adesão ou frete, o MercadoFlix também não exige valor mínimo de compra.","link_externo":"","link_interno":"","notification":"Diminua seus gastos com supermercado ","cabecalho_cta":"Veja mais","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","texto_chamada":"","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"wordcloud\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"textinput\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"main","main_text_text":"nos últimos <b>30 dias</b> você gastou com supermercados","notification_2":" ","notification_3":" ","texto_conteudo":"","cabecalho_emoji":"🤔","cabecalho_title":"Sua conta de água subiu 24%","conteudo_1_link":"https://google.com","disclaimer_body":"disclaimer","cabecalho_message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.google_play.amt30d</var></b> por ano.","user_engaged_link":"","call_to_action@cta":"","call_to_action_cta":"Você gostaria de conhecer mais a MercadoFlix?","external_link_body":"","external_link_link":"","external_link_text":"Ir para MercadoFlix","internal_link_body":"","internal_link_link":"","internal_link_text":"Ir para o resumo do mês","texto_chamada@text":"Teste<br />Teste<br /><b>Teste</b>","texto_chamada_text":"Texto Chamada","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","cabecalho_read_time":"3-5 min","call_to_action_body":"","featured_value_body":"","featured_value_text":"<b>R$ <var>=rvars.agg.l2cat110300.amt30d</var></b>","texto_conteudo@text":"","texto_conteudo_text":"Texto Conteúdo","user_option_1_reply":"Legal! Te explico como usar em apenas 3 passos:<br />1º Crie sua lista de compras pensando no que é essencial para a sua casa<br />...<br />E pronto! Gostou? Visite o site do MercadoFlix","user_option_2_reply":"","user_option_3_reply":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"delayed\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"engaged\",\"link_text\":\"\",\"link\":\"\"}}","cabecalho_description":"gastos com restaurante","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"dismissed\",\"link_text\":\"\"}}","user_option_1@feedback":"","user_option_1_feedback":"wordcloud","user_option_1_response":"","user_option_2@feedback":"","user_option_2_feedback":"textinput","user_option_2_response":"","user_option_3@feedback":"","user_option_3_feedback":"","user_option_3_response":"","call_to_action_feedback":"<b>Você sabe o que aconteceu?</b>","user_option_delayed_body":"","user_option_engaged_body":"","user_option_1_button_text":"Sim, claro","user_option_2_button_text":"Não tenho interesse","user_option_3_button_text":"","link_externo@external_link":"Link <u><font color=\"LINK_COLOR\">xoxo</font></u> :)","link_interno@internal_link":"","link_interno_internal_link":"itau:summary/monthly","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"delayed","user_option_engaged_feedback":"","user_option_engaged_response":"engaged","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"dismissed","link_externo_external_link_text":"Ir para Mercadoflix","link_interno_internal_link_text":"Ir para resumo mensal","user_option_dismissed_link_text":"","texto_conteudo_texto_chamada_text":"Texto Conteúdo","user_option_2_user_option_1_feedback":"Oxe","user_option_2_user_option_1_button_text":"Não","user_option_3_user_option_2_user_option_1_feedback":"E agora, <b>José</b>? 👀","user_option_3_user_option_2_user_option_1_button_text":"Talvez"},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-04T18:45:37.393Z","end_date":"2052-08-16T20:12:52.543Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-08-16T20:12:52.460Z","updated_by":"luciana.pavan@mailer.com.br","version":2,"profile_group_id":14,"previous_version":1,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"vem ver","feed_body":"Oi Café, que tal realizar os seus sonhos hoje?","categories":"10400","feed_emoji":"🤔","feed_media":"","feed_title":"gastos com supermercado","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"supermercado","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"3-5 min","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"574,2147483649","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"681","etl_aggregation_name":"Google Play - Last_30_Days","rvar_object":"google_play","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"transaction_property_ids":["google_play"]},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"308","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 60 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"641","etl_aggregation_name":"Any spend - 30 days ago","rvar_object":"any_spend","rvar_variable":"last_30_days","rule":{"code":"const _ = require('lodash');\nconst moment = require('moment');\n\nconst oneMonthAgo = moment().subtract(1, 'month').startOf('day').valueOf();\n\ntransactions = transactions.filter(t => t.date.getTime() >= oneMonthAgo && t.enabled && t.budget_type === 'variable' && t.cashflow === true && t.cashflow_type === 'out');\n\nlet amt30d = 0;\n\nif (transactions) {\n    amt30d = -_.sumBy(transactions, 'amount');\n}\n\nreturn {\n  amt30d\n}","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":574,"name":"Everyone - Constant 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":1,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_574"},{"applicability_rule_id":2147483649,"name":"Specific profile_ids","rule":[{"code":"    if (!dat.profile_settings\n        || !dat.profile_settings.name) return false;\n\n    if (parseInt(dat.profile_settings.name) == 17316797) return true;\n\n    return false;\n","type":"custom","description":"Select specific profile ids to send the insight"}],"updated_at":"2022-05-18T14:43:11.204858","updated_by":"ivanir@olivia.ai","applicability_name":"applicability_rule_id_2147483649"}],"shadow":false,"requires_etls":["l2cat110300.amt30d","google_play.amt30d","l2cat110300.amt60d","any_spend.last_30_days"],"conversation_group":"convos_itau_app_users","conversation_map_id":37201},{"promotion_id":"10178","name":"idl_teste_6","convo_template":"tpt_itau_summary","convo_variables":{"cta":"Veja aqui","code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","text":"Texto Conteúdo","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","emoji":"🤔","title":"Sua conta de água subiu 24%","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"context\"}}","message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.any_spend.last_30_days</var> </b>por ano.","feedback":":|","cabecalho":"","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"main\"}}","read_time":"3-5 min","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"disclaimer\"}}","button_text":"Repetido","description":"gastos com restaurante","content_body":"context","content_link":"","content_text":"Com essa dica você pode economizar <b>até 20%</b> isso significaria <b>R$ <var>=rvars.agg.l2cat110300.amt60d</var> </b>no seu bolso todo mês.<br />O <b>MercadoFlix</b> é um serviço de entrega recorrente de supermercado. Você mostra sua cesta de compras, agenda a data para receber tudo em casa.<br />Sem cobrar taxa de adesão ou frete, o MercadoFlix também não exige valor mínimo de compra.","link_externo":"","link_interno":"","notification":"Diminua seus gastos com supermercado ","cabecalho_cta":"Veja mais","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","texto_chamada":"","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"wordcloud\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"textinput\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"main","main_text_text":"nos últimos <b>30 dias</b> você gastou com supermercados","notification_2":" ","notification_3":" ","texto_conteudo":"","cabecalho_emoji":"🤔","cabecalho_title":"Sua conta de água subiu 24%","conteudo_1_link":"https://google.com","disclaimer_body":"disclaimer","cabecalho_message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.google_play.amt30d</var></b> por ano.","user_engaged_link":"","call_to_action@cta":"","call_to_action_cta":"Você gostaria de conhecer mais a MercadoFlix?","external_link_body":"","external_link_link":"","external_link_text":"Ir para MercadoFlix","internal_link_body":"","internal_link_link":"","internal_link_text":"Ir para o resumo do mês","texto_chamada@text":"Teste<br />Teste<br /><b>Teste</b>","texto_chamada_text":"Texto Chamada","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","cabecalho_read_time":"3-5 min","call_to_action_body":"","featured_value_body":"","featured_value_text":"<b>R$ <var>=rvars.agg.l2cat110300.amt30d</var></b>","texto_conteudo@text":"","texto_conteudo_text":"Texto Conteúdo","user_option_1_reply":"Legal! Te explico como usar em apenas 3 passos:<br />1º Crie sua lista de compras pensando no que é essencial para a sua casa<br />...<br />E pronto! Gostou? Visite o site do MercadoFlix","user_option_2_reply":"","user_option_3_reply":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"delayed\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"engaged\",\"link_text\":\"\",\"link\":\"\"}}","cabecalho_description":"gastos com restaurante","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"dismissed\",\"link_text\":\"\"}}","user_option_1@feedback":"","user_option_1_feedback":"wordcloud","user_option_1_response":"","user_option_2@feedback":"","user_option_2_feedback":"textinput","user_option_2_response":"","user_option_3@feedback":"","user_option_3_feedback":"","user_option_3_response":"","call_to_action_feedback":"<b>Você sabe o que aconteceu?</b>","user_option_delayed_body":"","user_option_engaged_body":"","user_option_1_button_text":"Sim, claro","user_option_2_button_text":"Não tenho interesse","user_option_3_button_text":"","link_externo@external_link":"Link <u><font color=\"LINK_COLOR\">xoxo</font></u> :)","link_interno@internal_link":"","link_interno_internal_link":"itau:summary/monthly","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"delayed","user_option_engaged_feedback":"","user_option_engaged_response":"engaged","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"dismissed","link_externo_external_link_text":"Ir para Mercadoflix","link_interno_internal_link_text":"Ir para resumo mensal","user_option_dismissed_link_text":"","texto_conteudo_texto_chamada_text":"Texto Conteúdo","user_option_2_user_option_1_feedback":"Oxe","user_option_2_user_option_1_button_text":"Não","user_option_3_user_option_2_user_option_1_feedback":"E agora, <b>José</b>? 👀","user_option_3_user_option_2_user_option_1_button_text":"Talvez"},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-04T18:45:37.393Z","end_date":"2052-08-16T20:13:50.601Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-08-16T20:13:50.530Z","updated_by":"luciana.pavan@mailer.com.br","version":2,"profile_group_id":14,"previous_version":1,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"vem ver","feed_body":"Que tal começar 2022 realizando sonhos? Aproveite que reduzimos suas taxas.","categories":"10400","feed_emoji":"🤔","feed_media":"","feed_title":"gastos com supermercado","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"supermercado","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"3-5 min","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"574,2147483649","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"681","etl_aggregation_name":"Google Play - Last_30_Days","rvar_object":"google_play","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"transaction_property_ids":["google_play"]},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"308","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 60 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"641","etl_aggregation_name":"Any spend - 30 days ago","rvar_object":"any_spend","rvar_variable":"last_30_days","rule":{"code":"const _ = require('lodash');\nconst moment = require('moment');\n\nconst oneMonthAgo = moment().subtract(1, 'month').startOf('day').valueOf();\n\ntransactions = transactions.filter(t => t.date.getTime() >= oneMonthAgo && t.enabled && t.budget_type === 'variable' && t.cashflow === true && t.cashflow_type === 'out');\n\nlet amt30d = 0;\n\nif (transactions) {\n    amt30d = -_.sumBy(transactions, 'amount');\n}\n\nreturn {\n  amt30d\n}","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":574,"name":"Everyone - Constant 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":1,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_574"},{"applicability_rule_id":2147483649,"name":"Specific profile_ids","rule":[{"code":"    if (!dat.profile_settings\n        || !dat.profile_settings.name) return false;\n\n    if (parseInt(dat.profile_settings.name) == 17316797) return true;\n\n    return false;\n","type":"custom","description":"Select specific profile ids to send the insight"}],"updated_at":"2022-05-18T14:43:11.204858","updated_by":"ivanir@olivia.ai","applicability_name":"applicability_rule_id_2147483649"}],"shadow":false,"requires_etls":["l2cat110300.amt30d","google_play.amt30d","l2cat110300.amt60d","any_spend.last_30_days"],"conversation_group":"convos_itau_app_users","conversation_map_id":37234},{"promotion_id":"10180","name":"idl_teste_7","convo_template":"tpt_itau_summary","convo_variables":{"cta":"Veja aqui","code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","text":"Texto Conteúdo","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","emoji":"🤔","title":"Sua conta de água subiu 24%","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"context\"}}","message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.any_spend.last_30_days</var> </b>por ano.","feedback":":|","cabecalho":"","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"main\"}}","read_time":"3-5 min","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"disclaimer\"}}","button_text":"Repetido","description":"gastos com restaurante","content_body":"context","content_link":"","content_text":"Com essa dica você pode economizar <b>até 20%</b> isso significaria <b>R$ <var>=rvars.agg.l2cat110300.amt60d</var> </b>no seu bolso todo mês.<br />O <b>MercadoFlix</b> é um serviço de entrega recorrente de supermercado. Você mostra sua cesta de compras, agenda a data para receber tudo em casa.<br />Sem cobrar taxa de adesão ou frete, o MercadoFlix também não exige valor mínimo de compra.","link_externo":"","link_interno":"","notification":"Diminua seus gastos com supermercado ","cabecalho_cta":"Veja mais","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","texto_chamada":"","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"wordcloud\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"textinput\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"main","main_text_text":"nos últimos <b>30 dias</b> você gastou com supermercados","notification_2":" ","notification_3":" ","texto_conteudo":"","cabecalho_emoji":"🤔","cabecalho_title":"Sua conta de água subiu 24%","conteudo_1_link":"https://google.com","disclaimer_body":"disclaimer","cabecalho_message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.google_play.amt30d</var></b> por ano.","user_engaged_link":"","call_to_action@cta":"","call_to_action_cta":"Você gostaria de conhecer mais a MercadoFlix?","external_link_body":"","external_link_link":"","external_link_text":"Ir para MercadoFlix","internal_link_body":"","internal_link_link":"","internal_link_text":"Ir para o resumo do mês","texto_chamada@text":"Teste<br />Teste<br /><b>Teste</b>","texto_chamada_text":"Texto Chamada","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","cabecalho_read_time":"3-5 min","call_to_action_body":"","featured_value_body":"","featured_value_text":"<b>R$ <var>=rvars.agg.l2cat110300.amt30d</var></b>","texto_conteudo@text":"","texto_conteudo_text":"Texto Conteúdo","user_option_1_reply":"Legal! Te explico como usar em apenas 3 passos:<br />1º Crie sua lista de compras pensando no que é essencial para a sua casa<br />...<br />E pronto! Gostou? Visite o site do MercadoFlix","user_option_2_reply":"","user_option_3_reply":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"delayed\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"engaged\",\"link_text\":\"\",\"link\":\"\"}}","cabecalho_description":"gastos com restaurante","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"dismissed\",\"link_text\":\"\"}}","user_option_1@feedback":"","user_option_1_feedback":"wordcloud","user_option_1_response":"","user_option_2@feedback":"","user_option_2_feedback":"textinput","user_option_2_response":"","user_option_3@feedback":"","user_option_3_feedback":"","user_option_3_response":"","call_to_action_feedback":"<b>Você sabe o que aconteceu?</b>","user_option_delayed_body":"","user_option_engaged_body":"","user_option_1_button_text":"Sim, claro","user_option_2_button_text":"Não tenho interesse","user_option_3_button_text":"","link_externo@external_link":"Link <u><font color=\"LINK_COLOR\">xoxo</font></u> :)","link_interno@internal_link":"","link_interno_internal_link":"itau:summary/monthly","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"delayed","user_option_engaged_feedback":"","user_option_engaged_response":"engaged","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"dismissed","link_externo_external_link_text":"Ir para Mercadoflix","link_interno_internal_link_text":"Ir para resumo mensal","user_option_dismissed_link_text":"","texto_conteudo_texto_chamada_text":"Texto Conteúdo","user_option_2_user_option_1_feedback":"Oxe","user_option_2_user_option_1_button_text":"Não","user_option_3_user_option_2_user_option_1_feedback":"E agora, <b>José</b>? 👀","user_option_3_user_option_2_user_option_1_button_text":"Talvez"},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-04T18:45:37.393Z","end_date":"2052-08-16T20:14:46.683Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-08-16T20:14:46.595Z","updated_by":"luciana.pavan@mailer.com.br","version":2,"profile_group_id":14,"previous_version":1,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"vem ver","feed_body":"Que tal começar 2022 realizando sonhos? Aproveite que reduzimos as taxas de crédito pra você!","categories":"10400","feed_emoji":"🤔","feed_media":"","feed_title":"gastos com supermercado","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"supermercado","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"3-5 min","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"574,2147483649","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"681","etl_aggregation_name":"Google Play - Last_30_Days","rvar_object":"google_play","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"transaction_property_ids":["google_play"]},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"308","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 60 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"641","etl_aggregation_name":"Any spend - 30 days ago","rvar_object":"any_spend","rvar_variable":"last_30_days","rule":{"code":"const _ = require('lodash');\nconst moment = require('moment');\n\nconst oneMonthAgo = moment().subtract(1, 'month').startOf('day').valueOf();\n\ntransactions = transactions.filter(t => t.date.getTime() >= oneMonthAgo && t.enabled && t.budget_type === 'variable' && t.cashflow === true && t.cashflow_type === 'out');\n\nlet amt30d = 0;\n\nif (transactions) {\n    amt30d = -_.sumBy(transactions, 'amount');\n}\n\nreturn {\n  amt30d\n}","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":574,"name":"Everyone - Constant 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":1,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_574"},{"applicability_rule_id":2147483649,"name":"Specific profile_ids","rule":[{"code":"    if (!dat.profile_settings\n        || !dat.profile_settings.name) return false;\n\n    if (parseInt(dat.profile_settings.name) == 17316797) return true;\n\n    return false;\n","type":"custom","description":"Select specific profile ids to send the insight"}],"updated_at":"2022-05-18T14:43:11.204858","updated_by":"ivanir@olivia.ai","applicability_name":"applicability_rule_id_2147483649"}],"shadow":false,"requires_etls":["l2cat110300.amt30d","google_play.amt30d","l2cat110300.amt60d","any_spend.last_30_days"],"conversation_group":"convos_itau_app_users","conversation_map_id":37198},{"promotion_id":"10182","name":"idl_teste_8","convo_template":"tpt_itau_summary","convo_variables":{"cta":"Veja aqui","code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","text":"Texto Conteúdo","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","emoji":"🤔","title":"Sua conta de água subiu 24%","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"context\"}}","message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.any_spend.last_30_days</var> </b>por ano.","feedback":":|","cabecalho":"","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"main\"}}","read_time":"3-5 min","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"disclaimer\"}}","button_text":"Repetido","description":"gastos com restaurante","content_body":"context","content_link":"","content_text":"Com essa dica você pode economizar <b>até 20%</b> isso significaria <b>R$ <var>=rvars.agg.l2cat110300.amt60d</var> </b>no seu bolso todo mês.<br />O <b>MercadoFlix</b> é um serviço de entrega recorrente de supermercado. Você mostra sua cesta de compras, agenda a data para receber tudo em casa.<br />Sem cobrar taxa de adesão ou frete, o MercadoFlix também não exige valor mínimo de compra.","link_externo":"","link_interno":"","notification":"Diminua seus gastos com supermercado ","cabecalho_cta":"Veja mais","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","texto_chamada":"","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"wordcloud\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"textinput\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"main","main_text_text":"nos últimos <b>30 dias</b> você gastou com supermercados","notification_2":" ","notification_3":" ","texto_conteudo":"","cabecalho_emoji":"🤔","cabecalho_title":"Sua conta de água subiu 24%","conteudo_1_link":"https://google.com","disclaimer_body":"disclaimer","cabecalho_message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.google_play.amt30d</var></b> por ano.","user_engaged_link":"","call_to_action@cta":"","call_to_action_cta":"Você gostaria de conhecer mais a MercadoFlix?","external_link_body":"","external_link_link":"","external_link_text":"Ir para MercadoFlix","internal_link_body":"","internal_link_link":"","internal_link_text":"Ir para o resumo do mês","texto_chamada@text":"Teste<br />Teste<br /><b>Teste</b>","texto_chamada_text":"Texto Chamada","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","cabecalho_read_time":"3-5 min","call_to_action_body":"","featured_value_body":"","featured_value_text":"<b>R$ <var>=rvars.agg.l2cat110300.amt30d</var></b>","texto_conteudo@text":"","texto_conteudo_text":"Texto Conteúdo","user_option_1_reply":"Legal! Te explico como usar em apenas 3 passos:<br />1º Crie sua lista de compras pensando no que é essencial para a sua casa<br />...<br />E pronto! Gostou? Visite o site do MercadoFlix","user_option_2_reply":"","user_option_3_reply":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"delayed\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"engaged\",\"link_text\":\"\",\"link\":\"\"}}","cabecalho_description":"gastos com restaurante","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"dismissed\",\"link_text\":\"\"}}","user_option_1@feedback":"","user_option_1_feedback":"wordcloud","user_option_1_response":"","user_option_2@feedback":"","user_option_2_feedback":"textinput","user_option_2_response":"","user_option_3@feedback":"","user_option_3_feedback":"","user_option_3_response":"","call_to_action_feedback":"<b>Você sabe o que aconteceu?</b>","user_option_delayed_body":"","user_option_engaged_body":"","user_option_1_button_text":"Sim, claro","user_option_2_button_text":"Não tenho interesse","user_option_3_button_text":"","link_externo@external_link":"Link <u><font color=\"LINK_COLOR\">xoxo</font></u> :)","link_interno@internal_link":"","link_interno_internal_link":"itau:summary/monthly","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"delayed","user_option_engaged_feedback":"","user_option_engaged_response":"engaged","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"dismissed","link_externo_external_link_text":"Ir para Mercadoflix","link_interno_internal_link_text":"Ir para resumo mensal","user_option_dismissed_link_text":"","texto_conteudo_texto_chamada_text":"Texto Conteúdo","user_option_2_user_option_1_feedback":"Oxe","user_option_2_user_option_1_button_text":"Não","user_option_3_user_option_2_user_option_1_feedback":"E agora, <b>José</b>? 👀","user_option_3_user_option_2_user_option_1_button_text":"Talvez"},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-04T18:45:37.393Z","end_date":"2052-08-16T20:15:59.964Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-08-16T20:15:59.877Z","updated_by":"luciana.pavan@mailer.com.br","version":2,"profile_group_id":14,"previous_version":1,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"vem ver","feed_body":"Que tal começar 2022 realizando sonhos? Aproveite que reduzimos as taxas de crédito pra você! ABCDEFGHIJKLMNOPQRSTUWVXZ","categories":"10400","feed_emoji":"🤔","feed_media":"","feed_title":"gastos com supermercado","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"supermercado","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"3-5 min","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"574,2147483649","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"681","etl_aggregation_name":"Google Play - Last_30_Days","rvar_object":"google_play","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"transaction_property_ids":["google_play"]},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"308","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 60 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"641","etl_aggregation_name":"Any spend - 30 days ago","rvar_object":"any_spend","rvar_variable":"last_30_days","rule":{"code":"const _ = require('lodash');\nconst moment = require('moment');\n\nconst oneMonthAgo = moment().subtract(1, 'month').startOf('day').valueOf();\n\ntransactions = transactions.filter(t => t.date.getTime() >= oneMonthAgo && t.enabled && t.budget_type === 'variable' && t.cashflow === true && t.cashflow_type === 'out');\n\nlet amt30d = 0;\n\nif (transactions) {\n    amt30d = -_.sumBy(transactions, 'amount');\n}\n\nreturn {\n  amt30d\n}","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":574,"name":"Everyone - Constant 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":1,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_574"},{"applicability_rule_id":2147483649,"name":"Specific profile_ids","rule":[{"code":"    if (!dat.profile_settings\n        || !dat.profile_settings.name) return false;\n\n    if (parseInt(dat.profile_settings.name) == 17316797) return true;\n\n    return false;\n","type":"custom","description":"Select specific profile ids to send the insight"}],"updated_at":"2022-05-18T14:43:11.204858","updated_by":"ivanir@olivia.ai","applicability_name":"applicability_rule_id_2147483649"}],"shadow":false,"requires_etls":["l2cat110300.amt30d","google_play.amt30d","l2cat110300.amt60d","any_spend.last_30_days"],"conversation_group":"convos_itau_app_users","conversation_map_id":37219},{"promotion_id":"10185","name":"idl_teste_1","convo_template":"tpt_itau_summary","convo_variables":{"cta":"Veja aqui","code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","text":"Texto Conteúdo","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","emoji":"🤔","title":"Sua conta de água subiu 24%","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"context\"}}","message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.any_spend.last_30_days</var> </b>por ano.","feedback":":|","cabecalho":"","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"main\"}}","read_time":"3-5 min","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"disclaimer\"}}","button_text":"Repetido","description":"gastos com restaurante","content_body":"context","content_link":"","content_text":"Com essa dica você pode economizar <b>até 20%</b> isso significaria <b>R$ <var>=rvars.agg.l2cat110300.amt60d</var> </b>no seu bolso todo mês.<br />O <b>MercadoFlix</b> é um serviço de entrega recorrente de supermercado. Você mostra sua cesta de compras, agenda a data para receber tudo em casa.<br />Sem cobrar taxa de adesão ou frete, o MercadoFlix também não exige valor mínimo de compra.","link_externo":"","link_interno":"","notification":"Diminua seus gastos com supermercado ","cabecalho_cta":"Veja mais","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","texto_chamada":"","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"wordcloud\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"textinput\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"main","main_text_text":"nos últimos <b>30 dias</b> você gastou com supermercados","notification_2":" ","notification_3":" ","texto_conteudo":"","cabecalho_emoji":"🤔","cabecalho_title":"Sua conta de água subiu 24%","conteudo_1_link":"https://google.com","disclaimer_body":"disclaimer","cabecalho_message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.google_play.amt30d</var></b> por ano.","user_engaged_link":"","call_to_action@cta":"","call_to_action_cta":"Você gostaria de conhecer mais a MercadoFlix?","external_link_body":"","external_link_link":"","external_link_text":"Ir para MercadoFlix","internal_link_body":"","internal_link_link":"","internal_link_text":"Ir para o resumo do mês","texto_chamada@text":"Teste<br />Teste<br /><b>Teste</b>","texto_chamada_text":"Texto Chamada","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","cabecalho_read_time":"3-5 min","call_to_action_body":"","featured_value_body":"","featured_value_text":"<b>R$ <var>=rvars.agg.l2cat110300.amt30d</var></b>","texto_conteudo@text":"","texto_conteudo_text":"Texto Conteúdo","user_option_1_reply":"Legal! Te explico como usar em apenas 3 passos:<br />1º Crie sua lista de compras pensando no que é essencial para a sua casa<br />...<br />E pronto! Gostou? Visite o site do MercadoFlix","user_option_2_reply":"","user_option_3_reply":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"delayed\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"engaged\",\"link_text\":\"\",\"link\":\"\"}}","cabecalho_description":"gastos com restaurante","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"dismissed\",\"link_text\":\"\"}}","user_option_1@feedback":"","user_option_1_feedback":"wordcloud","user_option_1_response":"","user_option_2@feedback":"","user_option_2_feedback":"textinput","user_option_2_response":"","user_option_3@feedback":"","user_option_3_feedback":"","user_option_3_response":"","call_to_action_feedback":"<b>Você sabe o que aconteceu?</b>","user_option_delayed_body":"","user_option_engaged_body":"","user_option_1_button_text":"Sim, claro","user_option_2_button_text":"Não tenho interesse","user_option_3_button_text":"","link_externo@external_link":"Link <u><font color=\"LINK_COLOR\">xoxo</font></u> :)","link_interno@internal_link":"","link_interno_internal_link":"itau:summary/monthly","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"delayed","user_option_engaged_feedback":"","user_option_engaged_response":"engaged","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"dismissed","link_externo_external_link_text":"Ir para Mercadoflix","link_interno_internal_link_text":"Ir para resumo mensal","user_option_dismissed_link_text":"","texto_conteudo_texto_chamada_text":"Texto Conteúdo","user_option_2_user_option_1_feedback":"Oxe","user_option_2_user_option_1_button_text":"Não","user_option_3_user_option_2_user_option_1_feedback":"E agora, <b>José</b>? 👀","user_option_3_user_option_2_user_option_1_button_text":"Talvez"},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-04T18:45:37.393Z","end_date":"2052-08-17T18:51:55.137Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-08-17T18:51:55.173Z","updated_by":"luciana.pavan@mailer.com.br","version":4,"profile_group_id":14,"previous_version":3,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"Veja aqui!","feed_body":"ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ","categories":"10400","feed_emoji":"🤔","feed_media":"","feed_title":"gastos com supermercado","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"supermercado","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"3-5 min","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"574","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"681","etl_aggregation_name":"Google Play - Last_30_Days","rvar_object":"google_play","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"transaction_property_ids":["google_play"]},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"308","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 60 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"641","etl_aggregation_name":"Any spend - 30 days ago","rvar_object":"any_spend","rvar_variable":"last_30_days","rule":{"code":"const _ = require('lodash');\nconst moment = require('moment');\n\nconst oneMonthAgo = moment().subtract(1, 'month').startOf('day').valueOf();\n\ntransactions = transactions.filter(t => t.date.getTime() >= oneMonthAgo && t.enabled && t.budget_type === 'variable' && t.cashflow === true && t.cashflow_type === 'out');\n\nlet amt30d = 0;\n\nif (transactions) {\n    amt30d = -_.sumBy(transactions, 'amount');\n}\n\nreturn {\n  amt30d\n}","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":574,"name":"Everyone - Constant 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":1,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_574"}],"shadow":false,"requires_etls":["l2cat110300.amt30d","google_play.amt30d","l2cat110300.amt60d","any_spend.last_30_days"],"conversation_group":"convos_itau_app_users","conversation_map_id":37177},{"promotion_id":"10215","name":"inf_alert_you_got_paid_not_spender_other_gains","convo_template":"tpt_itau_base_no_options_no_cooldown","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"const moment = require('moment');\\n\\nlet current_transaction = false;\\nlet failsafe = false;\\n\\nfor(const transaction of rvars.agg.income_transactions.last_7d) {\\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\\n    || transaction.olivia_category_id == 150300\\n    || !(transaction.amount > 200)\\n  ) continue;\\n\\n  failsafe = transaction;\\n\\n  if(!!ivars.you_got_paid_other_gains_historic\\n      && ivars.you_got_paid_other_gains_historic.some((hist) => hist == transaction.transaction_id)) continue;\\n  current_transaction = transaction;\\n}\\n\\n// Memory control\\nif (current_transaction) {\\n  ivars.you_got_paid_other_gains_historic = ivars.you_got_paid_other_gains_historic || [];\\n  ivars.you_got_paid_other_gains_historic.push(current_transaction.transaction_id);\\n}\\n\\n// Failsafe\\nif (!current_transaction) {\\n  current_transaction = failsafe;\\n}\\n\\nivars.temp_current_transaction_amount = current_transaction.amount;\\nivars.temp_current_transaction_description = current_transaction.description;\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Essa é uma boa hora para separar aquele dinheirinho e <b>investir</b>\"}}","code_body":"const moment = require('moment');\n\nlet current_transaction = false;\nlet failsafe = false;\n\nfor(const transaction of rvars.agg.income_transactions.last_7d) <var>enc$\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n    || transaction.olivia_category_id == 150300\n    || !(transaction.amount > 200)\n  ) continue;\n\n  failsafe = transaction;\n\n  if(!!ivars.you_got_paid_other_gains_historic\n      && ivars.you_got_paid_other_gains_historic.some((hist) => hist == transaction.transaction_id)) continue;\n  current_transaction = transaction;\n</var>\n\n// Memory control\nif (current_transaction) <var>enc$\n  ivars.you_got_paid_other_gains_historic = ivars.you_got_paid_other_gains_historic || [];\n  ivars.you_got_paid_other_gains_historic.push(current_transaction.transaction_id);\n</var>\n\n// Failsafe\nif (!current_transaction) <var>enc$\n  current_transaction = failsafe;\n</var>\n\nivars.temp_current_transaction_amount = current_transaction.amount;\nivars.temp_current_transaction_description = current_transaction.description;","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi que sua conta recebeu o pagamento <b><var>=ivars.temp_current_transaction_description</var></b>. O valor que entrou é de <b><var>=currency(ivars.temp_current_transaction_amount)</var></b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Essa é uma boa hora para separar aquele dinheirinho e <b>investir</b>","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"Clique aqui e faça já um investimento!\",\"link\":\"deeplink://spa/investimentos-robo-advisor\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Vi que sua conta recebeu o pagamento <b><var>=ivars.temp_current_transaction_description</var></b>. O valor que entrou é de <b><var>=currency(ivars.temp_current_transaction_amount)</var></b>","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"Clique aqui e faça já um investimento!","internal_link_link":"deeplink://spa/investimentos-robo-advisor","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-26T20:18:21.170Z","end_date":"2052-09-09T15:03:12.790Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-09-09T15:03:12.846Z","updated_by":"vitor-roberto.oliveira@mailer.com.br","version":16,"profile_group_id":14,"previous_version":15,"convo_header":{"type":"alert","barrier":"Avisar um pagamento extra disponível, sem que o usuário precise consultar o extrato da conta corrente.","behavior":"Fazer com que o usuário acompanhe entradas extras em sua conta corrente.","benefits":"Ajudar o usuário a criar o hábito de investir o dinheiro de seus pagamentos.","cooldown":"0","feed_cta":"quero ver","feed_body":"Tem um dinheiro pingando na sua conta! Quer conferir?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"quanto recebi","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"0","cooldownEngaged":"0","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"0","notification_type":"insight","cooldownFrustrated":"0","cooldownInteracted":"0","cooldownThumbsDown":"0","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"813,800","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["got paid"]},"visible":true,"deleted":false,"default_values":[{"name":"you_got_paid_other_gains_historic","type":"ivars","value":[],"data_type":"json"},{"name":"agg.income_transactions.last_7d","type":"rvars","value":[{"amount":20,"timestamp":1662336000000,"description":"NOTA FISCAL PAULISTA","formatted_date":"05/09/22","transaction_id":"1770_teste_new_transaction111","olivia_category_id":170000},{"amount":3500,"timestamp":1662422400000,"description":"salario vitao","formatted_date":"06/09/22","transaction_id":"1770_dfhwdvuofcosadcisadfciopahsdfpvitor","olivia_category_id":150300}],"data_type":"json"}],"etl_aggregations":[{"etl_aggregation_id":"753","etl_aggregation_name":"Income Transactions Since 7 Days Ago","rvar_object":"income_transactions","rvar_variable":"last_7d","rule":{"code":"    const moment = require('moment');\n\n    const LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS = [103, 104, 105, 201, 202, 203];\n    const seven_days_ago = moment.utc().subtract(7, 'days').startOf('day').valueOf();\n    const current_time = moment.utc().valueOf();\n    const income_array = [];\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.cashflow_type === 'in'\n            && !LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS.includes(transaction.account_type_id)\n            && transaction.enabled\n            && !transaction.pending\n            && m >= seven_days_ago\n            && m <= current_time\n        ) {\n            const transaction_data = {\n                amount: transaction.amount,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                transaction_id: transaction.transaction_id,\n                olivia_category_id: transaction.olivia_category_id,\n                description: transaction.description\n            };\n\n            income_array.push(transaction_data);\n        }\n    }\n\n    income_array.sort((a, b) => a.timestamp - b.timestamp);\n\n    return income_array;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate income transactions since the last 7 days","invert_value":true},"updated_at":"2021-04-14T14:18:45.963Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":813,"name":"Has Got Paid Other Gains","rule":[{"code":"const moment = require('moment');\n\nif (!rvars\n  || !rvars.agg\n  || !rvars.agg.income_transactions\n  || !rvars.agg.income_transactions.last_7d) return 0;\n\nfor(const transaction of rvars.agg.income_transactions.last_7d) {\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n    || transaction.olivia_category_id == 150300\n    || !(transaction.amount > 200)\n  ) continue;\n\n  if(!!ivars.you_got_paid_other_gains_historic\n      && ivars.you_got_paid_other_gains_historic.some((hist) => hist == transaction.transaction_id)) continue;\n\n  return 1;\n}\n\nreturn 0;","type":"custom","description":"Check for recent income not paychecks, not on historic"}],"updated_at":"2021-04-22T12:42:22.910937","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_813"},{"applicability_rule_id":800,"name":"Income > Spending in the last 3 closed Months","rule":[{"code":"  if (!dat\n    || !dat.profile_overview_panel_section\n    || !dat.profile_overview_panel_section.totals.income\n    || !dat.profile_overview_panel_section.totals.spending\n  ) return false;\n\n  const _ = require('lodash');\n  const moment = require('moment');\n\n  const income_data = _.get(dat.profile_overview_panel_section, 'totals.income');\n  const spending_data = _.get(dat.profile_overview_panel_section, 'totals.spending');\n\n  // Get closed months only\n  const months = [\n    moment().startOf('month').subtract(3, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(2, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(1, 'month').format('YYYY-MM-DD')\n  ];\n\n  const monthly_income = months.map((date) => {\n    const object = _.find(income_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  const monthly_spending = months.map((date) => {\n    const object = _.find(spending_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  return monthly_spending <= monthly_income;\n","type":"custom","description":""}],"updated_at":"2021-11-25T21:34:44.17071","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_800"}],"shadow":false,"requires_etls":["income_transactions.last_7d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37205},{"promotion_id":"10216","name":"idl_teste_Bis","convo_template":"tpt_itau_summary","convo_variables":{"cta":"Veja aqui","code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","text":"Texto Conteúdo","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","emoji":"🤔","title":"Sua conta de água subiu 24%","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"context\"}}","message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.any_spend.last_30_days</var> </b>por ano.","feedback":":|","cabecalho":"","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"main\"}}","read_time":"3-5 min","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"disclaimer\"}}","button_text":"Repetido","description":"gastos com restaurante","content_body":"context","content_link":"","content_text":"Com essa dica você pode economizar <b>até 20%</b> isso significaria <b>R$ <var>=rvars.agg.l2cat110300.amt60d</var> </b>no seu bolso todo mês.<br />O <b>MercadoFlix</b> é um serviço de entrega recorrente de supermercado. Você mostra sua cesta de compras, agenda a data para receber tudo em casa.<br />Sem cobrar taxa de adesão ou frete, o MercadoFlix também não exige valor mínimo de compra.","link_externo":"","link_interno":"","notification":"Diminua seus gastos com supermercado ","cabecalho_cta":"Veja mais","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","texto_chamada":"","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"wordcloud\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"textinput\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"main","main_text_text":"nos últimos <b>30 dias</b> você gastou com supermercados","notification_2":" ","notification_3":" ","texto_conteudo":"","cabecalho_emoji":"🤔","cabecalho_title":"Sua conta de água subiu 24%","conteudo_1_link":"https://google.com","disclaimer_body":"disclaimer","cabecalho_message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.google_play.amt30d</var></b> por ano.","user_engaged_link":"","call_to_action@cta":"","call_to_action_cta":"Você gostaria de conhecer mais a MercadoFlix?","external_link_body":"","external_link_link":"","external_link_text":"Ir para MercadoFlix","internal_link_body":"","internal_link_link":"","internal_link_text":"Ir para o resumo do mês","texto_chamada@text":"Teste<br />Teste<br /><b>Teste</b>","texto_chamada_text":"Texto Chamada","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","cabecalho_read_time":"3-5 min","call_to_action_body":"","featured_value_body":"","featured_value_text":"<b>R$ <var>=rvars.agg.l2cat110300.amt30d</var></b>","texto_conteudo@text":"","texto_conteudo_text":"Texto Conteúdo","user_option_1_reply":"Legal! Te explico como usar em apenas 3 passos:<br />1º Crie sua lista de compras pensando no que é essencial para a sua casa<br />...<br />E pronto! Gostou? Visite o site do MercadoFlix","user_option_2_reply":"","user_option_3_reply":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"delayed\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"engaged\",\"link_text\":\"\",\"link\":\"\"}}","cabecalho_description":"gastos com restaurante","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"dismissed\",\"link_text\":\"\"}}","user_option_1@feedback":"","user_option_1_feedback":"wordcloud","user_option_1_response":"","user_option_2@feedback":"","user_option_2_feedback":"textinput","user_option_2_response":"","user_option_3@feedback":"","user_option_3_feedback":"","user_option_3_response":"","call_to_action_feedback":"<b>Você sabe o que aconteceu?</b>","user_option_delayed_body":"","user_option_engaged_body":"","user_option_1_button_text":"Sim, claro","user_option_2_button_text":"Não tenho interesse","user_option_3_button_text":"","link_externo@external_link":"Link <u><font color=\"LINK_COLOR\">xoxo</font></u> :)","link_interno@internal_link":"","link_interno_internal_link":"itau:summary/monthly","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"delayed","user_option_engaged_feedback":"","user_option_engaged_response":"engaged","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"dismissed","link_externo_external_link_text":"Ir para Mercadoflix","link_interno_internal_link_text":"Ir para resumo mensal","user_option_dismissed_link_text":"","texto_conteudo_texto_chamada_text":"Texto Conteúdo","user_option_2_user_option_1_feedback":"Oxe","user_option_2_user_option_1_button_text":"Não","user_option_3_user_option_2_user_option_1_feedback":"E agora, <b>José</b>? 👀","user_option_3_user_option_2_user_option_1_button_text":"Talvez"},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-04T18:45:37.393Z","end_date":"2052-08-17T18:51:55.137Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-09-21T18:37:27.633Z","updated_by":"bismarck.araujo@mailer.com.br","version":1,"profile_group_id":14,"previous_version":0,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"Veja aqui!","feed_body":"ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ ABCDEFGHIJKLMNOPQRSTUWVXZ","categories":"10400","feed_emoji":"🤔","feed_media":"","feed_title":"gastos com supermercado","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"supermercado","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"3-5 min","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"574","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"681","etl_aggregation_name":"Google Play - Last_30_Days","rvar_object":"google_play","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"transaction_property_ids":["google_play"]},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"308","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 60 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"641","etl_aggregation_name":"Any spend - 30 days ago","rvar_object":"any_spend","rvar_variable":"last_30_days","rule":{"code":"const _ = require('lodash');\nconst moment = require('moment');\n\nconst oneMonthAgo = moment().subtract(1, 'month').startOf('day').valueOf();\n\ntransactions = transactions.filter(t => t.date.getTime() >= oneMonthAgo && t.enabled && t.budget_type === 'variable' && t.cashflow === true && t.cashflow_type === 'out');\n\nlet amt30d = 0;\n\nif (transactions) {\n    amt30d = -_.sumBy(transactions, 'amount');\n}\n\nreturn {\n  amt30d\n}","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":574,"name":"Everyone - Constant 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":1,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_574"}],"shadow":false,"requires_etls":["l2cat110300.amt30d","google_play.amt30d","l2cat110300.amt60d","any_spend.last_30_days"],"conversation_group":"convos_itau_app_users","conversation_map_id":37215},{"promotion_id":"10367","name":"act_pet_savings_cobasi_b","convo_template":"tpt_itau_base_no_options","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"//No code\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Já conhece o programa de fidelidade deles? Recomendo! Rende ofertas exclusivas, descontos e brindes 🎉\"}}","code_body":"//No code","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi que você gastou <b><var>=currency(rvars.agg.cobasi.amt_2m)</var></b> na <b>Cobasi</b> nos últimos <b>60 dias</b> 🐶 🐱\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\"}}","content_body":"Já conhece o programa de fidelidade deles? Recomendo! Rende ofertas exclusivas, descontos e brindes 🎉","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"👉 Clique para participar\",\"link\":\"https://www.cobasi.com.br/programa-amigo-cobasi\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","main_text_body":"Vi que você gastou <b><var>=currency(rvars.agg.cobasi.amt_2m)</var></b> na <b>Cobasi</b> nos últimos <b>60 dias</b> 🐶 🐱","notification_2":" ","notification_3":" ","disclaimer_body":"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","external_link_body":"👉 Clique para participar","external_link_link":"https://www.cobasi.com.br/programa-amigo-cobasi","internal_link_body":"","internal_link_link":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-05-11T19:22:52.076Z","end_date":"2053-01-16T17:04:17.685Z","validation_ids":[],"cooldown_groups":["pet_savings"],"updated_at":"2023-01-16T17:04:17.764Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":10,"profile_group_id":14,"previous_version":8,"convo_header":{"type":"default","barrier":"O usuário saber sobre o programa de benefícios e poder acessá-lo com um clique.","behavior":"O usuário se cadastrar em programas de fidelidade para gastos com pets.","benefits":"O usuário gastar menos nas compras para o seu pet.","cooldown":"0","feed_cta":"quero!","feed_body":"Você gastou [=currency(rvars.agg.cobasi.amt_2m)] com pets em 60 dias. Quer ver como economizar?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"animais de estimação","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"pet_savings","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"728,824","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["external_data"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat1000014.amt60d","type":"rvars","value":"800"},{"name":"agg.petz.amt_2m","type":"rvars","value":"200"},{"name":"agg.cobasi.amt_2m","type":"rvars","value":"400"},{"name":"agg.petlove.amt_2m","type":"rvars","value":"200"}],"etl_aggregations":[{"etl_aggregation_id":"765","etl_aggregation_name":"Cobasi Expenses Last 2 Months","rvar_object":"cobasi","rvar_variable":"amt_2m","rule":{"type":"sum_amount","filter":{"$regex":{"description":"cobasi"},"$last_x_months":2,"$valid_transactions":true,"olivia_category_level1_id":[1000014]},"invert_value":true},"updated_at":"2021-05-13T16:51:03.644Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":728,"name":"User belongs to AB test group 2","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_728"},{"applicability_rule_id":824,"name":"Itau Pet Savings on Cobasi","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.cobasi.amt_2m"},"right_value":{"type":"fixed","value":"100","variable_type":"int"}}],"updated_at":"2022-08-23T17:29:38.068","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_824"}],"shadow":false,"requires_etls":["cobasi.amt_2m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37176},{"promotion_id":"10217","name":"idl_teste_3","convo_template":"tpt_itau_summary","convo_variables":{"cta":"Veja aqui","code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","text":"Texto Conteúdo","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","emoji":"🤔","title":"Sua conta de água subiu 24%","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"context\"}}","message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.any_spend.last_30_days</var> </b>por ano.","feedback":":|","cabecalho":"","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"main\"}}","read_time":"3-5 min","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"disclaimer\"}}","button_text":"Repetido","description":"gastos com restaurante","content_body":"context","content_link":"","content_text":"Com essa dica você pode economizar <b>até 20%</b> isso significaria <b>R$ <var>=rvars.agg.l2cat110300.amt60d</var> </b>no seu bolso todo mês.<br />O <b>MercadoFlix</b> é um serviço de entrega recorrente de supermercado. Você mostra sua cesta de compras, agenda a data para receber tudo em casa.<br />Sem cobrar taxa de adesão ou frete, o MercadoFlix também não exige valor mínimo de compra.","link_externo":"","link_interno":"","notification":"Diminua seus gastos com supermercado ","cabecalho_cta":"Veja mais","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","texto_chamada":"","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"wordcloud\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"textinput\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"main","main_text_text":"nos últimos <b>30 dias</b> você gastou com supermercados","notification_2":" ","notification_3":" ","texto_conteudo":"","cabecalho_emoji":"🤔","cabecalho_title":"Sua conta de água subiu 24%","conteudo_1_link":"https://google.com","disclaimer_body":"disclaimer","cabecalho_message":"Vou ajudar você a descobrir o que houve e ainda economizar <b>R$ <var>=rvars.agg.google_play.amt30d</var></b> por ano.","user_engaged_link":"","call_to_action@cta":"","call_to_action_cta":"Você gostaria de conhecer mais a MercadoFlix?","external_link_body":"","external_link_link":"","external_link_text":"Ir para MercadoFlix","internal_link_body":"","internal_link_link":"","internal_link_text":"Ir para o resumo do mês","texto_chamada@text":"Teste<br />Teste<br /><b>Teste</b>","texto_chamada_text":"Texto Chamada","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","cabecalho_read_time":"3-5 min","call_to_action_body":"","featured_value_body":"","featured_value_text":"<b>R$ <var>=rvars.agg.l2cat110300.amt30d</var></b>","texto_conteudo@text":"","texto_conteudo_text":"Texto Conteúdo","user_option_1_reply":"Legal! Te explico como usar em apenas 3 passos:<br />1º Crie sua lista de compras pensando no que é essencial para a sua casa<br />...<br />E pronto! Gostou? Visite o site do MercadoFlix","user_option_2_reply":"","user_option_3_reply":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"delayed\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"engaged\",\"link_text\":\"\",\"link\":\"\"}}","cabecalho_description":"gastos com restaurante","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"dismissed\",\"link_text\":\"\"}}","user_option_1@feedback":"","user_option_1_feedback":"wordcloud","user_option_1_response":"","user_option_2@feedback":"","user_option_2_feedback":"textinput","user_option_2_response":"","user_option_3@feedback":"","user_option_3_feedback":"","user_option_3_response":"","call_to_action_feedback":"<b>Você sabe o que aconteceu?</b>","user_option_delayed_body":"","user_option_engaged_body":"","user_option_1_button_text":"Sim, claro","user_option_2_button_text":"Não tenho interesse","user_option_3_button_text":"","link_externo@external_link":"Link <u><font color=\"LINK_COLOR\">xoxo</font></u> :)","link_interno@internal_link":"","link_interno_internal_link":"itau:summary/monthly","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"delayed","user_option_engaged_feedback":"","user_option_engaged_response":"engaged","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"dismissed","link_externo_external_link_text":"Ir para Mercadoflix","link_interno_internal_link_text":"Ir para resumo mensal","user_option_dismissed_link_text":"","texto_conteudo_texto_chamada_text":"Texto Conteúdo","user_option_2_user_option_1_feedback":"Oxe","user_option_2_user_option_1_button_text":"Não","user_option_3_user_option_2_user_option_1_feedback":"E agora, <b>José</b>? 👀","user_option_3_user_option_2_user_option_1_button_text":"Talvez"},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-04T18:45:37.393Z","end_date":"2052-08-16T20:15:59.964Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2022-09-22T14:44:36.213Z","updated_by":"renato.lotto@mailer.com.br","version":1,"profile_group_id":14,"previous_version":0,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"vem ver","feed_body":"Que tal começar 2022 realizando sonhos? Aproveite que reduzimos as taxas de crédito pra você! ABCDEFGHIJKLMNOPQRSTUWVXZ","categories":"10400","feed_emoji":"🤔","feed_media":"","feed_title":"gastos com supermercado","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"supermercado","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"3-5 min","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"574,2147483649","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"681","etl_aggregation_name":"Google Play - Last_30_Days","rvar_object":"google_play","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"transaction_property_ids":["google_play"]},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"308","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 60 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"641","etl_aggregation_name":"Any spend - 30 days ago","rvar_object":"any_spend","rvar_variable":"last_30_days","rule":{"code":"const _ = require('lodash');\nconst moment = require('moment');\n\nconst oneMonthAgo = moment().subtract(1, 'month').startOf('day').valueOf();\n\ntransactions = transactions.filter(t => t.date.getTime() >= oneMonthAgo && t.enabled && t.budget_type === 'variable' && t.cashflow === true && t.cashflow_type === 'out');\n\nlet amt30d = 0;\n\nif (transactions) {\n    amt30d = -_.sumBy(transactions, 'amount');\n}\n\nreturn {\n  amt30d\n}","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":574,"name":"Everyone - Constant 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":1,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_574"},{"applicability_rule_id":2147483649,"name":"Specific profile_ids","rule":[{"code":"    if (!dat.profile_settings\n        || !dat.profile_settings.name) return false;\n\n    if (parseInt(dat.profile_settings.name) == 17316797) return true;\n\n    return false;\n","type":"custom","description":"Select specific profile ids to send the insight"}],"updated_at":"2022-05-18T14:43:11.204858","updated_by":"ivanir@olivia.ai","applicability_name":"applicability_rule_id_2147483649"}],"shadow":false,"requires_etls":["l2cat110300.amt30d","google_play.amt30d","l2cat110300.amt60d","any_spend.last_30_days"],"conversation_group":"convos_itau_app_users","conversation_map_id":37173},{"promotion_id":"10368","name":"act_pet_savings_petlove_b","convo_template":"tpt_itau_base_no_options","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"//No code\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Já conhece o programa de fidelidade deles? Recomendo! Rende 10% de desconto em todas as compras 🎉\"}}","code_body":"//No code","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi que você gastou <b><var>=currency(rvars.agg.petlove.amt_2m)</var></b> na <b>Petlove</b> nos últimos <b>60 dias</b> 🐶 🐱\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\"}}","content_body":"Já conhece o programa de fidelidade deles? Recomendo! Rende 10% de desconto em todas as compras 🎉","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"👉 Clique para participar\",\"link\":\"https://www.petlove.com.br/assinatura\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","main_text_body":"Vi que você gastou <b><var>=currency(rvars.agg.petlove.amt_2m)</var></b> na <b>Petlove</b> nos últimos <b>60 dias</b> 🐶 🐱","notification_2":" ","notification_3":" ","disclaimer_body":"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","external_link_body":"👉 Clique para participar","external_link_link":"https://www.petlove.com.br/assinatura","internal_link_body":"","internal_link_link":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-05-11T19:57:07.438Z","end_date":"2053-01-16T17:05:35.917Z","validation_ids":[],"cooldown_groups":["pet_savings"],"updated_at":"2023-01-16T17:05:35.984Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":10,"profile_group_id":14,"previous_version":9,"convo_header":{"type":"default","barrier":"O usuário saber sobre o programa de benefícios e poder acessá-lo com um clique.","behavior":"O usuário se cadastrar em programas de fidelidade para gastos com pets.","benefits":"O usuário gastar menos nas compras para o seu pet.","cooldown":"0","feed_cta":"quero!","feed_body":"Você gastou [=currency(rvars.agg.petlove.amt_2m)] com pets em 60 dias. Quer ver como economizar?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"animais de estimação","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"pet_savings","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"728,825","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["external_data"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat1000014.amt60d","type":"rvars","value":"800"},{"name":"agg.petz.amt_2m","type":"rvars","value":"200"},{"name":"agg.cobasi.amt_2m","type":"rvars","value":"200"},{"name":"agg.petlove.amt_2m","type":"rvars","value":"400"}],"etl_aggregations":[{"etl_aggregation_id":"766","etl_aggregation_name":"Petlove Expenses Last 2 Months","rvar_object":"petlove","rvar_variable":"amt_2m","rule":{"type":"sum_amount","filter":{"$regex":{"description":"petlove"},"$last_x_months":2,"$valid_transactions":true,"olivia_category_level1_id":[1000014]},"invert_value":true},"updated_at":"2021-06-11T16:31:27.823Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":728,"name":"User belongs to AB test group 2","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_728"},{"applicability_rule_id":825,"name":"Itau Pet Savings on Petlove","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.petlove.amt_2m"},"right_value":{"type":"fixed","value":"100","variable_type":"int"}}],"updated_at":"2022-08-23T17:30:46.763","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_825"}],"shadow":false,"requires_etls":["petlove.amt_2m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37183},{"promotion_id":"10362","name":"act_gas_station_programs_ipiranga","convo_template":"tpt_itau_base_no_options","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"//No code\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Já conhece o programa de fidelidade deles? Recomendo! Rende descontos e benefícios em lojas parceiras 🤓 🚘\"}}","code_body":"//No code","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Você gastou <b><var>=currency(rvars.agg.ipiranga.amt_1m)</var></b> na rede <b>Ipiranga</b> no último <b>mês</b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\"}}","content_body":"Já conhece o programa de fidelidade deles? Recomendo! Rende descontos e benefícios em lojas parceiras 🤓 🚘","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"👉 Clique para participar\",\"link\":\"https://www.kmdevantagens.com.br/wps/portal/Applications/MarketPlace/cadastro\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","main_text_body":"Você gastou <b><var>=currency(rvars.agg.ipiranga.amt_1m)</var></b> na rede <b>Ipiranga</b> no último <b>mês</b>","notification_2":" ","notification_3":" ","disclaimer_body":"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","external_link_body":"👉 Clique para participar","external_link_link":"https://www.kmdevantagens.com.br/wps/portal/Applications/MarketPlace/cadastro","internal_link_body":"","internal_link_link":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-05-07T18:42:44.916Z","end_date":"2053-01-16T12:39:27.750Z","validation_ids":[],"cooldown_groups":["gas_station"],"updated_at":"2023-01-16T12:39:28.540Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":12,"profile_group_id":14,"previous_version":11,"convo_header":{"type":"default","barrier":"Mostrar ao usuário, de forma fácil, o programa de fidelidade do posto de gasolina da rede que costuma frequentar e que ele pode utilizar.","behavior":"Fazer com que o usuário se cadastre e utilize o programa de fidelidade apresentado.","benefits":"Ao acumular pontos no programa, o usuário poderá trocar seus pontos por benefícios em compras no estabelecimentos parceiros.","cooldown":"0","feed_cta":"eu topo","feed_body":"Te mostro como economizar no posto de combustível onde você abastece. Topa? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"equilibrando as contas","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"gas_station","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"827","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["external_data"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.ipiranga.amt_1m","type":"rvars","value":"600"},{"name":"agg.shell.amt_1m","type":"rvars","value":"400"}],"etl_aggregations":[{"etl_aggregation_id":"768","etl_aggregation_name":"Ipiranga Expenses Last Month","rvar_object":"ipiranga","rvar_variable":"amt_1m","rule":{"type":"sum_amount","filter":{"$regex":{"description":"ipiranga"},"$last_x_months":1,"$valid_transactions":true,"olivia_category_level2_id":[130500]},"invert_value":true},"updated_at":"2021-05-13T16:51:03.644Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":827,"name":"Itau Gas Stations on Ipiranga","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.ipiranga.amt_1m"},"right_value":{"type":"fixed","value":"200","variable_type":"int"}}],"updated_at":"2022-08-23T14:33:48.964","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_827"}],"shadow":false,"requires_etls":["ipiranga.amt_1m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37191},{"promotion_id":"10369","name":"act_pet_savings_petz","convo_template":"tpt_itau_base_no_options","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"//No code\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Já conhece o programa de fidelidade deles? Recomendo! Rende ofertas exclusivas e até 10% de desconto 🎉\"}}","code_body":"//No code","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi que você gastou <b><var>=currency(rvars.agg.petz.amt_2m)</var></b> na <b>Petz</b> nos últimos<b> 60 dias</b> 🐶 🐱\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\"}}","content_body":"Já conhece o programa de fidelidade deles? Recomendo! Rende ofertas exclusivas e até 10% de desconto 🎉","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"👉 Clique para participar\",\"link\":\"https://www.petz.com.br/institucional/vale-a-pena-ser-fiel\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","main_text_body":"Vi que você gastou <b><var>=currency(rvars.agg.petz.amt_2m)</var></b> na <b>Petz</b> nos últimos<b> 60 dias</b> 🐶 🐱","notification_2":" ","notification_3":" ","disclaimer_body":"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","external_link_body":"👉 Clique para participar","external_link_link":"https://www.petz.com.br/institucional/vale-a-pena-ser-fiel","internal_link_body":"","internal_link_link":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-05-07T17:37:56.513Z","end_date":"2053-01-16T17:06:16.045Z","validation_ids":[],"cooldown_groups":["pet_savings"],"updated_at":"2023-01-16T17:06:16.176Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":17,"profile_group_id":14,"previous_version":16,"convo_header":{"type":"default","barrier":"O usuário saber sobre o programa de benefícios e poder acessá-lo com um clique.","behavior":"O usuário se cadastrar em programas de fidelidade para gastos com pets.","benefits":"O usuário gastar menos nas compras para o seu pet.","cooldown":"0","feed_cta":"quero ver","feed_body":"Cuidar dos pets pode custar caro! Te mostro como gastar 10% menos na sua loja preferida ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"animais de estimação","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"pet_savings","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"727,823","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["external_data"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat1000014.amt60d","type":"rvars","value":"800"},{"name":"agg.petz.amt_2m","type":"rvars","value":"400"},{"name":"agg.cobasi.amt_2m","type":"rvars","value":"200"},{"name":"agg.petlove.amt_2m","type":"rvars","value":"200"}],"etl_aggregations":[{"etl_aggregation_id":"764","etl_aggregation_name":"Petz Expenses Last 2 Months","rvar_object":"petz","rvar_variable":"amt_2m","rule":{"type":"sum_amount","filter":{"$regex":{"description":"petz"},"$last_x_months":2,"$valid_transactions":true,"olivia_category_level1_id":[1000014]},"invert_value":true},"updated_at":"2021-05-13T16:51:03.644Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":727,"name":"User belongs to AB test group 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_727"},{"applicability_rule_id":823,"name":"Itau Pet Savings on Petz","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.petz.amt_2m"},"right_value":{"type":"fixed","value":"100","variable_type":"int"}}],"updated_at":"2022-08-23T17:30:23.752","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_823"}],"shadow":false,"requires_etls":["petz.amt_2m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37204},{"promotion_id":"10370","name":"act_pet_savings_petz_b","convo_template":"tpt_itau_base_no_options","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"//No code\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Já conhece o programa de fidelidade deles? Recomendo! Rende ofertas exclusivas e até 10% de desconto 🎉\"}}","code_body":"//No code","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi que você gastou <b><var>=currency(rvars.agg.petz.amt_2m)</var></b> na <b>Petz</b> nos últimos<b> 60 dias</b> 🐶 🐱<br />teste\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\"}}","content_body":"Já conhece o programa de fidelidade deles? Recomendo! Rende ofertas exclusivas e até 10% de desconto 🎉","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"👉 Clique para participar\",\"link\":\"https://www.petz.com.br/institucional/vale-a-pena-ser-fiel\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","main_text_body":"Vi que você gastou <b><var>=currency(rvars.agg.petz.amt_2m)</var></b> na <b>Petz</b> nos últimos<b> 60 dias</b> 🐶 🐱<br />teste","notification_2":" ","notification_3":" ","disclaimer_body":"📌 Só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","external_link_body":"👉 Clique para participar","external_link_link":"https://www.petz.com.br/institucional/vale-a-pena-ser-fiel","internal_link_body":"","internal_link_link":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-05-07T17:37:56.513Z","end_date":"2053-01-16T17:07:56.205Z","validation_ids":[],"cooldown_groups":["pet_savings"],"updated_at":"2023-01-16T17:07:56.272Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"default","barrier":"O usuário saber sobre o programa de benefícios e poder acessá-lo com um clique.","behavior":"O usuário se cadastrar em programas de fidelidade para gastos com pets.","benefits":"O usuário gastar menos nas compras para o seu pet.","cooldown":"0","feed_cta":"quero!","feed_body":"Você gastou [=currency(rvars.agg.petz.amt_2m)] com pets em 60 dias. Quer ver como economizar?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"animais de estimação","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"pet_savings","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"728,823","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["external_data"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat1000014.amt60d","type":"rvars","value":"800"},{"name":"agg.petz.amt_2m","type":"rvars","value":"400"},{"name":"agg.cobasi.amt_2m","type":"rvars","value":"200"},{"name":"agg.petlove.amt_2m","type":"rvars","value":"200"}],"etl_aggregations":[{"etl_aggregation_id":"764","etl_aggregation_name":"Petz Expenses Last 2 Months","rvar_object":"petz","rvar_variable":"amt_2m","rule":{"type":"sum_amount","filter":{"$regex":{"description":"petz"},"$last_x_months":2,"$valid_transactions":true,"olivia_category_level1_id":[1000014]},"invert_value":true},"updated_at":"2021-05-13T16:51:03.644Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":728,"name":"User belongs to AB test group 2","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_728"},{"applicability_rule_id":823,"name":"Itau Pet Savings on Petz","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.petz.amt_2m"},"right_value":{"type":"fixed","value":"100","variable_type":"int"}}],"updated_at":"2022-08-23T17:30:23.752","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_823"}],"shadow":false,"requires_etls":["petz.amt_2m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37197},{"promotion_id":"10371","name":"act_spotify_offer","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Seu perfil de gastos indica que você mora com outras pessoas. E analisando suas transações, vi que você é assinante do <b>plano individual</b> do Spotify<br /><br />Para o seu caso, recomendo o <b>Plano Familiar</b> que pode te trazer uma <b>economia de mais de R$ 150 por ano</b><br /><br />O plano custa <b>R$ 34,90 por mês</b> e dá acesso para até <b>6 pessoas</b>\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Tem um plano do <b>Spotify</b> mais vantajoso para o seu bolso 🤩  E você pode economizar mais de <b>R$ 150</b> por ano com isso\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Seu perfil de gastos indica que você mora com outras pessoas. E analisando suas transações, vi que você é assinante do <b>plano individual</b> do Spotify<br /><br />Para o seu caso, recomendo o <b>Plano Familiar</b> que pode te trazer uma <b>economia de mais de R$ 150 por ano</b><br /><br />O plano custa <b>R$ 34,90 por mês</b> e dá acesso para até <b>6 pessoas</b>","content_link":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","user_option_1":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","user_option_2":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","user_option_3":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"feedback\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer alterar seu plano agora?\"}}","featured_value":"{\"bubbleTemplate\":\"big_text\",\"variables\":{\"body\":\"\"}}","main_text_body":"Tem um plano do <b>Spotify</b> mais vantajoso para o seu bolso 🤩  E você pode economizar mais de <b>R$ 150</b> por ano com isso","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"https://www.spotify.com/br/premium/?utm_campaign=olivia&utm_source=olivia&#PLANS","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","user_option_1_body":"","user_option_2_body":"","user_option_3_body":"","call_to_action_body":"Quer alterar seu plano agora?","featured_value_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero demais\",\"response\":\"Boa, nada de perder tempo quando se trata de economia, não é?<br /><br />📌Só para esclarecer, este tipo de serviço não é de responsabilidade do Itaú Unibanco.\",\"link_text\":\"Então já vem por aqui para resolver isso agora!\",\"link\":\"https://www.spotify.com/br/premium/?utm_campaign=olivia&utm_source=olivia&#PLANS\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não, valeu\",\"response\":\"Tudo bem! Em breve eu volto pra te trazer novas ideias de como economizar 😉💰\",\"link_text\":\"\"}}","user_option_1_feedback":"","user_option_1_response":"","user_option_2_feedback":"","user_option_2_response":"","user_option_3_feedback":"","user_option_3_response":"","internal_link_undefined":"","user_option_delayed_body":"","user_option_engaged_body":"Quero demais","user_option_dismissed_body":"Não, valeu","user_option_delayed_feedback":"","user_option_delayed_response":"","user_option_engaged_feedback":"","user_option_engaged_response":"Boa, nada de perder tempo quando se trata de economia, não é?<br /><br />📌Só para esclarecer, este tipo de serviço não é de responsabilidade do Itaú Unibanco.","user_option_delayed_link_text":"","user_option_engaged_link_text":"Então já vem por aqui para resolver isso agora!","user_option_dismissed_feedback":"","user_option_dismissed_response":"Tudo bem! Em breve eu volto pra te trazer novas ideias de como economizar 😉💰","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-20T14:18:17.614Z","end_date":"2053-01-16T17:08:57.482Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-16T17:08:57.567Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":21,"profile_group_id":14,"previous_version":20,"convo_header":{"type":"alert","cooldown":"0","feed_cta":"Veja aqui","feed_body":"Tem um plano do Spotify mais vantajoso para o seu bolso. E você pode economizar mais de R$150 por ano!","categories":"10400","feed_emoji":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"serviços por assinatura","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","feed_read_time":"","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"610,2147483650","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","applicability_rules_description":"","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["external_data","olivia partner"]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"313","etl_aggregation_name":"L2 Category Shopping/Toys & Baby Supplies 60 Days Sum Amount","rvar_object":"l2cat110800","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110800,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"524","etl_aggregation_name":"L1 Category Groceries 60 Days Sum Amount","rvar_object":"l1cat115000","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"$valid_transactions":true,"olivia_category_level1_id":115000},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"666","etl_aggregation_name":"Total Spending and Income - Last 06 months","rvar_object":"total_spending_and_income","rvar_variable":"totals","rule":{"code":"  const _ = require('lodash');\n  const moment = require('moment');\n\n  const restrict_spending_categories = [\n    10000,\n    20000,\n    30000,\n    40000,\n    50000,\n    60000,\n    70000,\n    80000,\n    90000,\n    10000014,\n    110000,\n    115000,\n    120000,\n    130000,\n  ];\n\n  const week_days_comparison_restrict_spending_categories = [\n    20000,\n    30000,\n    50000,\n    60000,\n    70000,\n    90000,\n    10000014,\n    110000,\n    115000,\n    120000,\n    130000,\n  ];\n\n  const start_1mo_closed = moment().subtract(1, 'month').startOf('month').valueOf();\n  const end_1mo_closed = moment().subtract(1, 'month').endOf('month').valueOf();\n  const start_3mo_closed = moment().subtract(3, 'month').startOf('month').valueOf();\n  const end_3mo_closed = moment().subtract(1, 'month').endOf('month').valueOf();\n  const start_6mo_closed = moment().subtract(6, 'month').startOf('month').valueOf();\n  const end_6mo_closed = moment().subtract(1, 'month').endOf('month').valueOf();\n  const start_this_month = moment().startOf('month').valueOf();\n  const oneMonthsAgo = moment().subtract(1, 'month').startOf('day').add(1, 'day').valueOf();\n  const threeMonthsAgo = moment().subtract(3, 'month').add(1, 'day').startOf('day').valueOf();\n  const sixMonthsAgo = moment().subtract(6, 'month').add(1, 'day').startOf('day').valueOf();\n\n  const start_year = moment('2021-01-01').valueOf();\n  const end_year = moment('2021-12-31').valueOf();\n  const this_moment = moment().utc().valueOf();\n  let spending = [];\n  let income = [];\n  let savings = [];\n\n  if (transactions && transactions.length) {\n    spending = transactions.filter(t => t.date.getTime() >= start_year &&\n      t.enabled && (t.budget_type === 'variable' || t.budget_type === 'fixed') && t.cashflow === true && t.cashflow_type === 'out');\n    income = transactions.filter(t => t.date.getTime() >= start_year && t.enabled && t.cashflow === true && t.cashflow_type === 'in');\n\n    savings = transactions.filter(t => t.date.getTime() >= start_year && t.enabled && t.cashflow === true && t.cashflow_type === 'nil' && [260000].includes(t.olivia_category_level1_id));\n  }\n\n  let date_last_income_transaction;\n  let date_last_spending_transaction;\n\n  let spending_12m = 0;\n  let spending_by_category_weekdays_12m = 0;\n  let spending_by_category_weekends_12m = 0;\n  let spending_06m = 0;\n  let spending_03m = 0;\n  let spending_01m = 0;\n  let spending_this_month = 0;\n  let savings_03m = 0;\n  let savings_unpaired_transactions_03m = 0;\n  let savings_investments_accounts_03m = 0;\n  let vendors_03m = null;\n  let vendors_12m = null;\n  let categories_01m = null;\n  let categories_03m = null;\n  let categories_12m = null;\n  let categories_this_month = null;\n  let variable_categories_this_month = null;\n  let transactions_03m = 0;\n  let spending_transactions_12m = 0;\n  let spending_transactions_credit_card_12m = 0;\n  let spending_list_credit_card_12m = [];\n  let income_transactions_12m = 0;\n  let food_and_drink_03m = 0;\n  let groceries_03m = 0;\n  let spending_01m_closed = 0;\n  let spending_03m_closed = 0;\n  let fixed_spending_01m = 0;\n  let variable_spending_01m = 0;\n  let fixed_spending_03m_closed = 0;\n  let variable_spending_03m_closed = 0;\n  let fixed_spending_06m_closed = 0;\n  let variable_spending_06m_closed = 0;\n  let fixed_spending_this_month = 0;\n  let variable_spending_this_month = 0;\n  let vendors_list_03m = [];\n  let vendors_list_12m = [];\n  let top_03_vendors_list_03m = [];\n  let top_03_vendors_list_12m = [];\n  let categories_list_this_month = [];\n  let top_03_categories_list_this_month = [];\n  let variable_categories_list_this_month = [];\n  let top_03_variable_categories_list_this_month = [];\n  let categories_list_01m = [];\n  let top_03_categories_list_01m = [];\n  let categories_list_03m = [];\n  let top_03_categories_list_03m = [];\n  let categories_list_12m = [];\n  let top_03_categories_list_12m = [];\n  let spending_credit_card_by_month = {};\n  let month_with_more_credit_card_transactions = '01';\n  let max_credit_card_transactions = 0;\n  let spending_by_category_weekend_list_12m = [];\n  let spending_by_category_weekdays_list_12m = [];\n  let top_03_spending_by_category_weekdays_12m = [];\n  let top_03_spending_by_category_weekend_12m = [];\n  let most_expensive_transaction_01m_closed = null;\n  let most_expensive_transaction_03m = null;\n\n  if (savings && savings.length) {\n    savings_unpaired_transactions_03m = -_.sumBy(savings.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && !t.paired_transaction_id), 'amount').toFixed(2);\n    savings_investments_accounts_03m = -_.sumBy(savings.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && [101, 103, 104, 105, 106].includes(t.account_type_id) && (t.account_type_id != 106 || !t.paired_transaction_id)), 'amount').toFixed(2);\n    savings_03m = savings_unpaired_transactions_03m - savings_investments_accounts_03m;\n  }\n\n  if (spending && spending.length) {\n    date_last_spending_transaction = moment(_.minBy(spending, 'date').date).format('YYYY-MM-DD');\n    spending_06m = -_.sumBy(spending.filter(t => t.date.getTime() >= sixMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    spending_12m = -_.sumBy(spending.filter(t => t.date.getTime() <= end_year), 'amount').toFixed(2);\n    spending_transactions_12m = _.size(spending.filter(t => t.date.getTime() <= end_year));\n\n    spending_by_category_weekdays_12m = _.groupBy(spending.filter(t => (moment(t.date).utc().day() != 0 && moment(t.date).utc().day() != 6) && t.date.getTime() <= end_year && week_days_comparison_restrict_spending_categories.includes(t.olivia_category_level1_id)), 'olivia_category_level1_id');;\n    if (spending_by_category_weekdays_12m) {\n      for (const category of Object.keys(spending_by_category_weekdays_12m)) {\n        const value = -spending_by_category_weekdays_12m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n        const transactions = _.size(spending_by_category_weekdays_12m[category]);\n        const percentual = parseFloat((value / spending_12m).toFixed(2));\n        spending_by_category_weekdays_list_12m.push({ category, value, transactions, percentual });\n      }\n    }\n    if (spending_by_category_weekdays_list_12m && spending_by_category_weekdays_list_12m.length) {\n      spending_by_category_weekdays_list_12m.sort((a, b) => b.value - a.value);\n      top_03_spending_by_category_weekdays_12m = spending_by_category_weekdays_list_12m.splice(0, 3);\n    }\n\n    spending_by_category_weekends_12m = _.groupBy(spending.filter(t => (moment(t.date).utc().day() == 0 || moment(t.date).utc().day() == 6) && t.date.getTime() <= end_year && week_days_comparison_restrict_spending_categories.includes(t.olivia_category_level1_id)), 'olivia_category_level1_id');;\n    if (spending_by_category_weekends_12m) {\n      for (const category of Object.keys(spending_by_category_weekends_12m)) {\n        const value = -spending_by_category_weekends_12m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n        const transactions = _.size(spending_by_category_weekends_12m[category]);\n        const percentual = parseFloat((value / spending_12m).toFixed(2));\n        spending_by_category_weekend_list_12m.push({ category, value, transactions, percentual });\n      }\n    }\n    if (spending_by_category_weekend_list_12m && spending_by_category_weekend_list_12m.length) {\n      spending_by_category_weekend_list_12m.sort((a, b) => b.value - a.value);\n      top_03_spending_by_category_weekend_12m = spending_by_category_weekend_list_12m.splice(0, 3);\n    }\n\n    categories_03m = _.groupBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n\n    spending_transactions_credit_card_12m = _.size(spending.filter(t => t.date.getTime() <= end_year && t.account_type_id == 200));\n\n    spending_list_credit_card_12m = spending.filter(t => t.date.getTime() <= end_year && t.account_type_id == 200);\n\n    for (const i in spending_list_credit_card_12m) {\n      const m = moment(spending_list_credit_card_12m[i].date).format('MM');\n      spending_credit_card_by_month[m] = (spending_credit_card_by_month[m] || 0) + 1;\n    }\n    for (const m of Object.keys(spending_credit_card_by_month)) {\n      month_with_more_credit_card_transactions = (spending_credit_card_by_month[m] >= (spending_credit_card_by_month[month_with_more_credit_card_transactions] || 0)) ? m : month_with_more_credit_card_transactions;\n      max_credit_card_transactions = (spending_credit_card_by_month[m] >= spending_credit_card_by_month[month_with_more_credit_card_transactions] || 0) ? spending_credit_card_by_month[m] : spending_credit_card_by_month[month_with_more_credit_card_transactions];\n    }\n\n    var spending_01m_closed_transactions = spending.filter(t => t.date.getTime() >= start_1mo_closed && t.date.getTime() <= end_1mo_closed);\n\n    if (spending_01m_closed_transactions && spending_01m_closed_transactions.length > 0) {\n      spending_01m_closed = -_.sumBy(spending_01m_closed_transactions, 'amount').toFixed(2);\n      most_expensive_transaction_01m_closed = spending_01m_closed_transactions.reduce((first, second) => (first.amount < second.amount) ? first : second);\n      most_expensive_transaction_01m_closed = _.pick(most_expensive_transaction_01m_closed, ['description', 'amount']);\n    }\n\n    var spending_03m_transactions = spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment);\n\n    if (spending_03m_transactions && spending_03m_transactions.length > 0) {\n      spending_03m = -_.sumBy(spending_03m_transactions, 'amount').toFixed(2);\n      most_expensive_transaction_03m = spending_03m_transactions.reduce((first, second) => (first.amount < second.amount) ? first : second);\n      most_expensive_transaction_03m = _.pick(most_expensive_transaction_03m, ['description', 'amount']);\n    }\n\n    vendors_03m = _.groupBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && restrict_spending_categories.includes(t.olivia_category_level1_id)), 'relevant_description');\n    vendors_12m = _.groupBy(spending.filter(t => t.date.getTime() <= end_year && restrict_spending_categories.includes(t.olivia_category_level1_id)), 'relevant_description');\n    categories_01m = _.groupBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n    categories_03m = _.groupBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n    categories_12m = _.groupBy(spending.filter(t => t.date.getTime() <= end_year), 'olivia_category_level1_id');\n    categories_this_month = _.groupBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment), 'olivia_category_level1_id');\n    variable_categories_this_month = _.groupBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && t.budget_type === 'variable'), 'olivia_category_level1_id');\n    transactions_03m = _.size(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment));\n    food_and_drink_03m = -_.sumBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && [60000].includes(t.olivia_category_level1_id)), 'amount').toFixed(2);\n    groceries_03m = -_.sumBy(spending.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment && [115000].includes(t.olivia_category_level1_id)), 'amount').toFixed(2);\n    spending_01m = -_.sumBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    spending_this_month = -_.sumBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    spending_03m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed), 'amount').toFixed(2);\n    fixed_spending_01m = -_.sumBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_01m = -_.sumBy(spending.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment && t.budget_type === 'variable'), 'amount').toFixed(2);\n    fixed_spending_this_month = -_.sumBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_this_month = -_.sumBy(spending.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && t.budget_type === 'variable'), 'amount').toFixed(2);\n    fixed_spending_03m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_03m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed && t.budget_type === 'variable'), 'amount').toFixed(2);\n    fixed_spending_06m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_6mo_closed && t.date.getTime() <= end_6mo_closed && t.budget_type === 'fixed'), 'amount').toFixed(2);\n    variable_spending_06m_closed = -_.sumBy(spending.filter(t => t.date.getTime() >= start_6mo_closed && t.date.getTime() <= end_6mo_closed && t.budget_type === 'variable'), 'amount').toFixed(2);\n  }\n\n  if (vendors_03m) {\n    for (const vendor of Object.keys(vendors_03m)) {\n      const value = -vendors_03m[vendor].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(vendors_03m[vendor]);\n      vendors_list_03m.push({ vendor, value, transactions });\n    }\n  }\n\n  if (vendors_list_03m && vendors_list_03m.length) {\n    vendors_list_03m.sort((a, b) => b.transactions - a.transactions);\n    top_03_vendors_list_03m = vendors_list_03m.splice(0, 3);\n  }\n\n  if (vendors_12m) {\n    for (const vendor of Object.keys(vendors_12m)) {\n      const value = -vendors_12m[vendor].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(vendors_12m[vendor]);\n      vendors_list_12m.push({ vendor, value, transactions });\n    }\n  }\n\n  if (vendors_list_12m && vendors_list_12m.length) {\n    vendors_list_12m.sort((a, b) => b.transactions - a.transactions);\n    top_03_vendors_list_12m = vendors_list_12m.splice(0, 3);\n  }\n\n  if (categories_01m) {\n    for (const category of Object.keys(categories_01m)) {\n      const value = -categories_01m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_01m[category]);\n      const percentual = parseFloat((value / spending_01m).toFixed(2));\n      categories_list_01m.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_01m && categories_list_01m.length) {\n    categories_list_01m.sort((a, b) => b.value - a.value);\n    top_03_categories_list_01m = categories_list_01m.splice(0, 3);\n  }\n\n  if (categories_03m) {\n    for (const category of Object.keys(categories_03m)) {\n      const value = -categories_03m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_03m[category]);\n      const percentual = parseFloat((value / spending_03m).toFixed(2));\n      categories_list_03m.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_03m && categories_list_03m.length) {\n    categories_list_03m.sort((a, b) => b.value - a.value);\n    top_03_categories_list_03m = categories_list_03m.splice(0, 3);\n  }\n  if (categories_12m) {\n    for (const category of Object.keys(categories_12m)) {\n      const value = -categories_12m[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_12m[category]);\n      const percentual = parseFloat((value / spending_12m).toFixed(2));\n      categories_list_12m.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_12m && categories_list_12m.length) {\n    categories_list_12m.sort((a, b) => b.value - a.value);\n    top_03_categories_list_12m = categories_list_12m.splice(0, 3);\n  }\n\n  if (categories_this_month) {\n    for (const category of Object.keys(categories_this_month)) {\n      const value = -categories_this_month[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(categories_this_month[category]);\n      const percentual = parseFloat((value / spending_this_month).toFixed(2));\n      categories_list_this_month.push({ category, value, transactions, percentual });\n    }\n  }\n  if (categories_list_this_month && categories_list_this_month.length) {\n    categories_list_this_month.sort((a, b) => b.value - a.value);\n    top_03_categories_list_this_month = categories_list_this_month.splice(0, 3);\n  }\n\n  if (variable_categories_this_month) {\n    for (const category of Object.keys(variable_categories_this_month)) {\n      const value = -variable_categories_this_month[category].reduce((t, c) => { return t += c.amount; }, 0).toFixed(2);\n      const transactions = _.size(variable_categories_this_month[category]);\n      const percentual = parseFloat((value / spending_this_month).toFixed(2));\n      variable_categories_list_this_month.push({ category, value, transactions, percentual });\n    }\n  }\n  if (variable_categories_list_this_month && variable_categories_list_this_month.length) {\n    variable_categories_list_this_month.sort((a, b) => b.value - a.value);\n    top_03_variable_categories_list_this_month = variable_categories_list_this_month.splice(0, 3);\n  }\n\n  let income_12m = 0;\n  let income_06m = 0;\n  let income_03m = 0;\n  let income_01m = 0;\n  let income_03m_closed = 0;\n  let income_this_month = 0;\n  let income_paycheck_this_month = 0;\n  let income_list_12m = null;\n  let income_by_month = {};\n  let month_with_more_deposits = '01'\n\n  if (income && income.length) {\n    date_last_income_transaction = moment(_.minBy(income, 'date').date).format('YYYY-MM-DD');\n    income_transactions_12m = _.size(income.filter(t => t.date.getTime() <= end_year));\n    income_list_12m = income.filter(t => t.date.getTime() <= end_year);\n    for (const i in income_list_12m) {\n      const m = moment(income_list_12m[i].date).format('MM');\n      income_by_month[m] = (income_by_month[m] || 0) + income_list_12m[i].amount;\n    }\n    for (const m of Object.keys(income_by_month)) {\n      month_with_more_deposits = (income_by_month[m] >= (income_by_month[month_with_more_deposits] || 0)) ? m : month_with_more_deposits;\n    }\n    income_12m = _.sumBy(income_list_12m, 'amount').toFixed(2);\n    income_06m = _.sumBy(income.filter(t => t.date.getTime() >= sixMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_03m = _.sumBy(income.filter(t => t.date.getTime() >= threeMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_01m = _.sumBy(income.filter(t => t.date.getTime() >= oneMonthsAgo && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_03m_closed = _.sumBy(income.filter(t => t.date.getTime() >= start_3mo_closed && t.date.getTime() <= end_3mo_closed), 'amount').toFixed(2);\n    income_this_month = _.sumBy(income.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment), 'amount').toFixed(2);\n    income_paycheck_this_month = _.sumBy(income.filter(t => t.date.getTime() >= start_this_month && t.date.getTime() <= this_moment && [150300].includes(t.olivia_category_id)), 'amount').toFixed(2);\n  }\n\n  let annual_savings_year = income_12m - spending_12m;\n  let annual_savings_2020 = income_12m - spending_12m;\n\n  return {\n    v: '3.3',\n    update_at: moment().format('llll'),\n    spending_06m,\n    spending_03m,\n    spending_transactions_12m,\n    spending_12m,\n    income_transactions_12m,\n    top_03_vendors_list_03m,\n    top_03_vendors_list_12m,\n    top_03_categories_list_01m,\n    top_03_categories_list_03m,\n    top_03_categories_list_12m,\n    top_03_categories_list_this_month,\n    top_03_variable_categories_list_this_month,\n    transactions_03m,\n    food_and_drink_03m,\n    groceries_03m,\n    spending_01m,\n    spending_01m_closed,\n    spending_03m_closed,\n    spending_this_month,\n    fixed_spending_01m,\n    variable_spending_01m,\n    fixed_spending_03m_closed,\n    variable_spending_03m_closed,\n    fixed_spending_06m_closed,\n    variable_spending_06m_closed,\n    fixed_spending_this_month,\n    variable_spending_this_month,\n    income_12m,\n    income_06m,\n    income_03m,\n    income_01m,\n    income_03m_closed,\n    income_this_month,\n    income_paycheck_this_month,\n    income_by_month,\n    most_expensive_transaction_01m_closed,\n    most_expensive_transaction_03m,\n    month_with_more_deposits,\n    annual_savings_year,\n    annual_savings_2020,\n    spending_transactions_credit_card_12m,\n    spending_credit_card_by_month,\n    month_with_more_credit_card_transactions,\n    max_credit_card_transactions,\n    top_03_spending_by_category_weekdays_12m,\n    top_03_spending_by_category_weekend_12m,\n    savings_unpaired_transactions_03m,\n    savings_investments_accounts_03m,\n    savings_03m,\n    date_last_spending_transaction,\n    date_last_income_transaction\n  }\n","type":"custom","filter":{"$valid_transactions":true},"description":"Agg Income and Spendind last 6 months. Save values for 3 months. Calculate top Vendors and Categories last 3 months.","invert_value":true},"updated_at":"2022-01-06T13:50:52.653Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"514","etl_aggregation_name":"L1 Category Education 60 Days Sum Amount","rvar_object":"l1cat20000","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"$valid_transactions":true,"olivia_category_level1_id":20000},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"185","etl_aggregation_name":"L2 Category Groceries/Market & Supermarket 30 Days Sum Amount","rvar_object":"l2cat110300","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"568","etl_aggregation_name":"Count Spotify Individual Plan Last 3 Months","rvar_object":"spotify","rvar_variable":"individual3m","rule":{"code":"const moment = require('moment');\nconst _ = require('lodash');\nconst threeMonthAgo = moment().utc().subtract(3, 'month').startOf('day');\n\ntransactions = transactions.filter(t => Array.isArray(t.transaction_property_ids) && t.transaction_property_ids.includes('spotify_individual_plan_uk'));\n\nif (!transactions || transactions.length == 0) return false;\nreturn true;","type":"count","filter":{"$amount":{"value":-19.9,"operator":"="},"$last_x_months":3,"$valid_transactions":true,"transaction_property_ids":["spotify_individual_plan_br"]},"invert_value":false},"updated_at":"2021-05-24T19:45:26.370Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":610,"name":"Has a spotify individual plan","rule":[{"type":"compare","operator":">=","left_value":{"type":"variable","variable":"rvars.agg.spotify.individual3m"},"right_value":{"type":"fixed","value":3,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_610"},{"applicability_rule_id":2147483650,"name":"Suspected Family Expenses 2","rule":[{"code":"    if (!rvars\n        || !rvars.agg\n        || !rvars.agg.l2cat110800\n        || rvars.agg.l2cat110800.amt60d == null\n        || !rvars.agg.l1cat115000\n        || rvars.agg.l1cat115000.amt60d == null\n        || !rvars.agg.total_spending_and_income\n        || !rvars.agg.total_spending_and_income.totals\n        || rvars.agg.total_spending_and_income.totals.income_06m == null\n        || !rvars.agg.l1cat20000\n        || rvars.agg.l1cat20000.amt60d == null\n        || !rvars.agg.l2cat110300\n        || rvars.agg.l2cat110300.amt30d == null\n    ) return false;\n\n    if ((rvars.agg.l2cat110800.amt60d > 10)\n        || (rvars.agg.l1cat115000.amt60d > (rvars.agg.total_spending_and_income.totals.income_06m * 0.1))\n        || (rvars.agg.l1cat20000.amt60d > 100)\n        || (rvars.agg.l2cat110300.amt30d > 1000)\n    ) return true;\n\n    return false;\n","type":"custom","description":"Spent on Toys > 10 OR Groceries > 10% Income OR Education > 100 in the last 60 days OR Spent on Groceries/Market & Supermarket 30 Days > 1000"}],"updated_at":"2022-08-10T14:39:00.567","updated_by":"raimundo.botelho@mailer.com.br","applicability_name":"applicability_rule_id_2147483650"}],"shadow":false,"requires_etls":["l2cat110800.amt60d","l1cat115000.amt60d","total_spending_and_income.totals","l1cat20000.amt60d","l2cat110300.amt30d","spotify.individual3m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37196},{"promotion_id":"10378","name":"alert_weekly_update_featured","convo_template":"tpt_itau_base_summary","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","no_etl":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Ainda estou analisando as movimentações da sua conta corrente desta semana.<br />Na próxima semana trago novidades! 😉\"}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","no_data":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Você não teve movimentações na sua conta corrente no período de <var>=ivars.last_week_info.cycle_name</var><br />Na próxima semana trago novidades! 😉\"}}","out_msg":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Vou continuar de olho nas suas finanças e volto na próxima semana com mais informações! 🤓\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Aqui estão os números atualizados <b>das suas finanças</b> no período de <var>=ivars.last_week_info.cycle_name</var>:<br /><var>=ivars.last_week_info.total_income</var><var>=ivars.last_week_info.total_spending</var><var>=ivars.last_week_info.fixed_spending</var><var>=ivars.last_week_info.variable_spending</var>\"}}","check_data":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"    // Check Data\\n    const moment = require('moment');\\n    const currency = formulas.currency;\\n    const _ = require('lodash');\\n\\n    ivars.last_week_info = {};\\n\\n    ivars.itau_summary_has_etl = 0;\\n    ivars.itau_summary_has_details = 0;\\n    ivars.itau_summary_has_data = 0;\\n    ivars.itau_summary_up_to_date = 0;\\n    ivars.last_week_info.biggest_expense = '';\\n    ivars.last_week_info.topThreeCategories = '';\\n\\n    const last_week_fixed = _.get(dat.profile_overview_panel_section, 'last_week_fixed');\\n    const total_income = _.get(dat.profile_overview_panel_section, 'last_week_fixed.income.total.amount');\\n    const total_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.total.total_amount');\\n    const fixed_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.fixed.total_amount');\\n    const variable_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.variable.total_amount');\\n\\n    if (!last_week_fixed) {\\n        ivars.itau_summary_has_etl = 0;\\n    }\\n    else {\\n        ivars.itau_summary_has_etl = 1;\\n\\n        ivars.last_week_info.cycle_name = moment(last_week_fixed.begin).format('DD/MM') + ' a ' + moment(last_week_fixed.end).format('DD/MM');\\n\\n        if (!last_week_fixed\\n            || !ivars.last_week_info.cycle_name\\n            || !(total_income + total_spending)) {\\n            ivars.itau_summary_has_data = 0;\\n        }\\n        else {\\n            ivars.itau_summary_has_data = 1;\\n        }\\n\\n        // Code Block\\n        if (ivars.itau_summary_has_data) { // only show the info if user has total_income and/or total spenfing calculated\\n            // Check if summary is up to date\\n            ivars.last_week_info.start_summary = moment(last_week_fixed.begin).format('YYYY-MM-DD');\\n            let b = (moment().day() == 4) ? 13 : ( (moment().day() + 2) > 7 ? 1 : moment().day() + 2);\\n            ivars.last_week_info.todays_minus_7 = moment().subtract( b, 'days').format('YYYY-MM-DD');\\n            if (ivars.last_week_info.start_summary >= ivars.last_week_info.todays_minus_7 ) {\\n                ivars.itau_summary_up_to_date = 1;\\n            } \\n            // Income\\n            ivars.last_week_info.total_income = ((total_income) ? ('<br />Você recebeu = <b>' + currency(total_income) + '</b>') : '');\\n            // Total Spending\\n            ivars.last_week_info.total_spending = ((total_spending) ? ('<br />Você gastou = <b>' + currency(-total_spending) + '</b>') : '');\\n            // Fixed Spending\\n            ivars.last_week_info.fixed_spending = ((fixed_spending) ? ('<br />📌 Gastos Fixos =  <b>' + currency(-fixed_spending) + '</b>') : '');\\n            // Variable Spending\\n            ivars.last_week_info.variable_spending = ((variable_spending) ? ('<br />💸 Gastos Variáveis  =  <b>' + currency(-variable_spending) + '</b>') : '');\\n\\n        }\\n        // Details\\n\\n        // Biggest Spending\\n        if (!!last_week_fixed.spending.transactions\\n            && !!last_week_fixed.spending.transactions.length) {\\n\\n            let t = last_week_fixed.spending.transactions.sort((a, b) => { return a.amount - b.amount })\\n            if (t[0].amount) {\\n                ivars.last_week_info.biggest_expense = ('<br />Seu gasto de maior valor:  <br /> <b>' + t[0].description + ' ' + currency(-t[0].amount) + '</b>')\\n            }\\n            ivars.itau_summary_has_details = 1;\\n        }\\n\\n        // Top three categories\\n\\n        const topCategories = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.total.by_category.top.categories');\\n\\n        const topThreeCategories = topCategories.slice(0, 3);\\n\\n        if (topThreeCategories.length < 1) {\\n            ivars.itau_summary_has_details = 0;\\n        }\\n        else if (topThreeCategories.length < 2) {\\n            ivars.last_week_info.topThreeCategories = ('<br />Sua categoria de maior gasto:  <br /> <b>'\\n                + topThreeCategories[0].name + ' '\\n                + currency(-topThreeCategories[0].amount) + ' <br /> </b>');\\n        }\\n        else {\\n            ivars.last_week_info.topThreeCategories = ('<br />Suas categorias de maior gasto:  <br /> <b>'\\n                + topThreeCategories[0].name + ' '\\n                + currency(-topThreeCategories[0].amount) + ' <br /> '\\n                + topThreeCategories[1].name + ' '\\n                + currency(-topThreeCategories[1].amount) + ' <br /> </b>');\\n            if (topThreeCategories.length > 2)\\n                ivars.last_week_info.topThreeCategories +=\\n                    '<b>' + (topThreeCategories[2].name + ' '\\n                        + currency(-topThreeCategories[2].amount) + '<br /> </b>');\\n        }\\n    }\\n \"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","no_etl_body":"Ainda estou analisando as movimentações da sua conta corrente desta semana.<br />Na próxima semana trago novidades! 😉","content_body":"","no_data_body":"Você não teve movimentações na sua conta corrente no período de <var>=ivars.last_week_info.cycle_name</var><br />Na próxima semana trago novidades! 😉","notification":" ","out_msg_body":"Vou continuar de olho nas suas finanças e volto na próxima semana com mais informações! 🤓","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"Aqui estão os números atualizados <b>das suas finanças</b> no período de <var>=ivars.last_week_info.cycle_name</var>:<br /><var>=ivars.last_week_info.total_income</var><var>=ivars.last_week_info.total_spending</var><var>=ivars.last_week_info.fixed_spending</var><var>=ivars.last_week_info.variable_spending</var>","notification_2":" ","notification_3":" ","check_data_body":"    // Check Data\n    const moment = require('moment');\n    const currency = formulas.currency;\n    const _ = require('lodash');\n\n    ivars.last_week_info = {};\n\n    ivars.itau_summary_has_etl = 0;\n    ivars.itau_summary_has_details = 0;\n    ivars.itau_summary_has_data = 0;\n    ivars.itau_summary_up_to_date = 0;\n    ivars.last_week_info.biggest_expense = '';\n    ivars.last_week_info.topThreeCategories = '';\n\n    const last_week_fixed = _.get(dat.profile_overview_panel_section, 'last_week_fixed');\n    const total_income = _.get(dat.profile_overview_panel_section, 'last_week_fixed.income.total.amount');\n    const total_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.total.total_amount');\n    const fixed_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.fixed.total_amount');\n    const variable_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.variable.total_amount');\n\n    if (!last_week_fixed) <var>enc$\n        ivars.itau_summary_has_etl = 0;\n    </var>\n    else <var>enc$\n        ivars.itau_summary_has_etl = 1;\n\n        ivars.last_week_info.cycle_name = moment(last_week_fixed.begin).format('DD/MM') + ' a ' + moment(last_week_fixed.end).format('DD/MM');\n\n        if (!last_week_fixed\n            || !ivars.last_week_info.cycle_name\n            || !(total_income + total_spending)) {\n            ivars.itau_summary_has_data = 0;\n        }\n        else {\n            ivars.itau_summary_has_data = 1;\n        }\n\n        // Code Block\n        if (ivars.itau_summary_has_data) { // only show the info if user has total_income and/or total spenfing calculated\n            // Check if summary is up to date\n            ivars.last_week_info.start_summary = moment(last_week_fixed.begin).format('YYYY-MM-DD');\n            let b = (moment().day() == 4) ? 13 : ( (moment().day() + 2) > 7 ? 1 : moment().day() + 2);\n            ivars.last_week_info.todays_minus_7 = moment().subtract( b, 'days').format('YYYY-MM-DD');\n            if (ivars.last_week_info.start_summary >= ivars.last_week_info.todays_minus_7 ) {\n                ivars.itau_summary_up_to_date = 1;\n            } \n            // Income\n            ivars.last_week_info.total_income = ((total_income) ? ('<br />Você recebeu = <b>' + currency(total_income) + '</b>') : '');\n            // Total Spending\n            ivars.last_week_info.total_spending = ((total_spending) ? ('<br />Você gastou = <b>' + currency(-total_spending) + '</b>') : '');\n            // Fixed Spending\n            ivars.last_week_info.fixed_spending = ((fixed_spending) ? ('<br />📌 Gastos Fixos =  <b>' + currency(-fixed_spending) + '</b>') : '');\n            // Variable Spending\n            ivars.last_week_info.variable_spending = ((variable_spending) ? ('<br />💸 Gastos Variáveis  =  <b>' + currency(-variable_spending) + '</b>') : '');\n\n        }\n        // Details\n\n        // Biggest Spending\n        if (!!last_week_fixed.spending.transactions\n            && !!last_week_fixed.spending.transactions.length) {\n\n            let t = last_week_fixed.spending.transactions.sort((a, b) => { return a.amount - b.amount })\n            if (t[0].amount) {\n                ivars.last_week_info.biggest_expense = ('<br />Seu gasto de maior valor:  <br /> <b>' + t[0].description + ' ' + currency(-t[0].amount) + '</b>')\n            }\n            ivars.itau_summary_has_details = 1;\n        }\n\n        // Top three categories\n\n        const topCategories = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.total.by_category.top.categories');\n\n        const topThreeCategories = topCategories.slice(0, 3);\n\n        if (topThreeCategories.length < 1) {\n            ivars.itau_summary_has_details = 0;\n        }\n        else if (topThreeCategories.length < 2) {\n            ivars.last_week_info.topThreeCategories = ('<br />Sua categoria de maior gasto:  <br /> <b>'\n                + topThreeCategories[0].name + ' '\n                + currency(-topThreeCategories[0].amount) + ' <br /> </b>');\n        }\n        else {\n            ivars.last_week_info.topThreeCategories = ('<br />Suas categorias de maior gasto:  <br /> <b>'\n                + topThreeCategories[0].name + ' '\n                + currency(-topThreeCategories[0].amount) + ' <br /> '\n                + topThreeCategories[1].name + ' '\n                + currency(-topThreeCategories[1].amount) + ' <br /> </b>');\n            if (topThreeCategories.length > 2)\n                ivars.last_week_info.topThreeCategories +=\n                    '<b>' + (topThreeCategories[2].name + ' '\n                        + currency(-topThreeCategories[2].amount) + '<br /> </b>');\n        }\n    </var>\n ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"Certo, aqui tem mais detalhes sobre seus gastos de <var>=ivars.last_week_info.cycle_name</var> 🔍 <var>=ivars.last_week_info.biggest_expense</var><br />Vou continuar de olho nas suas finanças e volto na próxima semana com mais informações! 🤓\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"Certo, aqui tem mais detalhes sobre seus gastos de <var>=ivars.last_week_info.cycle_name</var> 🔍 <var>=ivars.last_week_info.biggest_expense</var><br />Vou continuar de olho nas suas finanças e volto na próxima semana com mais informações! 🤓","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-06T16:53:05.271Z","end_date":"2053-01-16T18:50:43.831Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-16T18:50:43.912Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"alert","barrier":"Iremos fazer as contas dos gastos e recebimentos do usuário e mostrá-la semanalmente","behavior":"Usuário acompanhe seus gastos e recebimentos semanais na conta do Itaú","benefits":"Fazer com que o usuário acompanhe seus gastos e recebimentos durante todo o mês e não tenha surpresas no fechamento da fatura","cooldown":"0","feed_cta":"vamos!","feed_body":"Seu resumo semanal foi atualizado! Vem conferir as novidades da sua vida financeira. ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"resumo semanal","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"72","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["summary"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.last_week_fixed","type":"dat","value":{"end":"2022-10-13","begin":"2022-10-07","label":"7 outubro » 13 outubro","income":{"total":{"count":1,"amount":4222},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":4222}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-113.23}],"total_amount":-113.23},"bottom":{"categories":[],"total_amount":0}},"total_amount":-113.23,"transaction_count":1,"uncategorized_transaction_count":0},"total":{"by_category":{"top":{"categories":[{"id":190000,"name":"Transferências","color":"#996813","emoji":"🔁","amount":-450.05},{"id":110000,"name":"Compras","color":"#a12b83","emoji":"🛍️","amount":-443.51},{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-113.23}],"total_amount":-1006.79},"bottom":{"categories":[],"total_amount":0}},"total_amount":-1006.79,"transaction_count":3,"uncategorized_transaction_count":0},"variable":{"by_category":{"top":{"categories":[{"id":190000,"name":"Transferências","color":"#996813","emoji":"🔁","amount":-450.05},{"id":110000,"name":"Compras","color":"#a12b83","emoji":"🛍️","amount":-443.51}],"total_amount":-893.56},"bottom":{"categories":[],"total_amount":0}},"total_amount":-893.56,"transaction_count":2,"uncategorized_transaction_count":0},"transactions":[{"lat":-5.79448,"lon":-35.211,"date":"2022-10-11","tags":[],"notes":null,"amount":-113.23,"enabled":true,"pending":false,"cashflow":true,"category":{"id":10600,"name":"Contas / Água e esgoto","color":"#99482d","emoji":"🚰","level1":"Contas","level2":"Água e esgoto","level1_id":10000,"level2_id":10600},"frequency":"1-month","account_id":"42851472_ef937e3a06b80cc543ba35a3dc2a97cc","budget_type":"fixed","description":"SABESP 0633362514","installment":true,"transaction_id":"42851472_aguaaaaaaaaaa11111","account_type_id":100,"original_description":"SABESP 0633362514"},{"lat":-19.8157,"lon":-43.9542,"date":"2022-10-10","tags":[],"notes":null,"amount":-443.51,"enabled":true,"pending":false,"cashflow":true,"category":{"id":110500,"name":"Compras / Vestuário e acessórios","color":"#a12b83","emoji":"👖","level1":"Compras","level2":"Vestuário e acessórios","level1_id":110000,"level2_id":110500},"frequency":"0-none","account_id":"42851472_ef937e3a06b80cc543ba35a3dc2a97cc","budget_type":"variable","description":"RIACHUELO 204","transaction_id":"42851472_dddddd","account_type_id":100,"original_description":"RIACHUELO 204"},{"lat":-5.79448,"lon":-35.211,"date":"2022-10-09","tags":[],"notes":null,"amount":-450.05,"enabled":true,"pending":false,"cashflow":true,"category":{"id":191000,"name":"Transferências / Outras transferências","color":"#996813","emoji":"🔁","level1":"Transferências","level2":"Outras transferências","level1_id":190000,"level2_id":191000},"frequency":"0-none","account_id":"42851472_ef937e3a06b80cc543ba35a3dc2a97cc","description":"TED 080.0000BET CORRET","transaction_id":"42851472_teddddd","account_type_id":100,"original_description":"TED 080.0000BET CORRET"}]},"read_label":"7 (sex) e 13 (qui) de outubro","short_label":"7 out » 13 out"},"data_type":"json"}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37228},{"promotion_id":"10379","name":"inf_alert_alto_uso_limite","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\\n\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Isso representa<b> <var>=context.currentSession.svars.card_percentage</var></b> do seu limite total nesse cartão, que é de <b><var>=context.currentSession.svars.card_limit</var></b><br /><br />Recomendo que você programe seus próximos gastos para ficar dentro desse limite 😉\"}}","code_body":"\n","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Pelo que vi aqui, você gastou <b><var>=context.currentSession.svars.value_spent</var></b> da sua fatura atual no <b><var>=context.currentSession.svars.card_name</var></b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Isso representa<b> <var>=context.currentSession.svars.card_percentage</var></b> do seu limite total nesse cartão, que é de <b><var>=context.currentSession.svars.card_limit</var></b><br /><br />Recomendo que você programe seus próximos gastos para ficar dentro desse limite 😉","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Pelo que vi aqui, você gastou <b><var>=context.currentSession.svars.value_spent</var></b> da sua fatura atual no <b><var>=context.currentSession.svars.card_name</var></b>","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-23T19:03:39.889Z","end_date":"2053-01-16T18:57:20.286Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-16T18:57:20.368Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"alert","barrier":"Informar ao usuário o uso do seu limite.","behavior":"Fazer com que o usuário controle seus gastos e tenha consciência dos seus gastos.","benefits":"Fazer com que o usuário tenha controle dos seus gastos.","cooldown":"2160","feed_cta":"quero ver","feed_body":"Passando para te dizer que você está chegando perto do limite do seu cartão ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"gastos no cartão","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"2160","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"8280","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"2160","cooldownThumbsDown":"8280","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"849","cooldown_groups_merged":"true","session_variables_code":"    const { currency, percent } = formulas;\n\n    //Tied with priority\n    let info;\n    for (const credit_card of rvars.itau_credit_card_info) {\n        if (!!info) continue;\n        if (!credit_card.credit_card_limit) continue;\n\n        const percent_used = Math.abs(credit_card.credit_card_spent / credit_card.credit_card_limit);\n        if (percent_used >= 0.80) info = credit_card;\n    }\n\n    const value_spent = currency(Math.abs(info.credit_card_spent));\n    const card_name = `Itaú ${info.credit_card_segment} ${info.credit_card_brand} ${info.credit_card_variant}`;\n    const card_percentage = percent(Math.abs(info.credit_card_spent / info.credit_card_limit));\n    const card_limit = currency(info.credit_card_limit);\n\n    return { value_spent, card_name, card_percentage, card_limit };\n","session_variables_enabled":"true","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"itau_credit_card_info","type":"rvars","value":[{"credit_card_id":"2265890_5b1d08de-23a1-43b7-88a1-4853589f8bd3","credit_card_brand":"TST01","credit_card_limit":10000,"credit_card_spent":-8990.74,"credit_card_balance":-3974.74,"credit_card_segment":"Personnalite","credit_card_variant":"Black","credit_card_available":1000.43,"credit_card_expenses_01m":3000}]}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":849,"name":"Itau Alert Alto Uso Limite","rule":[{"code":"    if (!rvars\n        || !rvars.itau_credit_card_info\n        || !(rvars.itau_credit_card_info.length > 0)) return false;\n\n    for (const credit_card of rvars.itau_credit_card_info) {\n        if (!credit_card.credit_card_limit) continue;\n        const percent_used = Math.abs(credit_card.credit_card_spent / credit_card.credit_card_limit);\n        if (percent_used >= 0.80) return true;\n    }\n\n    return false;\n","type":"custom","description":""}],"updated_at":"2021-09-08T19:34:56.266224","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_849"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37169},{"promotion_id":"10382","name":"inf_alert_duplicated_payment","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"const duplicates = rvars.agg.duplicate_transactions.last_7d;\\nconst moment = require('moment');\\n\\n//Initialize history if not exists\\nivars.duplicated_payment_history = ivars.duplicated_payment_history || [];\\nivars.temp_duplicated_payment_1 = false;\\nivars.temp_duplicated_payment_2 = false;\\n\\n\\nfor (let key in duplicates) {\\n    const sorted_entries = duplicates[key].sort((a, b) => { return moment(a.timestamp).format('x') - moment(b.timestamp).format('x') });\\n    for (var entry = 0; entry < sorted_entries.length; entry++) {\\n        if(ivars.temp_duplicated_payment_1 || ivars.temp_duplicated_payment_2) continue;\\n        //Skip if not checking\\n        if (sorted_entries[entry].account_type_id != 100) continue;\\n\\n        //Check for history\\n        if (ivars.duplicated_payment_history.includes(sorted_entries[entry].transaction_id)) continue;\\n        //If there is no next element\\n        if (!sorted_entries[entry + 1]) continue;\\n        //Check if entries are 5 minutes apart\\n        if (moment(sorted_entries[entry].timestamp).add(1, 'day').isAfter(moment(sorted_entries[entry + 1].timestamp))) {\\n            //Add to history\\n            ivars.duplicated_payment_history.push(sorted_entries[entry].transaction_id);\\n            ivars.duplicated_payment_history.push(sorted_entries[entry + 1].transaction_id);\\n            //Return duplicated payments\\n            ivars.temp_duplicated_payment_1 = sorted_entries[entry];\\n            ivars.temp_duplicated_payment_2 = sorted_entries[entry + 1];\\n        };\\n    }\\n}\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"E ela caiu na sua <b>conta corrente</b> no dia <b><var>=ivars.temp_duplicated_payment_1.formatted_date</var></b>\"}}","code_body":"const duplicates = rvars.agg.duplicate_transactions.last_7d;\nconst moment = require('moment');\n\n//Initialize history if not exists\nivars.duplicated_payment_history = ivars.duplicated_payment_history || <var></var>;\nivars.temp_duplicated_payment_1 = false;\nivars.temp_duplicated_payment_2 = false;\n\n\nfor (let key in duplicates) <var>enc$\n    const sorted_entries = duplicates[key].sort((a, b) => { return moment(a.timestamp).format('x') - moment(b.timestamp).format('x') });\n    for (var entry = 0; entry < sorted_entries.length; entry++) {\n        if(ivars.temp_duplicated_payment_1 || ivars.temp_duplicated_payment_2) continue;\n        //Skip if not checking\n        if (sorted_entries[entry].account_type_id != 100) continue;\n\n        //Check for history\n        if (ivars.duplicated_payment_history.includes(sorted_entries[entry].transaction_id)) continue;\n        //If there is no next element\n        if (!sorted_entries[entry + 1]) continue;\n        //Check if entries are 5 minutes apart\n        if (moment(sorted_entries[entry].timestamp).add(1, 'day').isAfter(moment(sorted_entries[entry + 1].timestamp))) {\n            //Add to history\n            ivars.duplicated_payment_history.push(sorted_entries[entry].transaction_id);\n            ivars.duplicated_payment_history.push(sorted_entries[entry + 1].transaction_id);\n            //Return duplicated payments\n            ivars.temp_duplicated_payment_1 = sorted_entries[entry];\n            ivars.temp_duplicated_payment_2 = sorted_entries[entry + 1];\n        };\n    }\n</var>","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A transação que quero te mostrar é esta:<br /><var>=ivars.temp_duplicated_payment_1.description</var> - <var>=currency(ivars.temp_duplicated_payment_1.amount)</var>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"E ela caiu na sua <b>conta corrente</b> no dia <b><var>=ivars.temp_duplicated_payment_1.formatted_date</var></b>","notification":"Tava olhando seu extrato e vi uma transação duplicada. Será que é isso mesmo? 👀 ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você sabe o que aconteceu?\"}}","main_text_body":"A transação que quero te mostrar é esta:<br /><var>=ivars.temp_duplicated_payment_1.description</var> - <var>=currency(ivars.temp_duplicated_payment_1.amount)</var>","notification_2":"Notei duas transações com o mesmo valor no seu extrato. Vem comigo pra gente conferir 🤓 ","notification_3":"Parece que tem uma transação duplicada no seu extrato. Vamos ver? 🧐 ","disclaimer_body":"","user_engaged_link":"https://www.itau.com.br/atendimento-itau/para-voce/telefones","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Você sabe o que aconteceu?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Claro, está bem<br /><br />Só não deixa de conferir se tá tudo certo assim que puder, beleza? 😌\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não! O que faço?\",\"response\":\"O melhor é procurar logo o <b>Atendimento ao Cliente</b> para já ver tudo o que precisa\",\"link_text\":\"👉 Nesta página você encontra todos os telefones\",\"link\":\"https://www.itau.com.br/atendimento-itau/para-voce/telefones\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Tranquilo, sei o que é\",\"response\":\"Ah, que boa notícia!<br /><br />Vou continuar de olho em tudo pra cuidar das suas movimentações por aqui, tá? 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Não! O que faço?","user_option_dismissed_body":"Tranquilo, sei o que é","user_option_delayed_response":"Claro, está bem<br /><br />Só não deixa de conferir se tá tudo certo assim que puder, beleza? 😌","user_option_engaged_response":"O melhor é procurar logo o <b>Atendimento ao Cliente</b> para já ver tudo o que precisa","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Nesta página você encontra todos os telefones","user_option_dismissed_response":"Ah, que boa notícia!<br /><br />Vou continuar de olho em tudo pra cuidar das suas movimentações por aqui, tá? 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-07-19T13:05:54.835Z","end_date":"2053-01-18T16:50:53.704Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T16:50:53.832Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":14,"profile_group_id":14,"previous_version":13,"convo_header":{"type":"alert","barrier":"Mostrar ao usuário que uma transação duplicada foi identificada em seu extrato","behavior":"Fazer com que o usuário entre em contato com o Itaú e bloqueie o cartão, caso seja uma compra fraudulenta","benefits":"Caso tenha sido uma fraude, o usuário consiga bloquear o seu cartão e evitar mais compras fraudulentas","cooldown":"720","feed_cta":"vamos!","feed_body":"Vi uma transação duplicada aqui e queria te mostrar pra ter certeza de que está tudo certo. Vamos lá?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"de olho nas contas","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"720","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"720","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"828","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"agg.duplicate_transactions.last_7d","type":"rvars","value":{"110600_google good smile co_-22.9":[{"amount":43.19,"metadata":{"time":"2021-12-12T20:02:00Z"},"timestamp":1624305720000,"description":"CC-Google Good Smile Co","formatted_date":"12/12/21","transaction_id":"60cf002b26316a0025b05f41","account_type_id":100},{"amount":43.19,"metadata":{"time":"2021-12-12T20:04:00Z"},"timestamp":1624305840000,"description":"CC-Google Good Smile Co","formatted_date":"12/12/21","transaction_id":"60d4484abca674001d930b49","account_type_id":100}]},"data_type":"json"},{"name":"duplicated_payment_history","type":"ivars","value":[],"data_type":"string"}],"etl_aggregations":[{"etl_aggregation_id":"851","etl_aggregation_name":"Duplicate Transactions in the last week","rvar_object":"duplicate_transactions","rvar_variable":"last_7d","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const start_one_week_ago = moment.utc().subtract(1, 'week').valueOf();\n    const end_current_week = moment.utc().endOf('week').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_one_week_ago\n            && m <= end_current_week\n            && transaction.cashflow === true\n            && transaction.cashflow_type === 'out'\n            && !([260000].includes(transaction.olivia_category_level1_id))\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}_${transaction.relevant_description}_${transaction.amount}_${transaction.account_type_id}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description,\n                account_type_id: transaction.account_type_id,\n                metadata: transaction.metadata\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    const duplicateEntries = _.pickBy(billsRelDesc, function (value, key) {\n        if (value.length < 2) return false;\n        return true;\n    });\n\n    return duplicateEntries;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Find duplicate transactions from the last week","invert_value":true},"updated_at":"2021-12-23T17:47:20.591Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":828,"name":"Has Duplicate Transactions on the Same Day","rule":[{"code":"    if (!rvars\n        || !rvars.agg\n        || !rvars.agg.duplicate_transactions\n        || !rvars.agg.duplicate_transactions.last_7d) return 0;\n\n    const duplicates = rvars.agg.duplicate_transactions.last_7d;\n    const moment = require('moment');\n\n    //Initialize history if not exists\n    ivars.duplicated_payment_history = ivars.duplicated_payment_history || [];\n\n    for (let key in duplicates) {\n        const sorted_entries = duplicates[key].sort((a, b) => { return moment(a.timestamp).format('x') - moment(b.timestamp).format('x') });\n        for (var entry = 0; entry < sorted_entries.length; entry++) {\n            //Skip if not checking account\n            if (sorted_entries[entry].account_type_id != 100) continue;\n            //Check for history\n            if (ivars.duplicated_payment_history.includes(sorted_entries[entry].transaction_id)) continue;\n            //If there is no next element\n            if (!sorted_entries[entry + 1]) continue;\n            //Check if entries are on the same day\n            if (moment(sorted_entries[entry].timestamp).add(1, 'day').isAfter(moment(sorted_entries[entry + 1].timestamp))) return 1;\n        }\n    }\n\n    return 0;\n","type":"custom","description":"Check if there are duplicate transactions on the same day, only for checking account"}],"updated_at":"2021-12-23T17:47:20.563312","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_828"}],"shadow":false,"requires_etls":["duplicate_transactions.last_7d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37202},{"promotion_id":"10385","name":"inf_alert_unusual_expense_agua","convo_template":"tpt_itau_unusual_expense_agua","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_agua.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_agua.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_agua.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_agua.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_agua.current_transaction.month)</var>, ou seja, houve um <b>aumento </b>de <b><var>=percent((ivars.unusual_expense_agua.current_transaction.amount / ivars.unusual_expense_agua.previous_transaction.amount)-1)</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.","notification":"Notei uma mudança incomum na sua conta de água 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já sabe o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_agua.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_agua.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_agua.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_agua.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_agua.current_transaction.month)</var>, ou seja, houve um <b>aumento </b>de <b><var>=percent((ivars.unusual_expense_agua.current_transaction.amount / ivars.unusual_expense_agua.previous_transaction.amount)-1)</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_agua.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já sabe o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_agua.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_agua.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo! 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_agua.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo! 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-17T11:48:26.563Z","end_date":"2053-01-18T17:14:08.309Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:14:08.369Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":21,"profile_group_id":14,"previous_version":20,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos ver","feed_body":"Identifiquei que a sua conta de água aumentou. Quer ver alguns dados para entender o que houve? ","categories":"10600","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"727,795","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"unusual_expenses_agua_historic","type":"ivars","value":[]},{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10600sabesp | a":[{"month":5,"amount":75,"timestamp":1604188800000,"variation":0,"description":"sabesp a","formatted_date":"01/10/22","transaction_id":"e6af223b-8c9d-4f37-805a-6316c861bb5f"},{"month":6,"amount":50,"timestamp":1606780800000,"variation":0,"description":"sabesp a","formatted_date":"01/11/22","transaction_id":"dd39ce49-6239-4815-a3ce-fc0f5030aa7e"},{"month":7,"amount":50,"timestamp":1609459200000,"variation":0,"description":"sabesp a","formatted_date":"01/09/22","transaction_id":"ccc9f751-cece-49bf-92eb-e3953ce80290"},{"month":8,"amount":40,"timestamp":1662400433000,"variation":0,"description":"sabesp a","formatted_date":"05/09/22","transaction_id":"ebd3c7aa-52f1-4a52-8b12-c3153f89f45b"},{"month":9,"amount":50,"timestamp":1664992433000,"variation":0,"description":"sabesp a","formatted_date":"05/10/22","transaction_id":"26581d65-d3b5-46e9-930c-1b8e7c658b04"},{"month":10,"amount":76,"timestamp":1667670833000,"variation":0.4,"description":"sabesp a","formatted_date":"05/11/22","transaction_id":"fb261752-967a-4386-969d-d4a963b0ec25"}]}}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":727,"name":"User belongs to AB test group 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_727"},{"applicability_rule_id":795,"name":"Has Unusual Water Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'sabesp '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const before_last_transaction = transactions[transactions.length - 2];\n      if (moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_agua_historic && ivars.unusual_expenses_agua_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n\n      if (!(before_last_transaction.amount >= 30 && before_last_transaction.amount <= 60 && rounded_variation >= 0.3)\n        && !(before_last_transaction.amount > 60 && before_last_transaction.amount <= 100 && rounded_variation >= 0.25)\n        && !(before_last_transaction.amount > 100 && before_last_transaction.amount <= 150 && rounded_variation >= 0.2)\n        && !(before_last_transaction.amount > 150 && rounded_variation >= 0.2)) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Sabesp on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_795"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37182},{"promotion_id":"10383","name":"inf_alert_duplicated_payment_cartao","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"const duplicates = rvars.agg.duplicate_transactions.last_7d;\\nconst moment = require('moment');\\n\\n//Initialize history if not exists\\nivars.duplicated_payment_history = ivars.duplicated_payment_history || [];\\nivars.temp_duplicated_payment_1 = false;\\nivars.temp_duplicated_payment_2 = false;\\n\\n\\nfor (let key in duplicates) {\\n    const sorted_entries = duplicates[key].sort((a, b) => { return moment(a.timestamp).format('x') - moment(b.timestamp).format('x') });\\n    for (var entry = 0; entry < sorted_entries.length; entry++) {\\n        if(ivars.temp_duplicated_payment_1 || ivars.temp_duplicated_payment_2) continue;\\n        //Skip if not credit card\\n        if (sorted_entries[entry].account_type_id != 200) continue;\\n\\n        //Check for history\\n        if (ivars.duplicated_payment_history.includes(sorted_entries[entry].transaction_id)) continue;\\n        //If there is no next element\\n        if (!sorted_entries[entry + 1]) continue;\\n        //Check if entries are 5 minutes apart\\n        if (moment(sorted_entries[entry].timestamp).add(1, 'day').isAfter(moment(sorted_entries[entry + 1].timestamp))) {\\n            //Add to history\\n            ivars.duplicated_payment_history.push(sorted_entries[entry].transaction_id);\\n            ivars.duplicated_payment_history.push(sorted_entries[entry + 1].transaction_id);\\n            //Return duplicated payments\\n            ivars.temp_duplicated_payment_1 = sorted_entries[entry];\\n            ivars.temp_duplicated_payment_2 = sorted_entries[entry + 1];\\n        };\\n    }\\n}\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"E ela caiu no seu <b>cartão de crédito</b> no dia <b><var>=ivars.temp_duplicated_payment_1.formatted_date</var></b>\"}}","code_body":"const duplicates = rvars.agg.duplicate_transactions.last_7d;\nconst moment = require('moment');\n\n//Initialize history if not exists\nivars.duplicated_payment_history = ivars.duplicated_payment_history || <var></var>;\nivars.temp_duplicated_payment_1 = false;\nivars.temp_duplicated_payment_2 = false;\n\n\nfor (let key in duplicates) <var>enc$\n    const sorted_entries = duplicates[key].sort((a, b) => { return moment(a.timestamp).format('x') - moment(b.timestamp).format('x') });\n    for (var entry = 0; entry < sorted_entries.length; entry++) {\n        if(ivars.temp_duplicated_payment_1 || ivars.temp_duplicated_payment_2) continue;\n        //Skip if not credit card\n        if (sorted_entries[entry].account_type_id != 200) continue;\n\n        //Check for history\n        if (ivars.duplicated_payment_history.includes(sorted_entries[entry].transaction_id)) continue;\n        //If there is no next element\n        if (!sorted_entries[entry + 1]) continue;\n        //Check if entries are 5 minutes apart\n        if (moment(sorted_entries[entry].timestamp).add(1, 'day').isAfter(moment(sorted_entries[entry + 1].timestamp))) {\n            //Add to history\n            ivars.duplicated_payment_history.push(sorted_entries[entry].transaction_id);\n            ivars.duplicated_payment_history.push(sorted_entries[entry + 1].transaction_id);\n            //Return duplicated payments\n            ivars.temp_duplicated_payment_1 = sorted_entries[entry];\n            ivars.temp_duplicated_payment_2 = sorted_entries[entry + 1];\n        };\n    }\n</var>","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A transação que quero te mostrar é esta:<br /><var>=ivars.temp_duplicated_payment_1.description</var> - <var>=currency(ivars.temp_duplicated_payment_1.amount)</var>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"E ela caiu no seu <b>cartão de crédito</b> no dia <b><var>=ivars.temp_duplicated_payment_1.formatted_date</var></b>","notification":"Tava olhando sua fatura e vi uma transação duplicada. Será que é isso mesmo? 👀 ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você sabe o que aconteceu?\"}}","main_text_body":"A transação que quero te mostrar é esta:<br /><var>=ivars.temp_duplicated_payment_1.description</var> - <var>=currency(ivars.temp_duplicated_payment_1.amount)</var>","notification_2":"Notei duas transações com o mesmo valor na sua fatura. Vem comigo pra gente conferir 🤓 ","notification_3":"Parece que tem uma transação duplicada na sua fatura. Vamos ver? 🧐 ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Você sabe o que aconteceu?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Claro, está bem<br /><br />Só não deixa de conferir se tá tudo certo assim que puder, beleza? 😌\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não! O que faço?\",\"response\":\"O melhor é sinalizar a suspeita de fraude logo, dá para fazer isso aqui pelo app:<br /><br /><b>Serviços > Cartões > Contestar compras</b><br /><br />Espero ter ajudado e continuo alerta por aqui, acompanhando as suas finanças! 🔎\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Tranquilo, sei o que é\",\"response\":\"Ah, que boa notícia!<br /><br />Vou continuar de olho em tudo pra cuidar das suas movimentações por aqui, tá? 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Não! O que faço?","user_option_dismissed_body":"Tranquilo, sei o que é","user_option_delayed_response":"Claro, está bem<br /><br />Só não deixa de conferir se tá tudo certo assim que puder, beleza? 😌","user_option_engaged_response":"O melhor é sinalizar a suspeita de fraude logo, dá para fazer isso aqui pelo app:<br /><br /><b>Serviços > Cartões > Contestar compras</b><br /><br />Espero ter ajudado e continuo alerta por aqui, acompanhando as suas finanças! 🔎","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Ah, que boa notícia!<br /><br />Vou continuar de olho em tudo pra cuidar das suas movimentações por aqui, tá? 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-07-19T13:05:54.835Z","end_date":"2053-01-18T16:56:55.938Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T16:56:55.995Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":5,"profile_group_id":14,"previous_version":4,"convo_header":{"type":"alert","barrier":"Mostrar ao usuário que uma transação duplicada foi identificada em seu cartão de crédito","behavior":"Fazer com que o usuário entre em contato com o Itaú e bloqueie o cartão, caso seja uma compra fraudulenta","benefits":"Caso tenha sido uma fraude, o usuário consiga bloquear o seu cartão e evitar mais compras fraudulentas","cooldown":"720","feed_cta":"vamos!","feed_body":"Vi uma transação duplicada aqui e queria te mostrar pra ter certeza de que está tudo certo. Vamos lá? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"de olho nas contas","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"720","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"720","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"867","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"agg.duplicate_transactions.last_7d","type":"rvars","value":{"110600_google good smile co_-22.9":[{"amount":43.19,"metadata":{"time":"2021-12-12T20:02:00Z"},"timestamp":1624305720000,"description":"CC-Google Good Smile Co","formatted_date":"12/12/21","transaction_id":"60cf002b26316a0025b05f41","account_type_id":200},{"amount":43.19,"metadata":{"time":"2021-12-12T20:04:00Z"},"timestamp":1624305840000,"description":"CC-Google Good Smile Co","formatted_date":"12/12/21","transaction_id":"60d4484abca674001d930b49","account_type_id":200}]},"data_type":"json"},{"name":"duplicated_payment_history","type":"ivars","value":[],"data_type":"string"}],"etl_aggregations":[{"etl_aggregation_id":"851","etl_aggregation_name":"Duplicate Transactions in the last week","rvar_object":"duplicate_transactions","rvar_variable":"last_7d","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const start_one_week_ago = moment.utc().subtract(1, 'week').valueOf();\n    const end_current_week = moment.utc().endOf('week').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_one_week_ago\n            && m <= end_current_week\n            && transaction.cashflow === true\n            && transaction.cashflow_type === 'out'\n            && !([260000].includes(transaction.olivia_category_level1_id))\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}_${transaction.relevant_description}_${transaction.amount}_${transaction.account_type_id}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description,\n                account_type_id: transaction.account_type_id,\n                metadata: transaction.metadata\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    const duplicateEntries = _.pickBy(billsRelDesc, function (value, key) {\n        if (value.length < 2) return false;\n        return true;\n    });\n\n    return duplicateEntries;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Find duplicate transactions from the last week","invert_value":true},"updated_at":"2021-12-23T17:47:20.591Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":867,"name":"Has Duplicate Transactions on the Same Day - Credit Card","rule":[{"code":"    if (!rvars\n        || !rvars.agg\n        || !rvars.agg.duplicate_transactions\n        || !rvars.agg.duplicate_transactions.last_7d) return 0;\n\n    const duplicates = rvars.agg.duplicate_transactions.last_7d;\n    const moment = require('moment');\n\n    //Initialize history if not exists\n    ivars.duplicated_payment_history = ivars.duplicated_payment_history || [];\n\n    for (let key in duplicates) {\n        const sorted_entries = duplicates[key].sort((a, b) => { return moment(a.timestamp).format('x') - moment(b.timestamp).format('x') });\n        for (var entry = 0; entry < sorted_entries.length; entry++) {\n            //Skip if not credit card\n            if (sorted_entries[entry].account_type_id != 200) continue;\n            //Check for history\n            if (ivars.duplicated_payment_history.includes(sorted_entries[entry].transaction_id)) continue;\n            //If there is no next element\n            if (!sorted_entries[entry + 1]) continue;\n            //Check if entries are on the same day\n            if (moment(sorted_entries[entry].timestamp).add(1, 'day').isAfter(moment(sorted_entries[entry + 1].timestamp))) return 1;\n        }\n    }\n\n    return 0;\n","type":"custom","description":"Check if there are duplicate transactions on the same day, only for credit card"}],"updated_at":"2021-11-25T21:34:47.485603","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_867"}],"shadow":false,"requires_etls":["duplicate_transactions.last_7d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37214},{"promotion_id":"10386","name":"inf_alert_unusual_expense_agua_b","convo_template":"tpt_itau_unusual_expense_agua","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_agua.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_agua.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_agua.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_agua.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_agua.current_transaction.month)</var>, ou seja, houve um <b>aumento</b> de <b><var>=percent((ivars.unusual_expense_agua.current_transaction.amount / ivars.unusual_expense_agua.previous_transaction.amount) -1 )</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.","notification":"Notei uma mudança incomum na sua conta de água 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já sabe o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_agua.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_agua.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_agua.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_agua.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_agua.current_transaction.month)</var>, ou seja, houve um <b>aumento</b> de <b><var>=percent((ivars.unusual_expense_agua.current_transaction.amount / ivars.unusual_expense_agua.previous_transaction.amount) -1 )</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_agua.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já sabe o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala. 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_agua.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_agua.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo!😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala. 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_agua.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo!😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-17T11:48:26.563Z","end_date":"2053-01-18T17:14:57.622Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:14:57.672Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":13,"profile_group_id":14,"previous_version":12,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos checar","feed_body":"Identifiquei um aumento de [=percent((ivars.unusual_expense_agua.current_transaction.amount / ivars.unusual_expense_agua.previous_transaction.amount) -1 )] na sua conta de água. Quer checar no detalhe o que houve?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"728,795","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"unusual_expenses_agua_historic","type":"ivars","value":[]},{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10600sabesp | a":[{"month":7,"amount":100,"timestamp":1657612822000,"variation":0,"description":"sabesp a","formatted_date":"12/07/22","transaction_id":"teste_external_account_4"},{"month":8,"amount":50,"timestamp":1660291222000,"variation":0,"description":"sabesp a","formatted_date":"12/08/22","transaction_id":"teste_external_account_5"},{"month":9,"amount":200,"timestamp":1662969622000,"variation":0.4,"description":"sabesp a","formatted_date":"12/09/22","transaction_id":"teste_external_account_6"}]}}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":728,"name":"User belongs to AB test group 2","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_728"},{"applicability_rule_id":795,"name":"Has Unusual Water Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'sabesp '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const before_last_transaction = transactions[transactions.length - 2];\n      if (moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_agua_historic && ivars.unusual_expenses_agua_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n\n      if (!(before_last_transaction.amount >= 30 && before_last_transaction.amount <= 60 && rounded_variation >= 0.3)\n        && !(before_last_transaction.amount > 60 && before_last_transaction.amount <= 100 && rounded_variation >= 0.25)\n        && !(before_last_transaction.amount > 100 && before_last_transaction.amount <= 150 && rounded_variation >= 0.2)\n        && !(before_last_transaction.amount > 150 && rounded_variation >= 0.2)) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Sabesp on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_795"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37207},{"promotion_id":"10388","name":"inf_alert_unusual_expense_celular_b","convo_template":"tpt_itau_unusual_expense_celular","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_celular.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_celular.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_celular.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_celular.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_celular.current_transaction.month)</var>, ou seja, houve um <b>aumento</b> de <b><var>=percent((ivars.unusual_expense_celular.current_transaction.amount / ivars.unusual_expense_celular.previous_transaction.amount)-1)</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema.","notification":"Notei uma mudança incomum na sua conta de celular 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já sabe o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_celular.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_celular.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_celular.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_celular.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_celular.current_transaction.month)</var>, ou seja, houve um <b>aumento</b> de <b><var>=percent((ivars.unusual_expense_celular.current_transaction.amount / ivars.unusual_expense_celular.previous_transaction.amount)-1)</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_celular.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já sabe o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_celular.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_celular.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo! 😀\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_celular.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo! 😀","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-18T17:03:27.164Z","end_date":"2053-01-18T17:17:27.873Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:17:27.985Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":15,"profile_group_id":14,"previous_version":14,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos checar","feed_body":"Identifiquei um aumento de [=percent((ivars.unusual_expense_celular.current_transaction.amount / ivars.unusual_expense_celular.previous_transaction.amount)-1)] na sua conta de celular. Quer checar no detalhe o que houve?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"728,794","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"unusual_expenses_celular_historic","type":"ivars","value":[]},{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10300vivo | a":[{"month":7,"amount":110,"timestamp":1659016420000,"variation":0,"description":"vivo a","formatted_date":"28/07/22","transaction_id":"teste_external_account_1"},{"month":8,"amount":110,"timestamp":1661694820000,"variation":0,"description":"vivo a","formatted_date":"28/08/22","transaction_id":"teste_external_account_2"},{"month":9,"amount":160,"timestamp":1662126820000,"variation":0,"description":"vivo a","formatted_date":"02/09/22","transaction_id":"teste_external_account_3"}]}}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":728,"name":"User belongs to AB test group 2","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_728"},{"applicability_rule_id":794,"name":"Has Unusual Phone Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'vivo ',\n    'claro ',\n    'tim ',\n    'oi ',\n    'nextel '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(\"10300\") && vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n      if (rounded_variation < 0.1\n        || moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_celular_historic && ivars.unusual_expenses_celular_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Vivo, Claro, Tim and Oi on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_794"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37236},{"promotion_id":"10389","name":"inf_alert_unusual_expense_gas","convo_template":"tpt_itau_unusual_expense_gas","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_gas.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_gas.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_gas.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_gas.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_gas.current_transaction.month)</var>, ou seja, houve um um <b>aumento </b>de <b><var>=percent((ivars.unusual_expense_gas.current_transaction.amount / ivars.unusual_expense_gas.previous_transaction.amount) -1 )</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.","notification":"Notei uma mudança incomum na sua conta de gás 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já sabe o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_gas.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_gas.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_gas.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_gas.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_gas.current_transaction.month)</var>, ou seja, houve um um <b>aumento </b>de <b><var>=percent((ivars.unusual_expense_gas.current_transaction.amount / ivars.unusual_expense_gas.previous_transaction.amount) -1 )</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_gas.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já sabe o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_gas.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_gas.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo! 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_gas.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo! 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-17T19:18:18.139Z","end_date":"2053-01-18T17:17:58.153Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:17:58.246Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":17,"profile_group_id":14,"previous_version":16,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos ver","feed_body":"Identifiquei que a sua conta de gás aumentou. Quer checar alguns dados para entender o que houve? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"796,727","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10200comgas | a":[{"month":10,"amount":40,"timestamp":1604188800000,"variation":0,"description":"comgas a","formatted_date":"01/11/20","transaction_id":"e6af223b-8c9d-4f37-805a-6316c861bb5f"},{"month":11,"amount":40,"timestamp":1606780800000,"variation":0,"description":"comgas a","formatted_date":"01/12/20","transaction_id":"dd39ce49-6239-4815-a3ce-fc0f5030aa7e"},{"month":0,"amount":40,"timestamp":1609459200000,"variation":0,"description":"comgas a","formatted_date":"01/01/21","transaction_id":"ccc9f751-cece-49bf-92eb-e3953ce80290"},{"month":1,"amount":40,"timestamp":1612137600000,"variation":0,"description":"comgas a","formatted_date":"01/02/21","transaction_id":"ebd3c7aa-52f1-4a52-8b12-c3153f89f45b"},{"month":2,"amount":40,"timestamp":1614556800000,"variation":0,"description":"comgas a","formatted_date":"01/03/21","transaction_id":"26581d65-d3b5-46e9-930c-1b8e7c658b04"},{"month":3,"amount":60,"timestamp":1617235200000,"variation":0.4,"description":"comgas a","formatted_date":"01/04/21","transaction_id":"fb261752-967a-4386-969d-d4a963b0ec25"}]}},{"name":"unusual_expenses_gas_historic","type":"ivars","value":[]}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":796,"name":"Has Unusual Gas Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'comgas '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const before_last_transaction = transactions[transactions.length - 2];\n      if (moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_gas_historic && ivars.unusual_expenses_gas_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n\n      if (!(before_last_transaction.amount >= 10 && before_last_transaction.amount <= 20 && rounded_variation >= 0.5)\n        && !(before_last_transaction.amount > 20 && before_last_transaction.amount <= 40 && rounded_variation >= 0.4)\n        && !(before_last_transaction.amount > 40 && before_last_transaction.amount <= 80 && rounded_variation >= 0.3)\n        && !(before_last_transaction.amount > 80 && rounded_variation >= 0.2)) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Comgas on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_796"},{"applicability_rule_id":727,"name":"User belongs to AB test group 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_727"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37222},{"promotion_id":"10390","name":"inf_alert_unusual_expense_gas_b","convo_template":"tpt_itau_unusual_expense_gas","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_gas.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_gas.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_gas.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_gas.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_gas.current_transaction.month)</var>, ou seja, houve um aumento de <b><var>=percent((ivars.unusual_expense_gas.current_transaction.amount / ivars.unusual_expense_gas.previous_transaction.amount )-1)</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.","notification":"Notei uma mudança incomum na sua conta de gás 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já sabe o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_gas.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_gas.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_gas.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_gas.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_gas.current_transaction.month)</var>, ou seja, houve um aumento de <b><var>=percent((ivars.unusual_expense_gas.current_transaction.amount / ivars.unusual_expense_gas.previous_transaction.amount )-1)</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_gas.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já sabe o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_gas.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_gas.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo! 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_gas.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo! 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-17T19:18:18.139Z","end_date":"2053-01-18T17:18:32.107Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:18:32.180Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos checar","feed_body":"Identifiquei um aumento de [=percent((ivars.unusual_expense_gas.current_transaction.amount / ivars.unusual_expense_gas.previous_transaction.amount )-1)] na sua conta de gás. Quer checar no detalhe o que houve?","categories":"","feed_emoji":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"728,796","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10200comgas | a":[{"month":10,"amount":40,"timestamp":1604188800000,"variation":0,"description":"comgas a","formatted_date":"01/11/20","transaction_id":"e6af223b-8c9d-4f37-805a-6316c861bb5f"},{"month":11,"amount":40,"timestamp":1606780800000,"variation":0,"description":"comgas a","formatted_date":"01/12/20","transaction_id":"dd39ce49-6239-4815-a3ce-fc0f5030aa7e"},{"month":0,"amount":40,"timestamp":1609459200000,"variation":0,"description":"comgas a","formatted_date":"01/01/21","transaction_id":"ccc9f751-cece-49bf-92eb-e3953ce80290"},{"month":1,"amount":35,"timestamp":1612137600000,"variation":0,"description":"comgas a","formatted_date":"01/02/21","transaction_id":"ebd3c7aa-52f1-4a52-8b12-c3153f89f45b"},{"month":2,"amount":40,"timestamp":1614556800000,"variation":0,"description":"comgas a","formatted_date":"01/03/21","transaction_id":"26581d65-d3b5-46e9-930c-1b8e7c658b04"},{"month":3,"amount":80,"timestamp":1617235200000,"variation":0.4,"description":"comgas a","formatted_date":"01/04/21","transaction_id":"fb261752-967a-4386-969d-d4a963b0ec25"}]}},{"name":"unusual_expenses_gas_historic","type":"ivars","value":[]}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":728,"name":"User belongs to AB test group 2","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_728"},{"applicability_rule_id":796,"name":"Has Unusual Gas Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'comgas '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const before_last_transaction = transactions[transactions.length - 2];\n      if (moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_gas_historic && ivars.unusual_expenses_gas_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n\n      if (!(before_last_transaction.amount >= 10 && before_last_transaction.amount <= 20 && rounded_variation >= 0.5)\n        && !(before_last_transaction.amount > 20 && before_last_transaction.amount <= 40 && rounded_variation >= 0.4)\n        && !(before_last_transaction.amount > 40 && before_last_transaction.amount <= 80 && rounded_variation >= 0.3)\n        && !(before_last_transaction.amount > 80 && rounded_variation >= 0.2)) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Comgas on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_796"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37208},{"promotion_id":"10392","name":"inf_alert_unusual_expense_internet","convo_template":"tpt_itau_unusual_expense_internet","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_internet.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_internet.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_internet.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_internet.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_internet.current_transaction.month)</var>, ou seja, houve um <b>aumento </b>de <b><var>=percent((ivars.unusual_expense_internet.current_transaction.amount / ivars.unusual_expense_internet.previous_transaction.amount)-1)</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.","notification":"Notei uma mudança incomum na sua conta de internet 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já soube o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_internet.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_internet.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_internet.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_internet.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_internet.current_transaction.month)</var>, ou seja, houve um <b>aumento </b>de <b><var>=percent((ivars.unusual_expense_internet.current_transaction.amount / ivars.unusual_expense_internet.previous_transaction.amount)-1)</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_internet.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já soube o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_internet.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_internet.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo! 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_internet.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo! 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-18T14:57:42.216Z","end_date":"2053-01-18T17:32:41.152Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:32:41.214Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":17,"profile_group_id":14,"previous_version":16,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos ver","feed_body":"Identifiquei que a sua conta de internet aumentou. Quer ver alguns dados para entender o que houve? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"798,727","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"unusual_expenses_internet_historic","type":"ivars","value":[]},{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10500claro | a":[{"month":10,"amount":40,"timestamp":1604188800000,"variation":0,"description":"claro a","formatted_date":"01/11/20","transaction_id":"e6af223b-8c9d-4f37-805a-6316c861bb5f"},{"month":11,"amount":40,"timestamp":1606780800000,"variation":0,"description":"claro a","formatted_date":"01/12/20","transaction_id":"dd39ce49-6239-4815-a3ce-fc0f5030aa7e"},{"month":0,"amount":40,"timestamp":1609459200000,"variation":0,"description":"claro a","formatted_date":"01/01/21","transaction_id":"ccc9f751-cece-49bf-92eb-e3953ce80290"},{"month":1,"amount":40,"timestamp":1612137600000,"variation":0,"description":"claro a","formatted_date":"01/02/21","transaction_id":"ebd3c7aa-52f1-4a52-8b12-c3153f89f45b"},{"month":2,"amount":40,"timestamp":1614556800000,"variation":0,"description":"claro a","formatted_date":"01/03/21","transaction_id":"26581d65-d3b5-46e9-930c-1b8e7c658b04"},{"month":3,"amount":56,"timestamp":1617235200000,"variation":0.4,"description":"claro a","formatted_date":"01/04/21","transaction_id":"fb261752-967a-4386-969d-d4a963b0ec25"}]}}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":798,"name":"Has Unusual Internet Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'vivo ',\n    'claro ',\n    'tim ',\n    'oi ',\n    'sky ',\n    'super cabo ',\n    'vla ',\n    'sebratel '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(\"10500\") && vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n      if (rounded_variation < 0.1\n        || moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_internet_historic && ivars.unusual_expenses_internet_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Internet vendors on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_798"},{"applicability_rule_id":727,"name":"User belongs to AB test group 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_727"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37181},{"promotion_id":"10393","name":"inf_alert_unusual_expense_internet_b","convo_template":"tpt_itau_unusual_expense_internet","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_internet.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_internet.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_internet.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_internet.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_internet.current_transaction.month)</var>, ou seja, houve um aumento de <b><var>=percent((ivars.unusual_expense_internet.current_transaction.amount / ivars.unusual_expense_internet.previous_transaction.amount)-1)</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.","notification":"Notei uma mudança incomum na sua conta de internet 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já sabe o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_internet.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_internet.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_internet.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_internet.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_internet.current_transaction.month)</var>, ou seja, houve um aumento de <b><var>=percent((ivars.unusual_expense_internet.current_transaction.amount / ivars.unusual_expense_internet.previous_transaction.amount)-1)</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_internet.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já sabe o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_internet.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_internet.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo! 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_internet.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo! 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-18T14:57:42.216Z","end_date":"2053-01-18T17:33:30.709Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:33:30.768Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":14,"profile_group_id":14,"previous_version":13,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos checar","feed_body":"Identifiquei um aumento de [=percent((ivars.unusual_expense_internet.current_transaction.amount / ivars.unusual_expense_internet.previous_transaction.amount)-1)] na sua conta de internet. Quer checar no detalhe o que houve?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"728,798","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"unusual_expenses_internet_historic","type":"ivars","value":[]},{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10500claro | a":[{"month":7,"amount":40,"timestamp":1659037535000,"variation":10,"description":"claro a","formatted_date":"28/07/22","transaction_id":"teste_external_account_7"},{"month":8,"amount":40,"timestamp":1661715935000,"variation":510,"description":"claro a","formatted_date":"28/08/22","transaction_id":"teste_external_account_8"},{"month":9,"amount":90,"timestamp":1662147935000,"variation":0,"description":"claro a","formatted_date":"02/09/22","transaction_id":"teste_external_account_9"}]}}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":728,"name":"User belongs to AB test group 2","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_728"},{"applicability_rule_id":798,"name":"Has Unusual Internet Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'vivo ',\n    'claro ',\n    'tim ',\n    'oi ',\n    'sky ',\n    'super cabo ',\n    'vla ',\n    'sebratel '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(\"10500\") && vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n      if (rounded_variation < 0.1\n        || moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_internet_historic && ivars.unusual_expenses_internet_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Internet vendors on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_798"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37235},{"promotion_id":"10394","name":"inf_alert_unusual_expense_luz","convo_template":"tpt_itau_unusual_expense_luz","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_luz.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_luz.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_luz.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_luz.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_luz.current_transaction.month)</var>, ou seja, houve um <b>aumento</b> de <b><var>=percent((ivars.unusual_expense_luz.current_transaction.amount / ivars.unusual_expense_luz.previous_transaction.amount)-1)</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.","notification":"Notei uma mudança incomum na sua conta de luz 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já sabe o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_luz.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_luz.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_luz.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_luz.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_luz.current_transaction.month)</var>, ou seja, houve um <b>aumento</b> de <b><var>=percent((ivars.unusual_expense_luz.current_transaction.amount / ivars.unusual_expense_luz.previous_transaction.amount)-1)</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_luz.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já sabe o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_luz.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_luz.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo! 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_luz.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo! 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-17T20:05:58.563Z","end_date":"2053-01-18T17:34:01.704Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:34:01.775Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":16,"profile_group_id":14,"previous_version":15,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos ver","feed_body":"Identifiquei que a sua conta de luz aumentou. Quer ver alguns dados para entender o que houve? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"797,727","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"unusual_expenses_luz_historic","type":"ivars","value":[],"data_type":"string"},{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10100enel | a":[{"month":10,"amount":320,"timestamp":1604188800000,"variation":0,"description":"enel a","formatted_date":"01/11/20","transaction_id":"e6af223b-8c9d-4f37-805a-6316c861bb5f"},{"month":11,"amount":50,"timestamp":1606780800000,"variation":0,"description":"enel a","formatted_date":"01/12/20","transaction_id":"dd39ce49-6239-4815-a3ce-fc0f5030aa7e"},{"month":0,"amount":60,"timestamp":1609459200000,"variation":0,"description":"enel a","formatted_date":"01/01/21","transaction_id":"ccc9f751-cece-49bf-92eb-e3953ce80290"},{"month":1,"amount":56,"timestamp":1612137600000,"variation":0,"description":"enel a","formatted_date":"01/02/21","transaction_id":"ebd3c7aa-52f1-4a52-8b12-c3153f89f45b"},{"month":2,"amount":56,"timestamp":1614556800000,"variation":0,"description":"enel a","formatted_date":"01/03/21","transaction_id":"26581d65-d3b5-46e9-930c-1b8e7c658b04"},{"month":3,"amount":135,"timestamp":1617235200000,"variation":0.4,"description":"enel a","formatted_date":"01/04/21","transaction_id":"fb261752-967a-4386-969d-d4a963b0ec25"}]},"data_type":"json"}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":797,"name":"Has Unusual Electricity Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'enel '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const before_last_transaction = transactions[transactions.length - 2];\n      if (moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_luz_historic && ivars.unusual_expenses_luz_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n\n      if (!(before_last_transaction.amount >= 30 && before_last_transaction.amount <= 60 && rounded_variation >= 0.3)\n        && !(before_last_transaction.amount > 60 && before_last_transaction.amount <= 100 && rounded_variation >= 0.25)\n        && !(before_last_transaction.amount > 100 && before_last_transaction.amount <= 150 && rounded_variation >= 0.2)\n        && !(before_last_transaction.amount > 150 && rounded_variation >= 0.2)) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Enel on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_797"},{"applicability_rule_id":727,"name":"User belongs to AB test group 1","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_727"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37238},{"promotion_id":"10395","name":"inf_alert_unusual_expense_luz_b","convo_template":"tpt_itau_unusual_expense_luz","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A despesa <b><var>=ivars.unusual_expense_luz.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_luz.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_luz.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_luz.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_luz.current_transaction.month)</var>, ou seja, houve um <b>aumento</b> de <b><var>=percent((ivars.unusual_expense_luz.current_transaction.amount / ivars.unusual_expense_luz.previous_transaction.amount)-1)</var></b> 📈\"}}","content_body":"É bom verificar agora para economizar na próxima ou, se for o caso, resolver algum problema técnico.","notification":"Notei uma mudança incomum na sua conta de luz 🤔 Vamos dar uma conferida nisso? ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Você já sabe o que houve?\"}}","main_text_body":"A despesa <b><var>=ivars.unusual_expense_luz.current_vendor</var></b> passou de <b><var>=currency(ivars.unusual_expense_luz.previous_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_luz.previous_transaction.month)</var> para <b><var>=currency(ivars.unusual_expense_luz.current_transaction.amount)</var></b> em <var>=month_name(ivars.unusual_expense_luz.current_transaction.month)</var>, ou seja, houve um <b>aumento</b> de <b><var>=percent((ivars.unusual_expense_luz.current_transaction.amount / ivars.unusual_expense_luz.previous_transaction.amount)-1)</var></b> 📈","user_engaged_link":"<var>=ivars.unusual_expense_luz.current_link</var>","external_link_body":"","external_link_link":"","call_to_action_body":"Você já sabe o que houve?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Resolvo depois\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não sei\",\"response\":\"Você pode tirar essa dúvida observando os detalhes da sua conta.\",\"link_text\":\"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_luz.current_vendor</var> checar o que ocorreu\",\"link\":\"<var>=ivars.unusual_expense_luz.current_link</var>\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já sei\",\"response\":\"Que ótimo! 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Resolvo depois","user_option_engaged_body":"Não sei","user_option_dismissed_body":"Já sei","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Você pode tirar essa dúvida observando os detalhes da sua conta.","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui para ir ao site da <var>=ivars.unusual_expense_luz.current_vendor</var> checar o que ocorreu","user_option_dismissed_response":"Que ótimo! 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-17T20:05:58.563Z","end_date":"2053-01-18T17:34:37.483Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-18T17:34:37.557Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"alert","barrier":"Fazemos as contas para o usuário, mostrando um aumento não comum, e damos o caminho para que ele possa solucionar a questão.","behavior":"Usuário deve verificar os valores de suas contas.","benefits":"Detectar um problema e poder solucionar.","cooldown":"0","feed_cta":"vamos checar","feed_body":"Identifiquei um aumento de [=percent((ivars.unusual_expense_luz.current_transaction.amount / ivars.unusual_expense_luz.previous_transaction.amount)-1)] na sua conta de luz. Quer checar no detalhe o que houve?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"728,797","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["unusual expense"]},"visible":true,"deleted":false,"default_values":[{"name":"unusual_expenses_luz_historic","type":"ivars","value":[]},{"name":"agg.bills_by_category_and_description.last_6m","type":"rvars","value":{"10100enel | a":[{"month":1,"amount":72,"timestamp":1612148400000,"variation":0,"description":"enel a","formatted_date":"01/02/21","transaction_id":"e6af223b-8c9d-4f37-805a-6316c861bb5f"},{"month":2,"amount":70,"timestamp":1614567600000,"variation":0,"description":"enel a","formatted_date":"01/03/21","transaction_id":"dd39ce49-6239-4815-a3ce-fc0f5030aa7e"},{"month":3,"amount":75,"timestamp":1617246000000,"variation":0,"description":"enel a","formatted_date":"01/04/21","transaction_id":"ccc9f751-cece-49bf-92eb-e3953ce80290"},{"month":4,"amount":70,"timestamp":1619838000000,"variation":0,"description":"enel a","formatted_date":"01/05/21","transaction_id":"ebd3c7aa-52f1-4a52-8b12-c3153f89f45b"},{"month":5,"amount":72,"timestamp":1622516400000,"variation":0,"description":"enel a","formatted_date":"01/06/21","transaction_id":"26581d65-d3b5-46e9-930c-1b8e7c658b04"},{"month":6,"amount":160,"timestamp":1625108400000,"variation":0.4,"description":"enel a","formatted_date":"01/07/21","transaction_id":"fb261752-967a-4386-969d-d4a963b0ec25"}]},"data_type":"json"}],"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":728,"name":"User belongs to AB test group 2","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_728"},{"applicability_rule_id":797,"name":"Has Unusual Electricity Expenses","rule":[{"code":"  const moment = require('moment');\n\n  if (!rvars\n    || !rvars.agg\n    || !rvars.agg.bills_by_category_and_description\n    || !rvars.agg.bills_by_category_and_description.last_6m) return 0;\n\n  const vendors = [\n    'enel '\n  ];\n\n  for (const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n    if (vendors.some(v => vendor.includes(v))) {\n      const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n      if (transactions.length < 3) continue;\n\n      // Check if there are 2 transactions or more on the same month\n      let memory_object = {};\n      if (transactions.some((transaction) => {\n        if (!memory_object[transaction.month]) {\n          memory_object[transaction.month] = true;\n          return false;\n        }\n        else {\n          return true;\n        }\n      })) {\n        continue;\n      }\n\n      const last_transaction = transactions[transactions.length - 1];\n      const before_last_transaction = transactions[transactions.length - 2];\n      if (moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n        || (!!ivars.unusual_expenses_luz_historic && ivars.unusual_expenses_luz_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n      const rounded_variation = parseFloat((Math.round(parseFloat(`${last_transaction.variation}e+2`)) + 'e-2'));\n\n      if (!(before_last_transaction.amount >= 30 && before_last_transaction.amount <= 60 && rounded_variation >= 0.3)\n        && !(before_last_transaction.amount > 60 && before_last_transaction.amount <= 100 && rounded_variation >= 0.25)\n        && !(before_last_transaction.amount > 100 && before_last_transaction.amount <= 150 && rounded_variation >= 0.2)\n        && !(before_last_transaction.amount > 150 && rounded_variation >= 0.2)) continue;\n\n      return 1;\n    }\n  }\n\n  return 0;\n","type":"custom","description":"Check for Enel on Same Vendor Comparison"}],"updated_at":"2022-01-25T18:50:40.747103","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_797"}],"shadow":false,"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_group":"convos_itau_app_users","conversation_map_id":37194},{"promotion_id":"10397","name":"inf_beneficio_cartao_mastercard","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Quanto mais pontos acumular, mais possibilidades de troca por ofertas especiais\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"O programa de benefícios da Mastercard dá <b>1 ponto a cada compra</b> feita com seu cartão de crédito, não importa o valor\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Quanto mais pontos acumular, mais possibilidades de troca por ofertas especiais","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer cadastrar o seu cartão?\"}}","main_text_body":"O programa de benefícios da Mastercard dá <b>1 ponto a cada compra</b> feita com seu cartão de crédito, não importa o valor","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"https://surpreenda.naotempreco.com.br/","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer cadastrar o seu cartão?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro fazer isso depois\",\"response\":\"Tudo bem! Depois eu volto e continuamos esta conversa\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Isso aí, nada de perder tempo!<br /><br />Ao se cadastrar no programa, você também pode participar de sorteios exclusivos<br /><br />E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\",\"link_text\":\"Clique aqui para fazer agora o seu cadastro no Mastercard Surpreenda\",\"link\":\"https://surpreenda.naotempreco.com.br/\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse, valeu\",\"response\":\"Sem problemas! Em breve eu volto com novas ideias pra você\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro fazer isso depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não tenho interesse, valeu","user_option_delayed_response":"Tudo bem! Depois eu volto e continuamos esta conversa","user_option_engaged_response":"Isso aí, nada de perder tempo!<br /><br />Ao se cadastrar no programa, você também pode participar de sorteios exclusivos<br /><br />E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","user_option_delayed_link_text":"","user_option_engaged_link_text":"Clique aqui para fazer agora o seu cadastro no Mastercard Surpreenda","user_option_dismissed_response":"Sem problemas! Em breve eu volto com novas ideias pra você","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-31T17:59:10.977Z","end_date":"2053-01-19T14:11:18.329Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:11:18.382Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":7,"profile_group_id":14,"previous_version":6,"convo_header":{"type":"default","barrier":"Mostrar os benefícios e onde o usuário pode se cadastrar.","behavior":"Fazer com que o usuário se cadastre no programa de benefícios da Mastercard.","benefits":"Fazer com que o usuário use os benefícios da Mastercard e economize em suas compras.","cooldown":"8640","feed_cta":"quero saber","feed_body":"Você conhece o programa Mastercard Surpreenda? Vem saber e já cadastrar o seu cartão!","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"benefícios","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"low","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8640","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"2160","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"8640","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"850","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":850,"name":"Itau Beneficio Mastercard","rule":[{"code":"    if (!rvars\n        || !rvars.itau_credit_card_info\n        || !(rvars.itau_credit_card_info.length > 0)) return false;\n\n    const regex = /mastercard/i;\n\n    for (const credit_card of rvars.itau_credit_card_info) {\n        if (regex.test(credit_card.credit_card_brand) && credit_card.credit_card_expenses_01m >= 100) return true;\n    }\n\n    return false;\n","type":"custom","description":""}],"updated_at":"2021-09-30T17:16:58.915968","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_850"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37175},{"promotion_id":"10399","name":"inf_beneficio_tag_itau","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Com a <b>Tag Itaú</b>, além de economizar dinheiro, você também economiza tempo e passa direto por pedágios e usa estacionamentos do Brasil todo sem filas! 😅<br /><br />Você também reserva vaga no estacionamento, parcela débitos do seu veículo e gerencia a tag direto no app ConectCar\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vim falar sobre a parceria com a <b>ConectCar</b>, onde cliente Itaú fica<b> livre de mensalidade da Tag de Pedágio pra sempre </b>(olha a economia!)\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Com a <b>Tag Itaú</b>, além de economizar dinheiro, você também economiza tempo e passa direto por pedágios e usa estacionamentos do Brasil todo sem filas! 😅<br /><br />Você também reserva vaga no estacionamento, parcela débitos do seu veículo e gerencia a tag direto no app ConectCar","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer ver como se cadastrar?\"}}","main_text_body":"Vim falar sobre a parceria com a <b>ConectCar</b>, onde cliente Itaú fica<b> livre de mensalidade da Tag de Pedágio pra sempre </b>(olha a economia!)","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"https://itau.conectcar.com/","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer ver como se cadastrar?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"OK! Depois a gente se fala.😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero\",\"response\":\"Boa! Com o cartão de crédito ou débito Itaú, você pode pedir sua Tag Itaú sem mensalidade e taxa de recarga<br /><br />📌 E só pra esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\",\"link_text\":\"👉 Clique aqui pra pedir já a Tag Itaú\",\"link\":\"https://itau.conectcar.com/\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse\",\"response\":\"Tá bom! Volto depois.😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Sim, quero","user_option_dismissed_body":"Não tenho interesse","user_option_delayed_response":"OK! Depois a gente se fala.😉","user_option_engaged_response":"Boa! Com o cartão de crédito ou débito Itaú, você pode pedir sua Tag Itaú sem mensalidade e taxa de recarga<br /><br />📌 E só pra esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Clique aqui pra pedir já a Tag Itaú","user_option_dismissed_response":"Tá bom! Volto depois.😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-11-23T13:16:26.958Z","end_date":"2053-01-19T14:13:28.148Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:13:28.218Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":10,"profile_group_id":14,"previous_version":9,"convo_header":{"type":"alert","barrier":"Mostrar os benefícios da Tag Itaú: sem mensalidade; não pegar filas em pedágios e estacionamentos","behavior":"Fazer com que o usuário solicite a Tag Itaú através do link","benefits":"Economizar em mensalidade de pedágio e postos de gasolina","cooldown":"0","feed_cta":"quero conhecer!","feed_body":"Estacionar e pagar pedágio pode ser mais prático e barato. Já conhece a Tag Itaú? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","spec_summary":"Mostrar aos usuários o novo benefício do Itaú com a Conect Car.","triggerGroup":"","feed_subtitle":"benefícios","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":"simple","expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","spec_applicability":"A conversa deve ser enfileirada para todo usuário que: não tiver transação com a ConectCar; tenha gastos de cartão; tiver pelo menos R$ 30,00 em gastos com pedágios OU R$ 150,00 de gastos em Combustível nos últimos 60 dias.","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"869,2147483651","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["itau partner"]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"208","etl_aggregation_name":"L2 Category Transportation/Parking 30 Days Sum Amount","rvar_object":"l2cat130800","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":130800,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"328","etl_aggregation_name":"L2 Category Transportation/Gas & Fuel 60 Days Sum Amount","rvar_object":"l2cat130500","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":130500,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"335","etl_aggregation_name":"L2 Category Transportation/Toll 60 Days Sum Amount","rvar_object":"l2cat131200","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":131200,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"854","etl_aggregation_name":"Conectcar Expenses 30 Days Amount","rvar_object":"conectcar","rvar_variable":"amt_30d","rule":{"type":"sum_amount","filter":{"$regex":{"description":"conectcar"},"$last_x_days":30,"olivia_category_id":[130000],"$valid_transactions":true},"invert_value":true},"updated_at":"2022-01-28T13:05:30.177Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":869,"name":"No Conectcar Expenses","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"rvars.agg.conectcar.amt_30d"},"right_value":{"type":"fixed","value":"0","variable_type":"int"}}],"updated_at":"2021-11-29T18:59:07.471834","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_869"},{"applicability_rule_id":2147483651,"name":"Itau Beneficio Tag 08/2022","rule":[{"type":"or","validation_list":[{"type":"compare","operator":">=","left_value":{"type":"variable","variable":"rvars.agg.l2cat131200.amt60d"},"right_value":{"type":"fixed","value":"30","variable_type":"int"}},{"type":"compare","operator":">=","left_value":{"type":"variable","variable":"rvars.agg.l2cat130500.amt60d"},"right_value":{"type":"fixed","value":"150","variable_type":"int"}},{"type":"compare","operator":">=","left_value":{"type":"variable","variable":"rvars.agg.l2cat130800.amt30d"},"right_value":{"type":"fixed","value":"25","variable_type":"int"}}]}],"updated_at":"2022-08-17T14:06:24.004897","updated_by":"frank.carvalho@mailer.com.br","applicability_name":"applicability_rule_id_2147483651"}],"shadow":false,"requires_etls":["l2cat130800.amt30d","l2cat130500.amt60d","l2cat131200.amt60d","conectcar.amt_30d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37166},{"promotion_id":"10400","name":"inf_first_10_days_intra_month","convo_template":"tpt_itau_summary","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"<var>=ivars.partial_periods_totals['10_days']</var>\"}}","content_body":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"<var>=ivars.partial_periods_totals['10_days']</var>","user_engaged_link":"","external_link_body":"","external_link_link":"","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Agora não, valeu\",\"response\":\"Tudo bem, em breve eu volto com novas informações para você 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"<var>=ivars.partial_periods_expenses['10_days']</var><br />Vou continuar de olho nas suas finanças e volto em breve com mais informações! 🤓\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"Agora não, valeu","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"","user_option_delayed_response":"Tudo bem, em breve eu volto com novas informações para você 😉","user_option_engaged_response":"<var>=ivars.partial_periods_expenses['10_days']</var><br />Vou continuar de olho nas suas finanças e volto em breve com mais informações! 🤓","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-29T21:20:43.203Z","end_date":"2053-01-19T14:14:52.855Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:14:52.929Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":10,"profile_group_id":14,"previous_version":9,"convo_header":{"type":"alert","barrier":"Olivia faz as principais contas e análises e entrega tudo pronto pro usuário.","behavior":"Ter disciplina de acompanhar o padrão de despesas / receitas durante o mês.","benefits":"Autoconhecimento e criação do hábito de verificar o status de suas contas. Apoio emocional (saber que estamos aqui para ajudar o usuário a se manter no controle de suas finanças).","cooldown":"720","feed_cta":"quero ver","feed_body":"O resumo dos 10 primeiros dias do seu mês está pronto para você. Vamos ver?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"ciclo mensal","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"8","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"720","notification_type":"insight","cooldownFrustrated":"720","cooldownInteracted":"720","cooldownThumbsDown":"720","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["summary"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.totals.income","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":1242.07,"total":1242.07,"variable":0},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":767.78,"total":767.78,"variable":0},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":1646.24,"total":1646.24,"variable":0},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":3535.56,"total":3535.56,"variable":0},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":3035.56,"total":1035.56,"variable":0},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.spending","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":-628.36,"total":-628.36,"variable":0},"by_category":{"10000":{"fixed":-628.36,"total":-628.36,"variable":0}},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":-1406.43,"total":-2671.17,"variable":-1264.74},"by_category":{"10000":{"fixed":-1406.43,"total":-1406.43,"variable":0},"110000":{"fixed":0,"total":-1264.74,"variable":-1264.74}},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":-501.34,"total":-1432.88,"variable":-931.54},"by_category":{"10000":{"fixed":-501.34,"total":-501.34,"variable":0},"130000":{"fixed":0,"total":-931.54,"variable":-931.54}},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":-809.02,"total":-1668.56,"variable":-859.54},"by_category":{"10000":{"fixed":-809.02,"total":-809.02,"variable":0},"110000":{"fixed":0,"total":-609.02,"variable":-609.02},"1000006":{"fixed":0,"total":-250.52,"variable":-250.52}},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":0,"total":-1796.96,"variable":-1796.96},"by_category":{"110000":{"fixed":0,"total":-1796.96,"variable":-1796.96}},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":-70.49,"total":-70.49,"variable":0},"by_category":{"10000":{"fixed":-70.49,"total":-70.49,"variable":0}},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":-120.21,"total":-130.21,"variable":-10},"by_category":{"10000":{"fixed":-120.21,"total":-130.21,"variable":-10}},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.investments","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","count":0,"label":"Agosto 2020","amount":0,"short_label":"Ago 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-09-30","begin":"2020-09-01","count":0,"label":"Setembro 2020","amount":0,"short_label":"Set 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-10-31","begin":"2020-10-01","count":0,"label":"Outubro 2020","amount":0,"short_label":"Out 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-11-30","begin":"2020-11-01","count":0,"label":"Novembro 2020","amount":0,"short_label":"Nov 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-12-31","begin":"2020-12-01","count":0,"label":"Dezembro 2020","amount":0,"short_label":"Dez 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2021-01-31","begin":"2021-01-01","count":0,"label":"Janeiro","amount":0,"short_label":"Jan","deposit_amount":0,"withdraw_amount":0},{"end":"2021-02-28","begin":"2021-02-01","count":0,"label":"Fevereiro","amount":0,"short_label":"Fev","deposit_amount":0,"withdraw_amount":0},{"end":"2021-03-31","begin":"2021-03-01","count":0,"label":"Março","amount":0,"short_label":"Mar","deposit_amount":0,"withdraw_amount":0},{"end":"2021-04-30","begin":"2021-04-01","count":0,"label":"Abril","amount":0,"short_label":"Abr","deposit_amount":0,"withdraw_amount":0}]},{"name":"profile_overview_panel_section.partial_periods","type":"dat","value":{"1_period_ago":{"10_days":{"end":"2021-03-10","days":10,"begin":"2021-03-01","label":"1 março » 10 março","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 10 mar"},"15_days":{"end":"2021-03-15","days":15,"begin":"2021-03-01","label":"1 março » 15 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 15 mar"},"20_days":{"end":"2021-03-20","days":20,"begin":"2021-03-01","label":"1 março » 20 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 20 mar"}},"2_period_ago":{"10_days":{"end":"2021-02-10","days":10,"begin":"2021-02-01","label":"1 fevereiro » 10 fevereiro","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 10 fev"},"15_days":{"end":"2021-02-15","days":15,"begin":"2021-02-01","label":"1 fevereiro » 15 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 15 fev"},"20_days":{"end":"2021-02-20","days":20,"begin":"2021-02-01","label":"1 fevereiro » 20 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 20 fev"}},"3_period_ago":{"10_days":{"end":"2021-01-10","days":10,"begin":"2021-01-01","label":"1 janeiro » 10 janeiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 10 jan"},"15_days":{"end":"2021-01-15","days":15,"begin":"2021-01-01","label":"1 janeiro » 15 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 15 jan"},"20_days":{"end":"2021-01-20","days":20,"begin":"2021-01-01","label":"1 janeiro » 20 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 20 jan"}},"current_period":{"10_days":{"end":"2021-04-10","days":10,"begin":"2021-04-01","label":"1 abril » 10 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 10 abr"},"15_days":{"end":"2021-04-15","days":15,"begin":"2021-04-01","label":"1 abril » 15 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 15 abr"},"20_days":{"end":"2021-04-20","days":20,"begin":"2021-04-01","label":"1 abril » 20 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 20 abr"}}}}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37184},{"promotion_id":"10401","name":"inf_first_10_days_summary","convo_template":"tpt_itau_summary","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"<var>=ivars.partial_periods_totals['10_days'] </var>\"}}","content_body":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"<var>=ivars.partial_periods_totals['10_days'] </var>","user_engaged_link":"","external_link_body":"","external_link_link":"","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Agora não, valeu\",\"response\":\"Tudo bem, em breve eu volto com novas informações para você 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"<var>=ivars.partial_periods_expenses['10_days']</var><br />Vou continuar de olho nas suas finanças e volto em breve com mais informações! 🤓\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"Agora não, valeu","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"","user_option_delayed_response":"Tudo bem, em breve eu volto com novas informações para você 😉","user_option_engaged_response":"<var>=ivars.partial_periods_expenses['10_days']</var><br />Vou continuar de olho nas suas finanças e volto em breve com mais informações! 🤓","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-26T21:22:32.547Z","end_date":"2053-01-19T14:16:31.874Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:16:32.042Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":14,"profile_group_id":14,"previous_version":13,"convo_header":{"type":"alert","barrier":"Olivia faz as principais contas e análises e entrega tudo pronto pro usuário.","behavior":"Ter disciplina de acompanhar o padrão de despesas / receitas durante o mês.","benefits":"Autoconhecimento e criação do hábito de verificar o status de suas contas. Apoio emocional (saber que estamos aqui para ajudar o usuário a se manter no controle de suas finanças).","cooldown":"720","feed_cta":"quero ver","feed_body":"O resumo dos 10 primeiros dias do seu mês está pronto para você. Vamos ver?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"ciclo mensal","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"8","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"720","notification_type":"insight","cooldownFrustrated":"720","cooldownInteracted":"720","cooldownThumbsDown":"720","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["summary"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.totals.income","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":1242.07,"total":1242.07,"variable":0},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":767.78,"total":767.78,"variable":0},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":1646.24,"total":1646.24,"variable":0},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":3535.56,"total":3535.56,"variable":0},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":3035.56,"total":1035.56,"variable":0},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.spending","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":-628.36,"total":-628.36,"variable":0},"by_category":{"10000":{"fixed":-628.36,"total":-628.36,"variable":0}},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":-1406.43,"total":-2671.17,"variable":-1264.74},"by_category":{"10000":{"fixed":-1406.43,"total":-1406.43,"variable":0},"110000":{"fixed":0,"total":-1264.74,"variable":-1264.74}},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":-501.34,"total":-1432.88,"variable":-931.54},"by_category":{"10000":{"fixed":-501.34,"total":-501.34,"variable":0},"130000":{"fixed":0,"total":-931.54,"variable":-931.54}},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":-809.02,"total":-1668.56,"variable":-859.54},"by_category":{"10000":{"fixed":-809.02,"total":-809.02,"variable":0},"110000":{"fixed":0,"total":-609.02,"variable":-609.02},"1000006":{"fixed":0,"total":-250.52,"variable":-250.52}},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":0,"total":-1796.96,"variable":-1796.96},"by_category":{"110000":{"fixed":0,"total":-1796.96,"variable":-1796.96}},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":-70.49,"total":-70.49,"variable":0},"by_category":{"10000":{"fixed":-70.49,"total":-70.49,"variable":0}},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":-120.21,"total":-130.21,"variable":-10},"by_category":{"10000":{"fixed":-120.21,"total":-130.21,"variable":-10}},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.investments","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","count":0,"label":"Agosto 2020","amount":0,"short_label":"Ago 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-09-30","begin":"2020-09-01","count":0,"label":"Setembro 2020","amount":0,"short_label":"Set 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-10-31","begin":"2020-10-01","count":0,"label":"Outubro 2020","amount":0,"short_label":"Out 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-11-30","begin":"2020-11-01","count":0,"label":"Novembro 2020","amount":0,"short_label":"Nov 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-12-31","begin":"2020-12-01","count":0,"label":"Dezembro 2020","amount":0,"short_label":"Dez 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2021-01-31","begin":"2021-01-01","count":0,"label":"Janeiro","amount":0,"short_label":"Jan","deposit_amount":0,"withdraw_amount":0},{"end":"2021-02-28","begin":"2021-02-01","count":0,"label":"Fevereiro","amount":0,"short_label":"Fev","deposit_amount":0,"withdraw_amount":0},{"end":"2021-03-31","begin":"2021-03-01","count":0,"label":"Março","amount":0,"short_label":"Mar","deposit_amount":0,"withdraw_amount":0},{"end":"2021-04-30","begin":"2021-04-01","count":0,"label":"Abril","amount":0,"short_label":"Abr","deposit_amount":0,"withdraw_amount":0}]},{"name":"profile_overview_panel_section.partial_periods","type":"dat","value":{"1_period_ago":{"10_days":{"end":"2021-03-10","days":10,"begin":"2021-03-01","label":"1 março » 10 março","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 10 mar"},"15_days":{"end":"2021-03-15","days":15,"begin":"2021-03-01","label":"1 março » 15 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 15 mar"},"20_days":{"end":"2021-03-20","days":20,"begin":"2021-03-01","label":"1 março » 20 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 20 mar"}},"2_period_ago":{"10_days":{"end":"2021-02-10","days":10,"begin":"2021-02-01","label":"1 fevereiro » 10 fevereiro","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 10 fev"},"15_days":{"end":"2021-02-15","days":15,"begin":"2021-02-01","label":"1 fevereiro » 15 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 15 fev"},"20_days":{"end":"2021-02-20","days":20,"begin":"2021-02-01","label":"1 fevereiro » 20 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 20 fev"}},"3_period_ago":{"10_days":{"end":"2021-01-10","days":10,"begin":"2021-01-01","label":"1 janeiro » 10 janeiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 10 jan"},"15_days":{"end":"2021-01-15","days":15,"begin":"2021-01-01","label":"1 janeiro » 15 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 15 jan"},"20_days":{"end":"2021-01-20","days":20,"begin":"2021-01-01","label":"1 janeiro » 20 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 20 jan"}},"current_period":{"10_days":{"end":"2021-04-10","days":10,"begin":"2021-04-01","label":"1 abril » 10 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 10 abr"},"15_days":{"end":"2021-04-15","days":15,"begin":"2021-04-01","label":"1 abril » 15 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 15 abr"},"20_days":{"end":"2021-04-20","days":20,"begin":"2021-04-01","label":"1 abril » 20 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 20 abr"}}}},{"name":"profile_overview_panel_section.last_week_rolling","type":"dat","value":{"end":"2021-08-08","begin":"2021-08-02","label":"2 agosto » 8 agosto","income":{"total":{"count":2,"amount":330},"others":{"count":1,"amount":230},"paycheck":{"count":1,"amount":200}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":200,"transaction_count":2},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":430,"transaction_count":2},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":230,"transaction_count":20}},"read_label":"2 (seg) e 8 (dom) de agosto","short_label":"2 ago » 8 ago"}}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37223},{"promotion_id":"10402","name":"inf_first_20_days_intra_month","convo_template":"tpt_itau_summary","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"<var>=ivars.partial_periods_totals['20_days']</var>\"}}","content_body":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"<var>=ivars.partial_periods_totals['20_days']</var>","user_engaged_link":"","external_link_body":"","external_link_link":"","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Agora não, valeu\",\"response\":\"Tudo bem, em breve eu volto com novas informações para você 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"<var>=ivars.partial_periods_expenses['20_days']</var><br />Seguimos monitorando e cuidando das suas finanças! 🤗💰\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"Agora não, valeu","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"","user_option_delayed_response":"Tudo bem, em breve eu volto com novas informações para você 😉","user_option_engaged_response":"<var>=ivars.partial_periods_expenses['20_days']</var><br />Seguimos monitorando e cuidando das suas finanças! 🤗💰","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-29T22:00:45.264Z","end_date":"2053-01-19T14:17:05.837Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:17:05.901Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":10,"profile_group_id":14,"previous_version":9,"convo_header":{"type":"alert","barrier":"Olivia faz as principais contas e análises e entrega tudo pronto pro usuário.","behavior":"Ter disciplina de acompanhar o padrão de despesas / receitas durante o mês.","benefits":"Autoconhecimento e criação do hábito de verificar o status de suas contas. Apoio emocional (saber que estamos aqui para ajudar o usuário a se manter no controle de suas finanças).","cooldown":"720","feed_cta":"quero ver","feed_body":"Que tal espiar o resumo dos primeiros 20 dias do seu mês?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"ciclo mensal","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"8","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"720","notification_type":"insight","cooldownFrustrated":"720","cooldownInteracted":"720","cooldownThumbsDown":"720","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["summary"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.totals.income","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":1242.07,"total":1242.07,"variable":0},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":767.78,"total":767.78,"variable":0},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":1646.24,"total":1646.24,"variable":0},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":3535.56,"total":3535.56,"variable":0},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":3035.56,"total":1035.56,"variable":0},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.spending","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":-628.36,"total":-628.36,"variable":0},"by_category":{"10000":{"fixed":-628.36,"total":-628.36,"variable":0}},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":-1406.43,"total":-2671.17,"variable":-1264.74},"by_category":{"10000":{"fixed":-1406.43,"total":-1406.43,"variable":0},"110000":{"fixed":0,"total":-1264.74,"variable":-1264.74}},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":-501.34,"total":-1432.88,"variable":-931.54},"by_category":{"10000":{"fixed":-501.34,"total":-501.34,"variable":0},"130000":{"fixed":0,"total":-931.54,"variable":-931.54}},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":-809.02,"total":-1668.56,"variable":-859.54},"by_category":{"10000":{"fixed":-809.02,"total":-809.02,"variable":0},"110000":{"fixed":0,"total":-609.02,"variable":-609.02},"1000006":{"fixed":0,"total":-250.52,"variable":-250.52}},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":0,"total":-1796.96,"variable":-1796.96},"by_category":{"110000":{"fixed":0,"total":-1796.96,"variable":-1796.96}},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":-70.49,"total":-70.49,"variable":0},"by_category":{"10000":{"fixed":-70.49,"total":-70.49,"variable":0}},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":-120.21,"total":-130.21,"variable":-10},"by_category":{"10000":{"fixed":-120.21,"total":-130.21,"variable":-10}},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.investments","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","count":0,"label":"Agosto 2020","amount":0,"short_label":"Ago 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-09-30","begin":"2020-09-01","count":0,"label":"Setembro 2020","amount":0,"short_label":"Set 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-10-31","begin":"2020-10-01","count":0,"label":"Outubro 2020","amount":0,"short_label":"Out 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-11-30","begin":"2020-11-01","count":0,"label":"Novembro 2020","amount":0,"short_label":"Nov 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-12-31","begin":"2020-12-01","count":0,"label":"Dezembro 2020","amount":0,"short_label":"Dez 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2021-01-31","begin":"2021-01-01","count":0,"label":"Janeiro","amount":0,"short_label":"Jan","deposit_amount":0,"withdraw_amount":0},{"end":"2021-02-28","begin":"2021-02-01","count":0,"label":"Fevereiro","amount":0,"short_label":"Fev","deposit_amount":0,"withdraw_amount":0},{"end":"2021-03-31","begin":"2021-03-01","count":0,"label":"Março","amount":0,"short_label":"Mar","deposit_amount":0,"withdraw_amount":0},{"end":"2021-04-30","begin":"2021-04-01","count":0,"label":"Abril","amount":0,"short_label":"Abr","deposit_amount":0,"withdraw_amount":0}]},{"name":"profile_overview_panel_section.partial_periods","type":"dat","value":{"1_period_ago":{"10_days":{"end":"2021-03-10","days":10,"begin":"2021-03-01","label":"1 março » 10 março","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 10 mar"},"15_days":{"end":"2021-03-15","days":15,"begin":"2021-03-01","label":"1 março » 15 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 15 mar"},"20_days":{"end":"2021-03-20","days":20,"begin":"2021-03-01","label":"1 março » 20 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 20 mar"}},"2_period_ago":{"10_days":{"end":"2021-02-10","days":10,"begin":"2021-02-01","label":"1 fevereiro » 10 fevereiro","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 10 fev"},"15_days":{"end":"2021-02-15","days":15,"begin":"2021-02-01","label":"1 fevereiro » 15 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 15 fev"},"20_days":{"end":"2021-02-20","days":20,"begin":"2021-02-01","label":"1 fevereiro » 20 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 20 fev"}},"3_period_ago":{"10_days":{"end":"2021-01-10","days":10,"begin":"2021-01-01","label":"1 janeiro » 10 janeiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 10 jan"},"15_days":{"end":"2021-01-15","days":15,"begin":"2021-01-01","label":"1 janeiro » 15 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 15 jan"},"20_days":{"end":"2021-01-20","days":20,"begin":"2021-01-01","label":"1 janeiro » 20 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 20 jan"}},"current_period":{"10_days":{"end":"2021-04-10","days":10,"begin":"2021-04-01","label":"1 abril » 10 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 10 abr"},"15_days":{"end":"2021-04-15","days":15,"begin":"2021-04-01","label":"1 abril » 15 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 15 abr"},"20_days":{"end":"2021-04-20","days":20,"begin":"2021-04-01","label":"1 abril » 20 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 20 abr"}}}}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37230},{"promotion_id":"10403","name":"inf_first_20_days_summary","convo_template":"tpt_itau_summary","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"<var>=ivars.partial_periods_totals['20_days']</var>\"}}","content_body":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"<var>=ivars.partial_periods_totals['20_days']</var>","user_engaged_link":"","external_link_body":"","external_link_link":"","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Agora não, valeu\",\"response\":\"Tudo bem, em breve eu volto com novas informações para você 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"<var>=ivars.partial_periods_expenses['20_days']</var><br />Seguimos monitorando e cuidando das suas finanças! 🤗💰\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"Agora não, valeu","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"","user_option_delayed_response":"Tudo bem, em breve eu volto com novas informações para você 😉","user_option_engaged_response":"<var>=ivars.partial_periods_expenses['20_days']</var><br />Seguimos monitorando e cuidando das suas finanças! 🤗💰","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-26T21:48:58.681Z","end_date":"2053-01-19T14:17:40.984Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:17:41.055Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":15,"profile_group_id":14,"previous_version":14,"convo_header":{"type":"alert","barrier":"Olivia faz as principais contas e análises e entrega tudo pronto pro usuário.","behavior":"Ter disciplina de acompanhar o padrão de despesas / receitas durante o mês.","benefits":"Autoconhecimento e criação do hábito de verificar o status de suas contas. Apoio emocional (saber que estamos aqui para ajudar o usuário a se manter no controle de suas finanças).","cooldown":"720","feed_cta":"quero ver","feed_body":"Que tal espiar o resumo dos primeiros 20 dias do seu mês? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"ciclo mensal","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"8","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"720","notification_type":"insight","cooldownFrustrated":"720","cooldownInteracted":"720","cooldownThumbsDown":"720","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["summary"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.totals.income","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":1242.07,"total":1242.07,"variable":0},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":767.78,"total":767.78,"variable":0},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":1646.24,"total":1646.24,"variable":0},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":3535.56,"total":3535.56,"variable":0},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":3035.56,"total":1035.56,"variable":0},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.spending","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":-628.36,"total":-628.36,"variable":0},"by_category":{"10000":{"fixed":-628.36,"total":-628.36,"variable":0}},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":-1406.43,"total":-2671.17,"variable":-1264.74},"by_category":{"10000":{"fixed":-1406.43,"total":-1406.43,"variable":0},"110000":{"fixed":0,"total":-1264.74,"variable":-1264.74}},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":-501.34,"total":-1432.88,"variable":-931.54},"by_category":{"10000":{"fixed":-501.34,"total":-501.34,"variable":0},"130000":{"fixed":0,"total":-931.54,"variable":-931.54}},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":-809.02,"total":-1668.56,"variable":-859.54},"by_category":{"10000":{"fixed":-809.02,"total":-809.02,"variable":0},"110000":{"fixed":0,"total":-609.02,"variable":-609.02},"1000006":{"fixed":0,"total":-250.52,"variable":-250.52}},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":0,"total":-1796.96,"variable":-1796.96},"by_category":{"110000":{"fixed":0,"total":-1796.96,"variable":-1796.96}},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":-70.49,"total":-70.49,"variable":0},"by_category":{"10000":{"fixed":-70.49,"total":-70.49,"variable":0}},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":-120.21,"total":-130.21,"variable":-10},"by_category":{"10000":{"fixed":-120.21,"total":-130.21,"variable":-10}},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.investments","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","count":0,"label":"Agosto 2020","amount":0,"short_label":"Ago 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-09-30","begin":"2020-09-01","count":0,"label":"Setembro 2020","amount":0,"short_label":"Set 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-10-31","begin":"2020-10-01","count":0,"label":"Outubro 2020","amount":0,"short_label":"Out 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-11-30","begin":"2020-11-01","count":0,"label":"Novembro 2020","amount":0,"short_label":"Nov 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-12-31","begin":"2020-12-01","count":0,"label":"Dezembro 2020","amount":0,"short_label":"Dez 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2021-01-31","begin":"2021-01-01","count":0,"label":"Janeiro","amount":0,"short_label":"Jan","deposit_amount":0,"withdraw_amount":0},{"end":"2021-02-28","begin":"2021-02-01","count":0,"label":"Fevereiro","amount":0,"short_label":"Fev","deposit_amount":0,"withdraw_amount":0},{"end":"2021-03-31","begin":"2021-03-01","count":0,"label":"Março","amount":0,"short_label":"Mar","deposit_amount":0,"withdraw_amount":0},{"end":"2021-04-30","begin":"2021-04-01","count":0,"label":"Abril","amount":0,"short_label":"Abr","deposit_amount":0,"withdraw_amount":0}]},{"name":"profile_overview_panel_section.partial_periods","type":"dat","value":{"1_period_ago":{"10_days":{"end":"2021-03-10","days":10,"begin":"2021-03-01","label":"1 março » 10 março","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 10 mar"},"15_days":{"end":"2021-03-15","days":15,"begin":"2021-03-01","label":"1 março » 15 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 15 mar"},"20_days":{"end":"2021-03-20","days":20,"begin":"2021-03-01","label":"1 março » 20 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 20 mar"}},"2_period_ago":{"10_days":{"end":"2021-02-10","days":10,"begin":"2021-02-01","label":"1 fevereiro » 10 fevereiro","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 10 fev"},"15_days":{"end":"2021-02-15","days":15,"begin":"2021-02-01","label":"1 fevereiro » 15 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 15 fev"},"20_days":{"end":"2021-02-20","days":20,"begin":"2021-02-01","label":"1 fevereiro » 20 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 20 fev"}},"3_period_ago":{"10_days":{"end":"2021-01-10","days":10,"begin":"2021-01-01","label":"1 janeiro » 10 janeiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 10 jan"},"15_days":{"end":"2021-01-15","days":15,"begin":"2021-01-01","label":"1 janeiro » 15 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 15 jan"},"20_days":{"end":"2021-01-20","days":20,"begin":"2021-01-01","label":"1 janeiro » 20 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 20 jan"}},"current_period":{"10_days":{"end":"2021-04-10","days":10,"begin":"2021-04-01","label":"1 abril » 10 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 10 abr"},"15_days":{"end":"2021-04-15","days":15,"begin":"2021-04-01","label":"1 abril » 15 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 15 abr"},"20_days":{"end":"2021-04-20","days":20,"begin":"2021-04-01","label":"1 abril » 20 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 20 abr"}}}},{"name":"profile_overview_panel_section.last_week_rolling","type":"dat","value":{"end":"2021-08-08","begin":"2021-08-02","label":"2 agosto » 8 agosto","income":{"total":{"count":2,"amount":330},"others":{"count":1,"amount":230},"paycheck":{"count":1,"amount":200}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":200,"transaction_count":2},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":430,"transaction_count":2},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":230,"transaction_count":20}},"read_label":"2 (seg) e 8 (dom) de agosto","short_label":"2 ago » 8 ago"}}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37232},{"promotion_id":"10404","name":"inf_first_mid_month_intra_month","convo_template":"tpt_itau_summary","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"<var>=ivars.partial_periods_totals['15_days']</var>\"}}","content_body":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"<var>=ivars.partial_periods_totals['15_days']</var>","user_engaged_link":"","external_link_body":"","external_link_link":"","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Agora não, valeu\",\"response\":\"Tudo bem, em breve eu volto com novas informações para você 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"<var>=ivars.partial_periods_expenses['15_days']</var><br />Vamos em frente e até o próximo resumo das suas movimentações financeiras! 🏃💨\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"Agora não, valeu","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"","user_option_delayed_response":"Tudo bem, em breve eu volto com novas informações para você 😉","user_option_engaged_response":"<var>=ivars.partial_periods_expenses['15_days']</var><br />Vamos em frente e até o próximo resumo das suas movimentações financeiras! 🏃💨","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-29T21:49:47.642Z","end_date":"2053-01-19T14:18:12.208Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:18:12.285Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":9,"profile_group_id":14,"previous_version":8,"convo_header":{"type":"alert","barrier":"Olivia faz as principais contas e análises e entrega tudo pronto pro usuário.","behavior":"Ter disciplina de acompanhar o padrão de despesas / receitas durante o mês.","benefits":"Autoconhecimento e criação do hábito de verificar o status de suas contas. Apoio emocional (saber que estamos aqui para ajudar o usuário a se manter no controle de suas finanças).","cooldown":"720","feed_cta":"vamos!","feed_body":"Vamos dar uma olhada no resumo da primeira quinzena do seu mês? Vem comigo ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"ciclo mensal","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"8","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"720","notification_type":"insight","cooldownFrustrated":"720","cooldownInteracted":"720","cooldownThumbsDown":"720","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["summary"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.totals.income","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":1242.07,"total":1242.07,"variable":0},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":767.78,"total":767.78,"variable":0},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":1646.24,"total":1646.24,"variable":0},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":3535.56,"total":3535.56,"variable":0},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":3035.56,"total":1035.56,"variable":0},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.spending","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":-628.36,"total":-628.36,"variable":0},"by_category":{"10000":{"fixed":-628.36,"total":-628.36,"variable":0}},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":-1406.43,"total":-2671.17,"variable":-1264.74},"by_category":{"10000":{"fixed":-1406.43,"total":-1406.43,"variable":0},"110000":{"fixed":0,"total":-1264.74,"variable":-1264.74}},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":-501.34,"total":-1432.88,"variable":-931.54},"by_category":{"10000":{"fixed":-501.34,"total":-501.34,"variable":0},"130000":{"fixed":0,"total":-931.54,"variable":-931.54}},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":-809.02,"total":-1668.56,"variable":-859.54},"by_category":{"10000":{"fixed":-809.02,"total":-809.02,"variable":0},"110000":{"fixed":0,"total":-609.02,"variable":-609.02},"1000006":{"fixed":0,"total":-250.52,"variable":-250.52}},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":0,"total":-1796.96,"variable":-1796.96},"by_category":{"110000":{"fixed":0,"total":-1796.96,"variable":-1796.96}},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":-70.49,"total":-70.49,"variable":0},"by_category":{"10000":{"fixed":-70.49,"total":-70.49,"variable":0}},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":-120.21,"total":-130.21,"variable":-10},"by_category":{"10000":{"fixed":-120.21,"total":-130.21,"variable":-10}},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.investments","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","count":0,"label":"Agosto 2020","amount":0,"short_label":"Ago 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-09-30","begin":"2020-09-01","count":0,"label":"Setembro 2020","amount":0,"short_label":"Set 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-10-31","begin":"2020-10-01","count":0,"label":"Outubro 2020","amount":0,"short_label":"Out 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-11-30","begin":"2020-11-01","count":0,"label":"Novembro 2020","amount":0,"short_label":"Nov 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-12-31","begin":"2020-12-01","count":0,"label":"Dezembro 2020","amount":0,"short_label":"Dez 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2021-01-31","begin":"2021-01-01","count":0,"label":"Janeiro","amount":0,"short_label":"Jan","deposit_amount":0,"withdraw_amount":0},{"end":"2021-02-28","begin":"2021-02-01","count":0,"label":"Fevereiro","amount":0,"short_label":"Fev","deposit_amount":0,"withdraw_amount":0},{"end":"2021-03-31","begin":"2021-03-01","count":0,"label":"Março","amount":0,"short_label":"Mar","deposit_amount":0,"withdraw_amount":0},{"end":"2021-04-30","begin":"2021-04-01","count":0,"label":"Abril","amount":0,"short_label":"Abr","deposit_amount":0,"withdraw_amount":0}]},{"name":"profile_overview_panel_section.partial_periods","type":"dat","value":{"1_period_ago":{"10_days":{"end":"2021-03-10","days":10,"begin":"2021-03-01","label":"1 março » 10 março","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 10 mar"},"15_days":{"end":"2021-03-15","days":15,"begin":"2021-03-01","label":"1 março » 15 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 15 mar"},"20_days":{"end":"2021-03-20","days":20,"begin":"2021-03-01","label":"1 março » 20 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 20 mar"}},"2_period_ago":{"10_days":{"end":"2021-02-10","days":10,"begin":"2021-02-01","label":"1 fevereiro » 10 fevereiro","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 10 fev"},"15_days":{"end":"2021-02-15","days":15,"begin":"2021-02-01","label":"1 fevereiro » 15 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 15 fev"},"20_days":{"end":"2021-02-20","days":20,"begin":"2021-02-01","label":"1 fevereiro » 20 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 20 fev"}},"3_period_ago":{"10_days":{"end":"2021-01-10","days":10,"begin":"2021-01-01","label":"1 janeiro » 10 janeiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 10 jan"},"15_days":{"end":"2021-01-15","days":15,"begin":"2021-01-01","label":"1 janeiro » 15 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 15 jan"},"20_days":{"end":"2021-01-20","days":20,"begin":"2021-01-01","label":"1 janeiro » 20 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 20 jan"}},"current_period":{"10_days":{"end":"2021-04-10","days":10,"begin":"2021-04-01","label":"1 abril » 10 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 10 abr"},"15_days":{"end":"2021-04-15","days":15,"begin":"2021-04-01","label":"1 abril » 15 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 15 abr"},"20_days":{"end":"2021-04-20","days":20,"begin":"2021-04-01","label":"1 abril » 20 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 20 abr"}}}}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37237},{"promotion_id":"10405","name":"inf_first_mid_month_summary","convo_template":"tpt_itau_summary","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"<var>=ivars.partial_periods_totals['15_days']</var>\"}}","content_body":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"<var>=ivars.partial_periods_totals['15_days']</var>","user_engaged_link":"","external_link_body":"","external_link_link":"","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Agora não, valeu\",\"response\":\"Tudo bem, em breve eu volto com novas informações para você 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"<var>=ivars.partial_periods_expenses['15_days']</var><br />Vamos em frente e até o próximo resumo das suas movimentações financeiras! 🏃💨\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"Agora não, valeu","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"","user_option_delayed_response":"Tudo bem, em breve eu volto com novas informações para você 😉","user_option_engaged_response":"<var>=ivars.partial_periods_expenses['15_days']</var><br />Vamos em frente e até o próximo resumo das suas movimentações financeiras! 🏃💨","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-26T21:36:40.942Z","end_date":"2053-01-19T14:18:47.237Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:18:47.334Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":13,"profile_group_id":14,"previous_version":12,"convo_header":{"type":"alert","barrier":"Olivia faz as principais contas e análises e entrega tudo pronto pro usuário.","behavior":"Ter disciplina de acompanhar o padrão de despesas / receitas durante o mês.","benefits":"Autoconhecimento e criação do hábito de verificar o status de suas contas. Apoio emocional (saber que estamos aqui para ajudar o usuário a se manter no controle de suas finanças).","cooldown":"720","feed_cta":"vamos!","feed_body":"Vamos dar uma olhada no resumo da primeira quinzena do seu mês? Vem comigo ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"ciclo mensal","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"8","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"720","notification_type":"insight","cooldownFrustrated":"720","cooldownInteracted":"720","cooldownThumbsDown":"720","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["summary"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.totals.income","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":0,"total":0,"variable":120},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":1242.07,"total":1242.07,"variable":0},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":767.78,"total":767.78,"variable":0},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":1646.24,"total":1646.24,"variable":0},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":3535.56,"total":3535.56,"variable":0},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":1767.78,"total":1767.78,"variable":0},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":3035.56,"total":1035.56,"variable":0},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.spending","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","label":"Agosto 2020","amount":{"fixed":-628.36,"total":-628.36,"variable":120},"by_category":{"10000":{"fixed":-628.36,"total":-628.36,"variable":0}},"short_label":"Ago 2020"},{"end":"2020-09-30","begin":"2020-09-01","label":"Setembro 2020","amount":{"fixed":-1406.43,"total":-2671.17,"variable":-1264.74},"by_category":{"10000":{"fixed":-1406.43,"total":-1406.43,"variable":0},"110000":{"fixed":0,"total":-1264.74,"variable":-1264.74}},"short_label":"Set 2020"},{"end":"2020-10-31","begin":"2020-10-01","label":"Outubro 2020","amount":{"fixed":-501.34,"total":-1432.88,"variable":-931.54},"by_category":{"10000":{"fixed":-501.34,"total":-501.34,"variable":0},"130000":{"fixed":0,"total":-931.54,"variable":-931.54}},"short_label":"Out 2020"},{"end":"2020-11-30","begin":"2020-11-01","label":"Novembro 2020","amount":{"fixed":-809.02,"total":-1668.56,"variable":-859.54},"by_category":{"10000":{"fixed":-809.02,"total":-809.02,"variable":0},"110000":{"fixed":0,"total":-609.02,"variable":-609.02},"1000006":{"fixed":0,"total":-250.52,"variable":-250.52}},"short_label":"Nov 2020"},{"end":"2020-12-31","begin":"2020-12-01","label":"Dezembro 2020","amount":{"fixed":0,"total":-1796.96,"variable":-1796.96},"by_category":{"110000":{"fixed":0,"total":-1796.96,"variable":-1796.96}},"short_label":"Dez 2020"},{"end":"2021-01-31","begin":"2021-01-01","label":"Janeiro","amount":{"fixed":-70.49,"total":-70.49,"variable":0},"by_category":{"10000":{"fixed":-70.49,"total":-70.49,"variable":0}},"short_label":"Jan"},{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Fev"},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":-120.21,"total":-130.21,"variable":-10},"by_category":{"10000":{"fixed":-120.21,"total":-130.21,"variable":-10}},"short_label":"Mar"},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"by_category":{},"short_label":"Abr"}]},{"name":"profile_overview_panel_section.totals.investments","type":"dat","value":[{"end":"2020-08-31","begin":"2020-08-01","count":0,"label":"Agosto 2020","amount":0,"short_label":"Ago 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-09-30","begin":"2020-09-01","count":0,"label":"Setembro 2020","amount":0,"short_label":"Set 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-10-31","begin":"2020-10-01","count":0,"label":"Outubro 2020","amount":0,"short_label":"Out 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-11-30","begin":"2020-11-01","count":0,"label":"Novembro 2020","amount":0,"short_label":"Nov 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2020-12-31","begin":"2020-12-01","count":0,"label":"Dezembro 2020","amount":0,"short_label":"Dez 2020","deposit_amount":0,"withdraw_amount":0},{"end":"2021-01-31","begin":"2021-01-01","count":0,"label":"Janeiro","amount":0,"short_label":"Jan","deposit_amount":0,"withdraw_amount":0},{"end":"2021-02-28","begin":"2021-02-01","count":0,"label":"Fevereiro","amount":0,"short_label":"Fev","deposit_amount":0,"withdraw_amount":0},{"end":"2021-03-31","begin":"2021-03-01","count":0,"label":"Março","amount":0,"short_label":"Mar","deposit_amount":0,"withdraw_amount":0},{"end":"2021-04-30","begin":"2021-04-01","count":0,"label":"Abril","amount":0,"short_label":"Abr","deposit_amount":0,"withdraw_amount":0}]},{"name":"profile_overview_panel_section.partial_periods","type":"dat","value":{"1_period_ago":{"10_days":{"end":"2021-03-10","days":10,"begin":"2021-03-01","label":"1 março » 10 março","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 10 mar"},"15_days":{"end":"2021-03-15","days":15,"begin":"2021-03-01","label":"1 março » 15 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 15 mar"},"20_days":{"end":"2021-03-20","days":20,"begin":"2021-03-01","label":"1 março » 20 março","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de março","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":1,"short_label":"1 mar » 20 mar"}},"2_period_ago":{"10_days":{"end":"2021-02-10","days":10,"begin":"2021-02-01","label":"1 fevereiro » 10 fevereiro","income":{"total":{"count":0,"amount":0},"others":{"count":0,"amount":0},"paycheck":{"count":0,"amount":0}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 10 fev"},"15_days":{"end":"2021-02-15","days":15,"begin":"2021-02-01","label":"1 fevereiro » 15 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 15 fev"},"20_days":{"end":"2021-02-20","days":20,"begin":"2021-02-01","label":"1 fevereiro » 20 fevereiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de fevereiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":2,"short_label":"1 fev » 20 fev"}},"3_period_ago":{"10_days":{"end":"2021-01-10","days":10,"begin":"2021-01-01","label":"1 janeiro » 10 janeiro","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 10 jan"},"15_days":{"end":"2021-01-15","days":15,"begin":"2021-01-01","label":"1 janeiro » 15 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 15 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 15 jan"},"20_days":{"end":"2021-01-20","days":20,"begin":"2021-01-01","label":"1 janeiro » 20 janeiro","income":{"total":{"count":2,"amount":3535.56},"others":{"count":0,"amount":0},"paycheck":{"count":2,"amount":3535.56}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-70.49}],"total_amount":-70.49},"bottom":{"categories":[],"total_amount":0}},"total_amount":-70.49,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de janeiro","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":3,"short_label":"1 jan » 20 jan"}},"current_period":{"10_days":{"end":"2021-04-10","days":10,"begin":"2021-04-01","label":"1 abril » 10 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 10 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 10 abr"},"15_days":{"end":"2021-04-15","days":15,"begin":"2021-04-01","label":"1 abril » 15 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":-123,"transaction_count":0}},"read_label":"1 e 15 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 15 abr"},"20_days":{"end":"2021-04-20","days":20,"begin":"2021-04-01","label":"1 abril » 20 abril","income":{"total":{"count":1,"amount":1767.78},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":1767.78}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"total":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-80.21}],"total_amount":-80.21},"bottom":{"categories":[],"total_amount":0}},"total_amount":-80.21,"transaction_count":1},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":0,"transaction_count":0}},"read_label":"1 e 20 de abril","investments":{"total":{"count":0,"amount":0,"deposit_amount":0,"withdraw_amount":0}},"periods_ago":0,"short_label":"1 abr » 20 abr"}}}},{"name":"profile_overview_panel_section.last_week_rolling","type":"dat","value":{"end":"2021-08-08","begin":"2021-08-02","label":"2 agosto » 8 agosto","income":{"total":{"count":2,"amount":330},"others":{"count":1,"amount":230},"paycheck":{"count":1,"amount":200}},"spending":{"fixed":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":200,"transaction_count":2},"total":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":430,"transaction_count":2},"variable":{"by_category":{"top":{"categories":[],"total_amount":0},"bottom":{"categories":[],"total_amount":0}},"total_amount":230,"transaction_count":20}},"read_label":"2 (seg) e 8 (dom) de agosto","short_label":"2 ago » 8 ago"}}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37179},{"promotion_id":"10406","name":"inf_ifood_cartao_debito","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Vá em <b>Trocar</b> > <b>Pague pelo app</b> > <b>Adicionar novo cartão</b> > <b>Débito</b>, aí é só inserir o nº do cartão de débito, código de segurança e validade, e então salvar\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Aproveite e faça essa mudança no app do iFood na hora de pagar seu próximo pedido:\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Prontinho! Os pagamentos de iFood vão cair automaticamente no seu cartão de débito 😉\"}}","content_body":"Vá em <b>Trocar</b> > <b>Pague pelo app</b> > <b>Adicionar novo cartão</b> > <b>Débito</b>, aí é só inserir o nº do cartão de débito, código de segurança e validade, e então salvar","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Aproveite e faça essa mudança no app do iFood na hora de pagar seu próximo pedido:","notification_2":" ","notification_3":" ","disclaimer_body":"Prontinho! Os pagamentos de iFood vão cair automaticamente no seu cartão de débito 😉","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-23T18:14:27.193Z","end_date":"2053-01-19T14:19:56.490Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:19:56.548Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":5,"profile_group_id":14,"previous_version":4,"convo_header":{"type":"default","barrier":"Informar ao usuário que é possível cadastrar o seu cartão de débito em um app de delivery.","behavior":"Fazer com que o usuário cadastre seu cartão de débito no app do iFood.","benefits":"Ao realizar a compra pelo iFood, o usuário pode fazer o pagamento diretamente no aplicativo.","cooldown":"0","feed_cta":"me conta","feed_body":"Sabia dessa? Agora você cadastra seu cartão de débito para pagar o pedido pelo app do iFood ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"gastos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"low","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"842","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["itau partner"]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"823","etl_aggregation_name":"Itau iFood by Account Type","rvar_object":"itau_ifood_delivery","rvar_variable":"amt_30d","rule":{"code":"    const moment = require('moment');\n    const buffer = moment().utc().subtract(30, 'days').startOf('day');\n\n    const period_transactions = transactions.filter(t => t.date.getTime() >= buffer\n        && t.cashflow\n        && t.enabled);\n\n\n    const food_transactions = period_transactions.filter(t => [1000013].includes(t.olivia_category_id));\n    const checking_expenses = food_transactions.filter(t => t.account_type_id == 100).reduce((acc, item) => acc - item.amount, 0);\n\n    const credit_expenses = period_transactions.filter(t => t.account_type_id == 200).reduce((acc, item) => acc - item.amount, 0);\n\n    return { checking_expenses, credit_expenses };\n","type":"custom","filter":{"$valid_transactions":true},"description":"Check food delivery expenses on credit card and on checking account","invert_value":true},"updated_at":"2021-12-29T13:43:35.161Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":842,"name":"Itau iFood expenses without credit card","rule":[{"code":"    if (!rvars\n        || !rvars.agg\n        || !rvars.agg.itau_ifood_delivery\n        || !rvars.agg.itau_ifood_delivery.amt_30d) return 0;\n\n    // Requires no expense on credit card\n    if (rvars.agg.itau_ifood_delivery.amt_30d.credit_expenses > 0) return 0;\n\n    // At least 20 on checking\n    if (rvars.agg.itau_ifood_delivery.amt_30d.checking_expenses >= 20) return 1;\n\n    return 0;\n","type":"custom","description":""}],"updated_at":"2021-08-27T14:13:20.720504","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_842"}],"shadow":false,"requires_etls":["itau_ifood_delivery.amt_30d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37213},{"promotion_id":"10407","name":"inf_ignore_promo_email","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"São muitos milhões de e-mails disparados 24 horas por dia com uma única missão: fazer você comprar<br /><br />Mas tem jeito de não entrar nessa! 😅\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Nos últimos 30 dias você gastou<b> R$ <var>=rvars.agg.l1cat110000.amt30d</var></b> em compras.\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"São muitos milhões de e-mails disparados 24 horas por dia com uma única missão: fazer você comprar<br /><br />Mas tem jeito de não entrar nessa! 😅","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Vamos conversar sobre isso?\"}}","main_text_body":"Nos últimos 30 dias você gastou<b> R$ <var>=rvars.agg.l1cat110000.amt30d</var></b> em compras.","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Vamos conversar sobre isso?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Beleza! Volto outra hora para falarmos sobre formas de economizar 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Para que os e-mails com propagandas não te leve a fazer compras por impulso, você pode:<br /><br />📌Ativá-los como spam (e quando precisar de algo, procure os e-mails por lá);<br /><br />📌Criar um novo endereço e-mail só para cadastros em lojas.<br /><br />E claro, sempre avaliar se você, de fato, está precisando do item que quer comprar.😉\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não preciso, valeu\",\"response\":\"Vou ficar de olho em novas sugestões para você cuidar bem das suas finanças 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não preciso, valeu","user_option_delayed_response":"Beleza! Volto outra hora para falarmos sobre formas de economizar 😉","user_option_engaged_response":"Para que os e-mails com propagandas não te leve a fazer compras por impulso, você pode:<br /><br />📌Ativá-los como spam (e quando precisar de algo, procure os e-mails por lá);<br /><br />📌Criar um novo endereço e-mail só para cadastros em lojas.<br /><br />E claro, sempre avaliar se você, de fato, está precisando do item que quer comprar.😉","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Vou ficar de olho em novas sugestões para você cuidar bem das suas finanças 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-23T18:56:37.365Z","end_date":"2053-01-19T14:22:01.453Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:22:01.539Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":10,"profile_group_id":14,"previous_version":9,"convo_header":{"type":"default","barrier":"Mostrar como o usuário pode tirar o seu cadastro da lista de emails.","behavior":"Fazer com que o usuário ignore emails marketing com promoções de lojas.","benefits":"Reduzir gastos não previstos no seu orçamento.","cooldown":"0","feed_cta":"me conta!","feed_body":"Olá! Sabia que as propagandas que recebemos por e-mail nos influenciam a comprar por impulso?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"economia","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"847,2147483653","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"544","etl_aggregation_name":"L1 Category Shopping 30 Days Sum Amount","rvar_object":"l1cat110000","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"olivia_category_level1_id":110000},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":847,"name":"User has never seen or finished this convo","rule":[{"code":"    if (!hist) return 1;\n    const this_convo = hist[conversationName];\n    if (!this_convo) return 1;\n    if (!!this_convo.completed || !!this_convo.engaged || !!this_convo.delayed || !!this_convo.dismissed) return 0;\n    return 1;\n","type":"custom","description":"Return true if user never finished or engaged with this conversation before (Makes it a one-time conversation)"}],"updated_at":"2021-09-22T13:24:02.410655","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_847"},{"applicability_rule_id":2147483653,"name":"Spent > 300 at  L1 Category Shopping in 30 Days","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.l1cat110000.amt30d"},"right_value":{"type":"fixed","value":"300","variable_type":"int"}}],"updated_at":"2022-10-15T13:16:20.650571","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_2147483653"}],"shadow":false,"requires_etls":["l1cat110000.amt30d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37168},{"promotion_id":"10408","name":"inf_impulse_3_day_rule","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Sabia que as compras por impulso podem ser evitadas para o bem da sua saúde financeira?<br /><br />Para te ajudar, sugiro a <b>técnica dos 3 dias</b> 👀\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Nos últimos 30 dias você gastou <b><var>=currency(rvars.agg.l2cat110500.amt30d)</var> </b>em compras de acessórios e vestuário.<br /><br />Uma pesquisa feita por especialistas brasileiros mostrou que 19% deste tipo de compra são feitos por impulso, isso equivale a <b><var>=currency(rvars.agg.l2cat110500.amt30d*0.19)</var> do que você gastou</b>.\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Sabia que as compras por impulso podem ser evitadas para o bem da sua saúde financeira?<br /><br />Para te ajudar, sugiro a <b>técnica dos 3 dias</b> 👀","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer conhecer?\"}}","main_text_body":"Nos últimos 30 dias você gastou <b><var>=currency(rvars.agg.l2cat110500.amt30d)</var> </b>em compras de acessórios e vestuário.<br /><br />Uma pesquisa feita por especialistas brasileiros mostrou que 19% deste tipo de compra são feitos por impulso, isso equivale a <b><var>=currency(rvars.agg.l2cat110500.amt30d*0.19)</var> do que você gastou</b>.","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer conhecer?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero ver depois\",\"response\":\"Beleza, depois nos falamos! 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"É assim: sempre que for fazer uma compra, seja ela qual for, pense sobre o assunto durante 3 dias!<br /><br />Assim você tem tempo para analisar se aquele item realmente vai ser útil. <br /><br />Que tal aplicar essa técnica já na sua próxima compra?! 🤓💡\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já conheço!\",\"response\":\"Tá ótimo! Só não esquece de colocar em prática 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Quero ver depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Já conheço!","user_option_delayed_response":"Beleza, depois nos falamos! 😉","user_option_engaged_response":"É assim: sempre que for fazer uma compra, seja ela qual for, pense sobre o assunto durante 3 dias!<br /><br />Assim você tem tempo para analisar se aquele item realmente vai ser útil. <br /><br />Que tal aplicar essa técnica já na sua próxima compra?! 🤓💡","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Tá ótimo! Só não esquece de colocar em prática 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-23T18:43:37.762Z","end_date":"2053-01-19T14:22:32.498Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:22:32.689Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":13,"profile_group_id":14,"previous_version":12,"convo_header":{"type":"default","barrier":"Mostrar a técnica das 72h.","behavior":"Fazer com que o usuário reflita sobre as suas compras e não as faça de modo impulsivo.","benefits":"Reduzir gastos impulsivos.","cooldown":"0","feed_cta":"vamos!","feed_body":"Vamos conversar sobre compras por impulso?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"economia","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"847,2147483654","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l2cat110500.amt30d","type":"rvars","value":"1553,70","data_type":"number"}],"etl_aggregations":[{"etl_aggregation_id":"187","etl_aggregation_name":"L2 Category Shopping/Clothing & Accessories 30 Days Sum Amount","rvar_object":"l2cat110500","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110500,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":847,"name":"User has never seen or finished this convo","rule":[{"code":"    if (!hist) return 1;\n    const this_convo = hist[conversationName];\n    if (!this_convo) return 1;\n    if (!!this_convo.completed || !!this_convo.engaged || !!this_convo.delayed || !!this_convo.dismissed) return 0;\n    return 1;\n","type":"custom","description":"Return true if user never finished or engaged with this conversation before (Makes it a one-time conversation)"}],"updated_at":"2021-09-22T13:24:02.410655","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_847"},{"applicability_rule_id":2147483654,"name":"spent > 400 at Shopping Cloathing and Acessories in last 30 days","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.l2cat110500.amt30d"},"right_value":{"type":"fixed","value":"400","variable_type":"int"}}],"updated_at":"2022-10-15T13:24:13.289611","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_2147483654"}],"shadow":false,"requires_etls":["l2cat110500.amt30d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37212},{"promotion_id":"10409","name":"inf_impulse_3_day_rule_b","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"As compras por impulso podem - e devem- ser evitadas para o bem da sua saúde financeira.<br /><br />E estou falando não apenas das compras físicas, mas das compras online também. <br /><br />Para evitar isso, sugiro a <b>técnica dos 3 dias</b> 👀\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Nos últimos 30 dias você gastou <b><var>=currency(rvars.agg.l1cat110000.amt30d)</var> </b>em compras.\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"As compras por impulso podem - e devem- ser evitadas para o bem da sua saúde financeira.<br /><br />E estou falando não apenas das compras físicas, mas das compras online também. <br /><br />Para evitar isso, sugiro a <b>técnica dos 3 dias</b> 👀","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer conhecer essa técnica?\"}}","main_text_body":"Nos últimos 30 dias você gastou <b><var>=currency(rvars.agg.l1cat110000.amt30d)</var> </b>em compras.","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer conhecer essa técnica?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero ver depois\",\"response\":\"Beleza, nos falamos depois! 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"É assim: quando quiser fazer uma compra, seja ela qual for, pense sobre o assunto durante 3 dias!<br /><br />Assim você tem tempo para analisar se aquele item realmente vai ser útil.<br /><br />Que tal aplicar essa técnica já na sua próxima compra?! 🤓💡\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Já conheço!\",\"response\":\"Tá bom! Só não esquece de colocar em prática 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Quero ver depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Já conheço!","user_option_delayed_response":"Beleza, nos falamos depois! 😉","user_option_engaged_response":"É assim: quando quiser fazer uma compra, seja ela qual for, pense sobre o assunto durante 3 dias!<br /><br />Assim você tem tempo para analisar se aquele item realmente vai ser útil.<br /><br />Que tal aplicar essa técnica já na sua próxima compra?! 🤓💡","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Tá bom! Só não esquece de colocar em prática 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-23T18:43:37.762Z","end_date":"2053-01-19T14:23:08.696Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:23:08.822Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":6,"profile_group_id":14,"previous_version":5,"convo_header":{"type":"default","barrier":"Mostrar a técnica das 72h.","behavior":"Fazer com que o usuário reflita sobre as suas compras e não as faça de modo impulsivo.","benefits":"Reduzir gastos impulsivos.","cooldown":"0","feed_cta":"vamos!","feed_body":"Boa parte das nossas compras são feitas por impulso. Vamos conversar sobre isso? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"economia","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"847,2147483655","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat110000.amt30d","type":"rvars","value":"1533","data_type":""}],"etl_aggregations":[{"etl_aggregation_id":"544","etl_aggregation_name":"L1 Category Shopping 30 Days Sum Amount","rvar_object":"l1cat110000","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"$valid_transactions":true,"olivia_category_level1_id":110000},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":847,"name":"User has never seen or finished this convo","rule":[{"code":"    if (!hist) return 1;\n    const this_convo = hist[conversationName];\n    if (!this_convo) return 1;\n    if (!!this_convo.completed || !!this_convo.engaged || !!this_convo.delayed || !!this_convo.dismissed) return 0;\n    return 1;\n","type":"custom","description":"Return true if user never finished or engaged with this conversation before (Makes it a one-time conversation)"}],"updated_at":"2021-09-22T13:24:02.410655","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_847"},{"applicability_rule_id":2147483655,"name":"Spent > 400 at L1 Category Shopping in 30 Days","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.l1cat110000.amt30d"},"right_value":{"type":"fixed","value":"400","variable_type":"int"}}],"updated_at":"2022-10-15T13:34:37.959007","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_2147483655"}],"shadow":false,"requires_etls":["l1cat110000.amt30d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37218},{"promotion_id":"10410","name":"inf_insufficient_funds_for_payment","convo_template":"tpt_itau_insufficient_funds_for_payment","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Se não programou uma transferência, seria bom você cobrir esse valor 🧐\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Pelas minhas projeções, você tem um total de <b><var>=currency(ivars.temp_target_transactions.map(item => -item.amount).reduce((acc, item) => acc + item))</var></b> a vencer em <b><var>=ivars.temp_target_deadline</var> dias</b>:<br /><br /><var>=ivars.temp_target_transactions_description</var><br /><br />Seu saldo em conta pode ser  insuficiente para estes pagamentos.\"}}","content_body":"Se não programou uma transferência, seria bom você cobrir esse valor 🧐","notification":"Estou de olho no vencimento das suas contas mensais. Será que seu saldo é suficiente? 🔎 ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Pelas minhas projeções, você tem um total de <b><var>=currency(ivars.temp_target_transactions.map(item => -item.amount).reduce((acc, item) => acc + item))</var></b> a vencer em <b><var>=ivars.temp_target_deadline</var> dias</b>:<br /><br /><var>=ivars.temp_target_transactions_description</var><br /><br />Seu saldo em conta pode ser  insuficiente para estes pagamentos.","user_engaged_link":"","external_link_body":"","external_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-26T21:56:36.424Z","end_date":"2053-01-19T14:24:10.136Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:24:10.224Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":12,"profile_group_id":14,"previous_version":11,"convo_header":{"type":"alert","barrier":"Verificar os valores a vencer em sua conta e fazer as contas para o usuário.","behavior":"Fazer com que o usuário tenha consciência de suas contas a vencer e se programe para não pagar juros.","benefits":"Não deixar que o usuário fique com saldo negativo em sua conta.","cooldown":"0","feed_cta":"quero ver","feed_body":"Não quero que você fique no negativo. Vamos dar uma olhada nas contas que estão pra vencer?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"contas mensais","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"0","cooldownEngaged":"0","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"0","notification_type":"insight","cooldownFrustrated":"0","cooldownInteracted":"0","cooldownThumbsDown":"0","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"817","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"insufficient_funds_for_payment_historic","type":"ivars","value":[],"data_type":"json"},{"name":"profile_overview_panel_section.future_spending.transactions","type":"dat","value":[{"date":"2021-12-30","actual":false,"amount":-363.51,"enabled":true,"pending":false,"category":10500,"description":"DA Vivo","data_source_id":"3","transaction_id":"606e2437182c09001deaed43","account_type_id":100},{"date":"2021-12-30","actual":false,"amount":-400.31,"enabled":true,"pending":false,"category":10500,"description":"DA NA","data_source_id":"3","transaction_id":"606e2437182c09001deaed45","account_type_id":100}],"data_type":"json"},{"name":"profile_overview_panel_section.balances.checking.account_type_balance","type":"dat","value":"0","data_type":"number"}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":817,"name":"Has Insufficient Funds for Payment in 4 Days","rule":[{"code":"    if (!dat\n        || !dat.profile_overview_panel_section\n        || !dat.profile_overview_panel_section.future_spending\n        || !dat.profile_overview_panel_section.future_spending.transactions\n        || !dat.profile_overview_panel_section.balances\n        || !dat.profile_overview_panel_section.balances.checking\n        || dat.profile_overview_panel_section.balances.checking.account_type_balance == null) return false;\n\n    const all_transactions = dat.profile_overview_panel_section.future_spending.transactions;\n    const moment = require('moment');\n    var target_transactions = [];\n    var target_deadline = 1;\n\n    for (target_deadline = 1; target_deadline <= 4; target_deadline++) {\n        if (target_transactions.length > 0) break;\n        const deadline = moment().add(target_deadline, 'day').format('YYYY-MM-DD');\n        target_transactions = all_transactions\n            .filter(t => !t.pending)\n            .filter(t => t.date === deadline)\n            .filter(t => t.account_type_id == 100)\n            .filter((t) => {\n                if (!!ivars.insufficient_funds_for_payment_historic\n                    && ivars.insufficient_funds_for_payment_historic.some((hist) => hist == t.transaction_id)) return false;\n                return true;\n            });\n    }\n\n    if (target_transactions.length < 1) return false;\n\n    const transactions_until_deadline = all_transactions.filter(t => !t.pending && moment(t.date).isBefore(moment().add(target_deadline, 'days').endOf('day')) && moment(t.date).isAfter(moment().startOf('day')));\n\n    const balance_until_deadline = transactions_until_deadline.map(item => item.amount).reduce((acc, item) => acc + item);\n    const current_balance = dat.profile_overview_panel_section.balances.checking.account_type_balance;\n\n    if (balance_until_deadline >= 0 || current_balance + balance_until_deadline >= 0) return false;\n\n    return true;\n","type":"custom","description":"Check if there are insufficient funds for bills coming in 4 days"}],"updated_at":"2021-12-29T13:43:34.650455","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_817"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37226},{"promotion_id":"10414","name":"inf_self_comparison_higher_expenses","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"<b><var>=currency(context.currentSession.svars.period_amounts[0])</var></b> foi seu gasto na categoria de <var>=context.currentSession.svars.category_name</var><br /><br /><b><var>=currency(context.currentSession.svars.diff_amount)</var></b> foi o que você gastou a <b>mais</b> do que a média dos últimos 3 meses\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Fiz uma análise dos <b>primeiros 15 dias de <var>=context.currentSession.svars.period_months[0]</var></b>, te mostro:\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"<b><var>=currency(context.currentSession.svars.period_amounts[0])</var></b> foi seu gasto na categoria de <var>=context.currentSession.svars.category_name</var><br /><br /><b><var>=currency(context.currentSession.svars.diff_amount)</var></b> foi o que você gastou a <b>mais</b> do que a média dos últimos 3 meses","notification":"Tenho dados pra te mostrar sobre seus gastos na categoria de <var>=category(formulas.conversation_specific_function()).full_name</var> ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer ver um comparativo mês a mês?\"}}","main_text_body":"Fiz uma análise dos <b>primeiros 15 dias de <var>=context.currentSession.svars.period_months[0]</var></b>, te mostro:","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer ver um comparativo mês a mês?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Beleza, eu volto em breve para a gente falar sobre isso!\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Vamos lá<br /><br />Na <b>1ª quinzena</b> de cada mês, você gastou:<br /><b><var>=context.currentSession.svars.period_months[1]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[1])</var><br /><b><var>=context.currentSession.svars.period_months[2]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[2])</var><br /><b><var>=context.currentSession.svars.period_months[3]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[3])</var><br /><br />Agora é monitorar e avaliar se esse aumento de gastos poderia ter sido evitado – subida de preço não entra aqui, é claro<br /><br />No mais, foco na economia!\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não precisa, valeu\",\"response\":\"Tudo bem, vou buscar outros assuntos pra você\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não precisa, valeu","user_option_delayed_response":"Beleza, eu volto em breve para a gente falar sobre isso!","user_option_engaged_response":"Vamos lá<br /><br />Na <b>1ª quinzena</b> de cada mês, você gastou:<br /><b><var>=context.currentSession.svars.period_months[1]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[1])</var><br /><b><var>=context.currentSession.svars.period_months[2]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[2])</var><br /><b><var>=context.currentSession.svars.period_months[3]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[3])</var><br /><br />Agora é monitorar e avaliar se esse aumento de gastos poderia ter sido evitado – subida de preço não entra aqui, é claro<br /><br />No mais, foco na economia!","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Tudo bem, vou buscar outros assuntos pra você","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-09-22T18:43:23.069Z","end_date":"2053-01-19T14:28:58.598Z","validation_ids":[],"cooldown_groups":["itau_self_comparison_expenses"],"updated_at":"2023-01-19T14:28:58.687Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":27,"profile_group_id":14,"previous_version":26,"convo_header":{"type":"default","barrier":"A Olivia faz as contas do mês atual e compara com os meses anteriores","behavior":"Fazer com que o usuário tenha consciência dos seus gastos por categoria","benefits":"Fazer com que o usuário controle seus gastos e não aumente seu orçamento","cooldown":"720","feed_cta":"vamos!","feed_body":"Vamos avaliar seu padrão de gastos na categoria de [=category(formulas.conversation_specific_function()).full_name] e monitorar isso?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"gastos por categoria","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"720","localHoursValid":"","review_settings":"simple","expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"1440","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"720","cooldownThumbsDown":"2880","sharedCooldownGroup":"itau_self_comparison_expenses","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"857","cooldown_groups_merged":"true","session_variables_code":"    const moment = require('moment');\n    const { category } = formulas;\n\n    const CATEGORIES = [\n        115000, // Groceries\n        60000, // Food & Drink\n        1000014, // Pets\n        70300, // Healthcare/Pharmacy\n    ];\n\n\n    // const AGGREGATION = {\n    //    115000: rvars.agg.l1cat115000.sum15days4months,\n    //    60000: rvars.agg.l1cat60000.sum15days4months,\n    //    1000014: rvars.agg.l1cat1000014.sum15days4months,\n    //   70300: rvars.agg.l2cat70300.sum15days4months\n    // };\n\n    // usando etl que filtra cartões\n    const AGGREGATION = {\n        115000: rvars.agg.l1cat115000.sum15days4monthswithoutcreditcard,\n        60000: rvars.agg.l1cat60000.sum15days4monthswithoutcreditcard,\n        1000014: rvars.agg.l1cat1000014.sum15days4monthswithoutcreditcard,\n        70300: rvars.agg.l2cat70300.sum15days4monthswithoutcreditcard\n    };\n\n    const MONTHS = [\n        'current_month',\n        '1_month_ago',\n        '2_month_ago',\n        '3_month_ago'\n    ]\n\n    const tally = {};\n\n    for (const category of CATEGORIES) {\n        tally[category] = {};\n        tally[category]['enable'] = true;\n        for (const month of MONTHS) {\n            if (!(AGGREGATION[category][month] > 0)) tally[category]['enable'] = false;\n        }\n    }\n\n    // Check if there is at least one category that attends the higher expenses criteria\n    const enabled_categories = [];\n    for (const category of CATEGORIES) {\n        if (tally[category]['enable']) {\n            const period_amounts = MONTHS.map((m) => AGGREGATION[category][m]);\n            const past_expenses = period_amounts.slice(1);\n            const avg_amount = past_expenses.reduce((acc, item) => acc + item) / 3;\n\n            // Applicable if current amount > 3% of average\n            if (period_amounts[0] > avg_amount * 1.03) {\n                enabled_categories.push(category);\n            }\n        }\n    }\n    if (enabled_categories.length == 0) {\n        return {};\n    }\n\n    // Randomly selecting the conversation category:\n    // context.localMoment should be fixed while generating both session and push notification\n    // so this should be a 'fixed' way of making it random in the sense of generating pushes\n    // as well as synching with svars\n    const random_seed = moment(context.localMoment).format('x') % enabled_categories.length;\n    const random_category = enabled_categories[random_seed];\n\n    const period_amounts = MONTHS.map((m) => AGGREGATION[random_category][m]);\n    const period_months = [0, 1, 2, 3].map((months_ago) => moment().startOf('month').subtract(months_ago, 'month').locale('pt-BR').format('MMMM'));\n\n    // Exclude this month's expenses\n    const past_expenses = period_amounts.slice(1);\n    const avg_amount = past_expenses.reduce((acc, item) => acc + item) / 3;\n\n    const diff_amount = Math.abs(period_amounts[0] - avg_amount);\n\n    const category_name = category(random_category).full_name;\n\n    return {\n        period_amounts,\n        period_months,\n        diff_amount,\n        category_name\n    };\n","session_variables_enabled":"true","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"itau_self_comparison_expenses","notification_cooldown_groups_merged":"true","tags":["self comparison"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat60000.sum15days4months","type":"rvars","value":{"1_month_ago":103,"2_month_ago":102,"3_month_ago":101,"current_month":300},"data_type":"json"},{"name":"agg.l1cat115000.sum15days4months","type":"rvars","value":{"1_month_ago":0,"2_month_ago":0,"3_month_ago":0,"current_month":0},"data_type":"json"},{"name":"agg.l1cat1000014.sum15days4months","type":"rvars","value":{"1_month_ago":0,"2_month_ago":0,"3_month_ago":0,"current_month":0},"data_type":"json"},{"name":"agg.l2cat70300.sum15days4months","type":"rvars","value":{"1_month_ago":0,"2_month_ago":0,"3_month_ago":0,"current_month":0},"data_type":"json"}],"etl_aggregations":[{"etl_aggregation_id":"773","etl_aggregation_name":"L1 Category Groceries 15 Days/4 months Sum Amount","rvar_object":"l1cat115000","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level1_id === 115000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Groceries 15 Days/4 months Sum Amount","invert_value":true},"updated_at":"2021-10-21T18:01:30.677Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"842","etl_aggregation_name":"L1 Category Food & Drink 15 Days/4 months Sum Amount","rvar_object":"l1cat60000","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level1_id === 60000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Food & Drink 15 Days/4 months Sum Amount","invert_value":true},"updated_at":"2021-09-30T17:16:51.438Z","updated_by":"leal@olivia.ai"},{"etl_aggregation_id":"845","etl_aggregation_name":"L1 Category Pets 15 Days/4 months Sum Amount","rvar_object":"l1cat1000014","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level1_id === 1000014 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Pets 15 Days/4 months Sum Amount","invert_value":true},"updated_at":"2021-10-11T19:38:54.016Z","updated_by":"leal@olivia.ai"},{"etl_aggregation_id":"844","etl_aggregation_name":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount","rvar_object":"l2cat70300","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level2_id === 70300 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount","invert_value":true},"updated_at":"2021-09-30T17:16:51.438Z","updated_by":"leal@olivia.ai"},{"etl_aggregation_id":"2147483649","etl_aggregation_name":"L1 Category Groceries 15 Days/4 months Sum Amount without creditcard","rvar_object":"l1cat115000","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level1_id === 115000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Groceries 15 Days/4 months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:47:34.044Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483650","etl_aggregation_name":"L1 Category Food & Drink 15 Days/4 months Sum Amount without creditcard","rvar_object":"l1cat60000","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level1_id === 60000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Food & Drink 15 Days/4 months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:51:43.505Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483651","etl_aggregation_name":"L1 Category Pets 15 Days/4 months Sum Amount without creditcard","rvar_object":"l1cat1000014","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level1_id === 1000014 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Pets 15 Days/4 months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:56:38.616Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483652","etl_aggregation_name":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount without creditcard","rvar_object":"l2cat70300","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level2_id === 70300 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:59:20.661Z","updated_by":"leonardo-flavio.santos@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":857,"name":"Itau Self Comparison Higher Expenses","rule":[{"code":"    // Sanity checks\n    if (!rvars\n        || !rvars.agg\n        || !rvars.agg.l1cat115000\n        || !rvars.agg.l1cat60000\n        || !rvars.agg.l1cat1000014\n        || !rvars.agg.l2cat70300\n        || !rvars.agg.l1cat115000.sum15days4months\n        || !rvars.agg.l1cat60000.sum15days4months\n        || !rvars.agg.l1cat1000014.sum15days4months\n        || !rvars.agg.l2cat70300.sum15days4months) return 0;\n\n    // Only applicable day 18\n    const moment = require('moment');\n    if (moment().date() != 18) return 0;\n\n    const CATEGORIES = [\n        115000, // Groceries\n        60000, // Food & Drink\n        1000014, // Pets\n        70300, // Healthcare/Pharmacy\n    ];\n\n    const AGGREGATION = {\n        115000: rvars.agg.l1cat115000.sum15days4months,\n        60000: rvars.agg.l1cat60000.sum15days4months,\n        1000014: rvars.agg.l1cat1000014.sum15days4months,\n        70300: rvars.agg.l2cat70300.sum15days4months\n    };\n\n    const MONTHS = [\n        'current_month',\n        '1_month_ago',\n        '2_month_ago',\n        '3_month_ago'\n    ]\n\n    const tally = {};\n\n    for (const category of CATEGORIES) {\n        tally[category] = {};\n        tally[category]['enable'] = true;\n        for (const month of MONTHS) {\n            if (!(AGGREGATION[category][month] > 0)) tally[category]['enable'] = false;\n        }\n    }\n\n    // Check if there is at least one category that attends the higher expenses criteria\n    for (const category of CATEGORIES) {\n        if (tally[category]['enable']) {\n            const period_amounts = MONTHS.map((m) => AGGREGATION[category][m]);\n            const past_expenses = period_amounts.slice(1);\n            const avg_amount = past_expenses.reduce((acc, item) => acc + item) / 3;\n\n            // Applicable if current amount > 3% of average\n            if (period_amounts[0] > avg_amount * 1.03) {\n                return 1;\n            }\n        }\n    }\n\n    return 0;\n","type":"custom","description":""}],"updated_at":"2021-12-22T12:34:15.30321","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_857"}],"shadow":false,"requires_etls":["l1cat115000.sum15days4months","l1cat60000.sum15days4months","l1cat1000014.sum15days4months","l2cat70300.sum15days4months","l1cat115000.sum15days4monthswithoutcreditcard","l1cat60000.sum15days4monthswithoutcreditcard","l1cat1000014.sum15days4monthswithoutcreditcard","l2cat70300.sum15days4monthswithoutcreditcard"],"conversation_group":"convos_itau_app_users","conversation_map_id":37227},{"promotion_id":"10415","name":"inf_self_comparison_lower_expenses","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"<b><var>=currency(context.currentSession.svars.period_amounts[0])</var></b> foi seu gasto na categoria de <var>=context.currentSession.svars.category_name</var><br /><br /><b><var>=currency(context.currentSession.svars.diff_amount)</var></b> foi o que você gastou a <b>menos</b> do que a média dos últimos 3 meses\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Fiz uma análise dos <b>primeiros 15 dias de <var>=context.currentSession.svars.period_months[0]</var></b>, te mostro:\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"<b><var>=currency(context.currentSession.svars.period_amounts[0])</var></b> foi seu gasto na categoria de <var>=context.currentSession.svars.category_name</var><br /><br /><b><var>=currency(context.currentSession.svars.diff_amount)</var></b> foi o que você gastou a <b>menos</b> do que a média dos últimos 3 meses","notification":"Tenho dados pra te mostrar sobre seus gastos na categoria de <var>=category(formulas.conversation_specific_function()).full_name</var> ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer ver um comparativo mês a mês?\"}}","main_text_body":"Fiz uma análise dos <b>primeiros 15 dias de <var>=context.currentSession.svars.period_months[0]</var></b>, te mostro:","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer ver um comparativo mês a mês?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Beleza, eu volto em breve para a gente falar sobre isso!\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Vamos lá<br /><br />Na <b>1ª quinzena</b> de cada mês, você gastou:<br /><b><var>=context.currentSession.svars.period_months[1]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[1])</var><br /><b><var>=context.currentSession.svars.period_months[2]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[2])</var><br /><b><var>=context.currentSession.svars.period_months[3]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[3])</var><br /><br />Tente manter esse ritmo!<br /><br />Acompanhar os seus gastos é importante para controlar o orçamento\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não precisa, valeu\",\"response\":\"Tudo bem, vou buscar outros assuntos pra você\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não precisa, valeu","user_option_delayed_response":"Beleza, eu volto em breve para a gente falar sobre isso!","user_option_engaged_response":"Vamos lá<br /><br />Na <b>1ª quinzena</b> de cada mês, você gastou:<br /><b><var>=context.currentSession.svars.period_months[1]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[1])</var><br /><b><var>=context.currentSession.svars.period_months[2]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[2])</var><br /><b><var>=context.currentSession.svars.period_months[3]</var></b> - <var>=currency(context.currentSession.svars.period_amounts[3])</var><br /><br />Tente manter esse ritmo!<br /><br />Acompanhar os seus gastos é importante para controlar o orçamento","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Tudo bem, vou buscar outros assuntos pra você","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-09-22T19:24:59.785Z","end_date":"2053-01-19T14:29:32.140Z","validation_ids":[],"cooldown_groups":["itau_self_comparison_expenses"],"updated_at":"2023-01-19T14:29:32.219Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":8,"profile_group_id":14,"previous_version":7,"convo_header":{"type":"default","barrier":"A Olivia faz as contas do mês atual e compara com os meses anteriores","behavior":"Fazer com que o usuário tenha consciência dos seus gastos por categoria","benefits":"Fazer com que o usuário continue controlando os seus gastos","cooldown":"720","feed_cta":"vamos!","feed_body":"Vamos avaliar seu padrão de gastos na categoria de [=category(formulas.conversation_specific_function()).full_name] e monitorar isso?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"gastos por categoria","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"720","localHoursValid":"","review_settings":"simple","expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"1440","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"720","cooldownThumbsDown":"2880","sharedCooldownGroup":"itau_self_comparison_expenses","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"861","cooldown_groups_merged":"true","session_variables_code":"    const moment = require('moment');\n    const { category } = formulas;\n\n    const CATEGORIES = [\n        115000, // Groceries\n        60000, // Food & Drink\n        1000014, // Pets\n        70300, // Healthcare/Pharmacy\n    ];\n\n    // usando etl que filtra cartões\n    const AGGREGATION = {\n        115000: rvars.agg.l1cat115000.sum15days4monthswithoutcreditcard,\n        60000: rvars.agg.l1cat60000.sum15days4monthswithoutcreditcard,\n        1000014: rvars.agg.l1cat1000014.sum15days4monthswithoutcreditcard,\n        70300: rvars.agg.l2cat70300.sum15days4monthswithoutcreditcard\n    };\n\n    const MONTHS = [\n        'current_month',\n        '1_month_ago',\n        '2_month_ago',\n        '3_month_ago'\n    ]\n\n    const tally = {};\n\n    for (const category of CATEGORIES) {\n        tally[category] = {};\n        tally[category]['enable'] = true;\n        for (const month of MONTHS) {\n            if (!(AGGREGATION[category][month] > 0)) tally[category]['enable'] = false;\n        }\n    }\n\n    // Check if there is at least one category that attends the higher expenses criteria\n    const enabled_categories = [];\n    for (const category of CATEGORIES) {\n        if (tally[category]['enable']) {\n            const period_amounts = MONTHS.map((m) => AGGREGATION[category][m]);\n            const past_expenses = period_amounts.slice(1);\n            const avg_amount = past_expenses.reduce((acc, item) => acc + item) / 3;\n\n            // Applicable if current amount < 97% of average\n            if (period_amounts[0] < avg_amount * 0.97) {\n                enabled_categories.push(category);\n            }\n        }\n    }\n\n    if (enabled_categories.length == 0) {\n        return {};\n    }\n\n    // Randomly selecting the conversation category:\n    // context.localMoment should be fixed while generating both session and push notification\n    // so this should be a 'fixed' way of making it random in the sense of generating pushes\n    // as well as synching with svars\n    const random_seed = moment(context.localMoment).format('x') % enabled_categories.length;\n    const random_category = enabled_categories[random_seed];\n\n    const period_amounts = MONTHS.map((m) => AGGREGATION[random_category][m]);\n    const period_months = [0, 1, 2, 3].map((months_ago) => moment().startOf('month').subtract(months_ago, 'month').locale('pt-BR').format('MMMM'));\n\n    // Exclude this month's expenses\n    const past_expenses = period_amounts.slice(1);\n    const avg_amount = past_expenses.reduce((acc, item) => acc + item) / 3;\n\n    const diff_amount = Math.abs(period_amounts[0] - avg_amount);\n\n    const category_name = category(random_category).full_name;\n\n    return {\n        period_amounts,\n        period_months,\n        diff_amount,\n        category_name\n    };\n","session_variables_enabled":"true","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"itau_self_comparison_expenses","notification_cooldown_groups_merged":"true","tags":["self comparison"]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l1cat60000.sum15days4months","type":"rvars","value":{"1_month_ago":103,"2_month_ago":102,"3_month_ago":101,"current_month":96},"data_type":"json"},{"name":"agg.l1cat115000.sum15days4months","type":"rvars","value":{"1_month_ago":0,"2_month_ago":0,"3_month_ago":0,"current_month":0},"data_type":"json"},{"name":"agg.l1cat1000014.sum15days4months","type":"rvars","value":{"1_month_ago":0,"2_month_ago":0,"3_month_ago":0,"current_month":0},"data_type":"json"},{"name":"agg.l2cat70300.sum15days4months","type":"rvars","value":{"1_month_ago":0,"2_month_ago":0,"3_month_ago":0,"current_month":0},"data_type":"json"}],"etl_aggregations":[{"etl_aggregation_id":"2147483649","etl_aggregation_name":"L1 Category Groceries 15 Days/4 months Sum Amount without creditcard","rvar_object":"l1cat115000","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level1_id === 115000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Groceries 15 Days/4 months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:47:34.044Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483650","etl_aggregation_name":"L1 Category Food & Drink 15 Days/4 months Sum Amount without creditcard","rvar_object":"l1cat60000","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level1_id === 60000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Food & Drink 15 Days/4 months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:51:43.505Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483651","etl_aggregation_name":"L1 Category Pets 15 Days/4 months Sum Amount without creditcard","rvar_object":"l1cat1000014","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level1_id === 1000014 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Pets 15 Days/4 months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:56:38.616Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483652","etl_aggregation_name":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount without creditcard","rvar_object":"l2cat70300","rvar_variable":"sum15days4monthswithoutcreditcard","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.account_type_id != 200 &&\n            t.olivia_category_level2_id === 70300 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount without creditcard","invert_value":true},"updated_at":"2022-12-22T13:59:20.661Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"773","etl_aggregation_name":"L1 Category Groceries 15 Days/4 months Sum Amount","rvar_object":"l1cat115000","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level1_id === 115000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Groceries 15 Days/4 months Sum Amount","invert_value":true},"updated_at":"2021-10-21T18:01:30.677Z","updated_by":"ivanir@olivia.ai"},{"etl_aggregation_id":"842","etl_aggregation_name":"L1 Category Food & Drink 15 Days/4 months Sum Amount","rvar_object":"l1cat60000","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level1_id === 60000 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Food & Drink 15 Days/4 months Sum Amount","invert_value":true},"updated_at":"2021-09-30T17:16:51.438Z","updated_by":"leal@olivia.ai"},{"etl_aggregation_id":"845","etl_aggregation_name":"L1 Category Pets 15 Days/4 months Sum Amount","rvar_object":"l1cat1000014","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level1_id === 1000014 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L1 Category Pets 15 Days/4 months Sum Amount","invert_value":true},"updated_at":"2021-10-11T19:38:54.016Z","updated_by":"leal@olivia.ai"},{"etl_aggregation_id":"844","etl_aggregation_name":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount","rvar_object":"l2cat70300","rvar_variable":"sum15days4months","rule":{"code":"    const moment = require('moment');\n    const _ = require('lodash');\n\n    const getTransactionsSumFromPeriod = (periodsAgo) => {\n        const startDate = moment().startOf('month').subtract(periodsAgo, 'month');\n        const endDate = moment(startDate).add(14, 'day').endOf('day');\n\n        return -_.sumBy(transactions.filter(t => (\n            t.olivia_category_level2_id === 70300 &&\n            t.date >= startDate &&\n            t.date <= endDate\n        )), 'amount');\n    }\n\n    return {\n        current_month: getTransactionsSumFromPeriod(0),\n        '1_month_ago': getTransactionsSumFromPeriod(1),\n        '2_month_ago': getTransactionsSumFromPeriod(2),\n        '3_month_ago': getTransactionsSumFromPeriod(3),\n    }\n","type":"custom","filter":{"$valid_transactions":true},"description":"L2 Category Healthcare/Pharmacy 15 Days/4months Sum Amount","invert_value":true},"updated_at":"2021-09-30T17:16:51.438Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":861,"name":"Itau Self Comparison Lower Expenses","rule":[{"code":"    // Sanity checks\n    if (!rvars\n        || !rvars.agg\n        || !rvars.agg.l1cat115000\n        || !rvars.agg.l1cat60000\n        || !rvars.agg.l1cat1000014\n        || !rvars.agg.l2cat70300\n        || !rvars.agg.l1cat115000.sum15days4months\n        || !rvars.agg.l1cat60000.sum15days4months\n        || !rvars.agg.l1cat1000014.sum15days4months\n        || !rvars.agg.l2cat70300.sum15days4months) return 0;\n\n    // Only applicable day 18\n    const moment = require('moment');\n    if (moment().date() != 18) return 0;\n\n    const CATEGORIES = [\n        115000, // Groceries\n        60000, // Food & Drink\n        1000014, // Pets\n        70300, // Healthcare/Pharmacy\n    ];\n\n    const AGGREGATION = {\n        115000: rvars.agg.l1cat115000.sum15days4months,\n        60000: rvars.agg.l1cat60000.sum15days4months,\n        1000014: rvars.agg.l1cat1000014.sum15days4months,\n        70300: rvars.agg.l2cat70300.sum15days4months\n    };\n\n    const MONTHS = [\n        'current_month',\n        '1_month_ago',\n        '2_month_ago',\n        '3_month_ago'\n    ]\n\n    const tally = {};\n\n    for (const category of CATEGORIES) {\n        tally[category] = {};\n        tally[category]['enable'] = true;\n        for (const month of MONTHS) {\n            if (!(AGGREGATION[category][month] > 0)) tally[category]['enable'] = false;\n        }\n    }\n\n    // Check if there is at least one category that attends the higher expenses criteria\n    for (const category of CATEGORIES) {\n        if (tally[category]['enable']) {\n            const period_amounts = MONTHS.map((m) => AGGREGATION[category][m]);\n            const past_expenses = period_amounts.slice(1);\n            const avg_amount = past_expenses.reduce((acc, item) => acc + item) / 3;\n\n            // Applicable if current amount < 97% of average\n            if (period_amounts[0] < avg_amount * 0.97) {\n                return 1;\n            }\n        }\n    }\n\n    return 0;\n","type":"custom","description":""}],"updated_at":"2021-11-18T19:30:37.994346","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_861"}],"shadow":false,"requires_etls":["l1cat115000.sum15days4monthswithoutcreditcard","l1cat60000.sum15days4monthswithoutcreditcard","l1cat1000014.sum15days4monthswithoutcreditcard","l2cat70300.sum15days4monthswithoutcreditcard","l1cat115000.sum15days4months","l1cat60000.sum15days4months","l1cat1000014.sum15days4months","l2cat70300.sum15days4months"],"conversation_group":"convos_itau_app_users","conversation_map_id":37199},{"promotion_id":"10416","name":"inf_tipos_gastos","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"<b>Fixos</b> são gastos pagos todo mês —  contas de condomínio, luz, água, academia, assinaturas de streaming, empréstimos…<br /><br />O valor pode variar a cada mês, mas são contas <b>recorrentes</b> e fazem parte do orçamento mensal\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Esta conversa é pra te contar como seus gastos serão mostrados por aqui<br /><br />Eles serão divididos em dois tipos, <b>fixos</b> e <b>variáveis</b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"<b>Fixos</b> são gastos pagos todo mês —  contas de condomínio, luz, água, academia, assinaturas de streaming, empréstimos…<br /><br />O valor pode variar a cada mês, mas são contas <b>recorrentes</b> e fazem parte do orçamento mensal","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber sobre os variáveis?\"}}","main_text_body":"Esta conversa é pra te contar como seus gastos serão mostrados por aqui<br /><br />Eles serão divididos em dois tipos, <b>fixos</b> e <b>variáveis</b>","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer saber sobre os variáveis?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Sem problemas! Em breve eu volto pra gente conversar mais\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero\",\"response\":\"<b>Variáveis</b> são gastos que nem sempre acontecem todo mês e que <b>você pode escolher não ter</b><br /><br />Por exemplo, gastos em restaurantes e compras não-essenciais — que, se quiser, você pode tentar cortar<br /><br />Agora que já falamos sobre os tipos de gastos, acompanhe em qual deles você costuma gastar mais<br /><br />Vamos monitorando e cuidando das suas contas\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não precisa, valeu\",\"response\":\"Sem problemas! Em breve eu volto com outros temas pra você\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Sim, quero","user_option_dismissed_body":"Não precisa, valeu","user_option_delayed_response":"Sem problemas! Em breve eu volto pra gente conversar mais","user_option_engaged_response":"<b>Variáveis</b> são gastos que nem sempre acontecem todo mês e que <b>você pode escolher não ter</b><br /><br />Por exemplo, gastos em restaurantes e compras não-essenciais — que, se quiser, você pode tentar cortar<br /><br />Agora que já falamos sobre os tipos de gastos, acompanhe em qual deles você costuma gastar mais<br /><br />Vamos monitorando e cuidando das suas contas","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Sem problemas! Em breve eu volto com outros temas pra você","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-09-14T17:27:01.032Z","end_date":"2053-01-19T14:31:19.844Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:31:19.935Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":8,"profile_group_id":14,"previous_version":7,"convo_header":{"type":"default","barrier":"Trazer a informação para o usuário sobre o que são gastos fixos e variáveis","behavior":"Fazer com que o usuário entenda como seus gastos estão sendo agrupados nos insights","benefits":"Trazer conhecimento para o usuário e deixar os insights mais claros","cooldown":"0","feed_cta":"vamos!","feed_body":"Você sabe a diferença entre gastos fixos e variáveis? Vamos conversar sobre isso?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","spec_summary":"Ajudar os usuários a entenderem os tipos de gastos que são mostrados nos insights","triggerGroup":"","feed_subtitle":"tipos de gastos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"99999","localHoursValid":"","review_settings":"simple","expected_savings":"low","once_interrupted":"false","right_assumption":"high","time_sensitivity":"high","cooldownDismissed":"99999","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"24","cooldownThumbsDown":"99999","spec_applicability":"O insight deve ser enfileirado para todos os usuários que viram a conversa de onboarding. Ele deve ser enfileirado apenas uma vez","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"855","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":855,"name":"Itau Tipos Gastos","rule":[{"code":"    if (!hist) return false;\n\n    if (!!hist.promo_ops_onboarding_welcome_beta_tester && hist.promo_ops_onboarding_welcome_beta_tester.completed) return true;\n    if (!!hist.promo_ops_onboarding_welcome_beta_tester_b && hist.promo_ops_onboarding_welcome_beta_tester_b.completed) return true;\n\n    return false;\n","type":"custom","description":"True if either onboarding is complete"}],"updated_at":"2021-09-17T18:46:18.504955","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_855"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37209},{"promotion_id":"10429","name":"not_engaged_users_expectation","convo_template":"tpt_itau_onboarding","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Então, conta pro meu time <b>por que não está vendo as nossas dicas?</b> É rapidinho ⌛\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vimos que você não tem acompanhado as dicas personalizadas que estamos te enviando… 😟\"}}","content_body":"Então, conta pro meu time <b>por que não está vendo as nossas dicas?</b> É rapidinho ⌛","content_link":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Vimos que você não tem acompanhado as dicas personalizadas que estamos te enviando… 😟","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"","user_option_engaged_feedback":"textinput","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-25T19:57:55.379Z","end_date":"2053-01-19T14:43:55.965Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:43:56.028Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":5,"profile_group_id":14,"previous_version":4,"convo_header":{"type":"default","barrier":"Solicitar o feedback de forma simples.","behavior":"Fazer com que o usuário dê o feedback sobre o motivo de usar pouco o Minhas Finanças.","benefits":"Melhorar o produto, de acordo com as principais necessidades do usuário.","cooldown":"4320","featured":false,"feed_cta":"conto sim!","feed_body":"Conta pra gente como podemos melhorar a sua experiência por aqui? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"vamos juntos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"1440","once_completed":"false","validation_ids":"","cooldownDelayed":"4320","cooldownEngaged":"4320","localHoursValid":"","expected_savings":"low","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"4320","notification_type":"insight","cooldownFrustrated":"4320","cooldownInteracted":"4320","cooldownThumbsDown":"4320","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"858","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["feedback"]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":858,"name":"Itau Not Engaged Users Expectation","rule":[{"code":"    const moment = require('moment');\n\n    const BLACKLIST = [\n        \"promo_alert_weekly_update\",\n        \"promo_inf_last_month_summary\"\n    ]\n\n    const mapped = {};\n    for (const conversation in hist) {\n        if (typeof hist[conversation] != 'object') continue;\n        if (BLACKLIST.includes(conversation)) continue;\n        if (!hist[conversation].last_engaged) continue;\n\n        mapped[conversation] = hist[conversation].last_engaged;\n    }\n\n    const recent_conversations = Object.values(mapped)\n        .map(last_engaged => (moment().diff(moment(last_engaged), 'months') > 0) ? 0 : 1)\n        .reduce((acc, item) => item + acc, 0);\n\n    return recent_conversations < 2;\n","type":"custom","description":"User only has seen up to 1 conversation in the last month"}],"updated_at":"2021-10-11T19:38:53.962277","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_858"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37239},{"promotion_id":"10430","name":"offer_melhor_plano_mobile_phone_pos","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"context.currentSession.svars = context.currentSession.svars || {}\\n\\nconst post_paid_frequent_expenses = rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \\\"POSPAGO\\\" || item.type === \\\"CONTROLE\\\") && item.transactions > 2);\\nconst post_paid_few_expenses = rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \\\"POSPAGO\\\" || item.type === \\\"CONTROLE\\\") && !(item.transactions > 2));\\n\\nconst post_paid_expenses_sum = post_paid_frequent_expenses.reduce((acc, item) => acc + item.average_spending, 0) + post_paid_few_expenses.reduce((acc, item) => acc + item.average_ticket, 0);\\n\\ncontext.currentSession.svars.post_paid_expenses = currency(-post_paid_expenses_sum);\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","close":"😉","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Tenho uma sugestão que poderia te ajudar a economizar\"}}","code_body":"context.currentSession.svars = context.currentSession.svars || {}\n\nconst post_paid_frequent_expenses = rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \"POSPAGO\" || item.type === \"CONTROLE\") && item.transactions > 2);\nconst post_paid_few_expenses = rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \"POSPAGO\" || item.type === \"CONTROLE\") && !(item.transactions > 2));\n\nconst post_paid_expenses_sum = post_paid_frequent_expenses.reduce((acc, item) => acc + item.average_spending, 0) + post_paid_few_expenses.reduce((acc, item) => acc + item.average_ticket, 0);\n\ncontext.currentSession.svars.post_paid_expenses = currency(-post_paid_expenses_sum);","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Olhei seus pagamentos de celular nos últimos 3 meses e você vem gastando em média <b><var>=context.currentSession.svars.post_paid_expenses</var></b> por mês no plano <b>pós-pago</b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Tenho uma sugestão que poderia te ajudar a economizar","notification":" ","explanation_1":"As operadoras estão sempre criando ofertas, algumas específicas para um determinado mês ou data comemorativa. Essas são boas oportunidades para economizar!","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","user_response":"Boa, Olivia!","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","introduction_1":"Dei uma olhada nos seus pagamentos de fatura de celular nos últimos 3 meses e sua média mensal de gastos nesse período foi <b><var>=currency((rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \"POSPAGO\" || item.type === \"CONTROLE\") && item.transactions > 2).reduce((acc, item) => acc + item.average_spending, 0) + rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \"POSPAGO\" || item.type === \"CONTROLE\") && !(item.transactions > 2)).reduce((acc, item) => acc + item.average_ticket, 0)) * -1)</var></b>","introduction_2":"","introduction_3":"Também vi que você possui plano <b>pós-pago</b>, por isso tenho uma sugestão que vai te ajudar a economizar","main_text_body":"Olhei seus pagamentos de celular nos últimos 3 meses e você vem gastando em média <b><var>=context.currentSession.svars.post_paid_expenses</var></b> por mês no plano <b>pós-pago</b>","notification_1":"Olá! <var>enc$user_first_name</var>, hora de economizar com a conta do celular! 🤑📲 ","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"https://melhorplano.net/planos-de-celular?t=mobilePostPaid&utm_source=parceria_apol&utm_medium=link&utm_campaign=itaú","challenge_sentence":"Também vi que seu plano é pós-pago, por isso tenho uma sugestão que vai te ajudar a economizar","dismissed_response":"Tudo bem, falamos outra hora!","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer saber mais?","disclaimer_optional":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver outra hora\",\"response\":\"Beleza! Depois eu volto pra gente falar sobre esse assunto 😊\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"As operadoras sempre criam ofertas para datas comemorativas, são boas oportunidades para economizar!<br />Planos com fidelidade oferecem mais benefícios e após 1 ano você pode mudar. Vale pesquisar no comparador <b>Melhor Plano</b> 👀<br />📌 E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\",\"link_text\":\"👉 Para pesquisar no site Melhor Plano, basta clicar aqui\",\"link\":\"https://melhorplano.net/planos-de-celular?t=mobilePostPaid&utm_source=parceria_apol&utm_medium=link&utm_campaign=itaú\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse, valeu\",\"response\":\"Sem problemas! Vou continuar por aqui, pensando em formas de te ajudar a cuidar das suas finanças 😊\",\"link_text\":\"\"}}","explanation_1_with_url":"Geralmente, o plano pós-pago é indicado para pessoas que usam muito o pacote de dados. É o seu caso? Você já deu uma olhada na sua conta pra ver se está usando tudo o que contratou?","explanation_2_optional":"Os planos com fidelidade oferecem mais benefícios do que os que não têm, mas fique de olho 👀 pois depois de 1 ano você sempre pode mudar de plano","explanation_2_with_url":"Minha sugestão é, de acordo com o seu consumo, checar se existem planos que atendam sua necessidade por um preço mais baixo","explanation_3_with_url":"Minha dica é procurar opções no site <u><font color=\"LINK_COLOR\">Melhor Plano</font></u>👈","information_1_with_url":"","information_2_with_url":"","information_3_with_url":"","introduction_2_Optional":"","user_afirmative_response":"","user_option_delayed_body":"Prefiro ver outra hora","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não tenho interesse, valeu","explanation_1_with_url_link":"","explanation_2_with_url_link":"","explanation_3_with_url_link":"https://melhorplano.net/planos-de-celular?utm_source=apol&utm_medium=link","user_option_delayed_response":"Beleza! Depois eu volto pra gente falar sobre esse assunto 😊","user_option_engaged_response":"As operadoras sempre criam ofertas para datas comemorativas, são boas oportunidades para economizar!<br />Planos com fidelidade oferecem mais benefícios e após 1 ano você pode mudar. Vale pesquisar no comparador <b>Melhor Plano</b> 👀<br />📌 E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","user_option_more_information":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Para pesquisar no site Melhor Plano, basta clicar aqui","user_option_dismissed_response":"Sem problemas! Vou continuar por aqui, pensando em formas de te ajudar a cuidar das suas finanças 😊","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-09T17:18:24.230Z","end_date":"2053-01-19T14:50:24.768Z","validation_ids":[],"cooldown_groups":["mobile_phone_offers"],"updated_at":"2023-01-19T14:50:24.828Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":8,"profile_group_id":14,"previous_version":7,"convo_header":{"type":"default","barrier":"Usuário ter informação correta e atualizada para sua necessidade e localidade","behavior":"Manter-se informado sobre planos de telefonia móvel para garantir que não se está pagando a mais","benefits":"Reduzir custo de telefonia móvel ou garantir que possui um plano com preço justo","cooldown":"0","feed_cta":"quero saber","feed_body":"Vi aqui quanto custa seu plano de celular e acho que você pode gastar menos com isso ","categories":"10300","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"Fiz as contas e vi que você pode pagar menos no plano do seu celular","triggerGroup":"","feed_subtitle":"gastos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"mobile_phone_offers","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"790,788","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["olivia partner"]},"visible":true,"deleted":false,"default_values":[{"name":"dl_mobile_phone_users","type":"rvars","value":{"companies":[{"type":"POSPAGO","company":"VIVO","confidence":1,"transactions":2,"average_ticket":-60,"total_spending":-40,"average_spending":-13.33},{"type":"POSPAGO","company":"OTHERS","confidence":0.5,"transactions":4,"average_ticket":-34.2075,"total_spending":-136.83,"average_spending":-45.61}],"timestamp":1629396415715,"updated_at":"2021-08-19T18:06:55.715Z"}}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":790,"name":" Mobile Plan Expenses 3 Month Average > 100","rule":[{"code":"if(!rvars\n  || !rvars.dl_mobile_phone_users\n  || !rvars.dl_mobile_phone_users.companies\n  || rvars.dl_mobile_phone_users.companies.length < 1) return false;\n\nconst pospago_average = rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \"POSPAGO\" || item.type === \"CONTROLE\") && item.transactions > 2).reduce((acc, item) => acc + item.average_spending, 0);\n\nconst pospago_ticket = rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \"POSPAGO\" || item.type === \"CONTROLE\") && !(item.transactions > 2)).reduce((acc, item) => acc + item.average_ticket, 0);\n\nconst prepago_average = rvars.dl_mobile_phone_users.companies.filter((item) => item.type === \"PREPAGO\" || item.type === \"DIGITAL\").reduce((acc, item) => acc + item.average_spending, 0);\n\nif(pospago_average + pospago_ticket + prepago_average <= -100) {\n  return true;\n}\n\nreturn false;","type":"custom","description":" Sum mobile plans and check total"}],"updated_at":"2021-04-01T18:17:12.648464","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_790"},{"applicability_rule_id":788,"name":"User has mobile postpaid plan","rule":[{"code":"if(!rvars\n  || !rvars.dl_mobile_phone_users\n  || !rvars.dl_mobile_phone_users.companies\n  || rvars.dl_mobile_phone_users.companies.length < 1) return false;\n\nfor(const i in rvars.dl_mobile_phone_users.companies) {\n  if(rvars.dl_mobile_phone_users.companies[i].type === \"POSPAGO\" || rvars.dl_mobile_phone_users.companies[i].type === \"CONTROLE\") {\n    return true;\n  }\n}\n\nreturn false;","type":"custom","description":"Check if any phone is postpaid"}],"updated_at":"2021-04-01T18:17:12.648464","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_788"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37171},{"promotion_id":"10432","name":"offer_melhor_plano_mobile_phone_pre","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"context.currentSession.svars = context.currentSession.svars || {}\\n\\nconst pre_paid_expenses = rvars.dl_mobile_phone_users.companies.filter((item) => item.type === \\\"PREPAGO\\\" || item.type === \\\"DIGITAL\\\");\\n\\nconst pre_paid_expenses_sum = pre_paid_expenses.reduce((acc, item) => acc + item.average_spending, 0);\\n\\nconst money_saved = 49 + pre_paid_expenses_sum;\\n\\nconst money_saved_year = 12 * money_saved;\\n\\ncontext.currentSession.svars.pre_paid_expenses = currency(-pre_paid_expenses_sum);\\ncontext.currentSession.svars.money_saved = currency(-money_saved);\\ncontext.currentSession.svars.money_saved_year = currency(-money_saved_year);\\n\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","close":"😉","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Tenho uma sugestão que poderia te ajudar a economizar\"}}","code_body":"context.currentSession.svars = context.currentSession.svars || {}\n\nconst pre_paid_expenses = rvars.dl_mobile_phone_users.companies.filter((item) => item.type === \"PREPAGO\" || item.type === \"DIGITAL\");\n\nconst pre_paid_expenses_sum = pre_paid_expenses.reduce((acc, item) => acc + item.average_spending, 0);\n\nconst money_saved = 49 + pre_paid_expenses_sum;\n\nconst money_saved_year = 12 * money_saved;\n\ncontext.currentSession.svars.pre_paid_expenses = currency(-pre_paid_expenses_sum);\ncontext.currentSession.svars.money_saved = currency(-money_saved);\ncontext.currentSession.svars.money_saved_year = currency(-money_saved_year);\n","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Olhei seus pagamentos de celular nos últimos 3 meses e você vem gastando em média <b><var>=context.currentSession.svars.pre_paid_expenses</var></b> por mês no plano <b>pré-pago</b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Tenho uma sugestão que poderia te ajudar a economizar","notification":" ","explanation_1":"Pelos meus cálculos, você poderia economizar <b><var>=currency((rvars.dl_mobile_phone_users.companies.filter((item) => item.type === \"PREPAGO\" || item.type === \"DIGITAL\").reduce((acc, item) => acc + item.average_spending, 0) * -1) - 49)</var></b> por mês com um Plano Controle que tem um custo mensal de R$ 49. Isso daria uma economia de <b><var>=currency(((rvars.dl_mobile_phone_users.companies.filter((item) => item.type === \"PREPAGO\" || item.type === \"DIGITAL\").reduce((acc, item) => acc + item.average_spending, 0) * -1) - 49) * 12)</var></b> ao ano! 🙅","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","user_response":"Boa, Olivia!","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","introduction_1":"Dei uma olhada nos seus pagamentos de fatura de celular nos últimos 3 meses e sua média mensal de gastos nesse período foi <b><var>=currency(rvars.dl_mobile_phone_users.companies.filter((item) => item.type === \"PREPAGO\" || item.type === \"DIGITAL\").reduce((acc, item) => acc + item.average_spending, 0) * -1)</var></b>","introduction_2":"introduction 2","introduction_3":"Também vi que seu plano é <b>pré-pago</b>, por isso tenho uma sugestão que vai te ajudar a economizar","main_text_body":"Olhei seus pagamentos de celular nos últimos 3 meses e você vem gastando em média <b><var>=context.currentSession.svars.pre_paid_expenses</var></b> por mês no plano <b>pré-pago</b>","notification_1":"Olá! <var>enc$user_first_name</var>, hora de economizar com a conta do celular! 🤑📲 ","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"https://melhorplano.net/planos-de-celular?t=mobileControle&utm_source=parceria_apol&utm_medium=link&utm_campaign=itaú","challenge_sentence":"Também vi que seu plano é pré-pago, por isso tenho uma sugestão que vai te ajudar a economizar","dismissed_response":"Tudo bem, falamos outra hora!","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer saber mais?","disclaimer_optional":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver outra hora\",\"response\":\"Beleza! Depois eu volto pra gente falar sobre esse assunto 😊\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Pelos meus cálculos, você poderia economizar <b><var>=context.currentSession.svars.money_saved</var> por mês</b> com um Plano Controle que tem um custo mensal de R$ 49. Isso daria uma economia de <b><var>=context.currentSession.svars.money_saved_year</var> ao ano</b>!<br /><br />Vale dar uma olhada 🧐 no comparador <b>Melhor Plano</b> e entender se existe um plano melhor para você<br /><br />📌 E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\",\"link_text\":\"👉 Para pesquisar no site Melhor Plano, basta clicar aqui\",\"link\":\"https://melhorplano.net/planos-de-celular?t=mobileControle&utm_source=parceria_apol&utm_medium=link&utm_campaign=itaú\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse, valeu\",\"response\":\"Sem problemas! Vou continuar por aqui, pensando em formas de te ajudar a cuidar das suas finanças 😊\",\"link_text\":\"\"}}","explanation_1_with_url":"O pré-pago é bom pra quem não usa muito o celular. Mas existem opções de pacote de dados que atendem à necessidade e custam menos","explanation_2_optional":"Então dê uma olhada 🧐 se não existe uma alternativa melhor para o seu caso","explanation_2_with_url":"Para diminuir os gastos, pequenos cortes são bem-vindos: R$ 10 de economia por mês já viram R$ 120 por ano! 🙅","explanation_3_with_url":"Minha dica é procurar opções no site <u><font color=\"LINK_COLOR\">Melhor Plano</font></u>👈","information_1_with_url":"information 1 w/ url","information_2_with_url":"information 2 w/ url","information_3_with_url":"information 3 w/ url","introduction_2_Optional":"","user_afirmative_response":"user affirmative response","user_option_delayed_body":"Prefiro ver outra hora","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não tenho interesse, valeu","explanation_1_with_url_link":"","explanation_2_with_url_link":"","explanation_3_with_url_link":"https://melhorplano.net/planos-de-celular?utm_source=apol&t=mobileControle&utm_medium=link","user_option_delayed_response":"Beleza! Depois eu volto pra gente falar sobre esse assunto 😊","user_option_engaged_response":"Pelos meus cálculos, você poderia economizar <b><var>=context.currentSession.svars.money_saved</var> por mês</b> com um Plano Controle que tem um custo mensal de R$ 49. Isso daria uma economia de <b><var>=context.currentSession.svars.money_saved_year</var> ao ano</b>!<br /><br />Vale dar uma olhada 🧐 no comparador <b>Melhor Plano</b> e entender se existe um plano melhor para você<br /><br />📌 E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","user_option_more_information":"user option more information","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Para pesquisar no site Melhor Plano, basta clicar aqui","user_option_dismissed_response":"Sem problemas! Vou continuar por aqui, pensando em formas de te ajudar a cuidar das suas finanças 😊","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-09T12:04:16.789Z","end_date":"2053-01-19T14:52:03.391Z","validation_ids":[],"cooldown_groups":["mobile_phone_offers"],"updated_at":"2023-01-19T14:52:03.447Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":14,"profile_group_id":14,"previous_version":13,"convo_header":{"type":"default","barrier":"Usuário ter informação correta e atualizada para sua necessidade e localidade","behavior":"Manter o usuário informado sobre planos de telefonia móvel para garantir que não está pagando a mais","benefits":"Reduzir custo de telefonia móvel ou garantir que possui um plano com preço justo","cooldown":"0","feed_cta":"quero saber","feed_body":"Vi aqui quanto custa seu plano de celular e acho que você pode gastar menos com isso ","categories":"10300","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"Já analisei aqui que você pode economizar com créditos para o seu celular","triggerGroup":"","feed_subtitle":"gastos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"mobile_phone_offers","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"791,789,787","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["olivia partner"]},"visible":true,"deleted":false,"default_values":[{"name":"dl_mobile_phone_users","type":"rvars","value":{"companies":[{"type":"PREPAGO","company":"VIVO","confidence":1,"transactions":2,"average_ticket":-20,"total_spending":-40,"average_spending":-13.33},{"type":"PREPAGO","company":"OTHERS","confidence":0.5,"transactions":4,"average_ticket":-34.2075,"total_spending":-136.83,"average_spending":-45.61}],"timestamp":1629396415715,"updated_at":"2021-08-19T18:06:55.715Z"}}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":791,"name":" Mobile Plan Expenses 3 Month Average > 60","rule":[{"code":"if(!rvars\n  || !rvars.dl_mobile_phone_users\n  || !rvars.dl_mobile_phone_users.companies\n  || rvars.dl_mobile_phone_users.companies.length < 1) return false;\n\nconst pospago_average = rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \"POSPAGO\" || item.type === \"CONTROLE\") && item.transactions > 2).reduce((acc, item) => acc + item.average_spending, 0);\n\nconst pospago_ticket = rvars.dl_mobile_phone_users.companies.filter((item) => (item.type === \"POSPAGO\" || item.type === \"CONTROLE\") && !(item.transactions > 2)).reduce((acc, item) => acc + item.average_ticket, 0);\n\nconst prepago_average = rvars.dl_mobile_phone_users.companies.filter((item) => item.type === \"PREPAGO\" || item.type === \"DIGITAL\").reduce((acc, item) => acc + item.average_spending, 0);\n\nif(pospago_average + pospago_ticket + prepago_average <= -60) {\n  return true;\n}\n\nreturn false;","type":"custom","description":" Sum mobile plans and check total"}],"updated_at":"2021-04-01T18:17:12.648464","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_791"},{"applicability_rule_id":789,"name":"User does not have mobile postpaid plan","rule":[{"code":"if(!rvars\n  || !rvars.dl_mobile_phone_users\n  || !rvars.dl_mobile_phone_users.companies\n  || rvars.dl_mobile_phone_users.companies.length < 1) return true;\n\nfor(const i in rvars.dl_mobile_phone_users.companies) {\n  if(rvars.dl_mobile_phone_users.companies[i].type === \"POSPAGO\" || rvars.dl_mobile_phone_users.companies[i].type === \"CONTROLE\") {\n    return false;\n  }\n}\n\nreturn true;","type":"custom","description":"Check if no phones are postpaid"}],"updated_at":"2021-04-01T18:17:12.648464","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_789"},{"applicability_rule_id":787,"name":"User has mobile prepaid plan","rule":[{"code":"if(!rvars\n  || !rvars.dl_mobile_phone_users\n  || !rvars.dl_mobile_phone_users.companies\n  || rvars.dl_mobile_phone_users.companies.length < 1) return false;\n\nfor(const i in rvars.dl_mobile_phone_users.companies) {\n  if(rvars.dl_mobile_phone_users.companies[i].type === \"PREPAGO\" || rvars.dl_mobile_phone_users.companies[i].type === \"DIGITAL\") {\n    return true;\n  }\n}\n\nreturn false;","type":"custom","description":"Check if any phone is prepaid"}],"updated_at":"2021-04-01T18:17:12.648464","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_787"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37178},{"promotion_id":"10433","name":"ops_feedback_new_insights","convo_template":"tpt_itau_onboarding","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Então, conta pra gente: <b>quais assuntos você gostaria de ver aqui?</b>\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Pro nosso papo ficar ainda melhor, queremos saber o que é importante <b>pra você</b>! 🤓\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Então, conta pra gente: <b>quais assuntos você gostaria de ver aqui?</b>","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Pro nosso papo ficar ainda melhor, queremos saber o que é importante <b>pra você</b>! 🤓","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-31T19:32:11.609Z","end_date":"2053-01-19T14:53:09.609Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-19T14:53:09.671Z","updated_by":"danielle.cataneo-souza@mailer.com.br","version":5,"profile_group_id":14,"previous_version":4,"convo_header":{"type":"default","barrier":"Solicitar de forma ativa o feedback aos usuários.","behavior":"Fazer com que o usuário dê feedback sobre quais tipos de insights ele gostaria de ver no Minhas Finanças.","benefits":"Melhorar o produto de insights do Minhas Finanças.","cooldown":"99999","featured":"false","feed_cta":"vou te contar","feed_body":"Qual tema da sua vida financeira você quer encontrar aqui? ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"vamos juntos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"low","cooldownQueued":"99999","once_completed":"false","validation_ids":"","cooldownDelayed":"99999","cooldownEngaged":"99999","localHoursValid":"","expected_savings":"medium","once_interrupted":"false","right_assumption":"high","time_sensitivity":"medium","cooldownDismissed":"99999","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"99999","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"99999","requiredConversations":"master","applicability_rule_ids":"848","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["feedback"]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":848,"name":"Itau Feedback New Insights","rule":[{"code":"    if (!!hist && Object.values(hist).length) {\n        const started_conversations = Object.values(hist).filter(value => (typeof value === 'object' && value.hasOwnProperty('last_time')))\n\n        if (started_conversations.length > 3) return true;\n    }\n\n    return false;\n","type":"custom","description":"Seen 4 conversations"}],"updated_at":"2021-09-02T16:48:53.6919","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_848"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37203},{"promotion_id":"10441","name":"inf_clothing_expenses","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","close":"Agora você já sabe que se estiver cansad<var>=gender('o','a')</var>, estressad<var>=gender('o','a')</var> ou também muito eufóric<var>=gender('o','a')</var>, deixe as compras para outro dia! 😉","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Se deixar levar pelas emoções nas compras é muito comum! Mas algumas técnicas simples podem ajudar a não cair nessa cilada!\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Nos últimos 3 meses, você gastou <b><var>=currency(rvars.agg.l2cat110500.amt90d)</var></b> em roupas e acessórios. Nos últimos 30 dias, esse gasto foi de <b><var>=currency(rvars.agg.l2cat110500.amt30d)</var></b>\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Se deixar levar pelas emoções nas compras é muito comum! Mas algumas técnicas simples podem ajudar a não cair nessa cilada!","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","user_response":"Boa, vou fazer isso!","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer ver dicas para economizar?\"}}","introduction_1":"Vi que você gastou em média <var>=percent(rvars.agg.l2cat110500.amt60d / rvars.agg.l1cat150000.amt60d)</var> na categoria de <b>Compras</b>. No último mês, esse gasto foi de <var>=currency(rvars.agg.l2cat110500.amt30d)</var>. Fiquei aqui pensando em quantas vezes você talvez já tenha comprado roupa ou sapato por estar estressad<var>=gender('o','a')</var> ou chatead<var>=gender('o','a')</var>? 🤭","introduction_2":"Se deixar levar pelas emoções nas compras é muito comum 😊  Mas algumas técnicas simples podem ajudar a não cair nessa cilada 🐍","main_text_body":"Nos últimos 3 meses, você gastou <b><var>=currency(rvars.agg.l2cat110500.amt90d)</var></b> em roupas e acessórios. Nos últimos 30 dias, esse gasto foi de <b><var>=currency(rvars.agg.l2cat110500.amt30d)</var></b>","notification_1":"Não caia na cilada de comprar roupas guiad<var>=gender('o','a')</var> pelas emoções 👚 👔 ","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","challenge_sentence":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer ver dicas para economizar?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver outra hora\",\"response\":\"Tudo bem! Depois eu volto pra gente falar sobre como fazer mais com o seu dinheiro\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Boa!<br /><br />Evite lançamentos ou coleções novas. Procure liquidações, outlets e ofertas<br /><br />Siga a regra do <b>entra 1, sai 1</b>: para uma peça entrar no guarda-roupa, outra tem que sair. Isso ajuda a não comprar vários itens do mesmo tipo sem precisar<br /><br />O consumo consciente é bom para o planeta e para o seu bolso!\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse, valeu\",\"response\":\"Tudo bem! Vou continuar por aqui, trazendo ideias para te ajudar a cuidar das suas finanças\",\"link_text\":\"\"}}","explanation_1_with_url":"Se você gosta de comprar pela internet, evite comprar lançamentos ou produtos da nova coleção. Procure a área do site onde ficam as <b>liquidações, outlet ou ofertas 🤑</b>","explanation_2_with_url":"Nas compras em lojas físicas, procure sempre as áreas da loja onde ficam os produtos em promoção (às vezes, elas ficam mais escondidas, mas existem) 😉","explanation_3_with_url":"Tenha em mente a regra do <b>entra 1, sai 1</b>: só vale entrar uma peça no seu guarda-roupa se outra sair. Essa prática também ajuda a não comprarmos grandes quantidades da mesma coisa sem precisar","user_option_delayed_body":"Prefiro ver outra hora","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não tenho interesse, valeu","explanation_1_with_url_link":"","explanation_2_with_url_link":"","explanation_3_with_url_link":"","user_option_delayed_response":"Tudo bem! Depois eu volto pra gente falar sobre como fazer mais com o seu dinheiro","user_option_engaged_response":"Boa!<br /><br />Evite lançamentos ou coleções novas. Procure liquidações, outlets e ofertas<br /><br />Siga a regra do <b>entra 1, sai 1</b>: para uma peça entrar no guarda-roupa, outra tem que sair. Isso ajuda a não comprar vários itens do mesmo tipo sem precisar<br /><br />O consumo consciente é bom para o planeta e para o seu bolso!","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Tudo bem! Vou continuar por aqui, trazendo ideias para te ajudar a cuidar das suas finanças","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-06-02T18:26:27.223Z","end_date":"2053-01-27T13:12:56.570Z","validation_ids":[],"cooldown_groups":["insights"],"updated_at":"2023-01-27T13:12:56.567Z","updated_by":"luciana.pavan@mailer.com.br","version":12,"profile_group_id":14,"previous_version":11,"convo_header":{"type":"default","barrier":"Fazer as contas do gasto com essa categoria e mostrar ao usuário","behavior":"Fazer com que o usuário utilize as dicas de compras para gastar menos com roupas","benefits":"Economizar com gastos de roupas","cooldown":"8640","feed_cta":"quero ver","feed_body":"Andei vendo seus gastos com vestuário e tenho algumas técnicas para te ajudar a economizar.","locations":"country|br","categories":"110000","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"As emoções influenciam muito na tomada de decisões. Veja como não virar refém!","triggerGroup":"","feed_subtitle":"compras","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"low","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8640","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"low","time_sensitivity":"medium","cooldownDismissed":"8640","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"8640","cooldownThumbsDown":"99999","sharedCooldownGroup":"insights","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"519,696","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l2cat110500.amt30d","type":"rvars","value":"100"},{"name":"agg.l2cat110500.amt90d","type":"rvars","value":"600"}],"etl_aggregations":[{"etl_aggregation_id":"528","etl_aggregation_name":"L1 Category Income 60 Days Sum Amount","rvar_object":"l1cat150000","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"$valid_transactions":true,"olivia_category_level1_id":[150000]},"invert_value":false},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"leal@olivia.ai"},{"etl_aggregation_id":"433","etl_aggregation_name":"L2 Category Shopping/Clothing & Accessories 90 Days Sum Amount","rvar_object":"l2cat110500","rvar_variable":"amt90d","rule":{"type":"sum_amount","filter":{"$last_x_days":90,"olivia_category_id":110500,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"187","etl_aggregation_name":"L2 Category Shopping/Clothing & Accessories 30 Days Sum Amount","rvar_object":"l2cat110500","rvar_variable":"amt30d","rule":{"type":"sum_amount","filter":{"$last_x_days":30,"olivia_category_id":110500,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"310","etl_aggregation_name":"L2 Category Shopping/Clothing & Accessories 60 Days Sum Amount","rvar_object":"l2cat110500","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":110500,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":519,"name":"Spent at L1 Category Income in 60 Days","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.l1cat150000.amt60d"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_519"},{"applicability_rule_id":696,"name":"Spent at Clothing  > 2% of Income","rule":[{"code":"if (!dat\n || !dat.profile_reserved_variable\n || !dat.profile_reserved_variable.agg\n || !dat.profile_reserved_variable.agg.l1cat150000\n || !dat.profile_reserved_variable.agg.l2cat110500\n || !dat.profile_reserved_variable.agg.l1cat150000.amt30d\n || !dat.profile_reserved_variable.agg.l2cat110500.amt30d\n || dat.profile_reserved_variable.agg.l2cat110500.amt30d < (dat.profile_reserved_variable.agg.l1cat150000.amt30d * 0.02) ) return false;\nreturn true;","type":"custom","description":"Spent at Clothing  > 2% of Income"}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"ivanir@olivia.ai","applicability_name":"applicability_rule_id_696"}],"shadow":false,"requires_etls":["l1cat150000.amt60d","l2cat110500.amt90d","l2cat110500.amt30d","l2cat110500.amt60d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37185},{"promotion_id":"10442","name":"inf_movies_services_subscriptions","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Isso significa que você costuma gastar <b><var>=currency(rvars.aggregate_services_subscriptions.last_12_months_amt_total)</var></b> por ano com assinaturas de streaming\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Pelo que andei vendo aqui, você tem atualmente <b><var>=rvars.aggregate_services_subscriptions.services_qtt</var></b> <var>=plural(rvars.aggregate_services_subscriptions.services_qtt,'serviço assinado', 'serviços assinados')</var>, e isso te custa <b><var>=currency(rvars.aggregate_services_subscriptions.last_month_amt_total)</var></b> por mês\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Isso significa que você costuma gastar <b><var>=currency(rvars.aggregate_services_subscriptions.last_12_months_amt_total)</var></b> por ano com assinaturas de streaming","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer checar os detalhes?\"}}","main_text_body":"Pelo que andei vendo aqui, você tem atualmente <b><var>=rvars.aggregate_services_subscriptions.services_qtt</var></b> <var>=plural(rvars.aggregate_services_subscriptions.services_qtt,'serviço assinado', 'serviços assinados')</var>, e isso te custa <b><var>=currency(rvars.aggregate_services_subscriptions.last_month_amt_total)</var></b> por mês","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer checar os detalhes?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver outra hora\",\"response\":\"Tudo bem, volto depois para  conversar sobre isso contigo\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Estes são todos os serviços cobrados mensalmente de você:<br /><var>=rvars.aggregate_services_subscriptions.name_amt_txt</var><br /><br />Os conteúdos podem variar, mas avalie se não seria uma boa cancelar algum desses serviços e economizar<br /><br />Pense no seu bolso e veja o que faz mais sentido para você!\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse, valeu\",\"response\":\"Sem problemas. Vou buscar outros assuntos pra você\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver outra hora","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não tenho interesse, valeu","user_option_delayed_response":"Tudo bem, volto depois para  conversar sobre isso contigo","user_option_engaged_response":"Estes são todos os serviços cobrados mensalmente de você:<br /><var>=rvars.aggregate_services_subscriptions.name_amt_txt</var><br /><br />Os conteúdos podem variar, mas avalie se não seria uma boa cancelar algum desses serviços e economizar<br /><br />Pense no seu bolso e veja o que faz mais sentido para você!","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Sem problemas. Vou buscar outros assuntos pra você","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-17T15:14:22.645Z","end_date":"2053-01-27T13:14:27.491Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:14:27.471Z","updated_by":"luciana.pavan@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"default","barrier":"A Olivia irá fazer a conta dos gastos do usuário com serviços de assinatura e mostrá-la para ele","behavior":"Fazer com que o usuário tenha consciência dos serviços que assina e, caso algum não seja relevante, considere cancelar algum desses serviços","benefits":"Fazer com que o usuário gaste apenas com os serviços que utiliza","cooldown":"0","feed_cta":"quero ver","feed_body":"Vem ver minha análise sobre suas assinaturas de streaming.","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"gastos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"832","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"aggregate_services_subscriptions","type":"rvars","value":{"name_txt":"- netflix","services":[{"name":"netflix","last_month_amt":45.9,"last_12_months_amt":550.8}],"timestamp":1629400180032,"updated_at":"2021-08-19T19:09:40.032Z","name_amt_txt":"- netflix (R$ 45,90)","services_qtt":1,"last_month_amt_total":45.9,"last_12_months_amt_total":550.8},"data_type":"json"}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":832,"name":"Has Streaming Subscription","rule":[{"code":"  if (!rvars.aggregate_services_subscriptions\n    || !rvars.aggregate_services_subscriptions.services_qtt\n    || rvars.aggregate_services_subscriptions.services_qtt < 2\n  ) return 0;\n\n  return 1;\n","type":"custom","description":"Check if user has more than one streaming subscription"}],"updated_at":"2021-08-24T18:50:29.632586","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_832"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37162},{"promotion_id":"10444","name":"inf_music_services_subscriptions","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Isso significa que você costuma gastar <b><var>=currency(12 * rvars.aggregate_service_subscriptions.amount)</var></b> por ano com assinaturas de música\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Pelo que analisei, você tem atualmente <b><var>=rvars.aggregate_service_subscriptions.count</var></b> serviços assinados, e isso te custa <b><var>=currency(rvars.aggregate_service_subscriptions.amount)</var></b> por mês\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Isso significa que você costuma gastar <b><var>=currency(12 * rvars.aggregate_service_subscriptions.amount)</var></b> por ano com assinaturas de música","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer checar os detalhes?\"}}","main_text_body":"Pelo que analisei, você tem atualmente <b><var>=rvars.aggregate_service_subscriptions.count</var></b> serviços assinados, e isso te custa <b><var>=currency(rvars.aggregate_service_subscriptions.amount)</var></b> por mês","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer checar os detalhes?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Está bem, volto outra hora para seguirmos a nossa conversa\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"Estes são todos os serviços cobrados mensalmente de você:<br /><br /><var>=rvars.aggregate_service_subscriptions.descriptions</var><br /><br />Eu sei que ouvir música é um dos grandes prazeres da vida!<br /><br />Mas quem sabe daria para cancelar ao menos um desses serviços e economizar? Avalie o que é melhor para você\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse, valeu\",\"response\":\"Tranquilo, depois falamos sobre outras formas de cuidar das suas finanças\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não tenho interesse, valeu","user_option_delayed_response":"Está bem, volto outra hora para seguirmos a nossa conversa","user_option_engaged_response":"Estes são todos os serviços cobrados mensalmente de você:<br /><br /><var>=rvars.aggregate_service_subscriptions.descriptions</var><br /><br />Eu sei que ouvir música é um dos grandes prazeres da vida!<br /><br />Mas quem sabe daria para cancelar ao menos um desses serviços e economizar? Avalie o que é melhor para você","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Tranquilo, depois falamos sobre outras formas de cuidar das suas finanças","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-23T18:34:02.301Z","end_date":"2053-01-27T13:19:14.431Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:19:14.427Z","updated_by":"luciana.pavan@mailer.com.br","version":15,"profile_group_id":14,"previous_version":14,"convo_header":{"type":"default","barrier":"A Olivia irá fazer a conta dos gastos do usuário com serviços de assinatura de música e mostrá-la para ele.","behavior":"Fazer com que o usuário tenha consciência dos serviços de música que assina e, caso algum não seja relevante, considere cancelar um desses serviços.","benefits":"Fazer com que o usuário gaste apenas com os serviços que utiliza.","cooldown":"0","feed_cta":"quero saber","feed_body":"Corre aqui para saber como andam suas assinaturas de música.","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"gastos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"837","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"aggregate_service_subscriptions","type":"rvars","value":{"count":2,"amount":1234,"descriptions":"- youtube 1200<br/>- spotify 34"}}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":837,"name":"Subscribes to more than one music service","rule":[{"code":"    if (!rvars\n        || !rvars.aggregate_service_subscriptions\n        || !rvars.aggregate_service_subscriptions.duplicated) return 0;\n\n    //Taken from aggregate_service_subscriptions's code\n    const music_services = ['iTunes', 'Spotify', 'Deezer', 'YouTube', 'Amazon Music', 'Apple Music'];\n\n    if (music_services.includes(rvars.aggregate_service_subscriptions.duplicated.a)\n        && music_services.includes(rvars.aggregate_service_subscriptions.duplicated.b)) return 1;\n\n    return 0;\n","type":"custom","description":"Check if user subscribes to more than one music service"}],"updated_at":"2021-09-30T17:16:58.915968","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_837"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37211},{"promotion_id":"10445","name":"inf_pharmacies_tip","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Pelo <b>Programa de Benefício em Medicamentos (PBM)</b>, grandes redes de farmácias e laboratórios dão descontos em mais de 3 mil remédios\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi que você fez <b><var>=rvars.agg.l2cat70300.count60d</var> </b>compras em farmácias e gastou <b><var>=currency(rvars.agg.l2cat70300.amt60d)</var></b> com isso nos últimos 60 dias e quero te falar do cadastro que gera economia em medicamentos!\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Pelo <b>Programa de Benefício em Medicamentos (PBM)</b>, grandes redes de farmácias e laboratórios dão descontos em mais de 3 mil remédios","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber se o medicamento que você usa faz parte desse programa?\"}}","main_text_body":"Vi que você fez <b><var>=rvars.agg.l2cat70300.count60d</var> </b>compras em farmácias e gastou <b><var>=currency(rvars.agg.l2cat70300.amt60d)</var></b> com isso nos últimos 60 dias e quero te falar do cadastro que gera economia em medicamentos!","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"https://www.portaldopbm.com.br/","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer saber se o medicamento que você usa faz parte desse programa?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Combinado! Volto em breve para te contar mais sobre esse programa 😃\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Sim, quero!\",\"response\":\"No site do PBM, pesquise os medicamentos e laboratórios e faça um cadastro no site do laboratório fabricante, então informe isso ao comprar na farmácia 🤓<br /><br />📌 E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco\",\"link_text\":\"👉 Pesquise aqui se o remédio que você usa faz parte do programa e economize!\",\"link\":\"https://www.portaldopbm.com.br/\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não precisa, valeu\",\"response\":\"Tudo bem! Vou pesquisar outros assuntos para te sugerir 😃\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Sim, quero!","user_option_dismissed_body":"Não precisa, valeu","user_option_delayed_response":"Combinado! Volto em breve para te contar mais sobre esse programa 😃","user_option_engaged_response":"No site do PBM, pesquise os medicamentos e laboratórios e faça um cadastro no site do laboratório fabricante, então informe isso ao comprar na farmácia 🤓<br /><br />📌 E só para esclarecer, serviços prestados por terceiros não são de responsabilidade do Itaú Unibanco","user_option_delayed_link_text":"","user_option_engaged_link_text":"👉 Pesquise aqui se o remédio que você usa faz parte do programa e economize!","user_option_dismissed_response":"Tudo bem! Vou pesquisar outros assuntos para te sugerir 😃","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-23T18:24:37.918Z","end_date":"2053-01-27T13:20:33.537Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:20:33.511Z","updated_by":"luciana.pavan@mailer.com.br","version":16,"profile_group_id":14,"previous_version":15,"convo_header":{"type":"default","barrier":"Informar ao usuário como fazer isso.","behavior":"Fazer com que o usuário se cadastre no programa de desconto de remédios.","benefits":"Reduzir custo com gastos de remédio.","cooldown":"0","feed_cta":"quero ver","feed_body":"Te mostro como economizar até 60% com medicamentos.","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"economia","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"medium","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"2147483656","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"agg.l2cat70300.amt60d","type":"rvars","value":"530","data_type":"number"},{"name":"agg.l2cat70300.count60d","type":"rvars","value":"3","data_type":"number"}],"etl_aggregations":[{"etl_aggregation_id":"287","etl_aggregation_name":"L2 Category Healthcare/Pharmacy 60 Days Sum Amount","rvar_object":"l2cat70300","rvar_variable":"amt60d","rule":{"type":"sum_amount","filter":{"$last_x_days":60,"olivia_category_id":70300,"$valid_transactions":true},"invert_value":true},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"bruno@olivia.ai"},{"etl_aggregation_id":"675","etl_aggregation_name":"L2 Category Healthcare/Pharmacy 60 Days Count","rvar_object":"l2cat70300","rvar_variable":"count60d","rule":{"type":"count","filter":{"$last_x_days":60,"olivia_category_id":[70300],"$valid_transactions":true},"invert_value":false},"updated_at":"2020-11-27T18:19:54.586Z","updated_by":"ivanir@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":2147483656,"name":" have 2 pharmacies spending over > 100","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.l2cat70300.count60d"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}},{"type":"and","validation_list":[{"type":"compare","operator":">=","left_value":{"type":"variable","variable":"rvars.agg.l2cat70300.amt60d"},"right_value":{"type":"fixed","value":"100","variable_type":"int"}}]}],"updated_at":"2022-10-25T13:26:33.657771","updated_by":"frank.carvalho@mailer.com.br","applicability_name":"applicability_rule_id_2147483656"}],"shadow":false,"requires_etls":["l2cat70300.amt60d","l2cat70300.count60d"],"conversation_group":"convos_itau_app_users","conversation_map_id":37192},{"promotion_id":"10446","name":"alert_weekly_update","convo_template":"tpt_itau_base_summary","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","no_etl":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Ainda estou analisando as movimentações da sua <b>conta corrente</b> nesta semana<br /><br />Vamos nos falar de novo na próxima semana, para eu te trazer novidades! 😉\"}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","no_data":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Você não teve movimentações na sua <b>conta corrente</b> no período de <b><var>=ivars.last_week_info.cycle_name</var></b><br /><br />Vamos nos falar de novo na próxima semana, para eu te trazer novidades! 😉\"}}","out_msg":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Vou continuar de olho nas suas finanças e volto na próxima semana com mais informações! 🤓\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Trago os números das<b> suas finanças</b> no período de <b><var>=ivars.last_week_info.cycle_name</var></b>:<br /><var>=ivars.last_week_info.total_income</var><var>=ivars.last_week_info.total_spending</var><var>=ivars.last_week_info.fixed_spending</var><var>=ivars.last_week_info.variable_spending</var>\"}}","check_data":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"    // Check Data\\n    const moment = require('moment');\\n    const currency = formulas.currency;\\n    const _ = require('lodash');\\n\\n    ivars.last_week_info = {};\\n\\n    ivars.itau_summary_has_etl = 0;\\n    ivars.itau_summary_has_details = 0;\\n    ivars.itau_summary_has_data = 0;\\n    ivars.itau_summary_up_to_date = 0;\\n    ivars.last_week_info.biggest_expense = '';\\n    ivars.last_week_info.topThreeCategories = '';\\n\\n    const last_week_fixed = _.get(dat.profile_overview_panel_section, 'last_week_fixed');\\n    const total_income = _.get(dat.profile_overview_panel_section, 'last_week_fixed.income.total.amount');\\n    const total_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.total.total_amount');\\n    const fixed_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.fixed.total_amount');\\n    const variable_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.variable.total_amount');\\n\\n    if (!last_week_fixed) {\\n        ivars.itau_summary_has_etl = 0;\\n    }\\n    else {\\n        ivars.itau_summary_has_etl = 1;\\n\\n        ivars.last_week_info.cycle_name = moment(last_week_fixed.begin).format('DD/MM') + ' a ' + moment(last_week_fixed.end).format('DD/MM');\\n\\n        if (!last_week_fixed\\n            || !ivars.last_week_info.cycle_name\\n            || !(total_income + total_spending)) {\\n            ivars.itau_summary_has_data = 0;\\n        }\\n        else {\\n            ivars.itau_summary_has_data = 1;\\n        }\\n\\n        // Code Block\\n        if (ivars.itau_summary_has_data) { // only show the info if user has total_income and/or total spenfing calculated\\n            // Check if summary is up to date\\n            ivars.last_week_info.start_summary = moment(last_week_fixed.begin).format('YYYY-MM-DD');\\n            let b = (moment().day() == 4) ? 13 : ( (moment().day() + 2) > 7 ? 1 : moment().day() + 2);\\n            ivars.last_week_info.todays_minus_7 = moment().subtract( b, 'days').format('YYYY-MM-DD');\\n            if (ivars.last_week_info.start_summary >= ivars.last_week_info.todays_minus_7 ) {\\n                ivars.itau_summary_up_to_date = 1;\\n            } \\n            // Income\\n            ivars.last_week_info.total_income = ((total_income) ? ('<br />Você recebeu = <b>' + currency(total_income) + '</b>') : '');\\n            // Total Spending\\n            ivars.last_week_info.total_spending = ((total_spending) ? ('<br />Você gastou = <b>' + currency(-total_spending) + '</b>') : '');\\n            // Fixed Spending\\n            ivars.last_week_info.fixed_spending = ((fixed_spending) ? ('<br><br />📌 Gastos Fixos =  <b>' + currency(-fixed_spending) + '</b>') : '');\\n            // Variable Spending\\n            ivars.last_week_info.variable_spending = ((variable_spending) ? (fixed_spending ? '<br />💸 Gastos Variáveis  =  <b>' + currency(-variable_spending) + '</b>' : '<br><br />💸 Gastos Variáveis  =  <b>' + currency(-variable_spending) + '</b>') : '');\\n\\n        }\\n        // Details\\n\\n        // Biggest Spending\\n        if (!!last_week_fixed.spending.transactions\\n            && !!last_week_fixed.spending.transactions.length) {\\n\\n            let t = last_week_fixed.spending.transactions.sort((a, b) => { return a.amount - b.amount })\\n            if (t[0].amount) {\\n                ivars.last_week_info.biggest_expense = ('<br />Seu gasto de maior valor:  <br /> <b>' + t[0].description + ' ' + currency(-t[0].amount) + '</b>')\\n            }\\n            ivars.itau_summary_has_details = 1;\\n        }\\n\\n        // Top three categories\\n\\n        const topCategories = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.total.by_category.top.categories');\\n\\n        const topThreeCategories = topCategories.slice(0, 3);\\n\\n        if (topThreeCategories.length < 1) {\\n            ivars.itau_summary_has_details = 0;\\n        }\\n        else if (topThreeCategories.length < 2) {\\n            ivars.last_week_info.topThreeCategories = ('<br />Sua categoria de maior gasto:  <br /> <b>'\\n                + topThreeCategories[0].name + ' '\\n                + currency(-topThreeCategories[0].amount) + ' <br /> </b>');\\n        }\\n        else {\\n            ivars.last_week_info.topThreeCategories = ('<br />Suas categorias de maior gasto:  <br /> <b>'\\n                + topThreeCategories[0].name + ' '\\n                + currency(-topThreeCategories[0].amount) + ' <br /> '\\n                + topThreeCategories[1].name + ' '\\n                + currency(-topThreeCategories[1].amount) + ' <br /> </b>');\\n            if (topThreeCategories.length > 2)\\n                ivars.last_week_info.topThreeCategories +=\\n                    '<b>' + (topThreeCategories[2].name + ' '\\n                        + currency(-topThreeCategories[2].amount) + '<br /> </b>');\\n        }\\n    }\\n \"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","no_etl_body":"Ainda estou analisando as movimentações da sua <b>conta corrente</b> nesta semana<br /><br />Vamos nos falar de novo na próxima semana, para eu te trazer novidades! 😉","content_body":"","no_data_body":"Você não teve movimentações na sua <b>conta corrente</b> no período de <b><var>=ivars.last_week_info.cycle_name</var></b><br /><br />Vamos nos falar de novo na próxima semana, para eu te trazer novidades! 😉","notification":" ","out_msg_body":"Vou continuar de olho nas suas finanças e volto na próxima semana com mais informações! 🤓","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer saber mais?\"}}","main_text_body":"Trago os números das<b> suas finanças</b> no período de <b><var>=ivars.last_week_info.cycle_name</var></b>:<br /><var>=ivars.last_week_info.total_income</var><var>=ivars.last_week_info.total_spending</var><var>=ivars.last_week_info.fixed_spending</var><var>=ivars.last_week_info.variable_spending</var>","notification_2":" ","notification_3":" ","check_data_body":"    // Check Data\n    const moment = require('moment');\n    const currency = formulas.currency;\n    const _ = require('lodash');\n\n    ivars.last_week_info = {};\n\n    ivars.itau_summary_has_etl = 0;\n    ivars.itau_summary_has_details = 0;\n    ivars.itau_summary_has_data = 0;\n    ivars.itau_summary_up_to_date = 0;\n    ivars.last_week_info.biggest_expense = '';\n    ivars.last_week_info.topThreeCategories = '';\n\n    const last_week_fixed = _.get(dat.profile_overview_panel_section, 'last_week_fixed');\n    const total_income = _.get(dat.profile_overview_panel_section, 'last_week_fixed.income.total.amount');\n    const total_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.total.total_amount');\n    const fixed_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.fixed.total_amount');\n    const variable_spending = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.variable.total_amount');\n\n    if (!last_week_fixed) <var>enc$\n        ivars.itau_summary_has_etl = 0;\n    </var>\n    else <var>enc$\n        ivars.itau_summary_has_etl = 1;\n\n        ivars.last_week_info.cycle_name = moment(last_week_fixed.begin).format('DD/MM') + ' a ' + moment(last_week_fixed.end).format('DD/MM');\n\n        if (!last_week_fixed\n            || !ivars.last_week_info.cycle_name\n            || !(total_income + total_spending)) {\n            ivars.itau_summary_has_data = 0;\n        }\n        else {\n            ivars.itau_summary_has_data = 1;\n        }\n\n        // Code Block\n        if (ivars.itau_summary_has_data) { // only show the info if user has total_income and/or total spenfing calculated\n            // Check if summary is up to date\n            ivars.last_week_info.start_summary = moment(last_week_fixed.begin).format('YYYY-MM-DD');\n            let b = (moment().day() == 4) ? 13 : ( (moment().day() + 2) > 7 ? 1 : moment().day() + 2);\n            ivars.last_week_info.todays_minus_7 = moment().subtract( b, 'days').format('YYYY-MM-DD');\n            if (ivars.last_week_info.start_summary >= ivars.last_week_info.todays_minus_7 ) {\n                ivars.itau_summary_up_to_date = 1;\n            } \n            // Income\n            ivars.last_week_info.total_income = ((total_income) ? ('<br />Você recebeu = <b>' + currency(total_income) + '</b>') : '');\n            // Total Spending\n            ivars.last_week_info.total_spending = ((total_spending) ? ('<br />Você gastou = <b>' + currency(-total_spending) + '</b>') : '');\n            // Fixed Spending\n            ivars.last_week_info.fixed_spending = ((fixed_spending) ? ('<br><br />📌 Gastos Fixos =  <b>' + currency(-fixed_spending) + '</b>') : '');\n            // Variable Spending\n            ivars.last_week_info.variable_spending = ((variable_spending) ? (fixed_spending ? '<br />💸 Gastos Variáveis  =  <b>' + currency(-variable_spending) + '</b>' : '<br><br />💸 Gastos Variáveis  =  <b>' + currency(-variable_spending) + '</b>') : '');\n\n        }\n        // Details\n\n        // Biggest Spending\n        if (!!last_week_fixed.spending.transactions\n            && !!last_week_fixed.spending.transactions.length) {\n\n            let t = last_week_fixed.spending.transactions.sort((a, b) => { return a.amount - b.amount })\n            if (t[0].amount) {\n                ivars.last_week_info.biggest_expense = ('<br />Seu gasto de maior valor:  <br /> <b>' + t[0].description + ' ' + currency(-t[0].amount) + '</b>')\n            }\n            ivars.itau_summary_has_details = 1;\n        }\n\n        // Top three categories\n\n        const topCategories = _.get(dat.profile_overview_panel_section, 'last_week_fixed.spending.total.by_category.top.categories');\n\n        const topThreeCategories = topCategories.slice(0, 3);\n\n        if (topThreeCategories.length < 1) {\n            ivars.itau_summary_has_details = 0;\n        }\n        else if (topThreeCategories.length < 2) {\n            ivars.last_week_info.topThreeCategories = ('<br />Sua categoria de maior gasto:  <br /> <b>'\n                + topThreeCategories[0].name + ' '\n                + currency(-topThreeCategories[0].amount) + ' <br /> </b>');\n        }\n        else {\n            ivars.last_week_info.topThreeCategories = ('<br />Suas categorias de maior gasto:  <br /> <b>'\n                + topThreeCategories[0].name + ' '\n                + currency(-topThreeCategories[0].amount) + ' <br /> '\n                + topThreeCategories[1].name + ' '\n                + currency(-topThreeCategories[1].amount) + ' <br /> </b>');\n            if (topThreeCategories.length > 2)\n                ivars.last_week_info.topThreeCategories +=\n                    '<b>' + (topThreeCategories[2].name + ' '\n                        + currency(-topThreeCategories[2].amount) + '<br /> </b>');\n        }\n    </var>\n ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer saber mais?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"Certo, vamos ver mais sobre seus gastos de <b><var>=ivars.last_week_info.cycle_name</var></b> 🔍 <br /><var>=ivars.last_week_info.biggest_expense</var><br /><br />Vou continuar de olho nas suas finanças e volto na próxima semana com mais informações! 🤓\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"Certo, vamos ver mais sobre seus gastos de <b><var>=ivars.last_week_info.cycle_name</var></b> 🔍 <br /><var>=ivars.last_week_info.biggest_expense</var><br /><br />Vou continuar de olho nas suas finanças e volto na próxima semana com mais informações! 🤓","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-08-06T16:53:05.271Z","end_date":"2053-01-27T13:24:42.618Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:24:42.615Z","updated_by":"luciana.pavan@mailer.com.br","version":97,"profile_group_id":14,"previous_version":96,"convo_header":{"type":"alert","barrier":"Iremos fazer as contas dos gastos e recebimentos do usuário e mostrá-la semanalmente","behavior":"Usuário acompanhe seus gastos e recebimentos semanais na conta do Itaú","benefits":"Fazer com que o usuário acompanhe seus gastos e recebimentos durante todo o mês e não tenha surpresas no fechamento da fatura","cooldown":"0","feed_cta":"vamos!","feed_body":"Reuni suas principais movimentações da semana e está tudo anotado aqui. Vamos ver?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"resumo semanal","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"72","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["summary","coringa"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.last_week_fixed","type":"dat","value":{"end":"2022-10-13","begin":"2022-10-07","label":"7 outubro » 13 outubro","income":{"total":{"count":1,"amount":4222},"others":{"count":0,"amount":0},"paycheck":{"count":1,"amount":4222}},"spending":{"fixed":{"by_category":{"top":{"categories":[{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-113.23}],"total_amount":-113.23},"bottom":{"categories":[],"total_amount":0}},"total_amount":-113.23,"transaction_count":1,"uncategorized_transaction_count":0},"total":{"by_category":{"top":{"categories":[{"id":190000,"name":"Transferências","color":"#996813","emoji":"🔁","amount":-450.05},{"id":110000,"name":"Compras","color":"#a12b83","emoji":"🛍️","amount":-443.51},{"id":10000,"name":"Contas","color":"#99482d","emoji":"📩","amount":-113.23}],"total_amount":-1006.79},"bottom":{"categories":[],"total_amount":0}},"total_amount":-1006.79,"transaction_count":3,"uncategorized_transaction_count":0},"variable":{"by_category":{"top":{"categories":[{"id":190000,"name":"Transferências","color":"#996813","emoji":"🔁","amount":-450.05},{"id":110000,"name":"Compras","color":"#a12b83","emoji":"🛍️","amount":-443.51}],"total_amount":-893.56},"bottom":{"categories":[],"total_amount":0}},"total_amount":-893.56,"transaction_count":2,"uncategorized_transaction_count":0},"transactions":[{"lat":-5.79448,"lon":-35.211,"date":"2022-10-11","tags":[],"notes":null,"amount":-113.23,"enabled":true,"pending":false,"cashflow":true,"category":{"id":10600,"name":"Contas / Água e esgoto","color":"#99482d","emoji":"🚰","level1":"Contas","level2":"Água e esgoto","level1_id":10000,"level2_id":10600},"frequency":"1-month","account_id":"42851472_ef937e3a06b80cc543ba35a3dc2a97cc","budget_type":"fixed","description":"SABESP 0633362514","installment":true,"transaction_id":"42851472_aguaaaaaaaaaa11111","account_type_id":100,"original_description":"SABESP 0633362514"},{"lat":-19.8157,"lon":-43.9542,"date":"2022-10-10","tags":[],"notes":null,"amount":-443.51,"enabled":true,"pending":false,"cashflow":true,"category":{"id":110500,"name":"Compras / Vestuário e acessórios","color":"#a12b83","emoji":"👖","level1":"Compras","level2":"Vestuário e acessórios","level1_id":110000,"level2_id":110500},"frequency":"0-none","account_id":"42851472_ef937e3a06b80cc543ba35a3dc2a97cc","budget_type":"variable","description":"RIACHUELO 204","transaction_id":"42851472_dddddd","account_type_id":100,"original_description":"RIACHUELO 204"},{"lat":-5.79448,"lon":-35.211,"date":"2022-10-09","tags":[],"notes":null,"amount":-450.05,"enabled":true,"pending":false,"cashflow":true,"category":{"id":191000,"name":"Transferências / Outras transferências","color":"#996813","emoji":"🔁","level1":"Transferências","level2":"Outras transferências","level1_id":190000,"level2_id":191000},"frequency":"0-none","account_id":"42851472_ef937e3a06b80cc543ba35a3dc2a97cc","description":"TED 080.0000BET CORRET","transaction_id":"42851472_teddddd","account_type_id":100,"original_description":"TED 080.0000BET CORRET"}]},"read_label":"7 (sex) e 13 (qui) de outubro","short_label":"7 out » 13 out"},"data_type":"json"}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37170},{"promotion_id":"10447","name":"inf_alert_cashback","convo_template":"tpt_itau_base_no_options_no_cooldown","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"let current_transaction;\\n\\nfor (const transaction of rvars.aggregate_other_income.cashback_transactions) {\\n  if (!!current_transaction) continue;\\n  if (!!ivars.alert_cashback_historic\\n    && ivars.alert_cashback_historic.some((hist) => hist == transaction.transaction_id)) continue;\\n  current_transaction = transaction;\\n}\\n\\nif (!current_transaction\\n  && !!rvars.aggregate_other_income.cashback_transactions\\n  && rvars.aggregate_other_income.cashback_transactions.length > 0) {\\n  current_transaction = rvars.aggregate_other_income.cashback_transactions[0];\\n}\\n\\nif (!!current_transaction) {\\n  ivars.alert_cashback_historic = ivars.alert_cashback_historic || [];\\n  ivars.alert_cashback_historic.push(current_transaction.transaction_id);\\n}\\n\\nivars.temp_current_transaction = current_transaction;\\n\\nconst content_variation_1 = 'Para não deixar esse dinheiro parado, que tal transferir para uma aplicação?';\\nconst content_variation_2 = 'Continue pesquisando as melhores opções antes de comprar e receba de volta uma parte do que gastou';\\n\\nif (!!current_transaction && current_transaction.amt > 100) {\\n  ivars.temp_content = content_variation_1;\\n}\\nelse {\\n  ivars.temp_content = content_variation_2;\\n}\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"<var>=ivars.temp_content</var>\"}}","code_body":"let current_transaction;\n\nfor (const transaction of rvars.aggregate_other_income.cashback_transactions) <var>enc$\n  if (!!current_transaction) continue;\n  if (!!ivars.alert_cashback_historic\n    && ivars.alert_cashback_historic.some((hist) => hist == transaction.transaction_id)) continue;\n  current_transaction = transaction;\n</var>\n\nif (!current_transaction\n  && !!rvars.aggregate_other_income.cashback_transactions\n  && rvars.aggregate_other_income.cashback_transactions.length > 0) <var>enc$\n  current_transaction = rvars.aggregate_other_income.cashback_transactions[0];\n</var>\n\nif (!!current_transaction) <var>enc$\n  ivars.alert_cashback_historic = ivars.alert_cashback_historic || [];\n  ivars.alert_cashback_historic.push(current_transaction.transaction_id);\n</var>\n\nivars.temp_current_transaction = current_transaction;\n\nconst content_variation_1 = 'Para não deixar esse dinheiro parado, que tal transferir para uma aplicação?';\nconst content_variation_2 = 'Continue pesquisando as melhores opções antes de comprar e receba de volta uma parte do que gastou';\n\nif (!!current_transaction && current_transaction.amt > 100) <var>enc$\n  ivars.temp_content = content_variation_1;\n</var>\nelse <var>enc$\n  ivars.temp_content = content_variation_2;\n</var>","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Vi aqui que você recebeu <b><var>=currency(ivars.temp_current_transaction.amt)</var></b> de cashback do <b>Méliuz</b>!\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"<var>=ivars.temp_content</var>","notification":"Notícia boa também chega voando: você tem um crédito de cashback na sua conta! ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Vi aqui que você recebeu <b><var>=currency(ivars.temp_current_transaction.amt)</var></b> de cashback do <b>Méliuz</b>!","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-04-27T13:15:31.330Z","end_date":"2053-01-27T13:28:59.778Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:28:59.762Z","updated_by":"luciana.pavan@mailer.com.br","version":16,"profile_group_id":14,"previous_version":15,"convo_header":{"type":"alert","barrier":"Avisar que o dinheiro de um depósito de cashback está disponível, sem que o usuário precise consultar o extrato da conta corrente.","behavior":"Fazer com que o usuário saiba e acompanhe entradas extras em sua conta corrente.","benefits":"Fazer com que o usuário crie o hábito de investir o dinheiro de entradas extras.","cooldown":"0","feed_cta":"vamos ver","feed_body":"Você tem créditos de cashback! Vamos ver?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"equilibrando as contas","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"0","cooldownEngaged":"0","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"low","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"0","notification_type":"insight","cooldownFrustrated":"0","cooldownInteracted":"0","cooldownThumbsDown":"0","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"822","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"aggregate_other_income.cashback_transactions","type":"rvars","value":[{"amt":1230,"name":"meliuz","transaction_id":"transaction-test-id"}]},{"name":"alert_cashback_historic","type":"ivars","value":[]}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":822,"name":"Has cashback transactions","rule":[{"code":"if (!rvars.aggregate_other_income\n  || !rvars.aggregate_other_income.cashback_transactions\n  || !rvars.aggregate_other_income.cashback_transactions.length) return 0;\n\nfor (const transaction of rvars.aggregate_other_income.cashback_transactions) {\n  if (!!ivars.alert_cashback_historic\n    && ivars.alert_cashback_historic.some((hist) => hist == transaction.transaction_id)) continue;\n  return 1;\n}\n\nreturn 0;","type":"custom","description":"Check for recent cashback not on historic"}],"updated_at":"2021-05-11T12:09:53.858261","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_822"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37217},{"promotion_id":"10448","name":"inf_alert_fatura_fechada","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Como sua fatura fechou dia DD/MM/AA os próximos 10 dias são as melhores datas para fazer novas compras. Organize-se e ganhe uns dias a mais para pagar!\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"A sua fatura com vencimento no dia DD/MM/AA fechou. O valor desse mês ficou em R$ XXX.\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Como sua fatura fechou dia DD/MM/AA os próximos 10 dias são as melhores datas para fazer novas compras. Organize-se e ganhe uns dias a mais para pagar!","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Se a sua fatura não está em débito automático, posso te lembrar do pagamento 2 dias antes do vencimento. O que acha?\"}}","main_text_body":"A sua fatura com vencimento no dia DD/MM/AA fechou. O valor desse mês ficou em R$ XXX.","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Se a sua fatura não está em débito automático, posso te lembrar do pagamento 2 dias antes do vencimento. O que acha?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Uso débito automático\",\"response\":\"Pefeito! 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero lembrete\",\"response\":\"Fechado! Já me programei e te aviso no dia combinado 😉\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero pagar agora\",\"response\":\"Legal! 😀 É só clicar <b>aqui</b> e selecionar <b>Pagar a fatura.</b>\",\"link_text\":\"itauvarejo://cartoes \"}}","user_option_delayed_body":"Uso débito automático","user_option_engaged_body":"Quero lembrete","user_option_dismissed_body":"Quero pagar agora","user_option_delayed_response":"Pefeito! 😉","user_option_engaged_response":"Fechado! Já me programei e te aviso no dia combinado 😉","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Legal! 😀 É só clicar <b>aqui</b> e selecionar <b>Pagar a fatura.</b>","user_option_dismissed_link_text":"itauvarejo://cartoes "},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2022-04-01T17:35:25.442Z","end_date":"2053-01-27T13:31:40.280Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:31:40.271Z","updated_by":"luciana.pavan@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"default","cooldown":"0","feed_cta":"vamos","feed_body":"A sua fatura fechou e vence no dia DD/MM/AA. Vem conferir o valor! ","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"fatura de cartão","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"9","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37220},{"promotion_id":"10449","name":"inf_alert_nota_fiscal_paulista","convo_template":"tpt_itau_alert_nota_fiscal_paulista","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Aproveite e transfira agora esse dinheiro extra para uma aplicação\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Você recebeu <b><var>=currency(ivars.temp_current_transaction.amt)</var></b> em créditos de Nota Fiscal Paulista!\"}}","content_body":"Aproveite e transfira agora esse dinheiro extra para uma aplicação","notification":"Opa, vejo dinheiros caindo na sua conta vindos de Nota Fiscal Paulista! Te falo agora quanto! ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Você recebeu <b><var>=currency(ivars.temp_current_transaction.amt)</var></b> em créditos de Nota Fiscal Paulista!","user_engaged_link":"","external_link_body":"","external_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-15T14:27:15.518Z","end_date":"2053-01-27T13:34:01.742Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:34:01.740Z","updated_by":"luciana.pavan@mailer.com.br","version":11,"profile_group_id":14,"previous_version":10,"convo_header":{"type":"default","barrier":"Avisar que o dinheiro da nota fiscal paulista está disponível, sem que o usuário precise consultar o extrato da conta corrente.","behavior":"Fazer com que o usuário acompanhe entradas extras em sua conta corrente.","benefits":"Ajudar o usuário a criar o hábito de investir o dinheiro de entradas extras.","cooldown":"720","feed_cta":"vamos ","feed_body":"Você tem créditos de Nota Fiscal Paulista na sua conta! Vamos ver?","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"equilibrando as contas","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"720","cooldownEngaged":"720","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"99999","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"720","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48","requiredConversations":"master","applicability_rule_ids":"792","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"aggregate_other_income.nfp_transactions","type":"rvars","value":[{"amt":100,"transaction_id":"mock-1"},{"amt":20,"transaction_id":"mock-2"},{"amt":111,"transaction_id":"mock-3"}],"data_type":"json"}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":792,"name":"Has Nota Fiscal Paulista","rule":[{"code":"if (!rvars\n  || !rvars.aggregate_other_income\n  || !rvars.aggregate_other_income.nfp_transactions\n  || !rvars.aggregate_other_income.nfp_transactions.length\n) return false;\n\nif (!ivars.nota_fiscal_paulista_history) return true;\n\n// find next not shown\nlet show = false;\nfor (const i in rvars.aggregate_other_income.nfp_transactions) {\n  show = true;\n  for (const j in ivars.nota_fiscal_paulista_history) {\n    if (rvars.aggregate_other_income.nfp_transactions[i].transaction_id == ivars.nota_fiscal_paulista_history[j]) {\n      show = false;\n      break;\n    }\n  }\n\n  if (show) {\n    return true;\n  }\n}\n\nreturn false;","type":"custom","description":"Check if user has a recent nota fiscal paulista transaction"}],"updated_at":"2021-04-01T18:17:12.648464","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_792"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37180},{"promotion_id":"10453","name":"ops_feedback_beta_tester","convo_template":"tpt_itau_onboarding","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Agora você já conhece um pouco mais desta nova experiência!<br />Então, conta a sua opinião pro meu time? É anônimo e rapidinho\"}}","content_body":"","content_link":"","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Agora você já conhece um pouco mais desta nova experiência!<br />Então, conta a sua opinião pro meu time? É anônimo e rapidinho","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_feedback":"","user_option_delayed_response":"","user_option_engaged_feedback":"textinput","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_feedback":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2020-11-25T19:57:55.379Z","end_date":"2053-01-27T13:41:53.259Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:41:53.241Z","updated_by":"luciana.pavan@mailer.com.br","version":8,"profile_group_id":14,"previous_version":7,"convo_header":{"type":"alert","barrier":"Prover o feedback de forma rápida e simples.","behavior":"Usuário ajude a construir um produto melhor.","benefits":"Melhora do aplicativo com ajuda do usuário.","cooldown":"99999","featured":false,"feed_cta":"quero opinar","feed_body":"O que está achando? Vem contar como tem sido até aqui.","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"vamos juntos","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"99999","once_completed":"false","validation_ids":"","cooldownDelayed":"99999","cooldownEngaged":"99999","localHoursValid":"","expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"99999","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"99999","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"99999","requiredConversations":"master","applicability_rule_ids":"815","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["feedback"]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":815,"name":"Itau Beta Tester Feedback ","rule":[{"code":"  const moment = require('moment');\n\n  const mapped = {};\n  for (const conversation in hist) {\n    if (typeof hist[conversation] != 'object') continue;\n    if (!hist[conversation].last_engaged) continue;\n\n    mapped[conversation] = hist[conversation].last_engaged;\n  }\n\n  const recent_conversations = Object.values(mapped)\n    .map(last_engaged => (moment().diff(moment(last_engaged), 'months') > 0) ? 0 : 1)\n    .reduce((acc, item) => item + acc, 0);\n\n  return recent_conversations > 3;\n","type":"custom","description":"User has engaged on at least 4 conversations in the last month"}],"updated_at":"2021-11-18T19:30:37.994346","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_815"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37163},{"promotion_id":"10454","name":"inf_x_ray_categories","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Suas categorias de maior gasto:<br /><var>=context.currentSession.svars.category_summary</var><br /><br />Sua maior compra nesse período:<br /><var>=context.currentSession.svars.highest_expense</var>\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Analisei sua <b>conta corrente</b> nos últimos <b>3 meses</b> e quero te mostrar 🔎\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"Suas categorias de maior gasto:<br /><var>=context.currentSession.svars.category_summary</var><br /><br />Sua maior compra nesse período:<br /><var>=context.currentSession.svars.highest_expense</var>","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer ver os números detalhados?\"}}","main_text_body":"Analisei sua <b>conta corrente</b> nos últimos <b>3 meses</b> e quero te mostrar 🔎","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer ver os números detalhados?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Prefiro ver depois\",\"response\":\"Tudo bem, em breve falamos novamente 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"Esses foram seus números mês a mês:<br /><br /><var>=context.currentSession.svars.monthly_summary</var><br /><br />Vou continuar te acompanhando e ajudar a organizar suas contas 📝\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse\",\"response\":\"Sem problemas, vou buscar novos temas pra você 😊\",\"link_text\":\"\"}}","user_option_delayed_body":"Prefiro ver depois","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"Não tenho interesse","user_option_delayed_response":"Tudo bem, em breve falamos novamente 😉","user_option_engaged_response":"Esses foram seus números mês a mês:<br /><br /><var>=context.currentSession.svars.monthly_summary</var><br /><br />Vou continuar te acompanhando e ajudar a organizar suas contas 📝","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Sem problemas, vou buscar novos temas pra você 😊","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-11-26T18:21:11.240Z","end_date":"2053-01-27T13:43:32.322Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:43:32.306Z","updated_by":"luciana.pavan@mailer.com.br","version":19,"profile_group_id":14,"previous_version":18,"convo_header":{"type":"alert","barrier":"Realizamos as contas pelo usuário e fazemos uma análise das principais categorias de gastos","behavior":"Ajudar o usuário a entender seu padrão de gastos, sua situação financeira atual","benefits":"Apoio emocional, ajudar o usuário a atingir seus objetivos mais rápido","cooldown":"99999","feed_cta":"quero entender","feed_body":"Entenda para onde seu dinheiro está indo com esta análise de categorias que preparei.","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"raio-x","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"0","once_completed":"false","validation_ids":"","cooldownDelayed":"99999","cooldownEngaged":"99999","localHoursValid":"","expected_savings":"high","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"high","cooldownDismissed":"99999","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"99999","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"0","requiredConversations":"master","applicability_rule_ids":"873,872","cooldown_groups_merged":"true","session_variables_code":"    const _ = require('lodash');\n    const moment = require('moment');\n    const { category, currency } = formulas;\n\n    const spending_data = _.get(dat.profile_overview_panel_section, 'totals.spending');\n\n    // Get closed months only\n    const months = [\n        moment().startOf('month').subtract(3, 'month').format('YYYY-MM-DD'),\n        moment().startOf('month').subtract(2, 'month').format('YYYY-MM-DD'),\n        moment().startOf('month').subtract(1, 'month').format('YYYY-MM-DD')\n    ];\n\n    const monthly_category_spending = months.map((date) => {\n        const object = _.find(spending_data, { 'begin': date });\n        if (object) return object.by_category;\n        return undefined;\n    }).filter(n => n);\n\n    // List of spending sum by category\n    const category_spending_sum = {}\n\n    monthly_category_spending.forEach((monthly_spending) => {\n        const categories = Object.keys(monthly_spending);\n        categories.forEach((cat) => category_spending_sum[cat] = (category_spending_sum[cat] || 0) + ((monthly_spending[cat] || { total: 0 }).total));\n    });\n\n    // Top 3 categories by spending\n    const category_ranking = Object.keys(category_spending_sum).sort((a, b) => category_spending_sum[a] - category_spending_sum[b]).slice(0, 3);\n\n    const category_summary = category_ranking.map((top_spending) => `<b>${category(top_spending).full_name} ${currency(Math.abs(category_spending_sum[top_spending]))}</b>`).join('<br/>');\n\n    const monthly_summary = category_ranking.map((top_spending) => {\n        const summary = []\n        for (let i = 0; i < monthly_category_spending.length; i++) {\n            let total = Math.abs((monthly_category_spending[i][top_spending] || { total: 0 }).total);\n            if (total)\n                summary.push(`<b>➡</b> ${moment(months[i]).locale(\"PT-BR\").format(\"MMMM\")} <b>${currency(total)}</b>`)\n        }\n        return `<b>${category(top_spending).full_name}</b><br/>${summary.join('<br/>')}`;\n    }).join('<br/>');\n\n    const highest_expense = `<b>${rvars.agg.general_transactions.highest_expense_3_closed_months.desc} ${currency(Math.abs(rvars.agg.general_transactions.highest_expense_3_closed_months.amt))}</b>`;\n\n    return { category_summary, monthly_summary, highest_expense };\n\n","session_variables_enabled":"true","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":[{"name":"agg.general_transactions.highest_expense_3_closed_months","type":"rvars","value":{"amt":340,"desc":"teste"},"data_type":"json"},{"name":"profile_overview_panel_section.totals.spending","type":"dat","value":[{"end":"2021-02-28","begin":"2021-02-01","label":"Fevereiro","amount":{"fixed":-10.5,"total":-10.5,"variable":0},"by_category":{"10000":{"fixed":-10.5,"total":-10.5,"variable":0}},"short_label":"Fev","by_subcategory":{"10100":{"fixed":-10.5,"total":-10.5,"variable":0}}},{"end":"2021-03-31","begin":"2021-03-01","label":"Março","amount":{"fixed":-10.5,"total":-10.5,"variable":0},"by_category":{"10000":{"fixed":-10.5,"total":-10.5,"variable":0}},"short_label":"Mar","by_subcategory":{"10100":{"fixed":-10.5,"total":-10.5,"variable":0}}},{"end":"2021-04-30","begin":"2021-04-01","label":"Abril","amount":{"fixed":-10.5,"total":-33.85,"variable":-23.35},"by_category":{"10000":{"fixed":-10.5,"total":-10.5,"variable":0},"130000":{"fixed":0,"total":-23.35,"variable":-23.35}},"short_label":"Abr","by_subcategory":{"10100":{"fixed":-10.5,"total":-10.5,"variable":0},"130500":{"fixed":0,"total":-23.35,"variable":-23.35}}},{"end":"2021-05-31","begin":"2021-05-01","label":"Maio","amount":{"fixed":-1102.08,"total":-3682.37,"variable":-2580.29},"by_category":{"10000":{"fixed":-1102.08,"total":-1102.08,"variable":0},"20000":{"fixed":0,"total":-241.49,"variable":-241.49},"30000":{"fixed":0,"total":-0.81,"variable":-0.81},"60000":{"fixed":0,"total":-586.75,"variable":-586.75},"70000":{"fixed":0,"total":-77.86,"variable":-77.86},"80000":{"fixed":0,"total":-56.33,"variable":-56.33},"110000":{"fixed":0,"total":-92.26,"variable":-92.26},"115000":{"fixed":0,"total":-1062.55,"variable":-1062.55},"130000":{"fixed":0,"total":-122.43,"variable":-122.43},"190000":{"fixed":0,"total":-246,"variable":-246},"1000006":{"fixed":0,"total":-93.81,"variable":-93.81}},"short_label":"Mai","by_subcategory":{"10100":{"fixed":-170.92,"total":-170.92,"variable":0},"10300":{"fixed":-603.14,"total":-603.14,"variable":0},"10400":{"fixed":-23.04,"total":-23.04,"variable":0},"10700":{"fixed":-304.98,"total":-304.98,"variable":0},"20400":{"fixed":0,"total":-241.49,"variable":-241.49},"30600":{"fixed":0,"total":-0.81,"variable":-0.81},"60300":{"fixed":0,"total":-6.12,"variable":-6.12},"60400":{"fixed":0,"total":-553.17,"variable":-553.17},"60500":{"fixed":0,"total":-33.58,"variable":-33.58},"70300":{"fixed":0,"total":-77.86,"variable":-77.86},"80200":{"fixed":0,"total":-56.33,"variable":-56.33},"110200":{"fixed":0,"total":-49.5,"variable":-49.5},"110300":{"fixed":0,"total":-1056.43,"variable":-1056.43},"110400":{"fixed":0,"total":-39.49,"variable":-39.49},"110900":{"fixed":0,"total":-3.27,"variable":-3.27},"130500":{"fixed":0,"total":-89.63,"variable":-89.63},"130800":{"fixed":0,"total":-32.8,"variable":-32.8},"140000":{"fixed":0,"total":-93.81,"variable":-93.81},"191000":{"fixed":0,"total":-246,"variable":-246}}},{"end":"2021-06-30","begin":"2021-06-01","label":"Junho","amount":{"fixed":-660.72,"total":-3879.27,"variable":-3218.55},"by_category":{"10000":{"fixed":-489.49,"total":-489.49,"variable":0},"20000":{"fixed":-171.23,"total":-322.16,"variable":-150.93},"30000":{"fixed":0,"total":-41.9,"variable":-41.9},"60000":{"fixed":0,"total":-498.37,"variable":-498.37},"70000":{"fixed":0,"total":-47.09,"variable":-47.09},"80000":{"fixed":0,"total":-136.73,"variable":-136.73},"90000":{"fixed":0,"total":-82.3,"variable":-82.3},"110000":{"fixed":0,"total":-744.79,"variable":-744.79},"115000":{"fixed":0,"total":-991.67,"variable":-991.67},"130000":{"fixed":0,"total":-99.25,"variable":-99.25},"190000":{"fixed":0,"total":-285.89,"variable":-285.89},"1000006":{"fixed":0,"total":-139.63,"variable":-139.63}},"short_label":"Jun","by_subcategory":{"10100":{"fixed":-10.5,"total":-10.5,"variable":0},"10300":{"fixed":-178.51,"total":-178.51,"variable":0},"10400":{"fixed":-70,"total":-70,"variable":0},"10500":{"fixed":-230.48,"total":-230.48,"variable":0},"20300":{"fixed":-171.23,"total":-171.23,"variable":0},"20400":{"fixed":0,"total":-150.93,"variable":-150.93},"30600":{"fixed":0,"total":-41.9,"variable":-41.9},"60100":{"fixed":0,"total":-6.44,"variable":-6.44},"60300":{"fixed":0,"total":-77.61,"variable":-77.61},"60400":{"fixed":0,"total":-305.69,"variable":-305.69},"60500":{"fixed":0,"total":-186.24,"variable":-186.24},"70300":{"fixed":0,"total":-8.39,"variable":-8.39},"70500":{"fixed":0,"total":-38.7,"variable":-38.7},"80200":{"fixed":0,"total":-123.09,"variable":-123.09},"80400":{"fixed":0,"total":-13.64,"variable":-13.64},"90100":{"fixed":0,"total":-82.3,"variable":-82.3},"110200":{"fixed":0,"total":-644.39,"variable":-644.39},"110300":{"fixed":0,"total":-914.06,"variable":-914.06},"110700":{"fixed":0,"total":-48.74,"variable":-48.74},"110900":{"fixed":0,"total":-51.66,"variable":-51.66},"130800":{"fixed":0,"total":-79.46,"variable":-79.46},"131300":{"fixed":0,"total":-19.79,"variable":-19.79},"140000":{"fixed":0,"total":-134.24,"variable":-134.24},"191000":{"fixed":0,"total":-285.89,"variable":-285.89},"200000":{"fixed":0,"total":-5.39,"variable":-5.39}}},{"end":"2021-07-31","begin":"2021-07-01","label":"Julho","amount":{"fixed":-1468.52,"total":-3417.55,"variable":-1949.03},"by_category":{"0":{"fixed":0,"total":-687.84,"variable":-687.84},"10000":{"fixed":-153.33,"total":-153.33,"variable":0},"40000":{"fixed":0,"total":-1.89,"variable":-1.89},"60000":{"fixed":0,"total":-127.77,"variable":-127.77},"70000":{"fixed":0,"total":-4.83,"variable":-4.83},"80000":{"fixed":-883.02,"total":-883.02,"variable":0},"110000":{"fixed":0,"total":-90.86,"variable":-90.86},"115000":{"fixed":0,"total":-192.9,"variable":-192.9},"130000":{"fixed":0,"total":-119.94,"variable":-119.94},"190000":{"fixed":0,"total":-706.06,"variable":-706.06},"1000006":{"fixed":0,"total":-16.94,"variable":-16.94},"1000010":{"fixed":-322.17,"total":-322.17,"variable":0},"1000011":{"fixed":-110,"total":-110,"variable":0}},"short_label":"Jul","by_subcategory":{"0":{"fixed":0,"total":-687.84,"variable":-687.84},"10100":{"fixed":-10.5,"total":-10.5,"variable":0},"10400":{"fixed":-9.62,"total":-9.62,"variable":0},"10500":{"fixed":-67.47,"total":-67.47,"variable":0},"10800":{"fixed":-65.74,"total":-65.74,"variable":0},"20200":{"fixed":-167.17,"total":-167.17,"variable":0},"40400":{"fixed":0,"total":-1.89,"variable":-1.89},"60300":{"fixed":0,"total":-35.4,"variable":-35.4},"60400":{"fixed":0,"total":-125.88,"variable":-125.88},"60500":{"fixed":0,"total":-1.89,"variable":-1.89},"70300":{"fixed":0,"total":-4.83,"variable":-4.83},"80100":{"fixed":-32.46,"total":-32.46,"variable":0},"80700":{"fixed":-850.56,"total":-850.56,"variable":0},"110200":{"fixed":0,"total":-68.02,"variable":-68.02},"110300":{"fixed":0,"total":-157.5,"variable":-157.5},"110400":{"fixed":0,"total":-15.73,"variable":-15.73},"110500":{"fixed":0,"total":-7.11,"variable":-7.11},"130100":{"fixed":-110,"total":-110,"variable":0},"130500":{"fixed":0,"total":-87.18,"variable":-87.18},"131000":{"fixed":0,"total":-4.41,"variable":-4.41},"131300":{"fixed":0,"total":-28.35,"variable":-28.35},"140000":{"fixed":0,"total":-11.55,"variable":-11.55},"191000":{"fixed":0,"total":-706.06,"variable":-706.06},"200000":{"fixed":0,"total":-5.39,"variable":-5.39},"210000":{"fixed":-155,"total":-155,"variable":0}}},{"end":"2021-08-31","begin":"2021-08-01","label":"Agosto","amount":{"fixed":-2005.82,"total":-4589.29,"variable":-2583.47},"by_category":{"0":{"fixed":0,"total":-364.51,"variable":-364.51},"10000":{"fixed":-278.31,"total":-278.31,"variable":0},"30000":{"fixed":0,"total":-5.77,"variable":-5.77},"40000":{"fixed":-1.62,"total":5,"variable":6.62},"60000":{"fixed":0,"total":-95.42,"variable":-95.42},"70000":{"fixed":0,"total":-222.5,"variable":-222.5},"80000":{"fixed":-1224.73,"total":-1224.73,"variable":0},"90000":{"fixed":0,"total":-14.2,"variable":-14.2},"110000":{"fixed":0,"total":-1110.26,"variable":-1110.26},"115000":{"fixed":0,"total":-353.99,"variable":-353.99},"130000":{"fixed":0,"total":-122.41,"variable":-122.41},"190000":{"fixed":0,"total":-293.42,"variable":-293.42},"1000006":{"fixed":0,"total":-7.61,"variable":-7.61},"1000010":{"fixed":-391.16,"total":-391.16,"variable":0},"1000011":{"fixed":-110,"total":-110,"variable":0}},"short_label":"Ago","by_subcategory":{"0":{"fixed":0,"total":-364.51,"variable":-364.51},"10100":{"fixed":-132.47,"total":-132.47,"variable":0},"10400":{"fixed":-5.84,"total":-5.84,"variable":0},"10500":{"fixed":-45.33,"total":-45.33,"variable":0},"10800":{"fixed":-94.67,"total":-94.67,"variable":0},"20200":{"fixed":-236.16,"total":-236.16,"variable":0},"30300":{"fixed":0,"total":-5.77,"variable":-5.77},"40400":{"fixed":0,"total":-4.38,"variable":-4.38},"40600":{"fixed":0,"total":11,"variable":11},"40700":{"fixed":-1.62,"total":-1.62,"variable":0},"60300":{"fixed":0,"total":-2.92,"variable":-2.92},"60400":{"fixed":0,"total":-95.42,"variable":-95.42},"70500":{"fixed":0,"total":-222.5,"variable":-222.5},"80100":{"fixed":-27.83,"total":-27.83,"variable":0},"80700":{"fixed":-1196.9,"total":-1196.9,"variable":0},"90100":{"fixed":0,"total":-14.2,"variable":-14.2},"110200":{"fixed":0,"total":-30.26,"variable":-30.26},"110300":{"fixed":0,"total":-351.07,"variable":-351.07},"110700":{"fixed":0,"total":-1080,"variable":-1080},"130100":{"fixed":-110,"total":-110,"variable":0},"130500":{"fixed":0,"total":-117.96,"variable":-117.96},"130800":{"fixed":0,"total":-4.45,"variable":-4.45},"191000":{"fixed":0,"total":-293.42,"variable":-293.42},"200000":{"fixed":0,"total":-7.61,"variable":-7.61},"210000":{"fixed":-155,"total":-155,"variable":0}}},{"end":"2021-09-30","begin":"2021-09-01","label":"Setembro","amount":{"fixed":-1492.19,"total":-2678.36,"variable":-1186.17},"by_category":{"0":{"fixed":0,"total":-66.91,"variable":-66.91},"10000":{"fixed":-326.44,"total":-326.44,"variable":0},"30000":{"fixed":0,"total":-45,"variable":-45},"40000":{"fixed":0,"total":-1.5,"variable":-1.5},"60000":{"fixed":0,"total":-94.11,"variable":-94.11},"80000":{"fixed":-757.46,"total":-757.46,"variable":0},"110000":{"fixed":0,"total":-93.61,"variable":-93.61},"115000":{"fixed":0,"total":-340.8,"variable":-340.8},"120000":{"fixed":0,"total":-29.1,"variable":-29.1},"190000":{"fixed":0,"total":-515.14,"variable":-515.14},"1000010":{"fixed":-298.29,"total":-298.29,"variable":0},"1000011":{"fixed":-110,"total":-110,"variable":0}},"short_label":"Set","by_subcategory":{"0":{"fixed":0,"total":-66.91,"variable":-66.91},"10100":{"fixed":-69.84,"total":-69.84,"variable":0},"10300":{"fixed":-137.8,"total":-137.8,"variable":0},"10400":{"fixed":-8.43,"total":-8.43,"variable":0},"10500":{"fixed":-59.02,"total":-59.02,"variable":0},"10800":{"fixed":-51.35,"total":-51.35,"variable":0},"20200":{"fixed":-143.29,"total":-143.29,"variable":0},"30600":{"fixed":0,"total":-45,"variable":-45},"40400":{"fixed":0,"total":-1.5,"variable":-1.5},"60400":{"fixed":0,"total":-94.11,"variable":-94.11},"80100":{"fixed":-31.33,"total":-31.33,"variable":0},"80700":{"fixed":-726.13,"total":-726.13,"variable":0},"110300":{"fixed":0,"total":-340.8,"variable":-340.8},"110500":{"fixed":0,"total":-40.31,"variable":-40.31},"110600":{"fixed":0,"total":-53.3,"variable":-53.3},"120100":{"fixed":0,"total":-13.5,"variable":-13.5},"120300":{"fixed":0,"total":-15.6,"variable":-15.6},"130100":{"fixed":-110,"total":-110,"variable":0},"191000":{"fixed":0,"total":-515.14,"variable":-515.14},"210000":{"fixed":-155,"total":-155,"variable":0}}},{"end":"2021-10-31","begin":"2021-10-01","label":"Outubro","amount":{"fixed":-2025.37,"total":-4799.05,"variable":-2773.68},"by_category":{"0":{"fixed":0,"total":-102.32,"variable":-102.32},"10000":{"fixed":-212.53,"total":-212.53,"variable":0},"40000":{"fixed":0,"total":-0.47,"variable":-0.47},"60000":{"fixed":0,"total":-86.96,"variable":-86.96},"80000":{"fixed":-1090.87,"total":-1090.87,"variable":0},"110000":{"fixed":0,"total":-25.4,"variable":-25.4},"115000":{"fixed":0,"total":-602.53,"variable":-602.53},"120000":{"fixed":0,"total":-214.5,"variable":-214.5},"130000":{"fixed":0,"total":-121.07,"variable":-121.07},"190000":{"fixed":0,"total":-1525.02,"variable":-1525.02},"1000006":{"fixed":0,"total":-95.41,"variable":-95.41},"1000010":{"fixed":-611.97,"total":-611.97,"variable":0},"1000011":{"fixed":-110,"total":-110,"variable":0}},"short_label":"Out","by_subcategory":{"0":{"fixed":0,"total":-102.32,"variable":-102.32},"10100":{"fixed":-80.06,"total":-80.06,"variable":0},"10400":{"fixed":-16.74,"total":-16.74,"variable":0},"10500":{"fixed":-32.75,"total":-32.75,"variable":0},"10800":{"fixed":-82.98,"total":-82.98,"variable":0},"20200":{"fixed":-206.97,"total":-206.97,"variable":0},"40800":{"fixed":0,"total":-0.47,"variable":-0.47},"60100":{"fixed":0,"total":-22.48,"variable":-22.48},"60200":{"fixed":0,"total":-4.07,"variable":-4.07},"60300":{"fixed":0,"total":-13.8,"variable":-13.8},"60400":{"fixed":0,"total":-59.82,"variable":-59.82},"60500":{"fixed":0,"total":-0.59,"variable":-0.59},"80100":{"fixed":-40.19,"total":-40.19,"variable":0},"80700":{"fixed":-1050.68,"total":-1050.68,"variable":0},"110300":{"fixed":0,"total":-588.73,"variable":-588.73},"110600":{"fixed":0,"total":-25.4,"variable":-25.4},"120100":{"fixed":0,"total":-214.5,"variable":-214.5},"130100":{"fixed":-110,"total":-110,"variable":0},"130300":{"fixed":-250,"total":-250,"variable":0},"130500":{"fixed":0,"total":-121.07,"variable":-121.07},"191000":{"fixed":0,"total":-1525.02,"variable":-1525.02},"200000":{"fixed":0,"total":-95.41,"variable":-95.41},"210000":{"fixed":-155,"total":-155,"variable":0}}},{"end":"2021-11-30","begin":"2021-11-01","label":"Novembro","amount":{"fixed":-1413.42,"total":-6095.6,"variable":-4682.18},"by_category":{"0":{"fixed":0,"total":-469.53,"variable":-469.53},"10000":{"fixed":-95.92,"total":-95.92,"variable":0},"30000":{"fixed":0,"total":-12.52,"variable":-12.52},"60000":{"fixed":0,"total":-2225.02,"variable":-2225.02},"80000":{"fixed":-926.64,"total":-1007.2,"variable":-80.56},"110000":{"fixed":0,"total":-1139.99,"variable":-1139.99},"115000":{"fixed":0,"total":-489.05,"variable":-489.05},"130000":{"fixed":0,"total":-41.07,"variable":-41.07},"190000":{"fixed":0,"total":-144.18,"variable":-144.18},"1000006":{"fixed":0,"total":-80.26,"variable":-80.26},"1000010":{"fixed":-155,"total":-155,"variable":0},"1000011":{"fixed":-235.86,"total":-235.86,"variable":0}},"short_label":"Nov","by_subcategory":{"0":{"fixed":0,"total":-469.53,"variable":-469.53},"10100":{"fixed":-47.31,"total":-47.31,"variable":0},"10400":{"fixed":-48.61,"total":-48.61,"variable":0},"30600":{"fixed":0,"total":-12.52,"variable":-12.52},"60100":{"fixed":0,"total":-24.13,"variable":-24.13},"60200":{"fixed":0,"total":-1800,"variable":-1800},"60400":{"fixed":0,"total":-250.89,"variable":-250.89},"60500":{"fixed":0,"total":-150,"variable":-150},"80100":{"fixed":-40.22,"total":-40.22,"variable":0},"80400":{"fixed":0,"total":-80.56,"variable":-80.56},"80700":{"fixed":-886.42,"total":-886.42,"variable":0},"110300":{"fixed":0,"total":-489.05,"variable":-489.05},"110600":{"fixed":0,"total":-1139.99,"variable":-1139.99},"130100":{"fixed":-110,"total":-110,"variable":0},"130500":{"fixed":0,"total":-41.07,"variable":-41.07},"140000":{"fixed":0,"total":-80.26,"variable":-80.26},"191000":{"fixed":0,"total":-144.18,"variable":-144.18},"210000":{"fixed":-155,"total":-155,"variable":0},"220000":{"fixed":-125.86,"total":-125.86,"variable":0}}},{"end":"2021-12-31","begin":"2021-12-01","label":"Dezembro","amount":{"fixed":-229.85,"total":-3690.72,"variable":-3460.87},"by_category":{"0":{"fixed":0,"total":-640.77,"variable":-640.77},"10000":{"fixed":-229.85,"total":-229.85,"variable":0},"60000":{"fixed":0,"total":-313.39,"variable":-313.39},"110000":{"fixed":0,"total":-1489.05,"variable":-1489.05},"190000":{"fixed":0,"total":-157.92,"variable":-157.92},"1000006":{"fixed":0,"total":-33.6,"variable":-33.6},"1000014":{"fixed":0,"total":-826.14,"variable":-826.14}},"short_label":"Dez","by_subcategory":{"0":{"fixed":0,"total":-640.77,"variable":-640.77},"10100":{"fixed":-10.5,"total":-10.5,"variable":0},"10400":{"fixed":-219.35,"total":-219.35,"variable":0},"60400":{"fixed":0,"total":-313.39,"variable":-313.39},"110200":{"fixed":0,"total":-1339.2,"variable":-1339.2},"110400":{"fixed":0,"total":-149.85,"variable":-149.85},"191000":{"fixed":0,"total":-157.92,"variable":-157.92},"1000016":{"fixed":0,"total":-826.14,"variable":-826.14},"1000017":{"fixed":0,"total":-33.6,"variable":-33.6}}}],"data_type":"json"}],"etl_aggregations":[{"etl_aggregation_id":"855","etl_aggregation_name":"Highest Expense Last 3 Closed Months","rvar_object":"general_transactions","rvar_variable":"highest_expense_3_closed_months","rule":{"code":"    const _ = require('lodash');\n    const moment = require('moment');\n\n    const start = moment().subtract(3, 'months').startOf('month').valueOf();\n    const end = moment().subtract(1, 'months').endOf('month').valueOf();\n\n    transactions = transactions.filter(t => t.date.getTime() >= start\n                                            && t.date.getTime() <= end\n                                            && (t.budget_type === 'variable' || t.budget_type === 'fixed')\n                                            && t.cashflow === true\n                                            && t.cashflow_type === 'out'\n                                            && t.amount < 0\n                                            && t.enabled);\n\n    if (transactions.length < 1) return null;\n    const t = _.minBy(transactions, 'amount');\n    return {\n        desc: t.description,\n        amt: -t.amount,\n    }\n","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2021-12-08T18:56:15.859Z","updated_by":"leal@olivia.ai"}],"applicability_rules":[{"applicability_rule_id":873,"name":"Itau Completed any of the X-Ray convos","rule":[{"code":"    const WHITELIST = [\n        \"promo_inf_x_ray_inicial_not_spender_without_investments_b\",\n        \"promo_inf_x_ray_inicial_not_spender_with_investments_b\",\n        \"promo_inf_x_ray_inicial_spender_b\",\n        \"promo_inf_x_ray_inicial_not_spender_with_investments\",\n        \"promo_inf_x_ray_inicial_not_spender_0_0_b\",\n        \"promo_inf_x_ray_inicial_not_spender_0_0\",\n        \"promo_inf_x_ray_inicial_spender\",\n        \"promo_inf_x_ray_inicial_not_spender_without_investments\"\n    ];\n\n    for (const conversation in hist) {\n        if (typeof hist[conversation] != 'object') continue;\n        if (!WHITELIST.includes(conversation)) continue;\n        if (!hist[conversation].last_engaged) continue;\n\n        return true;\n    }\n\n    return false;\n","type":"custom","description":"True if user has engaged on any x-ray convo"}],"updated_at":"2021-12-08T18:56:15.802862","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_873"},{"applicability_rule_id":872,"name":"Spent on at least 2 different categories in the last 3 closed months","rule":[{"code":"    const _ = require('lodash');\n    const moment = require('moment');\n\n    if (!rvars\n        || !rvars.agg\n        || !rvars.agg.general_transactions\n        || !rvars.agg.general_transactions.highest_expense_3_closed_months) return 0;\n\n    const spending_data = _.get(dat.profile_overview_panel_section, 'totals.spending');\n\n    // Get closed months only\n    const months = [\n        moment().startOf('month').subtract(3, 'month').format('YYYY-MM-DD'),\n        moment().startOf('month').subtract(2, 'month').format('YYYY-MM-DD'),\n        moment().startOf('month').subtract(1, 'month').format('YYYY-MM-DD')\n    ];\n\n    const monthly_category_spending = months.map((date) => {\n        const object = _.find(spending_data, { 'begin': date });\n        if (object) return object.by_category;\n        return undefined;\n    }).filter(n => n);\n\n    return monthly_category_spending.length > 1;\n","type":"custom","description":""}],"updated_at":"2022-01-19T13:46:26.765498","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_872"}],"shadow":false,"requires_etls":["general_transactions.highest_expense_3_closed_months"],"conversation_group":"convos_itau_app_users","conversation_map_id":37193},{"promotion_id":"10455","name":"ops_onboarding","convo_template":"tpt_itau_onboarding","convo_variables":{"break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Pra isso, de agora em diante você vai encontrar por aqui:<br />📊 Resumos da sua vida financeira<br />🔔 Alertas de movimentações<br />💁 Recomendações personalizadas<br /><br />Tudo pensado para que você possa fazer mais com o seu dinheiro 💎<br /><br />📌Só para esclarecer, aqui seus dados estão seguros. E caso você queira deixar de receber dicas, desative na Configurações do Minhas Finanças.\"}}","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Queremos te ajudar a entender melhor as suas finanças! 🤗\"}}","content_body":"Pra isso, de agora em diante você vai encontrar por aqui:<br />📊 Resumos da sua vida financeira<br />🔔 Alertas de movimentações<br />💁 Recomendações personalizadas<br /><br />Tudo pensado para que você possa fazer mais com o seu dinheiro 💎<br /><br />📌Só para esclarecer, aqui seus dados estão seguros. E caso você queira deixar de receber dicas, desative na Configurações do Minhas Finanças.","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"\"}}","main_text_body":"Queremos te ajudar a entender melhor as suas finanças! 🤗","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"\",\"response\":\"\",\"link_text\":\"\"}}","user_option_delayed_body":"","user_option_engaged_body":"","user_option_dismissed_body":"","user_option_delayed_response":"","user_option_engaged_response":"","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-31T13:30:03.726Z","end_date":"2053-01-27T13:45:17.096Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-01-27T13:45:17.091Z","updated_by":"luciana.pavan@mailer.com.br","version":10,"profile_group_id":14,"previous_version":9,"convo_header":{"type":"alert","barrier":"Informações sobre como o produto irá funcionar.","behavior":"Apresentar o produto e fazer com que o usuário volte mais vezes, para ver mais insights.","benefits":"Ao olhar sempre as dicas, o usuário terá mais consciência sobre as suas finanças e dicas personalizadas.","cooldown":"99999","feed_cta":"me conta mais","feed_body":"A partir de agora te darei dicas para o seu dinheiro chegar mais longe.","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","triggerGroup":"","feed_subtitle":"dicas ","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"high","cooldownQueued":"99999","once_completed":"false","validation_ids":"","cooldownDelayed":"99999","cooldownEngaged":"99999","localHoursValid":"","review_settings":{"type":"none"},"expected_savings":"high","once_interrupted":"false","right_assumption":"high","time_sensitivity":"high","cooldownDismissed":"99999","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"99999","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"99999","requiredConversations":"master","applicability_rule_ids":"863","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["onboarding"]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":863,"name":"Itau Onboarding","rule":[{"code":"    if (!hist) return 1;\n\n    if (!!hist.promo_ops_onboarding_welcome_beta_tester && !!hist.promo_ops_onboarding_welcome_beta_tester.last_engaged) return 0;\n    if (!!hist.promo_ops_onboarding_welcome_beta_tester_b && !!hist.promo_ops_onboarding_welcome_beta_tester_b.last_engaged) return 0;\n\n    return 1;\n","type":"custom","description":"Do not repeat other onboarding conversations"}],"updated_at":"2021-12-23T17:47:21.303509","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_863"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37233},{"promotion_id":"10465","name":"inf_x_ray_inicial_spender_b","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Analisei suas movimentações e, nos últimos <b>3 meses</b>, numa <b>média mensal</b>, você:<br /><var>=context.currentSession.svars.string_average_income</var><br /><b>➡</b> gastou <b><var>=currency(context.currentSession.svars.average_spending)</var></b><br /><br />Suas despesas mensais passaram em <b><var>=currency(context.currentSession.svars.average_spending - context.currentSession.svars.average_income)</var></b> as receitas.\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"\"}}","content_body":"","notification":"Veja o raio-X das suas finanças para tomar melhores decisões 👀 ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"Quer conferir os números detalhados?\"}}","main_text_body":"Analisei suas movimentações e, nos últimos <b>3 meses</b>, numa <b>média mensal</b>, você:<br /><var>=context.currentSession.svars.string_average_income</var><br /><b>➡</b> gastou <b><var>=currency(context.currentSession.svars.average_spending)</var></b><br /><br />Suas despesas mensais passaram em <b><var>=currency(context.currentSession.svars.average_spending - context.currentSession.svars.average_income)</var></b> as receitas.","notification_2":" ","notification_3":" ","disclaimer_body":"","user_engaged_link":"","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"Quer conferir os números detalhados?","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Agora não\",\"response\":\"Ok! Depois a gente se fala 😉\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero sim!\",\"response\":\"Estes foram os seus números que aconteceram neste período:<var>=context.currentSession.svars.title_income</var><var>=context.currentSession.svars.income</var><br /><b>Despesas</b><br /><var>=context.currentSession.svars.spending</var><br /><br />Vou te acompanhar e te ajudar a traçar a melhor estratégia para equilibrar suas contas 💪\",\"link_text\":\"\",\"link\":\"\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não tenho interesse\",\"response\":\"Tudo bem, vou buscar outros assuntos pra você 😊\",\"link_text\":\"\"}}","user_option_delayed_body":"Agora não","user_option_engaged_body":"Quero sim!","user_option_dismissed_body":"Não tenho interesse","user_option_delayed_response":"Ok! Depois a gente se fala 😉","user_option_engaged_response":"Estes foram os seus números que aconteceram neste período:<var>=context.currentSession.svars.title_income</var><var>=context.currentSession.svars.income</var><br /><b>Despesas</b><br /><var>=context.currentSession.svars.spending</var><br /><br />Vou te acompanhar e te ajudar a traçar a melhor estratégia para equilibrar suas contas 💪","user_option_delayed_link_text":"","user_option_engaged_link_text":"","user_option_dismissed_response":"Tudo bem, vou buscar outros assuntos pra você 😊","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2021-03-25T12:22:20.083Z","end_date":"2053-01-31T19:36:38.878Z","validation_ids":[],"cooldown_groups":["itau_x_ray_inicial"],"updated_at":"2023-01-31T19:36:38.730Z","updated_by":"raimundo.botelho@mailer.com.br","version":25,"profile_group_id":14,"previous_version":24,"convo_header":{"type":"blocker_issue","barrier":"Realizamos as contas pelo usuário e fazemos uma análise inicial.","behavior":"Ajudar o usuário a entender seu padrão de gastos, sua situação financeira atual.","benefits":"Apoio emocional, ajudar o usuário a atingir seus objetivos mais rápido.","cooldown":"99999","feed_cta":"vamos nessa","feed_body":"Suas despesas do último trimestre precisam de atenção 🧐 Vamos checar alguns números?\n","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"raio-x","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"99999","once_completed":"false","validation_ids":"","cooldownDelayed":"99999","cooldownEngaged":"99999","localHoursValid":"","review_settings":{"type":"simple"},"expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"99999","notification_type":"insight","cooldownFrustrated":"99999","cooldownInteracted":"99999","cooldownThumbsDown":"99999","sharedCooldownGroup":"itau_x_ray_inicial","notificationCooldown":"99999","requiredConversations":"master","applicability_rule_ids":"799,728,866,9","cooldown_groups_merged":"true","session_variables_code":"    return {}; //#TODO FORMULA COM ERRO, QUEBRANDO OUTRAS CONVERSAS\n\n    const _ = require('lodash');\n    const moment = require('moment');\n    const { currency } = formulas;\n\n    const income_data = _.get(dat.profile_overview_panel_section, 'totals.income');\n    const spending_data = _.get(dat.profile_overview_panel_section, 'totals.spending');\n\n    // Get closed months only\n    const months = [\n        moment().startOf('month').subtract(3, 'month').format('YYYY-MM-DD'),\n        moment().startOf('month').subtract(2, 'month').format('YYYY-MM-DD'),\n        moment().startOf('month').subtract(1, 'month').format('YYYY-MM-DD')\n    ];\n\n    const monthly_income = months.map((date) => {\n        const object = _.find(income_data, { 'begin': date });\n        if (object) return { name: object.label, amount: object.amount.total };\n        return undefined;\n    }).filter(n => n);\n\n    const monthly_spending = months.map((date) => {\n        const object = _.find(spending_data, { 'begin': date });\n        if (object) return { name: object.label, amount: object.amount.total };\n        return undefined;\n    }).filter(n => n);\n\n    const average_income = monthly_income.reduce((acc, month) => acc + Math.abs(month.amount), 0) / 3;\n    const average_spending = monthly_spending.reduce((acc, month) => acc + Math.abs(month.amount), 0) / 3;\n    const string_average_income = (average_income > 0 ? `<b>➡</b> recebeu <b>${currency(average_income)}</b>` : '')\n\n    const title_income = (average_income > 0) ? `<br><b>Receitas</b><br>` : '';\n\n    //const summary_income = monthly_income.map((month) => `<b>➡</b> ${month.name}: <b>${currency(Math.abs(month.amount))}</b>`).join('<br/>');\n    //const summary_spending = monthly_spending.map((month) => `<b>➡</b> ${month.name}: <b>${currency(Math.abs(month.amount))}</b>`).join('<br/>');\n    const income_month1 = `<b>➡</b> ${monthly_income[0].name}: <b>${currency(monthly_income[0].amount)}</b>`\n    const income_month2 = `<b>➡</b> ${monthly_income[1].name}: <b>${currency(monthly_income[1].amount)}</b>`\n    const income_month3 = `<b>➡</b> ${monthly_income[2].name}: <b>${currency(monthly_income[2].amount)}</b>`\n    const income = (monthly_income[0].amount > 0 ? income_month1 : \"\") + (monthly_income[1].amount > 0 ? (monthly_income[0].amount > 0 ? \"<br>\" : \"\") + income_month2 : \"\") + (monthly_income[2].amount > 0 ? (monthly_income[1].amount > 0 || monthly_income[0].amount > 0 ? \"<br>\" : \"\") + income_month3 : \"\");\n\n    //Spending\n    const spending_month1 = `<b>➡</b> ${monthly_spending[0].name}: <b>${currency(monthly_spending[0].amount * -1)}</b>`\n    const spending_month2 = `<b>➡</b> ${monthly_spending[1].name}: <b>${currency(monthly_spending[1].amount * -1)}</b>`\n    const spending_month3 = `<b>➡</b> ${monthly_spending[2].name}: <b>${currency(monthly_spending[2].amount * -1)}</b>`\n    const spending = (monthly_spending[0].amount < 0 ? spending_month1 : \"\") + (monthly_spending[1].amount < 0 ? (monthly_spending[0].amount < 0 ? \"<br>\" : \"\") + spending_month2 : \"\") + (monthly_spending[2].amount < 0 ? (monthly_spending[1].amount < 0 || monthly_spending[0].amount < 0 ? \"<br>\" : \"\") + spending_month3 : \"\");\n    return { income, spending, average_income, average_spending, string_average_income, title_income };\n\n","session_variables_enabled":"true","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":["x-ray"]},"visible":true,"deleted":false,"default_values":[{"name":"profile_overview_panel_section.totals.income","type":"dat","value":[{"end":"2021-10-31","begin":"2021-10-01","label":"Outubro 2021","amount":{"fixed":0,"total":7352.24,"variable":7352.24},"short_label":"Out 2021"},{"end":"2021-11-30","begin":"2021-11-01","label":"Novembro 2021","amount":{"fixed":0,"total":2850,"variable":2850},"short_label":"Nov 2021"},{"end":"2021-12-31","begin":"2021-12-01","label":"Dezembro 2021","amount":{"fixed":1555,"total":287481.28,"variable":285926.28},"short_label":"Dez 2021"},{"end":"2022-01-31","begin":"2022-01-01","label":"Janeiro","amount":{"fixed":19496.4,"total":130975.08,"variable":111478.68},"short_label":"Jan"},{"end":"2022-02-28","begin":"2022-02-01","label":"Fevereiro","amount":{"fixed":25676.08,"total":378322.6,"variable":352646.52},"short_label":"Fev"},{"end":"2022-03-31","begin":"2022-03-01","label":"Março","amount":{"fixed":403,"total":5631.43,"variable":5228.43},"short_label":"Mar"},{"end":"2022-04-30","begin":"2022-04-01","label":"Abril","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Abr"},{"end":"2022-05-31","begin":"2022-05-01","label":"Maio","amount":{"fixed":0,"total":0,"variable":0},"short_label":"Mai"},{"end":"2022-06-30","begin":"2022-06-01","label":"Junho","amount":{"fixed":3500,"total":3500,"variable":0},"short_label":"Jun"},{"end":"2022-07-31","begin":"2022-07-01","label":"Julho","amount":{"fixed":0,"total":3952.04,"variable":3952.04},"short_label":"Jul"},{"end":"2022-08-31","begin":"2022-08-01","label":"Agosto","amount":{"fixed":0,"total":13745.32,"variable":13745.32},"short_label":"Ago"}],"data_type":"json"},{"name":"profile_overview_panel_section.totals.spending","type":"dat","value":[{"end":"2021-10-31","begin":"2021-10-01","label":"Outubro 2021","amount":{"fixed":-100,"total":-100,"variable":0},"by_category":{"10000":{"fixed":-100,"total":-100,"variable":0}},"short_label":"Out 2021","by_subcategory":{"10600":{"fixed":-100,"total":-100,"variable":0}}},{"end":"2021-11-30","begin":"2021-11-01","label":"Novembro 2021","amount":{"fixed":-99,"total":-99,"variable":0},"by_category":{"10000":{"fixed":-99,"total":-99,"variable":0}},"short_label":"Nov 2021","by_subcategory":{"10600":{"fixed":-99,"total":-99,"variable":0}}},{"end":"2021-12-31","begin":"2021-12-01","label":"Dezembro 2021","amount":{"fixed":-29035.2,"total":-493627.4,"variable":-464592.2},"by_category":{"0":{"fixed":0,"total":-45600,"variable":-45600},"10000":{"fixed":-305.56,"total":-305.56,"variable":0},"110000":{"fixed":0,"total":-1450,"variable":-1450},"180000":{"fixed":-28729.64,"total":-31778.8,"variable":-3049.16},"190000":{"fixed":0,"total":-414493.04,"variable":-414493.04}},"short_label":"Dez 2021","by_subcategory":{"0":{"fixed":0,"total":-45600,"variable":-45600},"10500":{"fixed":-199.56,"total":-199.56,"variable":0},"10600":{"fixed":-106,"total":-106,"variable":0},"111100":{"fixed":0,"total":-1450,"variable":-1450},"180100":{"fixed":-28729.64,"total":-28729.64,"variable":0},"180300":{"fixed":0,"total":-3049.16,"variable":-3049.16},"191000":{"fixed":0,"total":-414493.04,"variable":-414493.04}}},{"end":"2022-01-31","begin":"2022-01-01","label":"Janeiro","amount":{"fixed":-11196.58,"total":-328112.18,"variable":-316915.6},"by_category":{"10000":{"fixed":-121.9,"total":-121.9,"variable":0},"110000":{"fixed":0,"total":-443.51,"variable":-443.51},"180000":{"fixed":-11074.68,"total":-13395,"variable":-2320.32},"190000":{"fixed":0,"total":-313317.39,"variable":-313317.39},"250000":{"fixed":0,"total":-834.38,"variable":-834.38}},"short_label":"Jan","by_subcategory":{"10400":{"fixed":-16.9,"total":-16.9,"variable":0},"10600":{"fixed":-105,"total":-105,"variable":0},"110500":{"fixed":0,"total":-443.51,"variable":-443.51},"180100":{"fixed":-11074.68,"total":-11074.68,"variable":0},"180300":{"fixed":0,"total":-2320.32,"variable":-2320.32},"191000":{"fixed":0,"total":-313317.39,"variable":-313317.39},"250400":{"fixed":0,"total":-834.38,"variable":-834.38}}},{"end":"2022-02-28","begin":"2022-02-01","label":"Fevereiro","amount":{"fixed":-46595,"total":-1738650.36,"variable":-1692055.36},"by_category":{"0":{"fixed":0,"total":-1456963.52,"variable":-1456963.52},"10000":{"fixed":-103,"total":-103,"variable":0},"20000":{"fixed":-5336.48,"total":-5336.48,"variable":0},"90000":{"fixed":0,"total":-51,"variable":-51},"180000":{"fixed":-41155.52,"total":-50512.76,"variable":-9357.24},"190000":{"fixed":0,"total":-223481.23,"variable":-223481.23},"250000":{"fixed":0,"total":-2202.37,"variable":-2202.37}},"short_label":"Fev","by_subcategory":{"0":{"fixed":0,"total":-1456963.52,"variable":-1456963.52},"10600":{"fixed":-103,"total":-103,"variable":0},"20300":{"fixed":-5336.48,"total":-5336.48,"variable":0},"90100":{"fixed":0,"total":-51,"variable":-51},"180100":{"fixed":-41155.52,"total":-41155.52,"variable":0},"180300":{"fixed":0,"total":-9357.24,"variable":-9357.24},"191000":{"fixed":0,"total":-223481.23,"variable":-223481.23},"250400":{"fixed":0,"total":-2202.37,"variable":-2202.37}}},{"end":"2022-03-31","begin":"2022-03-01","label":"Março","amount":{"fixed":-220,"total":-3665.24,"variable":-3445.24},"by_category":{"10000":{"fixed":-220,"total":-220,"variable":0},"180000":{"fixed":0,"total":-1757.48,"variable":-1757.48},"190000":{"fixed":0,"total":-1165.76,"variable":-1165.76},"1000006":{"fixed":0,"total":-522,"variable":-522}},"short_label":"Mar","by_subcategory":{"10600":{"fixed":-220,"total":-220,"variable":0},"180300":{"fixed":0,"total":-1757.48,"variable":-1757.48},"191000":{"fixed":0,"total":-1165.76,"variable":-1165.76},"1000007":{"fixed":0,"total":-522,"variable":-522}}},{"end":"2022-04-30","begin":"2022-04-01","label":"Abril","amount":{"fixed":-5848.72,"total":-5848.72,"variable":0},"by_category":{"10000":{"fixed":-605,"total":-605,"variable":0},"180000":{"fixed":-5243.72,"total":-5243.72,"variable":0}},"short_label":"Abr","by_subcategory":{"10600":{"fixed":-605,"total":-605,"variable":0},"180100":{"fixed":-5243.72,"total":-5243.72,"variable":0}}},{"end":"2022-05-31","begin":"2022-05-01","label":"Maio","amount":{"fixed":-101,"total":-101,"variable":0},"by_category":{"10000":{"fixed":-101,"total":-101,"variable":0}},"short_label":"Mai","by_subcategory":{"10600":{"fixed":-101,"total":-101,"variable":0}}},{"end":"2022-06-30","begin":"2022-06-01","label":"Junho","amount":{"fixed":215.84,"total":-5852.17,"variable":-6068.01},"by_category":{"10000":{"fixed":350,"total":350,"variable":0},"130000":{"fixed":0,"total":-3599.74,"variable":-3599.74},"180000":{"fixed":-134.16,"total":-134.16,"variable":0},"1000006":{"fixed":0,"total":-2468.27,"variable":-2468.27}},"short_label":"Jun","by_subcategory":{"10600":{"fixed":350,"total":350,"variable":0},"131200":{"fixed":0,"total":-3599.74,"variable":-3599.74},"180100":{"fixed":-134.16,"total":-134.16,"variable":0},"1000008":{"fixed":0,"total":-2468.27,"variable":-2468.27}}},{"end":"2022-07-31","begin":"2022-07-01","label":"Julho","amount":{"fixed":0,"total":-3693.3,"variable":-3693.3},"by_category":{"190000":{"fixed":0,"total":-2646.65,"variable":-2646.65},"1000006":{"fixed":0,"total":-1046.65,"variable":-1046.65}},"short_label":"Jul","by_subcategory":{"191000":{"fixed":0,"total":-2646.65,"variable":-2646.65},"200000":{"fixed":0,"total":-1046.65,"variable":-1046.65}}},{"end":"2022-08-31","begin":"2022-08-01","label":"Agosto","amount":{"fixed":-562.53,"total":-1651.41,"variable":-1088.88},"by_category":{"180000":{"fixed":-562.53,"total":-1106.41,"variable":-543.88},"190000":{"fixed":0,"total":-545,"variable":-545}},"short_label":"Ago","by_subcategory":{"180100":{"fixed":-562.53,"total":-562.53,"variable":0},"180300":{"fixed":0,"total":-543.88,"variable":-543.88},"191000":{"fixed":0,"total":-545,"variable":-545}}}],"data_type":"json"}],"etl_aggregations":[],"applicability_rules":[{"applicability_rule_id":799,"name":"Income < Spending in the last 3 closed Months","rule":[{"code":"  if (!dat\n    || !dat.profile_overview_panel_section\n    || !dat.profile_overview_panel_section.totals.income\n    || !dat.profile_overview_panel_section.totals.spending\n  ) return false;\n\n  const _ = require('lodash');\n  const moment = require('moment');\n\n  const income_data = _.get(dat.profile_overview_panel_section, 'totals.income');\n  const spending_data = _.get(dat.profile_overview_panel_section, 'totals.spending');\n\n  // Get closed months only\n  const months = [\n    moment().startOf('month').subtract(3, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(2, 'month').format('YYYY-MM-DD'),\n    moment().startOf('month').subtract(1, 'month').format('YYYY-MM-DD')\n  ];\n\n  const monthly_income = months.map((date) => {\n    const object = _.find(income_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  const monthly_spending = months.map((date) => {\n    const object = _.find(spending_data, { 'begin': date });\n    if (object) return Math.abs(object.amount.total);\n    return 0;\n  }).reduce((acc, value) => acc + value);\n\n  return monthly_spending > monthly_income;\n","type":"custom","description":""}],"updated_at":"2021-11-25T21:34:44.17071","updated_by":"leal@olivia.ai","applicability_name":"applicability_rule_id_799"},{"applicability_rule_id":728,"name":"User belongs to AB test group 2","rule":[{"type":"compare","operator":"=","left_value":{"type":"variable","variable":"externalData.profile_settings.feature_flags.ab_test"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2021-05-24T19:45:25.864858","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_728"},{"applicability_rule_id":866,"name":"Check loading feed flag AND last_queued  before 2021-11-13","rule":[{"code":"    const _ = require('lodash');\n\n    const convo = _.get(hist, conversationName) || {};\n    const last_queued = convo.last_queued || 0;\n    if (context.is_loading_feed == true && last_queued < new Date('2021-11-13')) {\n        return 0;\n    }\n    return 1;\n","type":"custom","description":""}],"updated_at":"2021-11-12T16:48:59.140237","updated_by":"ivanir@olivia.ai","applicability_name":"applicability_rule_id_866"},{"applicability_rule_id":9,"name":"Nobody - Constant 0","rule":[{"type":"compare","operator":"=","left_value":{"type":"fixed","value":2,"variable_type":"int"},"right_value":{"type":"fixed","value":1,"variable_type":"int"}}],"updated_at":"2020-11-27T18:19:54.559659","updated_by":"bruno@olivia.ai","applicability_name":"applicability_rule_id_9"}],"shadow":false,"conversation_group":"convos_itau_app_users","conversation_map_id":37167},{"promotion_id":"10466","name":"inf_itau_shop","convo_template":"tpt_itau_base","convo_variables":{"code":"{\"bubbleTemplate\":\"code\",\"variables\":{\"body\":\"\"}}","break":"{\"bubbleTemplate\":\"hr\",\"variables\":{}}","content":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Te conto isso porque eu sei que você gosta de fazer compras online e com segurança. E, melhor ainda, fazer tudo por aqui, dentro do app.\"}}","code_body":"","main_text":"{\"bubbleTemplate\":\"main_text\",\"variables\":{\"body\":\"Tenho novidades: uma nova forma de você comprar tudo o que precisa em um só local! No <b>Itaú Shop</b> você compra até o seu ingresso para o Carnaval 2023! 🥁\"}}","disclaimer":"{\"bubbleTemplate\":\"text\",\"variables\":{\"body\":\"Semanalmente tem promoções diferentes com até 50% de desconto e 10% de cashback à vista ou opção de pagamento em, no mínimo, 12x sem juros com seu cartão Itaú.\"}}","content_body":"Te conto isso porque eu sei que você gosta de fazer compras online e com segurança. E, melhor ainda, fazer tudo por aqui, dentro do app.","notification":" ","external_link":"{\"bubbleTemplate\":\"external_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","internal_link":"{\"bubbleTemplate\":\"internal_link\",\"variables\":{\"body\":\"\",\"link\":\"\"}}","call_to_action":"{\"bubbleTemplate\":\"cta\",\"variables\":{\"body\":\"E tem mais, quer saber como comprar no Itau Shop sem tirar dinheiro do bolso? 💸\"}}","main_text_body":"Tenho novidades: uma nova forma de você comprar tudo o que precisa em um só local! No <b>Itaú Shop</b> você compra até o seu ingresso para o Carnaval 2023! 🥁","notification_2":" ","notification_3":" ","disclaimer_body":"Semanalmente tem promoções diferentes com até 50% de desconto e 10% de cashback à vista ou opção de pagamento em, no mínimo, 12x sem juros com seu cartão Itaú.","user_engaged_link":"https://itau_shop","external_link_body":"","external_link_link":"","internal_link_body":"","internal_link_link":"","call_to_action_body":"E tem mais, quer saber como comprar no Itau Shop sem tirar dinheiro do bolso? 💸","user_option_delayed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Agora não\",\"response\":\"Tá bem. Nos falamos depois.\",\"link_text\":\"\"}}","user_option_engaged":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Quero saber!\",\"response\":\"Você pode comprar sem desembolsar nada. Escolha pagar com seus pontos Iupp, caso tenha, ou usar o cashback das compras anteriores.\",\"link_text\":\"Clique agora para conhecer essa novidade aqui mesmo pelo app.\",\"link\":\"https://itau_shop\"}}","user_option_dismissed":"{\"bubbleTemplate\":\"feedback\",\"variables\":{\"body\":\"Não quero saber\",\"response\":\"Tá bem! A qualquer momento você pode conhecer o Itaú Shop, aqui na <b>aba produtos.</b> 😉\",\"link_text\":\"\"}}","user_option_delayed_body":"Agora não","user_option_engaged_body":"Quero saber!","user_option_dismissed_body":"Não quero saber","user_option_delayed_response":"Tá bem. Nos falamos depois.","user_option_engaged_response":"Você pode comprar sem desembolsar nada. Escolha pagar com seus pontos Iupp, caso tenha, ou usar o cashback das compras anteriores.","user_option_delayed_link_text":"","user_option_engaged_link_text":"Clique agora para conhecer essa novidade aqui mesmo pelo app.","user_option_dismissed_response":"Tá bem! A qualquer momento você pode conhecer o Itaú Shop, aqui na <b>aba produtos.</b> 😉","user_option_dismissed_link_text":""},"priority":1,"applicability_rule_id":null,"enabled":true,"start_date":"2022-04-01T17:35:25.442Z","end_date":"2053-02-06T18:14:25.531Z","validation_ids":[],"cooldown_groups":[],"updated_at":"2023-02-06T18:14:25.386Z","updated_by":"leonardo-flavio.santos@mailer.com.br","version":22,"profile_group_id":14,"previous_version":21,"convo_header":{"type":"default","cooldown":"0","feed_cta":"vamos","feed_body":"Fazer compras sem tirar dinheiro do bolso, ganhar cashback e ainda pagar em até 12x sem juros. Vem conhecer esta novidade!","categories":"","feed_media":"","feed_title":"","persistent":"false","cvr_enabled":"false","cvr_formula":"","header_text":"","triggerGroup":"","feed_subtitle":"dica de economia","priority_name":"0","same_priority":"true","triggerBubble":"","user_easiness":"medium","cooldownQueued":"720","once_completed":"false","validation_ids":"","cooldownDelayed":"48","cooldownEngaged":"8760","localHoursValid":"","expected_savings":"medium","once_interrupted":"false","right_assumption":"medium","time_sensitivity":"low","cooldownDismissed":"2880","notification_type":"insight","cooldownFrustrated":"5760","cooldownInteracted":"24","cooldownThumbsDown":"99999","sharedCooldownGroup":"","notificationCooldown":"48720","requiredConversations":"master","applicability_rule_ids":"2147483657,2147483659,2147483661","cooldown_groups_merged":"true","session_variables_code":"","session_variables_enabled":"false","notification_priority_name":"0","notificationLocalHoursValid":"[8,21]","notificationSharedCooldownGroup":"","notification_cooldown_groups_merged":"true","tags":[]},"visible":true,"deleted":false,"default_values":null,"etl_aggregations":[{"etl_aggregation_id":"2147483658","etl_aggregation_name":"itau_shop_last_180_days_count","rvar_object":"itau_shop","rvar_variable":"last_180_days","rule":{"code":"    const moment = require('moment');\n\n\n    const literal = 'shop \\| itau'\n    const itauRegex = new RegExp(`.*${literal}.*`, 'i')\n\n    const startDate = moment().startOf('month').subtract(180, 'days');\n\n    const shopTransactions = transactions.filter(t => (\n        itauRegex.test(t.relevant_description) &&\n        t.date >= startDate &&\n        t.date <= moment.now()\n    ));\n    return { count: shopTransactions.length || 0 }\n\n\n","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2023-02-06T14:52:08.298Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"2147483655","etl_aggregation_name":"marketPlaceExpenses","rvar_object":"expenses","rvar_variable":"last_60_days","rule":{"code":"    const moment = require('moment');\n\n    const regexLiteralsList = [\n        'shopee',\n        'aliexpress',\n        'ame dig',\n        'kabum',\n        'madeiramad',\n        'ebay',\n        'itau shop',\n        'amazon.com',\n        'amazon market',\n        'casas bahia',\n        'magalu',\n        'mercadoli',\n        'fast shop',\n        'lojas ameri',\n    ];\n\n    const generateRegexList = (literals = []) => {\n        const list = [];\n        literals.forEach((literal) => {\n            literal = literal.replace(' ', '\\\\s*');\n            list.push(new RegExp(`.*${literal}.*`, 'i'));\n        });\n\n        return list;\n    };\n\n    const regexList = generateRegexList(regexLiteralsList);\n\n    const startDate = moment().startOf('month').subtract(60, 'days');\n\n    const periodTransactions = transactions.filter(t => (\n        t.olivia_category_level1_id === 110000 &&\n        t.date >= startDate &&\n        t.date <= moment.now()\n    ));\n    let marketPlaceExpenses = 0;\n    periodTransactions.forEach((t) => {\n        regexList.some((rx) => rx.test(t.description.toLowerCase())) ? ++marketPlaceExpenses : null;\n    });\n\n    return marketPlaceExpenses\n\n","type":"custom","filter":{"$valid_transactions":true},"description":"marketPlaceExpenses","invert_value":true},"updated_at":"2023-02-02T12:09:03.175Z","updated_by":"leonardo-flavio.santos@mailer.com.br"},{"etl_aggregation_id":"824","etl_aggregation_name":"Credit Card Expenses","rvar_object":"credit_card","rvar_variable":"totals","rule":{"code":"    const moment = require('moment');\n    const last_30d = moment().subtract(30, 'days').startOf('day').valueOf();\n    const last_90d = moment().subtract(90, 'days').startOf('day').valueOf();\n    const last_120d = moment().subtract(120, 'days').startOf('day').valueOf();\n    const last_180d = moment().subtract(180, 'days').startOf('day').valueOf();\n    const credit_card_transactions = transactions.filter(t => t.enabled && t.account_type_id == 200);\n\n    const credit_card_expenses = credit_card_transactions.filter(t =>\n        (t.budget_type === 'variable' || t.budget_type === 'fixed')\n        && t.cashflow === true\n        && t.cashflow_type === 'out');\n\n    const spending_30d = credit_card_expenses.filter(t => t.date.getTime() >= last_30d).reduce((acc, item) => acc - item.amount, 0);\n    const spending_90d = credit_card_expenses.filter(t => t.date.getTime() >= last_90d).reduce((acc, item) => acc - item.amount, 0);\n    const spending_120d = credit_card_expenses.filter(t => t.date.getTime() >= last_120d).reduce((acc, item) => acc - item.amount, 0);\n    const spending_180d = credit_card_expenses.filter(t => t.date.getTime() >= last_180d).reduce((acc, item) => acc - item.amount, 0);\n    return { spending_30d, spending_90d, spending_120d, spending_180d };\n","type":"custom","filter":{"$valid_transactions":true},"invert_value":true},"updated_at":"2023-02-06T18:12:31.927Z","updated_by":"leonardo-flavio.santos@mailer.com.br"}],"applicability_rules":[{"applicability_rule_id":2147483657,"name":"Has Credit Card Expenses at last 90 Days","rule":[{"code":"    if (!rvars\n        || !rvars.agg\n        || !rvars.agg.credit_card\n        || !rvars.agg.credit_card.totals) return 0;\n\n    return !!rvars.agg.credit_card.totals.spending_90d\n","type":"custom","description":""}],"updated_at":"2023-01-23T15:23:24.988876","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_2147483657"},{"applicability_rule_id":2147483659,"name":"has marketplace expenses 60 days","rule":[{"type":"compare","operator":">","left_value":{"type":"variable","variable":"rvars.agg.expenses.last_60_days"},"right_value":{"type":"fixed","value":"2","variable_type":"int"}}],"updated_at":"2023-02-06T18:07:00.641","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_2147483659"},{"applicability_rule_id":2147483661,"name":" wont has expenses in itau shop in last 180 days","rule":[{"code":"\n    if (!rvars || !rvars.agg || !rvars.agg.itau_shop || !rvars.agg.itau_shop.last_180_days || rvars.agg.itau_shop.last_180_days.count === null) return false\n\n    return rvars.agg.itau_shop.last_180_days.count < 1\n","type":"custom","description":"check if wont has expenses in itau shop in last 180 days"}],"updated_at":"2023-02-06T14:50:11.58032","updated_by":"leonardo-flavio.santos@mailer.com.br","applicability_name":"applicability_rule_id_2147483661"}],"shadow":false,"requires_etls":["itau_shop.last_180_days","expenses.last_60_days","credit_card.totals"],"conversation_group":"convos_itau_app_users","conversation_map_id":37210}],"conversations_precedence_graph":{"conversations":[{"name":"master","paths":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]},{"name":"tpt_itau_alert_restituicao_ir","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownQueued":72,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_alert_restituicao_ir_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_alert_restituicao_ir_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_you_got_paid_other_gains","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownDismissed":99999,"cooldownFrustrated":99999,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_you_got_paid_other_gains_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_you_got_paid_other_gains_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_you_got_paid_paycheck","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownDismissed":99999,"cooldownFrustrated":99999,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_you_got_paid_paycheck_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_you_got_paid_paycheck_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_base_no_options_no_cooldown","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"priority":"0","priority_name":"tpt_itau_base_no_options_no_cooldown_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_base_no_options_no_cooldown_notification_priority","notification_begin":"451","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_summary","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldown":720,"cooldownInteracted":720,"cooldownEngaged":720,"cooldownDelayed":8,"cooldownDismissed":720,"cooldownFrustrated":720,"cooldownThumbsDown":720,"priority":"0","priority_name":"tpt_itau_summary_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_summary_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_base","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownQueued":720,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_base_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_base_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_base_no_options","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownQueued":720,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_base_no_options_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_base_no_options_notification_priority","notification_begin":"451","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_onboarding","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":99999,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownQueued":99999,"cooldown":99999,"cooldownInteracted":99999,"cooldownEngaged":99999,"cooldownDelayed":99999,"cooldownDismissed":99999,"cooldownFrustrated":99999,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_onboarding_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_onboarding_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_missing_bills","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldown":360,"cooldownInteracted":360,"cooldownEngaged":360,"cooldownDelayed":8,"cooldownDismissed":360,"cooldownFrustrated":360,"cooldownThumbsDown":360,"priority":"0","priority_name":"tpt_itau_missing_bills_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_missing_bills_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_base_summary","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownQueued":72,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_base_summary_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_base_summary_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_insufficient_funds_for_payment","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"priority":"0","priority_name":"tpt_itau_insufficient_funds_for_payment_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_insufficient_funds_for_payment_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_alert_nota_fiscal_paulista","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldown":720,"cooldownInteracted":720,"cooldownEngaged":720,"cooldownDelayed":720,"cooldownDismissed":99999,"cooldownFrustrated":99999,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_alert_nota_fiscal_paulista_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_alert_nota_fiscal_paulista_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_unusual_expense_agua","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_unusual_expense_agua_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_agua_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_unusual_expense_internet","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_unusual_expense_internet_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_internet_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_unusual_expense_gas","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_unusual_expense_gas_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_gas_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_unusual_expense_celular","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_unusual_expense_celular_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_celular_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]},{"name":"tpt_itau_unusual_expense_luz","type":"default","validation_ids":[],"once_completed":false,"once_interrupted":false,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","categories":[],"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"requiredConversations":["master"],"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"priority":"0","priority_name":"tpt_itau_unusual_expense_luz_priority","notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_luz_notification_priority","notification_begin":"368","tags":[],"requires":[],"requires_reserved_variables":[]}],"name":"conversations_precedence_graph","start_index":0,"version":"convos_itau_app_users"},"session_queue_prototype":{"types":[{"types":["greetings"],"maximum":1},{"types":["blocker_issue"],"maximum":1},{"types":["extra_start"],"maximum":1,"previous_types_forbidden":["blocker_issue"]},{"types":["major_issue"],"maximum":1,"previous_types_forbidden":["blocker_issue"]},{"types":["reminder","alert"],"maximum":1,"previous_types_forbidden":["blocker_issue"]},{"types":["default"],"maximum":1,"previous_types_forbidden":["blocker_issue"],"allow_same_type":true,"allow_only_time_sensitive":true},{"types":["seasonal"],"maximum":1,"previous_types_forbidden":["blocker_issue"]},{"types":["challenge"],"maximum":1,"previous_types_forbidden":["blocker_issue"]},{"types":["default"],"maximum":1,"previous_types_forbidden":["blocker_issue"],"allow_same_type":true},{"types":["extra_end"],"maximum":1,"previous_types_forbidden":["blocker_issue"]},{"types":["ending"],"maximum":1}],"minimum":3,"allow_same_type":true},"conversation_maps":{"tpt_itau_alert_restituicao_ir":{"begin":"417","conversation_states":[{"name":"417","type":"olivia","paths":[{"script":{"name":"blockDeprioritization","params":[]},"next":"426","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_417"}]},{"name":"426","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_alert_restituicao_ir_426"},{"type":"string","value":"let current_transaction = false;\n\n// first time\nif (!ivars.tax_refund_history) {\n  current_transaction = rvars.aggregate_other_income.tax_refund_transactions[0];\n  ivars.tax_refund_history = [current_transaction.transaction_id];\n      }\nelse {\n  // other times\n  let show = 0;\n  for (const i in rvars.aggregate_other_income.tax_refund_transactions) {\n    show = 1;\n    for (const j in ivars.tax_refund_history) {\n      if (ivars.tax_refund_history[j] == rvars.aggregate_other_income.tax_refund_transactions[i].transaction_id) {\n        show = 0;\n        break;\n      }\n    }\n\n    if (show) {\n      current_transaction = rvars.aggregate_other_income.tax_refund_transactions[i];\n      ivars.tax_refund_history.push(current_transaction.transaction_id);\n    }\n  }\n\n  // failsafe\n  if (!current_transaction) {\n    current_transaction = rvars.aggregate_other_income.tax_refund_transactions[0];\n    ivars.tax_refund_history = [current_transaction.transaction_id];\n  }\n}\n\nivars.temp_current_transaction = current_transaction;\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_426"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"381","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_378"}]},{"name":"381","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_381"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"name":"149","order":"numerical_constant_two","order_name":"tpt_itau_alert_restituicao_ir_322"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"name":"320","order":"numerical_constant_three","order_name":"tpt_itau_alert_restituicao_ir_322"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"name":"326","order":"numerical_constant_four","order_name":"tpt_itau_alert_restituicao_ir_322"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_393"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_alert_restituicao_ir","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":72,"cooldown":0,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_alert_restituicao_ir_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_restituicao_ir_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_alert_restituicao_ir_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["aggregate_other_income"],"hash":"086f6104301e2b3fd2b36e46cef267a5738c9571","shadow":false,"conversation_map_id":37152},"tpt_itau_you_got_paid_other_gains":{"begin":"433","conversation_states":[{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_you_got_paid_other_gains_433"},{"type":"string","value":"const moment = require('moment');\n\nlet current_transaction = false;\nlet failsafe = false;\n\nfor(const transaction of rvars.agg.income_transactions.last_7d) {\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n    || transaction.olivia_category_id == 150300\n    || !(transaction.amount > 200)\n  ) continue;\n\n  failsafe = transaction;\n\n  if(!!ivars.you_got_paid_other_gains_historic\n      && ivars.you_got_paid_other_gains_historic.some((hist) => hist == transaction.transaction_id)) continue;\n  current_transaction = transaction;\n}\n\n// Memory control\nif (current_transaction) {\n  ivars.you_got_paid_other_gains_historic = ivars.you_got_paid_other_gains_historic || [];\n  ivars.you_got_paid_other_gains_historic.push(current_transaction.transaction_id);\n}\n\n// Failsafe\nif (!current_transaction) {\n  current_transaction = failsafe;\n}\n\nivars.temp_current_transaction_amount = current_transaction.amount;\nivars.temp_current_transaction_description = current_transaction.description;\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_other_gains_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_other_gains_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"469","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_other_gains_375"}]},{"name":"469","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"458","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_other_gains_469"}]},{"name":"458","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"461","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_other_gains_458"}]},{"name":"461","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"456","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_other_gains_461"}]},{"name":"456","type":"olivia"}],"end":"456","name":"tpt_itau_you_got_paid_other_gains","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":0,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":0,"cooldownInteracted":0,"cooldownEngaged":0,"cooldownDelayed":0,"cooldownDismissed":99999,"cooldownFrustrated":99999,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_you_got_paid_other_gains_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_other_gains_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_you_got_paid_other_gains_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["agg"],"hash":"9786e9f2f5141b5fcc9cd349492b6c695afa810c","shadow":false,"etl_aggregations":[{"etl_aggregation_id":"753","etl_aggregation_name":"Income Transactions Since 7 Days Ago","rvar_object":"income_transactions","rvar_variable":"last_7d","rule":{"code":"    const moment = require('moment');\n\n    const LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS = [103, 104, 105, 201, 202, 203];\n    const seven_days_ago = moment.utc().subtract(7, 'days').startOf('day').valueOf();\n    const current_time = moment.utc().valueOf();\n    const income_array = [];\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.cashflow_type === 'in'\n            && !LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS.includes(transaction.account_type_id)\n            && transaction.enabled\n            && !transaction.pending\n            && m >= seven_days_ago\n            && m <= current_time\n        ) {\n            const transaction_data = {\n                amount: transaction.amount,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                transaction_id: transaction.transaction_id,\n                olivia_category_id: transaction.olivia_category_id,\n                description: transaction.description\n            };\n\n            income_array.push(transaction_data);\n        }\n    }\n\n    income_array.sort((a, b) => a.timestamp - b.timestamp);\n\n    return income_array;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate income transactions since the last 7 days","invert_value":true},"updated_at":"2021-04-14T14:18:45.963Z","updated_by":"leal@olivia.ai"}],"requires_etls":["income_transactions.last_7d"],"conversation_map_id":37155},"tpt_itau_you_got_paid_paycheck":{"begin":"433","conversation_states":[{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_you_got_paid_paycheck_433"},{"type":"string","value":"const moment = require('moment');\n\nlet current_transaction = false;\nlet failsafe = false;\n\nfor(const transaction of rvars.agg.income_transactions.last_7d) {\n  if(moment().endOf('day').diff(moment(transaction.timestamp).startOf('day'), 'days') > 3\n    || !(transaction.olivia_category_id == 150300)\n    ) continue;\n\n  failsafe = transaction;\n\n  if(!!ivars.you_got_paid_paycheck_historic\n      && ivars.you_got_paid_paycheck_historic.some((hist) => hist == transaction.transaction_id)) continue;\n  current_transaction = transaction;\n}\n\n// Memory control\nif (current_transaction) {\n  ivars.you_got_paid_paycheck_historic = ivars.you_got_paid_paycheck_historic || [];\n  ivars.you_got_paid_paycheck_historic.push(current_transaction.transaction_id);\n}\n\n// Failsafe\nif (!current_transaction) {\n  current_transaction = failsafe;\n}\n\nivars.temp_current_transaction_amount = current_transaction.amount;\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_paycheck_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_paycheck_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"469","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_paycheck_375"}]},{"name":"469","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"458","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_paycheck_469"}]},{"name":"458","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"461","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_paycheck_458"}]},{"name":"461","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"456","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_paycheck_461"}]},{"name":"456","type":"olivia"}],"end":"456","name":"tpt_itau_you_got_paid_paycheck","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":0,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":0,"cooldownInteracted":0,"cooldownEngaged":0,"cooldownDelayed":0,"cooldownDismissed":99999,"cooldownFrustrated":99999,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_you_got_paid_paycheck_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_you_got_paid_paycheck_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_you_got_paid_paycheck_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["agg"],"hash":"e712d033c96892f2f97dbbed55a9857208eb730c","shadow":false,"etl_aggregations":[{"etl_aggregation_id":"753","etl_aggregation_name":"Income Transactions Since 7 Days Ago","rvar_object":"income_transactions","rvar_variable":"last_7d","rule":{"code":"    const moment = require('moment');\n\n    const LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS = [103, 104, 105, 201, 202, 203];\n    const seven_days_ago = moment.utc().subtract(7, 'days').startOf('day').valueOf();\n    const current_time = moment.utc().valueOf();\n    const income_array = [];\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.cashflow_type === 'in'\n            && !LOAN_OR_INVESTMENT_ACCOUNT_TYPE_IDS.includes(transaction.account_type_id)\n            && transaction.enabled\n            && !transaction.pending\n            && m >= seven_days_ago\n            && m <= current_time\n        ) {\n            const transaction_data = {\n                amount: transaction.amount,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                transaction_id: transaction.transaction_id,\n                olivia_category_id: transaction.olivia_category_id,\n                description: transaction.description\n            };\n\n            income_array.push(transaction_data);\n        }\n    }\n\n    income_array.sort((a, b) => a.timestamp - b.timestamp);\n\n    return income_array;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate income transactions since the last 7 days","invert_value":true},"updated_at":"2021-04-14T14:18:45.963Z","updated_by":"leal@olivia.ai"}],"requires_etls":["income_transactions.last_7d"],"conversation_map_id":37145},"tpt_itau_base_no_options_no_cooldown":{"begin":"417","conversation_states":[{"name":"417","type":"olivia","paths":[{"script":{"name":"blockDeprioritization","params":[]},"next":"433","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_no_cooldown_417"}]},{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_base_no_options_no_cooldown_433"},{"type":"variable","value":"CT:code@code"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_no_cooldown_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_no_cooldown_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_no_cooldown_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_no_cooldown_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"447","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_no_cooldown_378"}]},{"name":"447","type":"olivia","paths":[{"body":"<input id=\"CT:internal_link@internal_link\"></input>","next":"440","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_no_cooldown_447"}]},{"name":"440","type":"olivia","paths":[{"body":"<input id=\"CT:disclaimer@text\"></input>","next":"443","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_no_cooldown_440"}]},{"name":"443","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"438","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_no_cooldown_443"}]},{"name":"438","type":"olivia"}],"end":"438","name":"tpt_itau_base_no_options_no_cooldown","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":0,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":0,"cooldownInteracted":0,"cooldownEngaged":0,"cooldownDelayed":0,"cooldownDismissed":0,"cooldownFrustrated":0,"cooldownThumbsDown":0,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_base_no_options_no_cooldown_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"451","notification_states":[{"name":"451","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"templateVariableEmpty('notification', conversationName)","probability_name":"tpt_itau_base_no_options_no_cooldown_452","template_order":"","name":"454","alias":"n1$nyt"},{"body":"<input id=\"CT:notification_2\"></input>","probability":"templateVariableEmpty('notification_2', conversationName)","probability_name":"tpt_itau_base_no_options_no_cooldown_453","template_order":"","name":"457","alias":"n2$1aiz"},{"body":"<input id=\"CT:notification_3\"></input>","probability":"templateVariableEmpty('notification_3', conversationName)","probability_name":"tpt_itau_base_no_options_no_cooldown_463","template_order":"","name":"460","alias":"n3$oei"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_base_no_options_no_cooldown_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":[],"hash":"c976e6ac99b4a2d9e779357b35f4a7451a7b7bfd","shadow":false,"conversation_map_id":37158},"tpt_itau_summary":{"begin":"417","conversation_states":[{"name":"417","type":"olivia","paths":[{"script":{"name":"blockDeprioritization","params":[]},"next":"421","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_417"}]},{"name":"421","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_summary_421"},{"type":"string","value":"const moment = require('moment');\nivars.last_week_rolling_totals = '';\nivars.last_week_rolling_spending = '';\nivars.last_month_totals = '';\nivars.last_month_variations = '';\nivars.partial_periods_totals = {};\nivars.partial_periods_expenses = {};\nivars.sumary_conversation_name = conversationName;\n\nif   (dat\n   && dat.profile_overview_panel_section\n   && dat.profile_overview_panel_section.last_week_rolling\n   && dat.profile_overview_panel_section.totals \n   && dat.profile_overview_panel_section.totals.spending\n   && dat.profile_overview_panel_section.totals.income\n   && dat.profile_overview_panel_section.totals.investments\n   && dat.profile_overview_panel_section.totals.spending.length > 4\n   && dat.profile_overview_panel_section.totals.income.length > 4\n   && dat.profile_overview_panel_section.totals.investments.length > 4) {\n\n // Last Month\n\n    // totals\n    const totals_income = dat.profile_overview_panel_section.totals.income;\n    const totals_last_income = dat.profile_overview_panel_section.totals.income[dat.profile_overview_panel_section.totals.income.length-2];\n    const last_cycle_name = moment(totals_last_income.begin).format('DD/MM') + ' a ' +  moment(totals_last_income.end).format('DD/MM');\n    const last_income = parseFloat((totals_last_income.amount.total).toFixed(2));\n\n    const totals_spending = dat.profile_overview_panel_section.totals.spending;\n    const last_spending = dat.profile_overview_panel_section.totals.spending[dat.profile_overview_panel_section.totals.spending.length-2];\n    const last_fixed_spending  = -parseFloat((last_spending.amount.fixed).toFixed(2));\n    const last_variable_spending  = -parseFloat((last_spending.amount.variable).toFixed(2));\n\n    const totals_investments = dat.profile_overview_panel_section.totals.investments;\n    const totals_last_investment = dat.profile_overview_panel_section.totals.investments[dat.profile_overview_panel_section.totals.investments.length-2];\n    const last_investment  = parseFloat((totals_last_investment.deposit_amount).toFixed(2));\n    const last_saving   = parseFloat((totals_last_investment.deposit_amount - totals_last_investment.withdraw_amount ).toFixed(2));\n\n    // average last 3 periods\n    const len_ti = totals_income.length;\n    const avg_income_last_3_periods = parseFloat(((totals_income.slice(len_ti - 5, len_ti - 2).map(t => t.amount.total).reduce((p, c) => p + c, 0))/ 3).toFixed(2));\n    const len_ts = totals_spending.length;\n    const avg_variable_spending_last_3_periods = -parseFloat(((totals_spending.slice(len_ts - 5,len_ts - 2).map(t => t.amount.variable).reduce((p, c) => p + c, 0))/ 3).toFixed(2));\n    const avg_fixed_spending_last_3_periods = -parseFloat(((totals_spending.slice(len_ts - 5,len_ts - 2).map(t => t.amount.fixed).reduce((p, c) => p + c, 0))/ 3).toFixed(2));\n    const len_tv = totals_investments.length;\n    const avg_investments_last_3_periods = parseFloat(((totals_investments.slice(len_tv - 5,len_tv - 2).map(t => (t.deposit_amount)).reduce((p, c) => p + c, 0))/ 3).toFixed(2));\n    const avg_savings_last_3_periods = parseFloat(((totals_investments.slice(len_tv - 5,len_tv - 2).map(t => (t.deposit_amount - t.withdraw_amount)).reduce((p, c) => p + c, 0))/ 3).toFixed(2));\n\n    // calculate variations last period / 3 previous periods(avg)\n    const income_var = avg_income_last_3_periods ? (last_income - avg_income_last_3_periods)/avg_income_last_3_periods : 0;\n    const income_var_signal = (income_var > 0) ? '⬆' : ((income_var < 0)? '⬇' : '');\n    const variable_spending_var = avg_variable_spending_last_3_periods? (last_variable_spending - avg_variable_spending_last_3_periods)/avg_variable_spending_last_3_periods : 0;\n    const variable_spending_var_signal = (variable_spending_var > 0) ? '⬆' : ((variable_spending_var < 0)? '⬇' : '');\n    const fixed_spending_var = avg_fixed_spending_last_3_periods? (last_fixed_spending - avg_fixed_spending_last_3_periods)/avg_fixed_spending_last_3_periods : 0;\n    const fixed_spending_var_signal = (fixed_spending_var > 0) ? '⬆' : ((fixed_spending_var < 0)? '⬇' : '');\n    const investments_var = avg_investments_last_3_periods? (last_investment - avg_investments_last_3_periods)/avg_investments_last_3_periods : 0;\n    const investments_var_signal = (investments_var > 0) ? '⬆' : ((investments_var < 0)? '⬇' : '');\n    const savings_var = avg_savings_last_3_periods? (last_saving - avg_savings_last_3_periods)/avg_savings_last_3_periods : 0;\n    const savings_var_signal = (savings_var > 0) ? '⬆' : ((savings_var < 0)? '⬇' : ''); // prepare last month texts\n    if(!last_cycle_name || (!last_income &&  !last_fixed_spending && !last_variable_spending && !last_investment && !last_saving) ) {\n        ivars.last_month_totals += 'Ainda estou analisando suas transações deste mês. Vamos nos falar de novo em breve, para eu te trazer novidades! 😉';\n    }\n    else {\n        ivars.last_month_totals += 'Acompanhei seus números do último ciclo (<b>'\n        + last_cycle_name\n        + '</b>), olha só:'\n        + ((last_income)? ('<br /> 💵 Renda Mensal = <b>' + currency(last_income) + '</b>') : '')\n        + ((last_fixed_spending)? ('<br /> 📌 Gasto Fixo = <b>'   + currency(last_fixed_spending) + '</b>'): '')\n        + ((last_variable_spending)? ('<br /> 💸 Gasto Variável = <b>' + currency(last_variable_spending) + '</b>'): '')\n        + ((last_saving)?  ('<br /> 🏦 Valor Guardado = <b>' +  currency(last_saving)+ '</b>') : '');\n        ivars.last_month_variations = 'Opa, vamos lá 🔍 <br />Veja como foi seu último ciclo em comparação com a média dos 3 ciclos anteriores:' \n        + ((last_income)? ('<br /> 💵 Renda Mensal = <b>' + income_var_signal  + percent(Math.abs(income_var)) + '</b>'): '')\n        + ((last_fixed_spending)? ('<br /> 📌 Gasto Fixo = <b>' + fixed_spending_var_signal   + percent(Math.abs(fixed_spending_var))+ '</b>') : '')\n        + ((last_variable_spending)? ('<br /> 💸 Gasto Variável = <b>' + variable_spending_var_signal + percent(Math.abs(variable_spending_var))+ '</b>') : '')\n        + ((last_saving)?  ('<br /> 🏦 Valor Guardado = <b>' + savings_var_signal + percent(Math.abs(savings_var))+ '</b>') : '')\n        + '<br /><br />Vamos seguir de olho, cuidando de perto das suas finanças 🕵️'; \n    }\n// Current month\n    // average last 3 periods\n    const avg_income_3_periods_before_current = parseFloat(((totals_income.slice(len_ti - 4, len_ti - 1).map(t => t.amount.total).reduce((p, c) => p + c, 0))/ 3).toFixed(2));\n    const avg_total_spending_3_periods_before_current = -parseFloat(((totals_spending.slice(len_ts - 4,len_ts - 1).map(t => t.amount.total).reduce((p, c) => p + c, 0))/ 3).toFixed(2));\n    const income_period_before_current = parseFloat((totals_income[len_ti-2].amount.total).toFixed(2));\n    const total_spending_period_before_current = -parseFloat((totals_spending[len_ti-2].amount.total).toFixed(2));\n\n// Partial Periods\n// calculations\n    const partial_periods_cycle_name = {};\n    const partial_periods_income = {};\n    const partial_periods_total_spending = {};\n    const partial_periods_fixed_spending = {};\n    const partial_periods_variable_spending = {};\n    const partial_periods_income_percentual_last_3_periods = {};\n    const partial_periods_total_spending_percentual_last_3_periods = {};   \n    const partial_periods_income_percentual_last_period = {};\n    const partial_periods_total_spending_percentual_last_period = {};\n\n    for (const p in dat.profile_overview_panel_section.partial_periods.current_period) {\n        // totals\n        const p_summary =  dat.profile_overview_panel_section.partial_periods.current_period[p];\n        partial_periods_cycle_name[p] =  moment(p_summary.begin).format('DD/MM') + ' a ' +  moment(p_summary.end).format('DD/MM');\n        partial_periods_income[p] = parseFloat((p_summary.income.total.amount).toFixed(2));\n        partial_periods_total_spending[p] = -parseFloat((p_summary.spending.total.total_amount).toFixed(2));\n        partial_periods_fixed_spending[p] = -parseFloat((p_summary.spending.fixed.total_amount).toFixed(2));\n        partial_periods_variable_spending[p] = -parseFloat((p_summary.spending.variable.total_amount).toFixed(2));\n        // percentual\n        partial_periods_income_percentual_last_3_periods[p] = (avg_income_3_periods_before_current ) ? (partial_periods_income[p]/avg_income_3_periods_before_current) : 0;\n        partial_periods_total_spending_percentual_last_3_periods[p] = (avg_total_spending_3_periods_before_current) ? (partial_periods_total_spending[p]/avg_total_spending_3_periods_before_current) : 0;\n        partial_periods_income_percentual_last_period[p] = (income_period_before_current ) ? (partial_periods_income[p]/income_period_before_current) : 0;\n        partial_periods_total_spending_percentual_last_period[p] = (total_spending_period_before_current) ? (partial_periods_total_spending[p]/total_spending_period_before_current) : 0;\n        ivars.partial_periods_totals[p] = '';\n        ivars.partial_periods_expenses[p]= '';\n        // prepare partial periods texts\n        if(!partial_periods_cycle_name[p] \n        || (!partial_periods_income[p]\n            && !partial_periods_total_spending[p]\n            && !partial_periods_fixed_spending[p]\n            && !partial_periods_variable_spending[p]) ) {\n                ivars.partial_periods_totals[p] += 'Ainda estou analisando suas transações deste mês. Vamos nos falar de novo em breve, para eu te trazer novidades! 😉';\n        }\n        else {\n            ivars.partial_periods_totals[p] += 'Acompanhei seus números no período de <b>' + partial_periods_cycle_name[p] + '</b> e vi que você:' \n            + ((partial_periods_income[p])? ('<br /><br /> Recebeu = <b>' + currency(partial_periods_income[p]) + '</b>') : '')\n            + ((conversationName.search('intra_month') < 0) ? \n                ((partial_periods_income_percentual_last_3_periods[p])?  '<br /> 📈 <b>' + percent(partial_periods_income_percentual_last_3_periods[p]) + '</b> da sua média nos últimos 3 meses' : '') :\n                ((partial_periods_income_percentual_last_period[p])?  '<br /> 📈 <b>' + percent(partial_periods_income_percentual_last_period[p]) + '</b> em relação ao mês passado' : '')\n            )\n            + ((partial_periods_total_spending[p]) ? ('<br /><br /> Gastou = <b>' + currency(partial_periods_total_spending[p]) + '</b>') : '')\n            + ((conversationName.search('intra_month') < 0) ? \n                ((partial_periods_total_spending_percentual_last_3_periods[p])?  '<br /> 📈 <b>' + percent(partial_periods_total_spending_percentual_last_3_periods[p]) + '</b> da sua média nos últimos 3 meses' : '') :\n                ((partial_periods_total_spending_percentual_last_period[p])?  '<br /> 📈 <b>' + percent(partial_periods_total_spending_percentual_last_period[p]) + '</b> em relação ao mês passado' : '')\n            )\n            ivars.partial_periods_expenses[p] +=  'Certo, vamos ver mais sobre seus gastos de <b>' + partial_periods_cycle_name[p] + '</b>' + ' 🔍' \n            + ((partial_periods_fixed_spending[p])? ('<br /><br /> 📌 Gasto Fixo = <b>' + currency(partial_periods_fixed_spending[p])+ '</b>') : '')\n            + ((partial_periods_variable_spending[p])? ('<br /><br /> 💸 Gasto Variável = <b>' + currency(partial_periods_variable_spending[p])+ '</b>') : '')\n            + '<br />'; \n        }\n    }\n// last week fixed totals \n// \n    const last_week_rolling = dat.profile_overview_panel_section.last_week_rolling;\n    const last_week_cycle_name = moment(last_week_rolling.begin).format('DD/MM') + ' a ' +  moment(last_week_rolling.end).format('DD/MM');\n    if(!last_week_cycle_name \n        || !last_week_rolling.income.total.amount\n        || !last_week_rolling.spending.total.total_amount\n        || !last_week_rolling.spending.fixed.total_amount\n        || !last_week_rolling.spending.variable.total_amount) {\n        ivars.last_week_rolling_totals =  'Ainda estou analisando suas transações desta semana. Vamos nos falar de novo em breve, para eu te trazer novidades! 😉';\n     }\n     else {\n        ivars.last_week_rolling_totals += 'Trago seus números do período de <b>' + last_week_cycle_name + '</b> :'\n        + ((last_week_rolling.income.total.amount)? ('<br /> Você recebeu = <b>' + currency(last_week_rolling.income.total.amount) + '</b>') : '')\n        + ((last_week_rolling.spending.total.total_amount) ? ('<br /> Você gastou = <b>' + currency(last_week_rolling.spending.total.total_amount) + '</b>') : '')\n        + '<br /> Sua compra de maior valor = '\n        + '<br /> <b>Extra Hipermercado R$ 500</b>';\n        ivars.last_week_rolling_spending += 'Certo, vamos ver mais sobre seus gastos de <b>' + last_week_cycle_name + '</b>🔍'\n        + ((last_week_rolling.spending.fixed.total_amount)? ('<br /> 📌 Gastos Fixos =  <b>' + currency(last_week_rolling.spending.fixed.total_amount) + '</b>') : '')\n        + ((last_week_rolling.spending.variable.total_amount)? ('<br /> 💸 Gastos Variáveis  =  <b>' + currency(last_week_rolling.spending.variable.total_amount) + '</b>') : '')\n        + '<br />Vou continuar de olho nas suas finanças e volto em breve com mais informações! 🤓';\n     }\n}\nelse {\n    ivars.last_month_totals = 'Ainda estou analisando suas transações deste mês. Vamos nos falar de novo em breve, para eu te trazer novidades! 😉';\n    ivars.partial_periods_totals['10_days'] = 'Ainda estou analisando suas transações deste mês. Vamos nos falar de novo em breve, para eu te trazer novidades! 😉';\n    ivars.partial_periods_totals['15_days'] = 'Ainda estou analisando suas transações deste mês. Vamos nos falar de novo em breve, para eu te trazer novidades! 😉';\n    ivars.partial_periods_totals['20_days'] = 'Ainda estou analisando suas transações deste mês. Vamos nos falar de novo em breve, para eu te trazer novidades! 😉';\n    ivars.last_week_rolling_totals =  'Ainda estou analisando suas transações desta semana. Vamos nos falar de novo em breve, para eu te trazer novidades! 😉';\n}\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_421"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"427","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_261"}]},{"name":"427","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_near_zero","probability_name":"tpt_itau_summary_428","template_order":"","name":"375"},{"script":{"name":"doNothing","params":[]},"next":"267","probability":"((ivars.sumary_conversation_name == 'promo_inf_last_month_summary'  && (!ivars.last_month_variations || !ivars.last_month_variations.length)) ||  !ivars.partial_periods_expenses || (ivars.sumary_conversation_name == 'promo_alert_weekly_update' && !ivars.last_week_rolling_spending) || (['promo_inf_first_10_days_summary','promo_inf_first_10_days_intra_month'].includes(ivars.sumary_conversation_name)  && (!ivars.partial_periods_expenses[\"10_days\"] || !ivars.partial_periods_expenses[\"10_days\"].length) ) ||  (['promo_inf_first_20_days_summary','promo_inf_first_20_days_intra_month'].includes(ivars.sumary_conversation_name)  && (!ivars.partial_periods_expenses[\"20_days\"] || !ivars.partial_periods_expenses[\"20_days\"].length) ) ||  (['promo_inf_first_mid_month_summary','promo_inf_first_mid_month_intra_month'].includes(ivars.sumary_conversation_name)  && (!ivars.partial_periods_expenses[\"15_days\"] || !ivars.partial_periods_expenses[\"15_days\"].length) )) ? 1 : 0","probability_name":"tpt_itau_summary_429","template_order":"","name":"auto_a_427_267"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_408"}]},{"name":"267","type":"olivia"},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"381","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_378"}]},{"name":"381","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_381"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"order":"numerical_constant_one","order_name":"tpt_itau_summary_430","name":"149"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"order":"numerical_constant_two","order_name":"tpt_itau_summary_431","name":"320"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"order":"numerical_constant_three","order_name":"tpt_itau_summary_432","name":"326"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_393"}]}],"end":"267","name":"tpt_itau_summary","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":720,"cooldownInteracted":720,"cooldownEngaged":720,"cooldownDelayed":8,"cooldownDismissed":720,"cooldownFrustrated":720,"cooldownThumbsDown":720,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_summary_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_summary_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_summary_notification_priority","multiple_notifications":true,"requires":["profile_overview_panel_section"],"requires_reserved_variables":[],"hash":"d1e5c7022b29b05387e0d917d0f26658ee7a0648","shadow":false,"conversation_map_id":37146},"tpt_itau_base":{"begin":"417","conversation_states":[{"name":"417","type":"olivia","paths":[{"script":{"name":"blockDeprioritization","params":[]},"next":"431","probability":"numerical_constant_one","probability_name":"tpt_itau_base_417"}]},{"name":"431","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_base_431"},{"type":"variable","value":"CT:code@code"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_base_431"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_base_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_base_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_base_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"424","probability":"numerical_constant_one","probability_name":"tpt_itau_base_378"}]},{"name":"424","type":"olivia","paths":[{"body":"<input id=\"CT:internal_link@internal_link\"></input>","next":"427","probability":"numerical_constant_one","probability_name":"tpt_itau_base_424"}]},{"name":"427","type":"olivia","paths":[{"body":"<input id=\"CT:disclaimer@text\"></input>","next":"381","probability":"numerical_constant_one","probability_name":"tpt_itau_base_427"}]},{"name":"381","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"numerical_constant_one","probability_name":"tpt_itau_base_381"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"name":"149","order":"numerical_constant_two","order_name":"tpt_itau_base_322"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"name":"320","order":"numerical_constant_three","order_name":"tpt_itau_base_322"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"name":"326","order":"numerical_constant_four","order_name":"tpt_itau_base_322"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_base_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_base_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_base_393"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_base","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":720,"cooldown":0,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_base_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"templateVariableEmpty('notification', conversationName)","probability_name":"tpt_itau_base_444","template_order":"","name":"446","alias":"n1$nyt"},{"body":"<input id=\"CT:notification_2\"></input>","probability":"templateVariableEmpty('notification_2', conversationName)","probability_name":"tpt_itau_base_445","template_order":"","name":"449","alias":"n2$1aiz"},{"body":"<input id=\"CT:notification_3\"></input>","probability":"templateVariableEmpty('notification_3', conversationName)","probability_name":"tpt_itau_base_455","template_order":"","name":"452","alias":"n3$oei"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_base_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":[],"hash":"ec03bcb5e797ce0398f5987477daa610061823cd","shadow":false,"conversation_map_id":37149},"tpt_itau_base_no_options":{"begin":"417","conversation_states":[{"name":"417","type":"olivia","paths":[{"script":{"name":"blockDeprioritization","params":[]},"next":"433","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_417"}]},{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_base_no_options_433"},{"type":"variable","value":"CT:code@code"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"447","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_378"}]},{"name":"447","type":"olivia","paths":[{"body":"<input id=\"CT:internal_link@internal_link\"></input>","next":"438","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_447"}]},{"name":"438","type":"olivia","paths":[{"body":"<input id=\"CT:disclaimer@text\"></input>","next":"442","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_438"}]},{"name":"442","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_base_no_options_442"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_base_no_options","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":720,"cooldown":0,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_base_no_options_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"451","notification_states":[{"name":"451","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"templateVariableEmpty('notification', conversationName)","probability_name":"tpt_itau_base_no_options_452","template_order":"","name":"454","alias":"n1$nyt"},{"body":"<input id=\"CT:notification_2\"></input>","probability":"templateVariableEmpty('notification_2', conversationName)","probability_name":"tpt_itau_base_no_options_453","template_order":"","name":"457","alias":"n2$1aiz"},{"body":"<input id=\"CT:notification_3\"></input>","probability":"templateVariableEmpty('notification_3', conversationName)","probability_name":"tpt_itau_base_no_options_463","template_order":"","name":"460","alias":"n3$oei"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_base_no_options_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":[],"hash":"798229f9ed5efd3cf6bea5e17eeb0e92c2cfafd7","shadow":false,"conversation_map_id":37159},"tpt_itau_onboarding":{"begin":"417","conversation_states":[{"name":"417","type":"olivia","paths":[{"script":{"name":"blockDeprioritization","params":[]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_onboarding_417"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_onboarding_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_onboarding_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_onboarding_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"423","probability":"numerical_constant_one","probability_name":"tpt_itau_onboarding_378"}]},{"name":"423","type":"olivia","paths":[{"body":"<input id=\"CT:internal_link@internal_link\"></input>","next":"384","probability":"numerical_constant_one","probability_name":"tpt_itau_onboarding_423"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_onboarding_384"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_onboarding","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":99999,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":99999,"cooldown":99999,"cooldownInteracted":99999,"cooldownEngaged":99999,"cooldownDelayed":99999,"cooldownDismissed":99999,"cooldownFrustrated":99999,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_onboarding_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_onboarding_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_onboarding_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":[],"hash":"73d3949f69a21c57d39d1711830047211343a53b","shadow":false,"conversation_map_id":37153},"tpt_itau_missing_bills":{"begin":"433","conversation_states":[{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_missing_bills_433"},{"type":"string","value":"const moment = require('moment');\n\nlet current_transaction = {};\n\nivars.missing_bills_history = (ivars.missing_bills_history || {});\n\nfor (const bill of rvars.aggregate_missing_bills) {\n  const { hash, description, customized_description, avg_amount, avg_day_of_month } = bill;\n  let lastTime = 0;\n  for (const key in ivars.missing_bills_history) {\n    const [keyHash, keyDesc, keyCustomDesc] = key.split('|');\n    if (\n      hash == parseInt(keyHash) ||\n      (description.length && description == keyDesc) ||\n      (keyCustomDesc.length && customized_description == keyCustomDesc)\n    ) {\n      lastTime = ivars.missing_bills_history[key];\n    }\n  }\n  if (moment().diff(moment(lastTime), 'month') > 0) {\n    const newKey = [hash, description, customized_description].join('|');\n    ivars.missing_bills_history[newKey] = Date.now();\n    current_transaction = {\n      hash,\n      description: customized_description || description,\n      avg_amount: -avg_amount,\n      avg_day_of_month,\n    };\n  }\n}\n\nivars.temp_missing_bill = current_transaction;"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_missing_bills_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_missing_bills_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_missing_bills_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_missing_bills_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"447","probability":"numerical_constant_one","probability_name":"tpt_itau_missing_bills_378"}]},{"name":"447","type":"olivia","paths":[{"body":"<input id=\"CT:internal_link@internal_link\"></input>","next":"443","probability":"numerical_constant_one","probability_name":"tpt_itau_missing_bills_447"}]},{"name":"443","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"441","probability":"numerical_constant_one","probability_name":"tpt_itau_missing_bills_443"}]},{"name":"441","type":"olivia"}],"end":"441","name":"tpt_itau_missing_bills","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":360,"cooldownInteracted":360,"cooldownEngaged":360,"cooldownDelayed":8,"cooldownDismissed":360,"cooldownFrustrated":360,"cooldownThumbsDown":360,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_missing_bills_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_missing_bills_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_missing_bills_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["aggregate_missing_bills"],"hash":"09bb147ff4d29741953fce5499813b92b76dbe97","shadow":false,"conversation_map_id":37151},"tpt_itau_base_summary":{"begin":"417","conversation_states":[{"name":"417","type":"olivia","paths":[{"script":{"name":"blockDeprioritization","params":[]},"next":"456","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_417"}]},{"name":"456","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_base_summary_456"},{"type":"variable","value":"CT:check_data@code"}]},"next":"460","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_456"}]},{"name":"460","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"!!ivars.itau_summary_has_etl && !!ivars.itau_summary_has_data","probability_name":"tpt_itau_base_summary_462","template_order":"","name":"261"},{"body":"<input id=\"CT:no_data@main_text\"></input>","next":"267","probability":"!!ivars.itau_summary_has_etl && !ivars.itau_summary_has_data","probability_name":"tpt_itau_base_summary_465","template_order":"","name":"463"},{"body":"<input id=\"CT:no_etl@main_text\"></input>","next":"267","probability":"!ivars.itau_summary_has_etl","probability_name":"tpt_itau_base_summary_472","template_order":"","name":"470"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_375"}]},{"name":"267","type":"olivia"},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"424","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_378"}]},{"name":"424","type":"olivia","paths":[{"body":"<input id=\"CT:internal_link@internal_link\"></input>","next":"427","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_424"}]},{"name":"427","type":"olivia","paths":[{"body":"<input id=\"CT:disclaimer@text\"></input>","next":"467","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_427"}]},{"name":"467","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"!!ivars.itau_summary_has_details","probability_name":"tpt_itau_base_summary_468","template_order":"","name":"381"},{"script":{"name":"doNothing","params":[]},"next":"267","probability":"!ivars.itau_summary_has_details","probability_name":"tpt_itau_base_summary_469","template_order":"","name":"auto_a_467_267"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"name":"149","order":"numerical_constant_two","order_name":"tpt_itau_base_summary_322"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"name":"320","order":"numerical_constant_three","order_name":"tpt_itau_base_summary_322"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"name":"326","order":"numerical_constant_four","order_name":"tpt_itau_base_summary_322"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_base_summary_393"}]}],"end":"267","name":"tpt_itau_base_summary","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":72,"cooldown":0,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_base_summary_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"templateVariableEmpty('notification', conversationName)","probability_name":"tpt_itau_base_summary_444","template_order":"","name":"446","alias":"n1$nyt"},{"body":"<input id=\"CT:notification_2\"></input>","probability":"templateVariableEmpty('notification_2', conversationName)","probability_name":"tpt_itau_base_summary_445","template_order":"","name":"449","alias":"n2$1aiz"},{"body":"<input id=\"CT:notification_3\"></input>","probability":"templateVariableEmpty('notification_3', conversationName)","probability_name":"tpt_itau_base_summary_455","template_order":"","name":"452","alias":"n3$oei"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_base_summary_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":[],"hash":"be3c46ae4279bd948b330fc94f4731e554b62965","shadow":false,"conversation_map_id":37160},"tpt_itau_insufficient_funds_for_payment":{"begin":"433","conversation_states":[{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_insufficient_funds_for_payment_433"},{"type":"string","value":"const all_transactions = dat.profile_overview_panel_section.future_spending.transactions;\nconst moment = require('moment');\nvar target_transactions = [];\nvar target_deadline = 1;\n\nfor(target_deadline = 1; target_deadline <= 4; target_deadline++) {\n    if(target_transactions.length > 0) break;\n    const deadline = moment().add(target_deadline, 'day').format('YYYY-MM-DD');\n    target_transactions = all_transactions\n    .filter(t => !t.pending)\n    .filter(t => t.date === deadline)\n    .filter(t => t.account_type_id == 100)\n    .filter((t) => {\n        if(!!ivars.insufficient_funds_for_payment_historic\n            && ivars.insufficient_funds_for_payment_historic.some((hist) => hist == t.transaction_id)) return false;\n        return true;\n    });\n}\n// Memory control\nif (target_transactions.length > 0) {\n    ivars.insufficient_funds_for_payment_historic = ivars.insufficient_funds_for_payment_historic || [];\n    for(const transaction of target_transactions) {\n        ivars.insufficient_funds_for_payment_historic.push(transaction.transaction_id);\n    }\n}\nivars.temp_target_transactions = target_transactions;\nivars.temp_target_deadline = target_deadline;\nivars.temp_target_transactions_description = target_transactions.map((item) => {\n    return `- <b>${item.description} ${currency(-item.amount)}</b>`;\n}).join('<br/>');"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_insufficient_funds_for_payment_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_insufficient_funds_for_payment_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"469","probability":"numerical_constant_one","probability_name":"tpt_itau_insufficient_funds_for_payment_375"}]},{"name":"469","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"458","probability":"numerical_constant_one","probability_name":"tpt_itau_insufficient_funds_for_payment_469"}]},{"name":"458","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"461","probability":"numerical_constant_one","probability_name":"tpt_itau_insufficient_funds_for_payment_458"}]},{"name":"461","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"456","probability":"numerical_constant_one","probability_name":"tpt_itau_insufficient_funds_for_payment_461"}]},{"name":"456","type":"olivia"}],"end":"456","name":"tpt_itau_insufficient_funds_for_payment","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":0,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":0,"cooldownInteracted":0,"cooldownEngaged":0,"cooldownDelayed":0,"cooldownDismissed":0,"cooldownFrustrated":0,"cooldownThumbsDown":0,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_insufficient_funds_for_payment_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_insufficient_funds_for_payment_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_insufficient_funds_for_payment_notification_priority","multiple_notifications":true,"requires":["profile_overview_panel_section"],"requires_reserved_variables":[],"hash":"5e4b1fd80792afba0022ee8edbc50d78daa5d8bf","shadow":false,"conversation_map_id":37154},"tpt_itau_alert_nota_fiscal_paulista":{"begin":"417","conversation_states":[{"name":"417","type":"olivia","paths":[{"script":{"name":"blockDeprioritization","params":[]},"next":"426","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_417"}]},{"name":"426","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_alert_nota_fiscal_paulista_426"},{"type":"string","value":"let current_transaction = false;\n\n// first time\nif (!ivars.nota_fiscal_paulista_history) {\n  current_transaction = rvars.aggregate_other_income.nfp_transactions[0];\n  ivars.nota_fiscal_paulista_history = [current_transaction.transaction_id];\n      }\nelse {\n  // other times\n  let show = 0;\n  for (const i in rvars.aggregate_other_income.nfp_transactions) {\n    show = 1;\n    for (const j in ivars.nota_fiscal_paulista_history) {\n      if (ivars.nota_fiscal_paulista_history[j] == rvars.aggregate_other_income.nfp_transactions[i].transaction_id) {\n        show = 0;\n        break;\n      }\n    }\n\n    if (show) {\n      current_transaction = rvars.aggregate_other_income.nfp_transactions[i];\n      ivars.nota_fiscal_paulista_history.push(current_transaction.transaction_id);\n    }\n  }\n\n  // failsafe\n  if (!current_transaction) {\n    current_transaction = rvars.aggregate_other_income.nfp_transactions[0];\n    ivars.nota_fiscal_paulista_history = [current_transaction.transaction_id];\n  }\n}\n\nivars.temp_current_transaction = current_transaction;\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_426"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"381","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_378"}]},{"name":"381","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_381"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"name":"149","order":"numerical_constant_two","order_name":"tpt_itau_alert_nota_fiscal_paulista_322"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"name":"320","order":"numerical_constant_three","order_name":"tpt_itau_alert_nota_fiscal_paulista_322"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"name":"326","order":"numerical_constant_four","order_name":"tpt_itau_alert_nota_fiscal_paulista_322"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_393"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_alert_nota_fiscal_paulista","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":720,"cooldownInteracted":720,"cooldownEngaged":720,"cooldownDelayed":720,"cooldownDismissed":99999,"cooldownFrustrated":99999,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_alert_nota_fiscal_paulista_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_alert_nota_fiscal_paulista_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_alert_nota_fiscal_paulista_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["aggregate_other_income"],"hash":"4db0b9801a74bb4cd0501e9aee3e8c312f0eb356","shadow":false,"conversation_map_id":37148},"tpt_itau_unusual_expense_agua":{"begin":"433","conversation_states":[{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_unusual_expense_agua_433"},{"type":"string","value":"const moment = require('moment');\n\nlet current_transaction = false;\nlet detected_vendor = false;\nlet current_transaction_bundle = false;\n\nivars.unusual_expense_agua = {};\n\nfor(const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n  if(vendor.includes('sabesp ') && !current_transaction) {\n    const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n    if(transactions.length < 3) continue;\n\n    // Check if there are 2 transactions on the same month\n    let memory_object = {};\n    if(transactions.some((transaction) => {\n      if(!memory_object[transaction.month]) {\n        memory_object[transaction.month] = true;\n        return false;\n      }\n      else {\n        return true;\n      }\n    })) {\n      continue;\n    }\n\n    current_transaction_bundle = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n    detected_vendor = 'Sabesp';\n\n    const last_transaction = transactions[transactions.length-1];\n    const before_last_transaction = transactions[transactions.length - 2];\n    if(moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n      || (!!ivars.unusual_expenses_agua_historic && ivars.unusual_expenses_agua_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n    const rounded_variation = +(Math.round(last_transaction.variation + 'e+2') + 'e-2');\n\n    if(!(before_last_transaction.amount >= 30 && before_last_transaction.amount <= 60 && rounded_variation >= 0.3)\n      && !(before_last_transaction.amount > 60 && before_last_transaction.amount <= 100 && rounded_variation >= 0.25)\n      && !(before_last_transaction.amount > 100 && before_last_transaction.amount <= 150 && rounded_variation >= 0.2)\n      && !(before_last_transaction.amount > 150 && rounded_variation >= 0.2)) continue;\n\n    current_transaction = last_transaction;\n  }\n}\n\n// Memory control\nif (current_transaction) {\n  ivars.unusual_expenses_agua_historic = ivars.unusual_expenses_agua_historic || [];\n  ivars.unusual_expenses_agua_historic.push(current_transaction.transaction_id);\n}\n\n// History failsafe\nif (!current_transaction) {\n  current_transaction = current_transaction_bundle[current_transaction_bundle.length-1];\n}\n\nivars.unusual_expense_agua.current_transaction = current_transaction;\nivars.unusual_expense_agua.previous_transaction = current_transaction_bundle[current_transaction_bundle.length-2];\nivars.unusual_expense_agua.current_vendor = detected_vendor;\nivars.unusual_expense_agua.current_link = 'http://site.sabesp.com.br/site/fale-conosco/Default.aspx?secaoId=71';\n\nlet previous_amount = 0;\nivars.unusual_expense_agua.current_history = current_transaction_bundle.slice(-3).map((item) => {\n  let history_string = `${item.formatted_date} - ${currency(item.amount)}`;\n\n  const rounded_variation = +(Math.round(item.variation + 'e+2') + 'e-2');\n\n  if((previous_amount >= 30 && previous_amount <= 60 && rounded_variation >= 0.3)\n    || (previous_amount > 60 && previous_amount <= 100 && rounded_variation >= 0.25)\n    || (previous_amount > 100 && previous_amount <= 150 && rounded_variation >= 0.2)\n    || (previous_amount > 150 && rounded_variation >= 0.2)) {\n    history_string = `<b>${history_string}</b>`;\n  }\n\n  previous_amount = item.amount;\n  return history_string;\n}).join('<br/>');\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"381","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_378"}]},{"name":"381","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_381"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"name":"149","order":"numerical_constant_two","order_name":"tpt_itau_unusual_expense_agua_322"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"name":"320","order":"numerical_constant_three","order_name":"tpt_itau_unusual_expense_agua_322"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"name":"326","order":"numerical_constant_four","order_name":"tpt_itau_unusual_expense_agua_322"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_393"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_unusual_expense_agua","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":0,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_unusual_expense_agua_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_agua_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_agua_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["agg"],"hash":"7e451298091c3d3498442574011e8e335c5ea58d","shadow":false,"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_map_id":37150},"tpt_itau_unusual_expense_internet":{"begin":"433","conversation_states":[{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_unusual_expense_internet_433"},{"type":"string","value":"const moment = require('moment');\n\nlet current_transaction = false;\nlet detected_vendor = false;\nlet current_transaction_bundle = false;\n\nivars.unusual_expense_internet = {};\n\nfor(const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n  if(vendor.includes('10500') && !current_transaction) {\n    const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n    if(transactions.length < 3) continue;\n\n    // Check if there are 2 transactions on the same month\n    let memory_object = {};\n    if(transactions.some((transaction) => {\n      if(!memory_object[transaction.month]) {\n        memory_object[transaction.month] = true;\n        return false;\n      }\n      else {\n        return true;\n      }\n    })) {\n      continue;\n    }\n\n    current_transaction_bundle = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n    if(vendor.includes('vivo ')) detected_vendor = 'Vivo';\n    else if(vendor.includes('claro ')) detected_vendor = 'Claro';\n    else if(vendor.includes('oi ')) detected_vendor = 'Oi';\n    else if(vendor.includes('tim ')) detected_vendor = 'Tim';\n    else if(vendor.includes('sky ')) detected_vendor = 'Sky';\n    else if(vendor.includes('super cabo ')) detected_vendor = 'Super Cabo';\n    else if(vendor.includes('vla ')) detected_vendor = 'VLA';\n    else if(vendor.includes('sebratel ')) detected_vendor = 'Sebratel';\n\n    const last_transaction = transactions[transactions.length-1];\n    const rounded_variation = +(Math.round(last_transaction.variation + 'e+2') + 'e-2');\n    if(rounded_variation < 0.1\n      || moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n      || (!!ivars.unusual_expenses_internet_historic && ivars.unusual_expenses_internet_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n    current_transaction = last_transaction;\n  }\n}\n\n// Memory control\nif (current_transaction) {\n  ivars.unusual_expenses_internet_historic = ivars.unusual_expenses_internet_historic || [];\n  ivars.unusual_expenses_internet_historic.push(current_transaction.transaction_id);\n}\n\n// History failsafe\nif (!current_transaction) {\n  current_transaction = current_transaction_bundle[current_transaction_bundle.length-1];\n}\n\nivars.unusual_expense_internet.current_transaction = current_transaction;\nivars.unusual_expense_internet.previous_transaction = current_transaction_bundle[current_transaction_bundle.length-2];\nivars.unusual_expense_internet.current_vendor = detected_vendor;\n\nif(detected_vendor === 'Vivo') ivars.unusual_expense_internet.current_link = 'https://www.vivo.com.br/para-voce/ajuda/mais-ajuda/fale-com-a-vivo';\nelse if(detected_vendor === 'Claro') ivars.unusual_expense_internet.current_link = 'https://www.claro.com.br/atendimento';\nelse if(detected_vendor === 'Tim') ivars.unusual_expense_internet.current_link = 'https://www.tim.com.br/sp/para-voce/atendimento/fale-conosco';\nelse if(detected_vendor === 'Oi') ivars.unusual_expense_internet.current_link = 'https://www.oi.com.br/minha-oi/internet/';\nelse if(detected_vendor === 'Sky') ivars.unusual_expense_internet.current_link = 'https://www.sky.com.br/central-de-atendimento';\nelse if(detected_vendor === 'Super Cabo') ivars.unusual_expense_internet.current_link = 'https://supercabomulti.com.br/fale-conosco/';\nelse if(detected_vendor === 'VLA') ivars.unusual_expense_internet.current_link = 'https://www.vla.net.br/contato';\nelse if(detected_vendor === 'Sebratel') ivars.unusual_expense_internet.current_link = 'https://www.sebratel.com.br/fale-conosco/';\nelse ivars.unusual_expense_internet.current_link = 'https://';\n\nivars.unusual_expense_internet.current_history = current_transaction_bundle.slice(-3).map((item) => {\n  const rounded_variation = +(Math.round(item.variation + 'e+2') + 'e-2');\n\n  if(rounded_variation < 0.1) return `${item.formatted_date} - ${currency(item.amount)}`;\n  else return `<b>${item.formatted_date} - ${currency(item.amount)}</b>`;\n}).join('<br/>');\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"381","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_378"}]},{"name":"381","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_381"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"name":"149","order":"numerical_constant_two","order_name":"tpt_itau_unusual_expense_internet_322"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"name":"320","order":"numerical_constant_three","order_name":"tpt_itau_unusual_expense_internet_322"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"name":"326","order":"numerical_constant_four","order_name":"tpt_itau_unusual_expense_internet_322"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_393"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_unusual_expense_internet","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":0,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_unusual_expense_internet_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_internet_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_internet_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["agg"],"hash":"1f6c6414e4dc20f1c052af1286977f4fd4c2988a","shadow":false,"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_map_id":37161},"tpt_itau_unusual_expense_gas":{"begin":"433","conversation_states":[{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_unusual_expense_gas_433"},{"type":"string","value":"const moment = require('moment');\n\nlet current_transaction = false;\nlet detected_vendor = false;\nlet current_transaction_bundle = false;\n\nivars.unusual_expense_gas = {};\n\nfor(const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n  if(vendor.includes('comgas ') && !current_transaction) {\n    const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n    if(transactions.length < 3) continue;\n\n    // Check if there are 2 transactions on the same month\n    let memory_object = {};\n    if(transactions.some((transaction) => {\n      if(!memory_object[transaction.month]) {\n        memory_object[transaction.month] = true;\n        return false;\n      }\n      else {\n        return true;\n      }\n    })) {\n      continue;\n    }\n\n    current_transaction_bundle = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n    detected_vendor = 'Comgás';\n\n    const last_transaction = transactions[transactions.length-1];\n    const before_last_transaction = transactions[transactions.length - 2];\n\n    if(moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n      || (!!ivars.unusual_expenses_gas_historic && ivars.unusual_expenses_gas_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n    const rounded_variation = +(Math.round(last_transaction.variation + 'e+2') + 'e-2');\n\n    if(!(before_last_transaction.amount >= 10 && before_last_transaction.amount <= 20 && rounded_variation >= 0.5)\n      && !(before_last_transaction.amount > 20 && before_last_transaction.amount <= 40 && rounded_variation >= 0.4)\n      && !(before_last_transaction.amount > 40 && before_last_transaction.amount <= 80 && rounded_variation >= 0.3)\n      && !(before_last_transaction.amount > 80 && rounded_variation >= 0.2)) continue;\n\n    current_transaction = last_transaction;\n  }\n}\n\n// Memory control\nif (current_transaction) {\n  ivars.unusual_expenses_gas_historic = ivars.unusual_expenses_gas_historic || [];\n  ivars.unusual_expenses_gas_historic.push(current_transaction.transaction_id);\n}\n\n// History failsafe\nif (!current_transaction) {\n  current_transaction = current_transaction_bundle[current_transaction_bundle.length-1];\n}\n\nivars.unusual_expense_gas.current_transaction = current_transaction;\nivars.unusual_expense_gas.previous_transaction = current_transaction_bundle[current_transaction_bundle.length-2];\nivars.unusual_expense_gas.current_vendor = detected_vendor;\nivars.unusual_expense_gas.current_link = 'https://www.comgas.com.br/a-comgas/fale-com-a-gente/';\n\nlet previous_amount = 0;\nivars.unusual_expense_gas.current_history = current_transaction_bundle.slice(-3).map((item) => {\n  let history_string = `${item.formatted_date} - ${currency(item.amount)}`;\n\n  const rounded_variation = +(Math.round(item.variation + 'e+2') + 'e-2');\n\n  if((previous_amount >= 10 && previous_amount <= 20 && rounded_variation >= 0.5)\n    || (previous_amount > 20 && previous_amount <= 40 && rounded_variation >= 0.4)\n    || (previous_amount > 40 && previous_amount <= 80 && rounded_variation >= 0.3)\n    || (previous_amount > 80 && rounded_variation >= 0.2)) {\n    history_string = `<b>${history_string}</b>`;\n  }\n\n  previous_amount = item.amount;\n  return history_string;\n}).join('<br/>');\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"381","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_378"}]},{"name":"381","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_381"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"name":"149","order":"numerical_constant_two","order_name":"tpt_itau_unusual_expense_gas_322"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"name":"320","order":"numerical_constant_three","order_name":"tpt_itau_unusual_expense_gas_322"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"name":"326","order":"numerical_constant_four","order_name":"tpt_itau_unusual_expense_gas_322"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_393"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_unusual_expense_gas","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":0,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_unusual_expense_gas_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_gas_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_gas_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["agg"],"hash":"6b0d9dffd45331a0cc85937bd65951b4abe26f8c","shadow":false,"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_map_id":37157},"tpt_itau_unusual_expense_celular":{"begin":"433","conversation_states":[{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_unusual_expense_celular_433"},{"type":"string","value":"const moment = require('moment');\n\nlet current_transaction = false;\nlet detected_vendor = false;\nlet current_transaction_bundle = false;\n\nivars.unusual_expense_celular = {};\n\nfor(const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n  if(vendor.includes('10300') && !current_transaction) {\n    const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n    if(transactions.length < 3) continue;\n\n    // Check if there are 2 transactions on the same month\n    let memory_object = {};\n    if(transactions.some((transaction) => {\n      if(!memory_object[transaction.month]) {\n        memory_object[transaction.month] = true;\n        return false;\n      }\n      else {\n        return true;\n      }\n    })) {\n      continue;\n    }\n\n    current_transaction_bundle = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n    if(vendor.includes('vivo ')) detected_vendor = 'Vivo';\n    else if(vendor.includes('claro ')) detected_vendor = 'Claro';\n    else if(vendor.includes('oi ')) detected_vendor = 'Oi';\n    else if(vendor.includes('tim ')) detected_vendor = 'Tim';\n    else if(vendor.includes('nextel ')) detected_vendor = 'Nextel';\n\n    const last_transaction = transactions[transactions.length-1];\n    const rounded_variation = +(Math.round(last_transaction.variation + 'e+2') + 'e-2');\n\n    if(rounded_variation < 0.1\n      || moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n      || (!!ivars.unusual_expenses_celular_historic && ivars.unusual_expenses_celular_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n    current_transaction = last_transaction;\n  }\n}\n\n// Memory control\nif (current_transaction) {\n  ivars.unusual_expenses_celular_historic = ivars.unusual_expenses_celular_historic || [];\n  ivars.unusual_expenses_celular_historic.push(current_transaction.transaction_id);\n}\n\n// History failsafe\nif (!current_transaction) {\n  current_transaction = current_transaction_bundle[current_transaction_bundle.length-1];\n}\n\nivars.unusual_expense_celular.current_transaction = current_transaction;\nivars.unusual_expense_celular.previous_transaction = current_transaction_bundle[current_transaction_bundle.length-2];\nivars.unusual_expense_celular.current_vendor = detected_vendor;\n\nif(detected_vendor === 'Vivo') ivars.unusual_expense_celular.current_link = 'https://www.vivo.com.br/para-voce/ajuda/mais-ajuda/fale-com-a-vivo';\nelse if(detected_vendor === 'Claro') ivars.unusual_expense_celular.current_link = 'https://www.claro.com.br/atendimento';\nelse if(detected_vendor === 'Tim') ivars.unusual_expense_celular.current_link = 'https://www.tim.com.br/sp/para-voce/atendimento/fale-conosco';\nelse if(detected_vendor === 'Oi') ivars.unusual_expense_celular.current_link = 'https://servicos.oi.com.br/atendimento/';\nelse if(detected_vendor === 'Nextel') ivars.unusual_expense_celular.current_link = 'https://www.claro.com.br/claronxt';\nelse ivars.unusual_expense_celular.current_link = 'https://';\n\nivars.unusual_expense_celular.current_history = current_transaction_bundle.slice(-3).map((item) => {\n  const rounded_variation = +(Math.round(item.variation + 'e+2') + 'e-2');\n\n  if(rounded_variation < 0.1) return `${item.formatted_date} - ${currency(item.amount)}`;\n  else return `<b>${item.formatted_date} - ${currency(item.amount)}</b>`;\n}).join('<br/>');\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"381","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_378"}]},{"name":"381","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_381"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"name":"149","order":"numerical_constant_two","order_name":"tpt_itau_unusual_expense_celular_322"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"name":"320","order":"numerical_constant_three","order_name":"tpt_itau_unusual_expense_celular_322"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"name":"326","order":"numerical_constant_four","order_name":"tpt_itau_unusual_expense_celular_322"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_393"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_unusual_expense_celular","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":0,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_unusual_expense_celular_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_celular_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_celular_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["agg"],"hash":"88808c2ef0ab4ee3915abe783199862eb77c0e5b","shadow":false,"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_map_id":37156},"tpt_itau_unusual_expense_luz":{"begin":"433","conversation_states":[{"name":"433","type":"olivia","paths":[{"script":{"name":"evaluateOliviaCode","params":[{"type":"string","value":"tpt_itau_unusual_expense_luz_433"},{"type":"string","value":"const moment = require('moment');\n\nlet current_transaction = false;\nlet detected_vendor = false;\nlet current_transaction_bundle = false;\n\nivars.unusual_expense_luz = {};\n\nfor(const vendor in rvars.agg.bills_by_category_and_description.last_6m) {\n  if(vendor.includes('enel ') && !current_transaction) {\n    const transactions = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n\n    if(transactions.length < 3) continue;\n\n    // Check if there are 2 transactions on the same month\n    let memory_object = {};\n    if(transactions.some((transaction) => {\n      if(!memory_object[transaction.month]) {\n        memory_object[transaction.month] = true;\n        return false;\n      }\n      else {\n        return true;\n      }\n    })) {\n      continue;\n    }\n\n    current_transaction_bundle = rvars.agg.bills_by_category_and_description.last_6m[vendor];\n    detected_vendor = 'Enel';\n\n    const last_transaction = transactions[transactions.length-1];\n    const before_last_transaction = transactions[transactions.length - 2];\n    if(moment().endOf('day').diff(moment(last_transaction.timestamp).startOf('day'), 'days') > 7\n      || (!!ivars.unusual_expenses_luz_historic && ivars.unusual_expenses_luz_historic.some((hist) => hist == last_transaction.transaction_id))) continue;\n\n    const rounded_variation = +(Math.round(last_transaction.variation + 'e+2') + 'e-2');\n    if(!(before_last_transaction.amount >= 30 && before_last_transaction.amount <= 60 && rounded_variation >= 0.3)\n      && !(before_last_transaction.amount > 60 && before_last_transaction.amount <= 100 && rounded_variation >= 0.25)\n      && !(before_last_transaction.amount > 100 && before_last_transaction.amount <= 150 && rounded_variation >= 0.2)\n      && !(before_last_transaction.amount > 150 && rounded_variation >= 0.2)) continue;\n\n    current_transaction = last_transaction;\n  }\n}\n\n// Memory control\nif (current_transaction) {\n  ivars.unusual_expenses_luz_historic = ivars.unusual_expenses_luz_historic || [];\n  ivars.unusual_expenses_luz_historic.push(current_transaction.transaction_id);\n}\n\n// History failsafe\nif (!current_transaction) {\n  current_transaction = current_transaction_bundle[current_transaction_bundle.length-1];\n}\n\nivars.unusual_expense_luz.current_transaction = current_transaction;\nivars.unusual_expense_luz.previous_transaction = current_transaction_bundle[current_transaction_bundle.length-2];\nivars.unusual_expense_luz.current_vendor = detected_vendor;\nivars.unusual_expense_luz.current_link = 'https://www.enel.com.br/pt-saopaulo/atendimento.html';\n\nlet previous_amount = 0;\nivars.unusual_expense_luz.current_history = current_transaction_bundle.slice(-3).map((item) => {\n  let history_string = `${item.formatted_date} - ${currency(item.amount)}`;\n\n  const rounded_variation = +(Math.round(item.variation + 'e+2') + 'e-2');\n\n  if((previous_amount >= 30 && previous_amount <= 60 && rounded_variation >= 0.3)\n    || (previous_amount > 60 && previous_amount <= 100 && rounded_variation >= 0.25)\n    || (previous_amount > 100 && previous_amount <= 150 && rounded_variation >= 0.2)\n    || (previous_amount > 150 && rounded_variation >= 0.2)) {\n    history_string = `<b>${history_string}</b>`;\n  }\n\n  previous_amount = item.amount;\n  return history_string;\n}).join('<br/>');\n"}]},"next":"261","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_433"}]},{"name":"261","type":"olivia","paths":[{"body":"<input id=\"CT:main_text@main_text\"></input>","next":"375","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_261"}]},{"name":"375","type":"olivia","paths":[{"body":"<input id=\"CT:break@hr\"></input>","next":"408","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_375"}]},{"name":"408","type":"olivia","paths":[{"body":"<input id=\"CT:content@text\"></input>","next":"378","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_408"}]},{"name":"378","type":"olivia","paths":[{"body":"<input id=\"CT:external_link@external_link\"></input>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:external_link_link"}]},"next":"381","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_378"}]},{"name":"381","type":"olivia","paths":[{"body":"<input id=\"CT:call_to_action@cta\"></input>","next":"322","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_381"}]},{"name":"322","type":"user","paths":[{"body":"<var>CT:user_option_engaged@feedback</var>","script_touch":{"name":"openURLWindow","params":[{"type":"variable","value":"CT:user_engaged_link"}]},"next":"384","default":true,"name":"149","order":"numerical_constant_two","order_name":"tpt_itau_unusual_expense_luz_322"},{"body":"<var>CT:user_option_delayed@feedback</var>","next":"389","default":false,"name":"320","order":"numerical_constant_three","order_name":"tpt_itau_unusual_expense_luz_322"},{"body":"<var>CT:user_option_dismissed@feedback</var>","next":"393","default":false,"name":"326","order":"numerical_constant_four","order_name":"tpt_itau_unusual_expense_luz_322"}]},{"name":"384","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"engaged"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_384"}]},{"name":"389","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"delayed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_389"}]},{"name":"393","type":"olivia","paths":[{"script":{"name":"reachConversationEngagement","params":[{"type":"string","value":"dismissed"}]},"next":"267","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_393"}]},{"name":"267","type":"olivia"}],"end":"267","name":"tpt_itau_unusual_expense_luz","notify":true,"once_completed":false,"once_interrupted":false,"sharedCooldownGroup":null,"notificationSharedCooldownGroup":null,"time_sensitivity":"low","expected_savings":"medium","right_assumption":"medium","user_easiness":"medium","applicability_rules_description":null,"applicability_rules":[],"value_proposition":null,"goals":null,"spec_summary":null,"spec_applicability":null,"spec_flow_description":null,"spec_data_reliability":null,"spec_area":null,"spec_style":null,"spec_impact":null,"categories":[],"localHoursValid":null,"eventsToIgnore":null,"notificationCooldown":48,"notificationLocalHoursValid":[8,21],"metadata":null,"requiredConversations":["master"],"cooldownQueued":0,"cooldown":0,"cooldownInteracted":24,"cooldownEngaged":8760,"cooldownDelayed":48,"cooldownDismissed":2880,"cooldownFrustrated":5760,"cooldownThumbsDown":99999,"triggerBubble":null,"triggerGroup":null,"persistent":false,"priority":"0","priority_name":"tpt_itau_unusual_expense_luz_priority","triggers":[],"type":"default","version":"convos_itau_app_users","validation_ids":[],"feed":null,"review_settings":null,"locations":null,"cvr_enabled":false,"cvr_formula":null,"tags":[],"same_priority":true,"notification_begin":"368","notification_states":[{"name":"368","type":"olivia","paths":[{"body":"<input id=\"CT:notification\"></input>","probability":"numerical_constant_one","probability_name":"tpt_itau_unusual_expense_luz_371","template_order":"","name":"279","alias":"n1$nyt"}]}],"notification_type":"insight","notification_priority":"0","notification_priority_name":"tpt_itau_unusual_expense_luz_notification_priority","multiple_notifications":true,"requires":[],"requires_reserved_variables":["agg"],"hash":"a1415c5654c3acda5ecd94487449a41bd44643bd","shadow":false,"etl_aggregations":[{"etl_aggregation_id":"752","etl_aggregation_name":"Bills by Category and Description","rvar_object":"bills_by_category_and_description","rvar_variable":"last_6m","rule":{"code":"    const moment = require('moment');\n\n    const start_six_months_ago = moment.utc().subtract(6, 'months').startOf('month').valueOf();\n    const end_current_month = moment.utc().endOf('month').valueOf();\n    const billsRelDesc = {};\n\n    for (const transaction of transactions) {\n        const m = transaction.date.getTime();\n        if (transaction.cashflow\n            && transaction.enabled\n            && !transaction.pending\n            && m >= start_six_months_ago\n            && m <= end_current_month\n            && [10100, 10200, 10300, 10400, 10500, 10600].includes(transaction.olivia_category_id)\n        ) {\n            // group bills per relevant description and category, summing previous and current month separately\n            const relDesc = `${transaction.olivia_category_id}${transaction.relevant_description}`;\n            billsRelDesc[relDesc] = billsRelDesc[relDesc] || [];\n            const transaction_data = {\n                amount: -transaction.amount,\n                account_id: transaction.account_id,\n                timestamp: transaction.date.getTime(),\n                formatted_date: moment(transaction.date.getTime()).format('DD/MM/YY'),\n                month: moment(transaction.date.getTime()).month(),\n                transaction_id: transaction.transaction_id,\n                description: transaction.description\n            };\n\n            billsRelDesc[relDesc].push(transaction_data);\n        }\n    }\n\n    for (const relDesc in billsRelDesc) {\n        billsRelDesc[relDesc].sort((a, b) => a.timestamp - b.timestamp);\n        let last_value = 0;\n        let last_month = -1;\n        for (const i in billsRelDesc[relDesc]) {\n            const previous_month_number = (billsRelDesc[relDesc][i].month + 11) % 12;\n            if (last_month >= 0 && last_month == previous_month_number && last_value != 0) {\n                billsRelDesc[relDesc][i].variation = (billsRelDesc[relDesc][i].amount / last_value) - 1;\n            }\n            else {\n                billsRelDesc[relDesc][i].variation = 0;\n            }\n            last_value = billsRelDesc[relDesc][i].amount;\n            last_month = billsRelDesc[relDesc][i].month;\n        };\n    }\n\n    return billsRelDesc;\n","type":"custom","filter":{"$valid_transactions":true},"description":"Aggregate bills by category and description","invert_value":true},"updated_at":"2022-06-21T17:19:05.823Z","updated_by":"bismarck.araujo@mailer.com.br"}],"requires_etls":["bills_by_category_and_description.last_6m"],"conversation_map_id":37147}},"conversation_triggers":{"name":"conversation_triggers","version":"convos_itau_app_users","trigger_index":{},"trigger_bubble_text":{}}}